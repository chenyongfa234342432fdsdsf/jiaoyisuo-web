/**
 * 
 *   Version: 0.12.3
 * 
 *   Git Hash: 1e29863397d62295db762f58beb5f2b3b9fe846b
 * 
 *   Created At: 2023/3/9 下午6:30:10
 * 
 *   Target: esm/index.js
 *   
 */

var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t){var a={exports:{}};return t(a,a.exports),a.exports}var a,o,c=/*@__PURE__*/getDefaultExportFromCjs(createCommonjsModule((function(t){t.exports=function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.__esModule=!0,t.exports.default=t.exports}))),check=function(t){return t&&t.Math==Math&&t},m=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof t&&t)||function(){return this}()||Function("return this")(),fails=function(t){try{return!!t()}catch(t){return!0}},h=!fails((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),v=Function.prototype,b=v.apply,S=v.call,M="object"==typeof Reflect&&Reflect.apply||(h?S.bind(b):function(){return S.apply(b,arguments)}),C=Function.prototype,T=C.bind,w=C.call,I=h&&T.bind(w,w),k=h?function(t){return t&&I(t)}:function(t){return t&&function(){return w.apply(t,arguments)}},isCallable=function(t){return"function"==typeof t},x=!fails((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),R=Function.prototype.call,E=h?R.bind(R):function(){return R.apply(R,arguments)},A={}.propertyIsEnumerable,q=Object.getOwnPropertyDescriptor,P={f:q&&!A.call({1:2},1)?function propertyIsEnumerable(t){var a=q(this,t);return!!a&&a.enumerable}:A},createPropertyDescriptor=function(t,a){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:a}},O=k({}.toString),U=k("".slice),classofRaw=function(t){return U(O(t),8,-1)},B=Object,L=k("".split),j=fails((function(){return!B("z").propertyIsEnumerable(0)}))?function(t){return"String"==classofRaw(t)?L(t,""):B(t)}:B,isNullOrUndefined=function(t){return null==t},N=TypeError,requireObjectCoercible=function(t){if(isNullOrUndefined(t))throw N("Can't call method on "+t);return t},toIndexedObject=function(t){return j(requireObjectCoercible(t))},D="object"==typeof document&&document.all,$=void 0===D&&void 0!==D?function(t){return"object"==typeof t?null!==t:isCallable(t)||t===D}:function(t){return"object"==typeof t?null!==t:isCallable(t)},H={},aFunction=function(t){return isCallable(t)?t:void 0},getBuiltIn=function(t,a){return arguments.length<2?aFunction(H[t])||aFunction(m[t]):H[t]&&H[t][a]||m[t]&&m[t][a]},G=k({}.isPrototypeOf),Q=getBuiltIn("navigator","userAgent")||"",W=m.process,V=m.Deno,K=W&&W.versions||V&&V.version,z=K&&K.v8;z&&(o=(a=z.split("."))[0]>0&&a[0]<4?1:+(a[0]+a[1])),!o&&Q&&(!(a=Q.match(/Edge\/(\d+)/))||a[1]>=74)&&(a=Q.match(/Chrome\/(\d+)/))&&(o=+a[1]);var J,Y=o,X=!!Object.getOwnPropertySymbols&&!fails((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Y&&Y<41})),Z=X&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ee=Object,te=Z?function(t){return"symbol"==typeof t}:function(t){var a=getBuiltIn("Symbol");return isCallable(a)&&G(a.prototype,ee(t))},re=String,tryToString=function(t){try{return re(t)}catch(t){return"Object"}},ne=TypeError,aCallable=function(t){if(isCallable(t))return t;throw ne(tryToString(t)+" is not a function")},getMethod=function(t,a){var o=t[a];return isNullOrUndefined(o)?void 0:aCallable(o)},ae=TypeError,oe=Object.defineProperty,ie=m["__core-js_shared__"]||function(t,a){try{oe(m,t,{value:a,configurable:!0,writable:!0})}catch(o){m[t]=a}return a}("__core-js_shared__",{}),se=createCommonjsModule((function(t){(t.exports=function(t,a){return ie[t]||(ie[t]=void 0!==a?a:{})})("versions",[]).push({version:"3.25.0",mode:"pure",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),ce=Object,toObject=function(t){return ce(requireObjectCoercible(t))},le=k({}.hasOwnProperty),ue=Object.hasOwn||function hasOwn(t,a){return le(toObject(t),a)},de=0,pe=Math.random(),me=k(1..toString),uid=function(t){return"Symbol("+(void 0===t?"":t)+")_"+me(++de+pe,36)},he=se("wks"),fe=m.Symbol,ge=fe&&fe.for,ye=Z?fe:fe&&fe.withoutSetter||uid,wellKnownSymbol=function(t){if(!ue(he,t)||!X&&"string"!=typeof he[t]){var a="Symbol."+t;X&&ue(fe,t)?he[t]=fe[t]:he[t]=Z&&ge?ge(a):ye(a)}return he[t]},ve=TypeError,be=wellKnownSymbol("toPrimitive"),toPrimitive=function(t,a){if(!$(t)||te(t))return t;var o,c=getMethod(t,be);if(c){if(void 0===a&&(a="default"),o=E(c,t,a),!$(o)||te(o))return o;throw ve("Can't convert object to primitive value")}return void 0===a&&(a="number"),function(t,a){var o,c;if("string"===a&&isCallable(o=t.toString)&&!$(c=E(o,t)))return c;if(isCallable(o=t.valueOf)&&!$(c=E(o,t)))return c;if("string"!==a&&isCallable(o=t.toString)&&!$(c=E(o,t)))return c;throw ae("Can't convert object to primitive value")}(t,a)},toPropertyKey=function(t){var a=toPrimitive(t,"string");return te(a)?a:a+""},Se=m.document,Me=$(Se)&&$(Se.createElement),documentCreateElement=function(t){return Me?Se.createElement(t):{}},Ce=!x&&!fails((function(){return 7!=Object.defineProperty(documentCreateElement("div"),"a",{get:function(){return 7}}).a})),Te=Object.getOwnPropertyDescriptor,_e={f:x?Te:function getOwnPropertyDescriptor(t,a){if(t=toIndexedObject(t),a=toPropertyKey(a),Ce)try{return Te(t,a)}catch(t){}if(ue(t,a))return createPropertyDescriptor(!E(P.f,t,a),t[a])}},we=/#|\.prototype\./,isForced=function(t,a){var o=ke[Ie(t)];return o==Re||o!=xe&&(isCallable(a)?fails(a):!!a)},Ie=isForced.normalize=function(t){return String(t).replace(we,".").toLowerCase()},ke=isForced.data={},xe=isForced.NATIVE="N",Re=isForced.POLYFILL="P",Ee=isForced,Ae=k(k.bind),functionBindContext=function(t,a){return aCallable(t),void 0===a?t:h?Ae(t,a):function(){return t.apply(a,arguments)}},qe=x&&fails((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Pe=String,Oe=TypeError,anObject=function(t){if($(t))return t;throw Oe(Pe(t)+" is not an object")},Ue=TypeError,Be=Object.defineProperty,Fe=Object.getOwnPropertyDescriptor,Le={f:x?qe?function defineProperty(t,a,o){if(anObject(t),a=toPropertyKey(a),anObject(o),"function"==typeof t&&"prototype"===a&&"value"in o&&"writable"in o&&!o.writable){var c=Fe(t,a);c&&c.writable&&(t[a]=o.value,o={configurable:"configurable"in o?o.configurable:c.configurable,enumerable:"enumerable"in o?o.enumerable:c.enumerable,writable:!1})}return Be(t,a,o)}:Be:function defineProperty(t,a,o){if(anObject(t),a=toPropertyKey(a),anObject(o),Ce)try{return Be(t,a,o)}catch(t){}if("get"in o||"set"in o)throw Ue("Accessors not supported");return"value"in o&&(t[a]=o.value),t}},je=x?function(t,a,o){return Le.f(t,a,createPropertyDescriptor(1,o))}:function(t,a,o){return t[a]=o,t},Ne=_e.f,wrapConstructor=function(t){var Wrapper=function(a,o,c){if(this instanceof Wrapper){switch(arguments.length){case 0:return new t;case 1:return new t(a);case 2:return new t(a,o)}return new t(a,o,c)}return M(t,this,arguments)};return Wrapper.prototype=t.prototype,Wrapper},_export=function(t,a){var o,c,h,v,b,S,M,C,T=t.target,w=t.global,I=t.stat,x=t.proto,R=w?m:I?m[T]:(m[T]||{}).prototype,E=w?H:H[T]||je(H,T,{})[T],A=E.prototype;for(h in a)o=!Ee(w?h:T+(I?".":"#")+h,t.forced)&&R&&ue(R,h),b=E[h],o&&(S=t.dontCallGetSet?(C=Ne(R,h))&&C.value:R[h]),v=o&&S?S:a[h],o&&typeof b==typeof v||(M=t.bind&&o?functionBindContext(v,m):t.wrap&&o?wrapConstructor(v):x&&isCallable(v)?k(v):v,(t.sham||v&&v.sham||b&&b.sham)&&je(M,"sham",!0),je(E,h,M),x&&(ue(H,c=T+"Prototype")||je(H,c,{}),je(H[c],h,v),t.real&&A&&!A[h]&&je(A,h,v)))},De=Math.ceil,$e=Math.floor,He=Math.trunc||function trunc(t){var a=+t;return(a>0?$e:De)(a)},toIntegerOrInfinity=function(t){var a=+t;return a!=a||0===a?0:He(a)},Ge=Math.max,Qe=Math.min,toAbsoluteIndex=function(t,a){var o=toIntegerOrInfinity(t);return o<0?Ge(o+a,0):Qe(o,a)},We=Math.min,lengthOfArrayLike=function(t){return(a=t.length)>0?We(toIntegerOrInfinity(a),9007199254740991):0;var a},createMethod$4=function(t){return function(a,o,c){var m,h=toIndexedObject(a),v=lengthOfArrayLike(h),b=toAbsoluteIndex(c,v);if(t&&o!=o){for(;v>b;)if((m=h[b++])!=m)return!0}else for(;v>b;b++)if((t||b in h)&&h[b]===o)return t||b||0;return!t&&-1}},Ve={includes:createMethod$4(!0),indexOf:createMethod$4(!1)},Ke={},ze=Ve.indexOf,Je=k([].push),objectKeysInternal=function(t,a){var o,c=toIndexedObject(t),m=0,h=[];for(o in c)!ue(Ke,o)&&ue(c,o)&&Je(h,o);for(;a.length>m;)ue(c,o=a[m++])&&(~ze(h,o)||Je(h,o));return h},Ye=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Xe=Object.keys||function keys(t){return objectKeysInternal(t,Ye)},Ze=x&&!qe?Object.defineProperties:function defineProperties(t,a){anObject(t);for(var o,c=toIndexedObject(a),m=Xe(a),h=m.length,v=0;h>v;)Le.f(t,o=m[v++],c[o]);return t},et={f:Ze},rt=getBuiltIn("document","documentElement"),nt=se("keys"),sharedKey=function(t){return nt[t]||(nt[t]=uid(t))},at=sharedKey("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(t){return"<script>"+t+"<\/script>"},NullProtoObjectViaActiveX=function(t){t.write(scriptTag("")),t.close();var a=t.parentWindow.Object;return t=null,a},NullProtoObject=function(){try{J=new ActiveXObject("htmlfile")}catch(t){}var t,a;NullProtoObject="undefined"!=typeof document?document.domain&&J?NullProtoObjectViaActiveX(J):((a=documentCreateElement("iframe")).style.display="none",rt.appendChild(a),a.src=String("javascript:"),(t=a.contentWindow.document).open(),t.write(scriptTag("document.F=Object")),t.close(),t.F):NullProtoObjectViaActiveX(J);for(var o=Ye.length;o--;)delete NullProtoObject.prototype[Ye[o]];return NullProtoObject()};Ke[at]=!0;var ot=Object.create||function create(t,a){var o;return null!==t?(EmptyConstructor.prototype=anObject(t),o=new EmptyConstructor,EmptyConstructor.prototype=null,o[at]=t):o=NullProtoObject(),void 0===a?o:et.f(o,a)};_export({target:"Object",stat:!0,sham:!x},{create:ot});var it=H.Object,st=function create(t,a){return it.create(t,a)},ct=String,lt=TypeError,ut=Object.setPrototypeOf||("__proto__"in{}?function(){var t,a=!1,o={};try{(t=k(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(o,[]),a=o instanceof Array}catch(t){}return function setPrototypeOf(o,c){return anObject(o),function(t){if("object"==typeof t||isCallable(t))return t;throw lt("Can't set "+ct(t)+" as a prototype")}(c),a?t(o,c):o.__proto__=c,o}}():void 0);_export({target:"Object",stat:!0},{setPrototypeOf:ut});var dt=H.Object.setPrototypeOf,pt=k([].slice),mt=Function,ht=k([].concat),ft=k([].join),gt={},construct$8=function(t,a,o){if(!ue(gt,a)){for(var c=[],m=0;m<a;m++)c[m]="a["+m+"]";gt[a]=mt("C,a","return new C("+ft(c,",")+")")}return gt[a](t,o)},yt=h?mt.bind:function bind(t){var a=aCallable(this),o=a.prototype,c=pt(arguments,1),m=function bound(){var o=ht(c,pt(arguments));return this instanceof m?construct$8(a,o.length,o):a.apply(t,o)};return $(o)&&(m.prototype=o),m};_export({target:"Function",proto:!0,forced:Function.bind!==yt},{bind:yt});var entryVirtual=function(t){return H[t+"Prototype"]},vt=entryVirtual("Function").bind,bt=Function.prototype,bind$1=function(t){var a=t.bind;return t===bt||G(bt,t)&&a===bt.bind?vt:a},St=createCommonjsModule((function(t){function _setPrototypeOf(a,o){var c;return t.exports=_setPrototypeOf=dt?bind$1(c=dt).call(c):function _setPrototypeOf(t,a){return t.__proto__=a,t},t.exports.__esModule=!0,t.exports.default=t.exports,_setPrototypeOf(a,o)}t.exports=_setPrototypeOf,t.exports.__esModule=!0,t.exports.default=t.exports})),Mt=/*@__PURE__*/getDefaultExportFromCjs(createCommonjsModule((function(t){t.exports=function _inheritsLoose(t,a){t.prototype=st(a.prototype),t.prototype.constructor=t,St(t,a)},t.exports.__esModule=!0,t.exports.default=t.exports}))),Ct=Array.isArray||function isArray(t){return"Array"==classofRaw(t)},Tt=TypeError,doesNotExceedSafeInteger=function(t){if(t>9007199254740991)throw Tt("Maximum allowed index exceeded");return t},createProperty=function(t,a,o){var c=toPropertyKey(a);c in t?Le.f(t,c,createPropertyDescriptor(0,o)):t[c]=o},_t={};_t[wellKnownSymbol("toStringTag")]="z";var wt="[object z]"===String(_t),It=wellKnownSymbol("toStringTag"),kt=Object,xt="Arguments"==classofRaw(function(){return arguments}()),Rt=wt?classofRaw:function(t){var a,o,c;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(o=function(t,a){try{return t[a]}catch(t){}}(a=kt(t),It))?o:xt?classofRaw(a):"Object"==(c=classofRaw(a))&&isCallable(a.callee)?"Arguments":c},Et=k(Function.toString);isCallable(ie.inspectSource)||(ie.inspectSource=function(t){return Et(t)});var At=ie.inspectSource,noop$1=function(){},qt=[],Pt=getBuiltIn("Reflect","construct"),Ot=/^\s*(?:class|function)\b/,Ut=k(Ot.exec),Bt=!Ot.exec(noop$1),Ft=function isConstructor(t){if(!isCallable(t))return!1;try{return Pt(noop$1,qt,t),!0}catch(t){return!1}},Lt=function isConstructor(t){if(!isCallable(t))return!1;switch(Rt(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Bt||!!Ut(Ot,At(t))}catch(t){return!0}};Lt.sham=!0;var jt=!Pt||fails((function(){var t;return Ft(Ft.call)||!Ft(Object)||!Ft((function(){t=!0}))||t}))?Lt:Ft,Nt=wellKnownSymbol("species"),Dt=Array,arraySpeciesCreate=function(t,a){return new(function(t){var a;return Ct(t)&&(a=t.constructor,(jt(a)&&(a===Dt||Ct(a.prototype))||$(a)&&null===(a=a[Nt]))&&(a=void 0)),void 0===a?Dt:a}(t))(0===a?0:a)},$t=wellKnownSymbol("species"),arrayMethodHasSpeciesSupport=function(t){return Y>=51||!fails((function(){var a=[];return(a.constructor={})[$t]=function(){return{foo:1}},1!==a[t](Boolean).foo}))},Ht=wellKnownSymbol("isConcatSpreadable"),Gt=Y>=51||!fails((function(){var t=[];return t[Ht]=!1,t.concat()[0]!==t})),Qt=arrayMethodHasSpeciesSupport("concat"),isConcatSpreadable=function(t){if(!$(t))return!1;var a=t[Ht];return void 0!==a?!!a:Ct(t)};_export({target:"Array",proto:!0,arity:1,forced:!Gt||!Qt},{concat:function concat(t){var a,o,c,m,h,v=toObject(this),b=arraySpeciesCreate(v,0),S=0;for(a=-1,c=arguments.length;a<c;a++)if(isConcatSpreadable(h=-1===a?v:arguments[a]))for(m=lengthOfArrayLike(h),doesNotExceedSafeInteger(S+m),o=0;o<m;o++,S++)o in h&&createProperty(b,S,h[o]);else doesNotExceedSafeInteger(S+1),createProperty(b,S++,h);return b.length=S,b}});var Wt,Vt,Kt,zt=String,toString$1=function(t){if("Symbol"===Rt(t))throw TypeError("Cannot convert a Symbol value to a string");return zt(t)},Jt=Ye.concat("length","prototype"),Yt={f:Object.getOwnPropertyNames||function getOwnPropertyNames(t){return objectKeysInternal(t,Jt)}},Xt=Array,Zt=Math.max,arraySliceSimple=function(t,a,o){for(var c=lengthOfArrayLike(t),m=toAbsoluteIndex(a,c),h=toAbsoluteIndex(void 0===o?c:o,c),v=Xt(Zt(h-m,0)),b=0;m<h;m++,b++)createProperty(v,b,t[m]);return v.length=b,v},er=Yt.f,tr="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],rr={f:function getOwnPropertyNames(t){return tr&&"Window"==classofRaw(t)?function(t){try{return er(t)}catch(t){return arraySliceSimple(tr)}}(t):er(toIndexedObject(t))}},nr={f:Object.getOwnPropertySymbols},defineBuiltIn=function(t,a,o,c){return c&&c.enumerable?t[a]=o:je(t,a,o),t},ar={f:wellKnownSymbol},or=Le.f,wellKnownSymbolDefine=function(t){var a=H.Symbol||(H.Symbol={});ue(a,t)||or(a,t,{value:ar.f(t)})},symbolDefineToPrimitive=function(){var t=getBuiltIn("Symbol"),a=t&&t.prototype,o=a&&a.valueOf,c=wellKnownSymbol("toPrimitive");a&&!a[c]&&defineBuiltIn(a,c,(function(t){return E(o,this)}),{arity:1})},ir=wt?{}.toString:function toString(){return"[object "+Rt(this)+"]"},sr=Le.f,cr=wellKnownSymbol("toStringTag"),setToStringTag=function(t,a,o,c){if(t){var m=o?t:t.prototype;ue(m,cr)||sr(m,cr,{configurable:!0,value:a}),c&&!wt&&je(m,"toString",ir)}},lr=m.WeakMap,ur=isCallable(lr)&&/native code/.test(String(lr)),dr=m.TypeError,pr=m.WeakMap;if(ur||ie.state){var mr=ie.state||(ie.state=new pr),hr=k(mr.get),fr=k(mr.has),gr=k(mr.set);Wt=function(t,a){if(fr(mr,t))throw dr("Object already initialized");return a.facade=t,gr(mr,t,a),a},Vt=function(t){return hr(mr,t)||{}},Kt=function(t){return fr(mr,t)}}else{var yr=sharedKey("state");Ke[yr]=!0,Wt=function(t,a){if(ue(t,yr))throw dr("Object already initialized");return a.facade=t,je(t,yr,a),a},Vt=function(t){return ue(t,yr)?t[yr]:{}},Kt=function(t){return ue(t,yr)}}var vr={set:Wt,get:Vt,has:Kt,enforce:function(t){return Kt(t)?Vt(t):Wt(t,{})},getterFor:function(t){return function(a){var o;if(!$(a)||(o=Vt(a)).type!==t)throw dr("Incompatible receiver, "+t+" required");return o}}},br=k([].push),createMethod$3=function(t){var a=1==t,o=2==t,c=3==t,m=4==t,h=6==t,v=7==t,b=5==t||h;return function(S,M,C,T){for(var w,I,k=toObject(S),x=j(k),R=functionBindContext(M,C),E=lengthOfArrayLike(x),A=0,q=T||arraySpeciesCreate,P=a?q(S,E):o||v?q(S,0):void 0;E>A;A++)if((b||A in x)&&(I=R(w=x[A],A,k),t))if(a)P[A]=I;else if(I)switch(t){case 3:return!0;case 5:return w;case 6:return A;case 2:br(P,w)}else switch(t){case 4:return!1;case 7:br(P,w)}return h?-1:c||m?m:P}},Sr={forEach:createMethod$3(0),map:createMethod$3(1),filter:createMethod$3(2),some:createMethod$3(3),every:createMethod$3(4),find:createMethod$3(5),findIndex:createMethod$3(6),filterReject:createMethod$3(7)},Mr=Sr.forEach,Cr=sharedKey("hidden"),Tr=vr.set,_r=vr.getterFor("Symbol"),wr=Object.prototype,Ir=m.Symbol,kr=Ir&&Ir.prototype,xr=m.TypeError,Rr=m.QObject,Er=_e.f,Ar=Le.f,qr=rr.f,Pr=P.f,Or=k([].push),Ur=se("symbols"),Br=se("op-symbols"),Fr=se("wks"),Lr=!Rr||!Rr.prototype||!Rr.prototype.findChild,jr=x&&fails((function(){return 7!=ot(Ar({},"a",{get:function(){return Ar(this,"a",{value:7}).a}})).a}))?function(t,a,o){var c=Er(wr,a);c&&delete wr[a],Ar(t,a,o),c&&t!==wr&&Ar(wr,a,c)}:Ar,wrap$1=function(t,a){var o=Ur[t]=ot(kr);return Tr(o,{type:"Symbol",tag:t,description:a}),x||(o.description=a),o},Nr=function defineProperty(t,a,o){t===wr&&Nr(Br,a,o),anObject(t);var c=toPropertyKey(a);return anObject(o),ue(Ur,c)?(o.enumerable?(ue(t,Cr)&&t[Cr][c]&&(t[Cr][c]=!1),o=ot(o,{enumerable:createPropertyDescriptor(0,!1)})):(ue(t,Cr)||Ar(t,Cr,createPropertyDescriptor(1,{})),t[Cr][c]=!0),jr(t,c,o)):Ar(t,c,o)},Dr=function defineProperties(t,a){anObject(t);var o=toIndexedObject(a),c=Xe(o).concat($getOwnPropertySymbols(o));return Mr(c,(function(a){x&&!E($r,o,a)||Nr(t,a,o[a])})),t},$r=function propertyIsEnumerable(t){var a=toPropertyKey(t),o=E(Pr,this,a);return!(this===wr&&ue(Ur,a)&&!ue(Br,a))&&(!(o||!ue(this,a)||!ue(Ur,a)||ue(this,Cr)&&this[Cr][a])||o)},Hr=function getOwnPropertyDescriptor(t,a){var o=toIndexedObject(t),c=toPropertyKey(a);if(o!==wr||!ue(Ur,c)||ue(Br,c)){var m=Er(o,c);return!m||!ue(Ur,c)||ue(o,Cr)&&o[Cr][c]||(m.enumerable=!0),m}},Gr=function getOwnPropertyNames(t){var a=qr(toIndexedObject(t)),o=[];return Mr(a,(function(t){ue(Ur,t)||ue(Ke,t)||Or(o,t)})),o},$getOwnPropertySymbols=function(t){var a=t===wr,o=qr(a?Br:toIndexedObject(t)),c=[];return Mr(o,(function(t){!ue(Ur,t)||a&&!ue(wr,t)||Or(c,Ur[t])})),c};X||(kr=(Ir=function Symbol(){if(G(kr,this))throw xr("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?toString$1(arguments[0]):void 0,a=uid(t),setter=function(t){this===wr&&E(setter,Br,t),ue(this,Cr)&&ue(this[Cr],a)&&(this[Cr][a]=!1),jr(this,a,createPropertyDescriptor(1,t))};return x&&Lr&&jr(wr,a,{configurable:!0,set:setter}),wrap$1(a,t)}).prototype,defineBuiltIn(kr,"toString",(function toString(){return _r(this).tag})),defineBuiltIn(Ir,"withoutSetter",(function(t){return wrap$1(uid(t),t)})),P.f=$r,Le.f=Nr,et.f=Dr,_e.f=Hr,Yt.f=rr.f=Gr,nr.f=$getOwnPropertySymbols,ar.f=function(t){return wrap$1(wellKnownSymbol(t),t)},x&&Ar(kr,"description",{configurable:!0,get:function description(){return _r(this).description}})),_export({global:!0,constructor:!0,wrap:!0,forced:!X,sham:!X},{Symbol:Ir}),Mr(Xe(Fr),(function(t){wellKnownSymbolDefine(t)})),_export({target:"Symbol",stat:!0,forced:!X},{useSetter:function(){Lr=!0},useSimple:function(){Lr=!1}}),_export({target:"Object",stat:!0,forced:!X,sham:!x},{create:function create(t,a){return void 0===a?ot(t):Dr(ot(t),a)},defineProperty:Nr,defineProperties:Dr,getOwnPropertyDescriptor:Hr}),_export({target:"Object",stat:!0,forced:!X},{getOwnPropertyNames:Gr}),symbolDefineToPrimitive(),setToStringTag(Ir,"Symbol"),Ke[Cr]=!0;var Qr=X&&!!Symbol.for&&!!Symbol.keyFor,Wr=se("string-to-symbol-registry"),Vr=se("symbol-to-string-registry");_export({target:"Symbol",stat:!0,forced:!Qr},{for:function(t){var a=toString$1(t);if(ue(Wr,a))return Wr[a];var o=getBuiltIn("Symbol")(a);return Wr[a]=o,Vr[o]=a,o}});var Kr=se("symbol-to-string-registry");_export({target:"Symbol",stat:!0,forced:!Qr},{keyFor:function keyFor(t){if(!te(t))throw TypeError(tryToString(t)+" is not a symbol");if(ue(Kr,t))return Kr[t]}});var zr=getBuiltIn("JSON","stringify"),Jr=k(/./.exec),Yr=k("".charAt),Xr=k("".charCodeAt),Zr=k("".replace),en=k(1..toString),tn=/[\uD800-\uDFFF]/g,rn=/^[\uD800-\uDBFF]$/,nn=/^[\uDC00-\uDFFF]$/,an=!X||fails((function(){var t=getBuiltIn("Symbol")();return"[null]"!=zr([t])||"{}"!=zr({a:t})||"{}"!=zr(Object(t))})),sn=fails((function(){return'"\\udf06\\ud834"'!==zr("\udf06\ud834")||'"\\udead"'!==zr("\udead")})),stringifyWithSymbolsFix=function(t,a){var o=pt(arguments),c=a;if(($(a)||void 0!==t)&&!te(t))return Ct(a)||(a=function(t,a){if(isCallable(c)&&(a=E(c,this,t,a)),!te(a))return a}),o[1]=a,M(zr,null,o)},fixIllFormed=function(t,a,o){var c=Yr(o,a-1),m=Yr(o,a+1);return Jr(rn,t)&&!Jr(nn,m)||Jr(nn,t)&&!Jr(rn,c)?"\\u"+en(Xr(t,0),16):t};zr&&_export({target:"JSON",stat:!0,arity:3,forced:an||sn},{stringify:function stringify(t,a,o){var c=pt(arguments),m=M(an?stringifyWithSymbolsFix:zr,null,c);return sn&&"string"==typeof m?Zr(m,tn,fixIllFormed):m}});var cn=!X||fails((function(){nr.f(1)}));_export({target:"Object",stat:!0,forced:cn},{getOwnPropertySymbols:function getOwnPropertySymbols(t){var a=nr.f;return a?a(toObject(t)):[]}}),wellKnownSymbolDefine("asyncIterator"),wellKnownSymbolDefine("hasInstance"),wellKnownSymbolDefine("isConcatSpreadable"),wellKnownSymbolDefine("iterator"),wellKnownSymbolDefine("match"),wellKnownSymbolDefine("matchAll"),wellKnownSymbolDefine("replace"),wellKnownSymbolDefine("search"),wellKnownSymbolDefine("species"),wellKnownSymbolDefine("split"),wellKnownSymbolDefine("toPrimitive"),symbolDefineToPrimitive(),wellKnownSymbolDefine("toStringTag"),setToStringTag(getBuiltIn("Symbol"),"Symbol"),wellKnownSymbolDefine("unscopables"),setToStringTag(m.JSON,"JSON",!0);var ln,un,dn,pn=H.Symbol,mn={},hn=Function.prototype,fn=x&&Object.getOwnPropertyDescriptor,gn=ue(hn,"name"),yn={EXISTS:gn,PROPER:gn&&"something"===function something(){}.name,CONFIGURABLE:gn&&(!x||x&&fn(hn,"name").configurable)},vn=!fails((function(){function F(){}return F.prototype.constructor=null,Object.getPrototypeOf(new F)!==F.prototype})),bn=sharedKey("IE_PROTO"),Sn=Object,Mn=Sn.prototype,Cn=vn?Sn.getPrototypeOf:function(t){var a=toObject(t);if(ue(a,bn))return a[bn];var o=a.constructor;return isCallable(o)&&a instanceof o?o.prototype:a instanceof Sn?Mn:null},Tn=wellKnownSymbol("iterator"),_n=!1;[].keys&&("next"in(dn=[].keys())?(un=Cn(Cn(dn)))!==Object.prototype&&(ln=un):_n=!0);var wn=!$(ln)||fails((function(){var t={};return ln[Tn].call(t)!==t}));ln=wn?{}:ot(ln),isCallable(ln[Tn])||defineBuiltIn(ln,Tn,(function(){return this}));var In={IteratorPrototype:ln,BUGGY_SAFARI_ITERATORS:_n},kn=In.IteratorPrototype,returnThis$1=function(){return this},xn=yn.PROPER,Rn=In.BUGGY_SAFARI_ITERATORS,En=wellKnownSymbol("iterator"),returnThis=function(){return this},iteratorDefine=function(t,a,o,c,m,h,v){!function(t,a,o,c){var m=a+" Iterator";t.prototype=ot(kn,{next:createPropertyDescriptor(+!c,o)}),setToStringTag(t,m,!1,!0),mn[m]=returnThis$1}(o,a,c);var b,S,M,getIterationMethod=function(t){if(t===m&&k)return k;if(!Rn&&t in w)return w[t];switch(t){case"keys":return function keys(){return new o(this,t)};case"values":return function values(){return new o(this,t)};case"entries":return function entries(){return new o(this,t)}}return function(){return new o(this)}},C=a+" Iterator",T=!1,w=t.prototype,I=w[En]||w["@@iterator"]||m&&w[m],k=!Rn&&I||getIterationMethod(m),x="Array"==a&&w.entries||I;if(x&&(b=Cn(x.call(new t)))!==Object.prototype&&b.next&&(setToStringTag(b,C,!0,!0),mn[C]=returnThis),xn&&"values"==m&&I&&"values"!==I.name&&(T=!0,k=function values(){return E(I,this)}),m)if(S={values:getIterationMethod("values"),keys:h?k:getIterationMethod("keys"),entries:getIterationMethod("entries")},v)for(M in S)(Rn||T||!(M in w))&&defineBuiltIn(w,M,S[M]);else _export({target:a,proto:!0,forced:Rn||T},S);return v&&w[En]!==k&&defineBuiltIn(w,En,k,{name:m}),mn[a]=k,S};Le.f;var An=vr.set,qn=vr.getterFor("Array Iterator");iteratorDefine(Array,"Array",(function(t,a){An(this,{type:"Array Iterator",target:toIndexedObject(t),index:0,kind:a})}),(function(){var t=qn(this),a=t.target,o=t.kind,c=t.index++;return!a||c>=a.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==o?{value:c,done:!1}:"values"==o?{value:a[c],done:!1}:{value:[c,a[c]],done:!1}}),"values"),mn.Arguments=mn.Array;var Pn=wellKnownSymbol("toStringTag");for(var On in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var Un=m[On],Bn=Un&&Un.prototype;Bn&&Rt(Bn)!==Pn&&je(Bn,Pn,On),mn[On]=mn.Array}var Fn=pn;wellKnownSymbolDefine("asyncDispose"),wellKnownSymbolDefine("dispose"),wellKnownSymbolDefine("matcher"),wellKnownSymbolDefine("metadataKey"),wellKnownSymbolDefine("observable"),wellKnownSymbolDefine("metadata"),wellKnownSymbolDefine("patternMatch"),wellKnownSymbolDefine("replaceAll");var Ln=Fn,jn=k("".charAt),Nn=k("".charCodeAt),Dn=k("".slice),createMethod$2=function(t){return function(a,o){var c,m,h=toString$1(requireObjectCoercible(a)),v=toIntegerOrInfinity(o),b=h.length;return v<0||v>=b?t?"":void 0:(c=Nn(h,v))<55296||c>56319||v+1===b||(m=Nn(h,v+1))<56320||m>57343?t?jn(h,v):c:t?Dn(h,v,v+2):m-56320+(c-55296<<10)+65536}},$n={codeAt:createMethod$2(!1),charAt:createMethod$2(!0)}.charAt,Hn=vr.set,Gn=vr.getterFor("String Iterator");iteratorDefine(String,"String",(function(t){Hn(this,{type:"String Iterator",string:toString$1(t),index:0})}),(function next(){var t,a=Gn(this),o=a.string,c=a.index;return c>=o.length?{value:void 0,done:!0}:(t=$n(o,c),a.index+=t.length,{value:t,done:!1})}));var Qn=ar.f("iterator"),Wn=createCommonjsModule((function(t){function _typeof(a){return t.exports=_typeof="function"==typeof Ln&&"symbol"==typeof Qn?function(t){return typeof t}:function(t){return t&&"function"==typeof Ln&&t.constructor===Ln&&t!==Ln.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,_typeof(a)}t.exports=_typeof,t.exports.__esModule=!0,t.exports.default=t.exports})),Vn=Le.f;_export({target:"Object",stat:!0,forced:Object.defineProperty!==Vn,sham:!x},{defineProperty:Vn});var Kn=createCommonjsModule((function(t){var a=H.Object,o=t.exports=function defineProperty(t,o,c){return a.defineProperty(t,o,c)};a.defineProperty.sham&&(o.sham=!0)})),zn=Kn,Jn=fails((function(){Cn(1)}));_export({target:"Object",stat:!0,forced:Jn,sham:!vn},{getPrototypeOf:function getPrototypeOf(t){return Cn(toObject(t))}});var Yn=H.Object.getPrototypeOf,arrayMethodIsStrict=function(t,a){var o=[][t];return!!o&&fails((function(){o.call(null,a||function(){return 1},1)}))},Xn=Sr.forEach,Zn=arrayMethodIsStrict("forEach")?[].forEach:function forEach(t){return Xn(this,t,arguments.length>1?arguments[1]:void 0)};_export({target:"Array",proto:!0,forced:[].forEach!=Zn},{forEach:Zn});var ea=entryVirtual("Array").forEach,ta=Array.prototype,ra={DOMTokenList:!0,NodeList:!0},forEach$1=function(t){var a=t.forEach;return t===ta||G(ta,t)&&a===ta.forEach||ue(ra,Rt(t))?ea:a},na=k([].concat),aa=getBuiltIn("Reflect","ownKeys")||function ownKeys(t){var a=Yt.f(anObject(t)),o=nr.f;return o?na(a,o(t)):a},oa=Error,ia=k("".replace),sa=String(oa("zxcasd").stack),ca=/\n\s*at [^:]*:[^\n]*/,la=ca.test(sa),errorStackClear=function(t,a){if(la&&"string"==typeof t&&!oa.prepareStackTrace)for(;a--;)t=ia(t,ca,"");return t},installErrorCause=function(t,a){$(a)&&"cause"in a&&je(t,"cause",a.cause)},ua=wellKnownSymbol("iterator"),da=Array.prototype,isArrayIteratorMethod=function(t){return void 0!==t&&(mn.Array===t||da[ua]===t)},pa=wellKnownSymbol("iterator"),getIteratorMethod$5=function(t){if(!isNullOrUndefined(t))return getMethod(t,pa)||getMethod(t,"@@iterator")||mn[Rt(t)]},ma=TypeError,getIterator=function(t,a){var o=arguments.length<2?getIteratorMethod$5(t):a;if(aCallable(o))return anObject(E(o,t));throw ma(tryToString(t)+" is not iterable")},iteratorClose=function(t,a,o){var c,m;anObject(t);try{if(!(c=getMethod(t,"return"))){if("throw"===a)throw o;return o}c=E(c,t)}catch(t){m=!0,c=t}if("throw"===a)throw o;if(m)throw c;return anObject(c),o},ha=TypeError,Result=function(t,a){this.stopped=t,this.result=a},fa=Result.prototype,iterate=function(t,a,o){var c,m,h,v,b,S,M,C=o&&o.that,T=!(!o||!o.AS_ENTRIES),w=!(!o||!o.IS_RECORD),I=!(!o||!o.IS_ITERATOR),k=!(!o||!o.INTERRUPTED),x=functionBindContext(a,C),stop=function(t){return c&&iteratorClose(c,"normal",t),new Result(!0,t)},callFn=function(t){return T?(anObject(t),k?x(t[0],t[1],stop):x(t[0],t[1])):k?x(t,stop):x(t)};if(w)c=t.iterator;else if(I)c=t;else{if(!(m=getIteratorMethod$5(t)))throw ha(tryToString(t)+" is not iterable");if(isArrayIteratorMethod(m)){for(h=0,v=lengthOfArrayLike(t);v>h;h++)if((b=callFn(t[h]))&&G(fa,b))return b;return new Result(!1)}c=getIterator(t,m)}for(S=w?t.next:c.next;!(M=E(S,c)).done;){try{b=callFn(M.value)}catch(t){iteratorClose(c,"throw",t)}if("object"==typeof b&&b&&G(fa,b))return b}return new Result(!1)},normalizeStringArgument=function(t,a){return void 0===t?arguments.length<2?"":a:toString$1(t)},ga=!fails((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",createPropertyDescriptor(1,7)),7!==t.stack)})),ya=wellKnownSymbol("toStringTag"),va=Error,ba=[].push,Sa=function AggregateError(t,a){var o,c=arguments.length>2?arguments[2]:void 0,m=G(Ma,this);ut?o=ut(va(),m?Cn(this):Ma):(o=m?this:ot(Ma),je(o,ya,"Error")),void 0!==a&&je(o,"message",normalizeStringArgument(a)),ga&&je(o,"stack",errorStackClear(o.stack,1)),installErrorCause(o,c);var h=[];return iterate(t,ba,{that:h}),je(o,"errors",h),o};ut?ut(Sa,va):function(t,a,o){for(var c=aa(a),m=Le.f,h=_e.f,v=0;v<c.length;v++){var b=c[v];ue(t,b)||o&&ue(o,b)||m(t,b,h(a,b))}}(Sa,va,{name:!0});var Ma=Sa.prototype=ot(va.prototype,{constructor:createPropertyDescriptor(1,Sa),message:createPropertyDescriptor(1,""),name:createPropertyDescriptor(1,"AggregateError")});_export({global:!0,constructor:!0,arity:2},{AggregateError:Sa});var Ca,Ta,_a,wa,Ia="process"==classofRaw(m.process),ka=wellKnownSymbol("species"),setSpecies=function(t){var a=getBuiltIn(t),o=Le.f;x&&a&&!a[ka]&&o(a,ka,{configurable:!0,get:function(){return this}})},xa=TypeError,anInstance=function(t,a){if(G(a,t))return t;throw xa("Incorrect invocation")},Ra=TypeError,aConstructor=function(t){if(jt(t))return t;throw Ra(tryToString(t)+" is not a constructor")},Ea=wellKnownSymbol("species"),speciesConstructor=function(t,a){var o,c=anObject(t).constructor;return void 0===c||isNullOrUndefined(o=anObject(c)[Ea])?a:aConstructor(o)},Aa=TypeError,validateArgumentsLength=function(t,a){if(t<a)throw Aa("Not enough arguments");return t},qa=/(?:ipad|iphone|ipod).*applewebkit/i.test(Q),Pa=m.setImmediate,Oa=m.clearImmediate,Ua=m.process,Ba=m.Dispatch,Fa=m.Function,La=m.MessageChannel,ja=m.String,Na=0,Da={};try{Ca=m.location}catch(t){}var run=function(t){if(ue(Da,t)){var a=Da[t];delete Da[t],a()}},runner=function(t){return function(){run(t)}},listener=function(t){run(t.data)},post=function(t){m.postMessage(ja(t),Ca.protocol+"//"+Ca.host)};Pa&&Oa||(Pa=function setImmediate(t){validateArgumentsLength(arguments.length,1);var a=isCallable(t)?t:Fa(t),o=pt(arguments,1);return Da[++Na]=function(){M(a,void 0,o)},Ta(Na),Na},Oa=function clearImmediate(t){delete Da[t]},Ia?Ta=function(t){Ua.nextTick(runner(t))}:Ba&&Ba.now?Ta=function(t){Ba.now(runner(t))}:La&&!qa?(wa=(_a=new La).port2,_a.port1.onmessage=listener,Ta=functionBindContext(wa.postMessage,wa)):m.addEventListener&&isCallable(m.postMessage)&&!m.importScripts&&Ca&&"file:"!==Ca.protocol&&!fails(post)?(Ta=post,m.addEventListener("message",listener,!1)):Ta="onreadystatechange"in documentCreateElement("script")?function(t){rt.appendChild(documentCreateElement("script")).onreadystatechange=function(){rt.removeChild(this),run(t)}}:function(t){setTimeout(runner(t),0)});var $a,Ha,Ga,Qa,Wa,Va,Ka,za,Ja={set:Pa,clear:Oa},Ya=/ipad|iphone|ipod/i.test(Q)&&void 0!==m.Pebble,Xa=/web0s(?!.*chrome)/i.test(Q),Za=_e.f,eo=Ja.set,to=m.MutationObserver||m.WebKitMutationObserver,ro=m.document,no=m.process,ao=m.Promise,oo=Za(m,"queueMicrotask"),io=oo&&oo.value;io||($a=function(){var t,a;for(Ia&&(t=no.domain)&&t.exit();Ha;){a=Ha.fn,Ha=Ha.next;try{a()}catch(t){throw Ha?Qa():Ga=void 0,t}}Ga=void 0,t&&t.enter()},qa||Ia||Xa||!to||!ro?!Ya&&ao&&ao.resolve?((Ka=ao.resolve(void 0)).constructor=ao,za=functionBindContext(Ka.then,Ka),Qa=function(){za($a)}):Ia?Qa=function(){no.nextTick($a)}:(eo=functionBindContext(eo,m),Qa=function(){eo($a)}):(Wa=!0,Va=ro.createTextNode(""),new to($a).observe(Va,{characterData:!0}),Qa=function(){Va.data=Wa=!Wa}));var so=io||function(t){var a={fn:t,next:void 0};Ga&&(Ga.next=a),Ha||(Ha=a,Qa()),Ga=a},perform=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Queue=function(){this.head=null,this.tail=null};Queue.prototype={add:function(t){var a={item:t,next:null};this.head?this.tail.next=a:this.head=a,this.tail=a},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var co,lo,uo=Queue,po=m.Promise,mo="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,ho=!mo&&!Ia&&"object"==typeof window&&"object"==typeof document,fo=po&&po.prototype,go=wellKnownSymbol("species"),yo=!1,vo=isCallable(m.PromiseRejectionEvent),bo=Ee("Promise",(function(){var t=At(po),a=t!==String(po);if(!a&&66===Y)return!0;if(!fo.catch||!fo.finally)return!0;if(!Y||Y<51||!/native code/.test(t)){var o=new po((function(t){t(1)})),FakePromise=function(t){t((function(){}),(function(){}))};if((o.constructor={})[go]=FakePromise,!(yo=o.then((function(){}))instanceof FakePromise))return!0}return!a&&(ho||mo)&&!vo})),So={CONSTRUCTOR:bo,REJECTION_EVENT:vo,SUBCLASSING:yo},Mo=TypeError,PromiseCapability=function(t){var a,o;this.promise=new t((function(t,c){if(void 0!==a||void 0!==o)throw Mo("Bad Promise constructor");a=t,o=c})),this.resolve=aCallable(a),this.reject=aCallable(o)},Co={f:function(t){return new PromiseCapability(t)}},To=Ja.set,_o=So.CONSTRUCTOR,wo=So.REJECTION_EVENT,Io=vr.getterFor("Promise"),ko=vr.set,xo=po&&po.prototype,Ro=po,Eo=xo,Ao=m.TypeError,qo=m.document,Po=m.process,Oo=Co.f,Uo=Oo,Bo=!!(qo&&qo.createEvent&&m.dispatchEvent),isThenable=function(t){var a;return!(!$(t)||!isCallable(a=t.then))&&a},callReaction=function(t,a){var o,c,m,h=a.value,v=1==a.state,b=v?t.ok:t.fail,S=t.resolve,M=t.reject,C=t.domain;try{b?(v||(2===a.rejection&&onHandleUnhandled(a),a.rejection=1),!0===b?o=h:(C&&C.enter(),o=b(h),C&&(C.exit(),m=!0)),o===t.promise?M(Ao("Promise-chain cycle")):(c=isThenable(o))?E(c,o,S,M):S(o)):M(h)}catch(t){C&&!m&&C.exit(),M(t)}},notify=function(t,a){t.notified||(t.notified=!0,so((function(){for(var o,c=t.reactions;o=c.get();)callReaction(o,t);t.notified=!1,a&&!t.rejection&&onUnhandled(t)})))},dispatchEvent=function(t,a,o){var c,h;Bo?((c=qo.createEvent("Event")).promise=a,c.reason=o,c.initEvent(t,!1,!0),m.dispatchEvent(c)):c={promise:a,reason:o},!wo&&(h=m["on"+t])?h(c):"unhandledrejection"===t&&function(t,a){var o=m.console;o&&o.error&&(1==arguments.length?o.error(t):o.error(t,a))}("Unhandled promise rejection",o)},onUnhandled=function(t){E(To,m,(function(){var a,o=t.facade,c=t.value;if(isUnhandled(t)&&(a=perform((function(){Ia?Po.emit("unhandledRejection",c,o):dispatchEvent("unhandledrejection",o,c)})),t.rejection=Ia||isUnhandled(t)?2:1,a.error))throw a.value}))},isUnhandled=function(t){return 1!==t.rejection&&!t.parent},onHandleUnhandled=function(t){E(To,m,(function(){var a=t.facade;Ia?Po.emit("rejectionHandled",a):dispatchEvent("rejectionhandled",a,t.value)}))},bind=function(t,a,o){return function(c){t(a,c,o)}},internalReject=function(t,a,o){t.done||(t.done=!0,o&&(t=o),t.value=a,t.state=2,notify(t,!0))},internalResolve=function(t,a,o){if(!t.done){t.done=!0,o&&(t=o);try{if(t.facade===a)throw Ao("Promise can't be resolved itself");var c=isThenable(a);c?so((function(){var o={done:!1};try{E(c,a,bind(internalResolve,o,t),bind(internalReject,o,t))}catch(a){internalReject(o,a,t)}})):(t.value=a,t.state=1,notify(t,!1))}catch(a){internalReject({done:!1},a,t)}}};_o&&(Eo=(Ro=function Promise(t){anInstance(this,Eo),aCallable(t),E(co,this);var a=Io(this);try{t(bind(internalResolve,a),bind(internalReject,a))}catch(t){internalReject(a,t)}}).prototype,(co=function Promise(t){ko(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new uo,rejection:!1,state:0,value:void 0})}).prototype=defineBuiltIn(Eo,"then",(function then(t,a){var o=Io(this),c=Oo(speciesConstructor(this,Ro));return o.parent=!0,c.ok=!isCallable(t)||t,c.fail=isCallable(a)&&a,c.domain=Ia?Po.domain:void 0,0==o.state?o.reactions.add(c):so((function(){callReaction(c,o)})),c.promise})),lo=function(){var t=new co,a=Io(t);this.promise=t,this.resolve=bind(internalResolve,a),this.reject=bind(internalReject,a)},Co.f=Oo=function(t){return t===Ro||undefined===t?new lo(t):Uo(t)}),_export({global:!0,constructor:!0,wrap:!0,forced:_o},{Promise:Ro}),setToStringTag(Ro,"Promise",!1,!0),setSpecies("Promise");var Fo=wellKnownSymbol("iterator"),Lo=!1;try{var jo=0,No={next:function(){return{done:!!jo++}},return:function(){Lo=!0}};No[Fo]=function(){return this},Array.from(No,(function(){throw 2}))}catch(t){}var checkCorrectnessOfIteration=function(t,a){if(!a&&!Lo)return!1;var o=!1;try{var c={};c[Fo]=function(){return{next:function(){return{done:o=!0}}}},t(c)}catch(t){}return o},Do=So.CONSTRUCTOR||!checkCorrectnessOfIteration((function(t){po.all(t).then(void 0,(function(){}))}));_export({target:"Promise",stat:!0,forced:Do},{all:function all(t){var a=this,o=Co.f(a),c=o.resolve,m=o.reject,h=perform((function(){var o=aCallable(a.resolve),h=[],v=0,b=1;iterate(t,(function(t){var S=v++,M=!1;b++,E(o,a,t).then((function(t){M||(M=!0,h[S]=t,--b||c(h))}),m)})),--b||c(h)}));return h.error&&m(h.value),o.promise}});var $o=So.CONSTRUCTOR;po&&po.prototype,_export({target:"Promise",proto:!0,forced:$o,real:!0},{catch:function(t){return this.then(void 0,t)}}),_export({target:"Promise",stat:!0,forced:Do},{race:function race(t){var a=this,o=Co.f(a),c=o.reject,m=perform((function(){var m=aCallable(a.resolve);iterate(t,(function(t){E(m,a,t).then(o.resolve,c)}))}));return m.error&&c(m.value),o.promise}}),_export({target:"Promise",stat:!0,forced:So.CONSTRUCTOR},{reject:function reject(t){var a=Co.f(this);return E(a.reject,void 0,t),a.promise}});var promiseResolve=function(t,a){if(anObject(t),$(a)&&a.constructor===t)return a;var o=Co.f(t);return(0,o.resolve)(a),o.promise},Ho=So.CONSTRUCTOR,Go=getBuiltIn("Promise"),Qo=!Ho;_export({target:"Promise",stat:!0,forced:!0},{resolve:function resolve(t){return promiseResolve(Qo&&this===Go?po:this,t)}}),_export({target:"Promise",stat:!0},{allSettled:function allSettled(t){var a=this,o=Co.f(a),c=o.resolve,m=o.reject,h=perform((function(){var o=aCallable(a.resolve),m=[],h=0,v=1;iterate(t,(function(t){var b=h++,S=!1;v++,E(o,a,t).then((function(t){S||(S=!0,m[b]={status:"fulfilled",value:t},--v||c(m))}),(function(t){S||(S=!0,m[b]={status:"rejected",reason:t},--v||c(m))}))})),--v||c(m)}));return h.error&&m(h.value),o.promise}});_export({target:"Promise",stat:!0},{any:function any(t){var a=this,o=getBuiltIn("AggregateError"),c=Co.f(a),m=c.resolve,h=c.reject,v=perform((function(){var c=aCallable(a.resolve),v=[],b=0,S=1,M=!1;iterate(t,(function(t){var C=b++,T=!1;S++,E(c,a,t).then((function(t){T||M||(M=!0,m(t))}),(function(t){T||M||(T=!0,v[C]=t,--S||h(new o(v,"No one promise resolved")))}))})),--S||h(new o(v,"No one promise resolved"))}));return v.error&&h(v.value),c.promise}});var Wo=po&&po.prototype,Vo=!!po&&fails((function(){Wo.finally.call({then:function(){}},(function(){}))}));_export({target:"Promise",proto:!0,real:!0,forced:Vo},{finally:function(t){var a=speciesConstructor(this,getBuiltIn("Promise")),o=isCallable(t);return this.then(o?function(o){return promiseResolve(a,t()).then((function(){return o}))}:t,o?function(o){return promiseResolve(a,t()).then((function(){throw o}))}:t)}});var Ko=H.Promise;_export({target:"Promise",stat:!0,forced:!0},{try:function(t){var a=Co.f(this),o=perform(t);return(o.error?a.reject:a.resolve)(o.value),a.promise}});var zo=Ko,Jo=k([].reverse),Yo=[1,2];_export({target:"Array",proto:!0,forced:String(Yo)===String(Yo.reverse())},{reverse:function reverse(){return Ct(this)&&(this.length=this.length),Jo(this)}});var Xo=entryVirtual("Array").reverse,Zo=Array.prototype,reverse$1=function(t){var a=t.reverse;return t===Zo||G(Zo,t)&&a===Zo.reverse?Xo:a},ei=arrayMethodHasSpeciesSupport("slice"),ti=wellKnownSymbol("species"),ri=Array,ni=Math.max;_export({target:"Array",proto:!0,forced:!ei},{slice:function slice(t,a){var o,c,m,h=toIndexedObject(this),v=lengthOfArrayLike(h),b=toAbsoluteIndex(t,v),S=toAbsoluteIndex(void 0===a?v:a,v);if(Ct(h)&&(o=h.constructor,(jt(o)&&(o===ri||Ct(o.prototype))||$(o)&&null===(o=o[ti]))&&(o=void 0),o===ri||void 0===o))return pt(h,b,S);for(c=new(void 0===o?ri:o)(ni(S-b,0)),m=0;b<S;b++,m++)b in h&&createProperty(c,m,h[b]);return c.length=m,c}});var ai=entryVirtual("Array").slice,oi=Array.prototype,slice=function(t){var a=t.slice;return t===oi||G(oi,t)&&a===oi.slice?ai:a},ii=createCommonjsModule((function(t){var a=Wn.default;function _regeneratorRuntime(){t.exports=_regeneratorRuntime=function _regeneratorRuntime(){return o},t.exports.__esModule=!0,t.exports.default=t.exports;var o={},c=Object.prototype,m=c.hasOwnProperty,h="function"==typeof Ln?Ln:{},v=h.iterator||"@@iterator",b=h.asyncIterator||"@@asyncIterator",S=h.toStringTag||"@@toStringTag";function define(t,a,o){return zn(t,a,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[a]}try{define({},"")}catch(t){define=function define(t,a,o){return t[a]=o}}function wrap(t,a,o,c){var m=a&&a.prototype instanceof Generator?a:Generator,h=st(m.prototype),v=new Context(c||[]);return h._invoke=function(t,a,o){var c="suspendedStart";return function(m,h){if("executing"===c)throw new Error("Generator is already running");if("completed"===c){if("throw"===m)throw h;return doneResult()}for(o.method=m,o.arg=h;;){var v=o.delegate;if(v){var b=maybeInvokeDelegate(v,o);if(b){if(b===M)continue;return b}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===c)throw c="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);c="executing";var S=tryCatch(t,a,o);if("normal"===S.type){if(c=o.done?"completed":"suspendedYield",S.arg===M)continue;return{value:S.arg,done:o.done}}"throw"===S.type&&(c="completed",o.method="throw",o.arg=S.arg)}}}(t,o,v),h}function tryCatch(t,a,o){try{return{type:"normal",arg:t.call(a,o)}}catch(t){return{type:"throw",arg:t}}}o.wrap=wrap;var M={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var C={};define(C,v,(function(){return this}));var T=Yn&&Yn(Yn(values([])));T&&T!==c&&m.call(T,v)&&(C=T);var w=GeneratorFunctionPrototype.prototype=Generator.prototype=st(C);function defineIteratorMethods(t){var a;forEach$1(a=["next","throw","return"]).call(a,(function(a){define(t,a,(function(t){return this._invoke(a,t)}))}))}function AsyncIterator(t,o){function invoke(c,h,v,b){var S=tryCatch(t[c],t,h);if("throw"!==S.type){var M=S.arg,C=M.value;return C&&"object"==a(C)&&m.call(C,"__await")?o.resolve(C.__await).then((function(t){invoke("next",t,v,b)}),(function(t){invoke("throw",t,v,b)})):o.resolve(C).then((function(t){M.value=t,v(M)}),(function(t){return invoke("throw",t,v,b)}))}b(S.arg)}var c;this._invoke=function(t,a){function callInvokeWithMethodAndArg(){return new o((function(o,c){invoke(t,a,o,c)}))}return c=c?c.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(t,a){var o=t.iterator[a.method];if(void 0===o){if(a.delegate=null,"throw"===a.method){if(t.iterator.return&&(a.method="return",a.arg=void 0,maybeInvokeDelegate(t,a),"throw"===a.method))return M;a.method="throw",a.arg=new TypeError("The iterator does not provide a 'throw' method")}return M}var c=tryCatch(o,t.iterator,a.arg);if("throw"===c.type)return a.method="throw",a.arg=c.arg,a.delegate=null,M;var m=c.arg;return m?m.done?(a[t.resultName]=m.value,a.next=t.nextLoc,"return"!==a.method&&(a.method="next",a.arg=void 0),a.delegate=null,M):m:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,M)}function pushTryEntry(t){var a={tryLoc:t[0]};1 in t&&(a.catchLoc=t[1]),2 in t&&(a.finallyLoc=t[2],a.afterLoc=t[3]),this.tryEntries.push(a)}function resetTryEntry(t){var a=t.completion||{};a.type="normal",delete a.arg,t.completion=a}function Context(t){this.tryEntries=[{tryLoc:"root"}],forEach$1(t).call(t,pushTryEntry,this),this.reset(!0)}function values(t){if(t){var a=t[v];if(a)return a.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,c=function next(){for(;++o<t.length;)if(m.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return c.next=c}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(w,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,S,"GeneratorFunction"),o.isGeneratorFunction=function(t){var a="function"==typeof t&&t.constructor;return!!a&&(a===GeneratorFunction||"GeneratorFunction"===(a.displayName||a.name))},o.mark=function(t){return dt?dt(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,S,"GeneratorFunction")),t.prototype=st(w),t},o.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,b,(function(){return this})),o.AsyncIterator=AsyncIterator,o.async=function(t,a,c,m,h){void 0===h&&(h=zo);var v=new AsyncIterator(wrap(t,a,c,m),h);return o.isGeneratorFunction(a)?v:v.next().then((function(t){return t.done?t.value:v.next()}))},defineIteratorMethods(w),define(w,S,"Generator"),define(w,v,(function(){return this})),define(w,"toString",(function(){return"[object Generator]"})),o.keys=function(t){var a=[];for(var o in t)a.push(o);return reverse$1(a).call(a),function next(){for(;a.length;){var o=a.pop();if(o in t)return next.value=o,next.done=!1,next}return next.done=!0,next}},o.values=values,Context.prototype={constructor:Context,reset:function reset(t){var a;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,forEach$1(a=this.tryEntries).call(a,resetTryEntry),!t)for(var o in this)"t"===o.charAt(0)&&m.call(this,o)&&!isNaN(+slice(o).call(o,1))&&(this[o]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var a=this;function handle(o,c){return h.type="throw",h.arg=t,a.next=o,c&&(a.method="next",a.arg=void 0),!!c}for(var o=this.tryEntries.length-1;o>=0;--o){var c=this.tryEntries[o],h=c.completion;if("root"===c.tryLoc)return handle("end");if(c.tryLoc<=this.prev){var v=m.call(c,"catchLoc"),b=m.call(c,"finallyLoc");if(v&&b){if(this.prev<c.catchLoc)return handle(c.catchLoc,!0);if(this.prev<c.finallyLoc)return handle(c.finallyLoc)}else if(v){if(this.prev<c.catchLoc)return handle(c.catchLoc,!0)}else{if(!b)throw new Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return handle(c.finallyLoc)}}}},abrupt:function abrupt(t,a){for(var o=this.tryEntries.length-1;o>=0;--o){var c=this.tryEntries[o];if(c.tryLoc<=this.prev&&m.call(c,"finallyLoc")&&this.prev<c.finallyLoc){var h=c;break}}h&&("break"===t||"continue"===t)&&h.tryLoc<=a&&a<=h.finallyLoc&&(h=null);var v=h?h.completion:{};return v.type=t,v.arg=a,h?(this.method="next",this.next=h.finallyLoc,M):this.complete(v)},complete:function complete(t,a){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&a&&(this.next=a),M},finish:function finish(t){for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),M}},catch:function _catch(t){for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a];if(o.tryLoc===t){var c=o.completion;if("throw"===c.type){var m=c.arg;resetTryEntry(o)}return m}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,a,o){return this.delegate={iterator:values(t),resultName:a,nextLoc:o},"next"===this.method&&(this.arg=void 0),M}},o}t.exports=_regeneratorRuntime,t.exports.__esModule=!0,t.exports.default=t.exports})),si=ii(),ci=si;try{regeneratorRuntime=si}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=si:Function("r","regeneratorRuntime = r")(si)}_export({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991});var li=fails((function(){Xe(1)}));_export({target:"Object",stat:!0,forced:li},{keys:function keys(t){return Xe(toObject(t))}});var ui=H.Object.keys,di=Object.assign,pi=Object.defineProperty,mi=k([].concat),hi=!di||fails((function(){if(x&&1!==di({b:1},di(pi({},"a",{enumerable:!0,get:function(){pi(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},a={},o=Symbol(),c="abcdefghijklmnopqrst";return t[o]=7,c.split("").forEach((function(t){a[t]=t})),7!=di({},t)[o]||Xe(di({},a)).join("")!=c}))?function assign(t,a){for(var o=toObject(t),c=arguments.length,m=1,h=nr.f,v=P.f;c>m;)for(var b,S=j(arguments[m++]),M=h?mi(Xe(S),h(S)):Xe(S),C=M.length,T=0;C>T;)b=M[T++],x&&!E(v,S,b)||(o[b]=S[b]);return o}:di;_export({target:"Object",stat:!0,arity:2,forced:Object.assign!==hi},{assign:hi});var fi=H.Object.assign;H.JSON||(H.JSON={stringify:JSON.stringify});var gi=function stringify(t,a,o){return M(H.JSON.stringify,null,arguments)},yi=Ve.indexOf,vi=k([].indexOf),bi=!!vi&&1/vi([1],1,-0)<0,Si=arrayMethodIsStrict("indexOf");_export({target:"Array",proto:!0,forced:bi||!Si},{indexOf:function indexOf(t){var a=arguments.length>1?arguments[1]:void 0;return bi?vi(this,t,a)||0:yi(this,t,a)}});var Mi=entryVirtual("Array").indexOf,Ci=Array.prototype,indexOf=function(t){var a=t.indexOf;return t===Ci||G(Ci,t)&&a===Ci.indexOf?Mi:a},Ti=entryVirtual("Array").concat,_i=Array.prototype,concat=function(t){var a=t.concat;return t===_i||G(_i,t)&&a===_i.concat?Ti:a};function __rest(t,a){var o={};for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&a.indexOf(c)<0&&(o[c]=t[c]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var m=0;for(c=Object.getOwnPropertySymbols(t);m<c.length;m++)a.indexOf(c[m])<0&&Object.prototype.propertyIsEnumerable.call(t,c[m])&&(o[c[m]]=t[c[m]])}return o}function __awaiter(t,a,o,c){return new(o||(o=Promise))((function(m,h){function fulfilled(t){try{step(c.next(t))}catch(t){h(t)}}function rejected(t){try{step(c.throw(t))}catch(t){h(t)}}function step(t){t.done?m(t.value):function adopt(t){return t instanceof o?t:new o((function(a){a(t)}))}(t.value).then(fulfilled,rejected)}step((c=c.apply(t,a||[])).next())}))}var wi=fails((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),Ii=Object.isExtensible,ki=fails((function(){Ii(1)}))||wi?function isExtensible(t){return!!$(t)&&((!wi||"ArrayBuffer"!=classofRaw(t))&&(!Ii||Ii(t)))}:Ii,xi=!fails((function(){return Object.isExtensible(Object.preventExtensions({}))})),Ri=createCommonjsModule((function(t){var a=Le.f,o=!1,c=uid("meta"),m=0,setMetadata=function(t){a(t,c,{value:{objectID:"O"+m++,weakData:{}}})},h=t.exports={enable:function(){h.enable=function(){},o=!0;var t=Yt.f,a=k([].splice),m={};m[c]=1,t(m).length&&(Yt.f=function(o){for(var m=t(o),h=0,v=m.length;h<v;h++)if(m[h]===c){a(m,h,1);break}return m},_export({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:rr.f}))},fastKey:function(t,a){if(!$(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!ue(t,c)){if(!ki(t))return"F";if(!a)return"E";setMetadata(t)}return t[c].objectID},getWeakData:function(t,a){if(!ue(t,c)){if(!ki(t))return!0;if(!a)return!1;setMetadata(t)}return t[c].weakData},onFreeze:function(t){return xi&&o&&ki(t)&&!ue(t,c)&&setMetadata(t),t}};Ke[c]=!0})),Ei=Le.f,Ai=Sr.forEach,qi=vr.set,Pi=vr.getterFor,collection=function(t,a,o){var c,h=-1!==t.indexOf("Map"),v=-1!==t.indexOf("Weak"),b=h?"set":"add",S=m[t],M=S&&S.prototype,C={};if(x&&isCallable(S)&&(v||M.forEach&&!fails((function(){(new S).entries().next()})))){var T=(c=a((function(a,o){qi(anInstance(a,T),{type:t,collection:new S}),null!=o&&iterate(o,a[b],{that:a,AS_ENTRIES:h})}))).prototype,w=Pi(t);Ai(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(t){var a="add"==t||"set"==t;!(t in M)||v&&"clear"==t||je(T,t,(function(o,c){var m=w(this).collection;if(!a&&v&&!$(o))return"get"==t&&void 0;var h=m[t](0===o?0:o,c);return a?this:h}))})),v||Ei(T,"size",{configurable:!0,get:function(){return w(this).collection.size}})}else c=o.getConstructor(a,t,h,b),Ri.enable();return setToStringTag(c,t,!1,!0),C[t]=c,_export({global:!0,forced:!0},C),v||o.setStrong(c,t,h),c},defineBuiltIns=function(t,a,o){for(var c in a)o&&o.unsafe&&t[c]?t[c]=a[c]:defineBuiltIn(t,c,a[c],o);return t},Oi=Le.f,Ui=Ri.fastKey,Bi=vr.set,Fi=vr.getterFor,Li={getConstructor:function(t,a,o,c){var m=t((function(t,m){anInstance(t,h),Bi(t,{type:a,index:ot(null),first:void 0,last:void 0,size:0}),x||(t.size=0),isNullOrUndefined(m)||iterate(m,t[c],{that:t,AS_ENTRIES:o})})),h=m.prototype,v=Fi(a),define=function(t,a,o){var c,m,h=v(t),b=getEntry(t,a);return b?b.value=o:(h.last=b={index:m=Ui(a,!0),key:a,value:o,previous:c=h.last,next:void 0,removed:!1},h.first||(h.first=b),c&&(c.next=b),x?h.size++:t.size++,"F"!==m&&(h.index[m]=b)),t},getEntry=function(t,a){var o,c=v(t),m=Ui(a);if("F"!==m)return c.index[m];for(o=c.first;o;o=o.next)if(o.key==a)return o};return defineBuiltIns(h,{clear:function clear(){for(var t=v(this),a=t.index,o=t.first;o;)o.removed=!0,o.previous&&(o.previous=o.previous.next=void 0),delete a[o.index],o=o.next;t.first=t.last=void 0,x?t.size=0:this.size=0},delete:function(t){var a=this,o=v(a),c=getEntry(a,t);if(c){var m=c.next,h=c.previous;delete o.index[c.index],c.removed=!0,h&&(h.next=m),m&&(m.previous=h),o.first==c&&(o.first=m),o.last==c&&(o.last=h),x?o.size--:a.size--}return!!c},forEach:function forEach(t){for(var a,o=v(this),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0);a=a?a.next:o.first;)for(c(a.value,a.key,this);a&&a.removed;)a=a.previous},has:function has(t){return!!getEntry(this,t)}}),defineBuiltIns(h,o?{get:function get(t){var a=getEntry(this,t);return a&&a.value},set:function set(t,a){return define(this,0===t?0:t,a)}}:{add:function add(t){return define(this,t=0===t?0:t,t)}}),x&&Oi(h,"size",{get:function(){return v(this).size}}),m},setStrong:function(t,a,o){var c=a+" Iterator",m=Fi(a),h=Fi(c);iteratorDefine(t,a,(function(t,a){Bi(this,{type:c,target:t,state:m(t),kind:a,last:void 0})}),(function(){for(var t=h(this),a=t.kind,o=t.last;o&&o.removed;)o=o.previous;return t.target&&(t.last=o=o?o.next:t.state.first)?"keys"==a?{value:o.key,done:!1}:"values"==a?{value:o.value,done:!1}:{value:[o.key,o.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),o?"entries":"values",!o,!0),setSpecies(a)}};collection("Map",(function(t){return function Map(){return t(this,arguments.length?arguments[0]:void 0)}}),Li);var ji=H.Map,Ni=[].push,Di=function from(t){var a,o,c,m,h=arguments.length,v=h>1?arguments[1]:void 0;return aConstructor(this),(a=void 0!==v)&&aCallable(v),isNullOrUndefined(t)?new this:(o=[],a?(c=0,m=functionBindContext(v,h>2?arguments[2]:void 0),iterate(t,(function(t){E(Ni,o,m(t,c++))}))):iterate(t,Ni,{that:o}),new this(o))};_export({target:"Map",stat:!0,forced:!0},{from:Di});var $i=function of(){return new this(pt(arguments))};_export({target:"Map",stat:!0,forced:!0},{of:$i});var Hi=function deleteAll(){for(var t,a=anObject(this),o=aCallable(a.delete),c=!0,m=0,h=arguments.length;m<h;m++)t=E(o,a,arguments[m]),c=c&&t;return!!c};_export({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:Hi});_export({target:"Map",proto:!0,real:!0,forced:!0},{emplace:function emplace(t,a){var o,c,m=anObject(this),h=aCallable(m.get),v=aCallable(m.has),b=aCallable(m.set);return E(v,m,t)?(o=E(h,m,t),"update"in a&&(o=a.update(o,t,m),E(b,m,t,o)),o):(c=a.insert(t,m),E(b,m,t,c),c)}});var Gi=getIterator;_export({target:"Map",proto:!0,real:!0,forced:!0},{every:function every(t){var a=anObject(this),o=Gi(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return!iterate(o,(function(t,o,m){if(!c(o,t,a))return m()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{filter:function filter(t){var a=anObject(this),o=Gi(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0),m=new(speciesConstructor(a,getBuiltIn("Map"))),h=aCallable(m.set);return iterate(o,(function(t,o){c(o,t,a)&&E(h,m,t,o)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),m}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{find:function find(t){var a=anObject(this),o=Gi(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(o,(function(t,o,m){if(c(o,t,a))return m(o)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function findKey(t){var a=anObject(this),o=Gi(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(o,(function(t,o,m){if(c(o,t,a))return m(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Qi=k([].push);_export({target:"Map",stat:!0,forced:!0},{groupBy:function groupBy(t,a){aCallable(a);var o=getIterator(t),c=new this,m=aCallable(c.has),h=aCallable(c.get),v=aCallable(c.set);return iterate(o,(function(t){var o=a(t);E(m,c,o)?Qi(E(h,c,o),t):E(v,c,o,[t])}),{IS_ITERATOR:!0}),c}});_export({target:"Map",proto:!0,real:!0,forced:!0},{includes:function includes(t){return iterate(Gi(anObject(this)),(function(a,o,c){if((m=o)===(h=t)||m!=m&&h!=h)return c();var m,h}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",stat:!0,forced:!0},{keyBy:function keyBy(t,a){var o=new this;aCallable(a);var c=aCallable(o.set);return iterate(t,(function(t){E(c,o,a(t),t)})),o}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function keyOf(t){return iterate(Gi(anObject(this)),(function(a,o,c){if(o===t)return c(a)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function mapKeys(t){var a=anObject(this),o=Gi(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0),m=new(speciesConstructor(a,getBuiltIn("Map"))),h=aCallable(m.set);return iterate(o,(function(t,o){E(h,m,c(o,t,a),o)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),m}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function mapValues(t){var a=anObject(this),o=Gi(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0),m=new(speciesConstructor(a,getBuiltIn("Map"))),h=aCallable(m.set);return iterate(o,(function(t,o){E(h,m,t,c(o,t,a))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),m}}),_export({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function merge(t){for(var a=anObject(this),o=aCallable(a.set),c=arguments.length,m=0;m<c;)iterate(arguments[m++],o,{that:a,AS_ENTRIES:!0});return a}});var Wi=TypeError;_export({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function reduce(t){var a=anObject(this),o=Gi(a),c=arguments.length<2,m=c?void 0:arguments[1];if(aCallable(t),iterate(o,(function(o,h){c?(c=!1,m=h):m=t(m,h,o,a)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),c)throw Wi("Reduce of empty map with no initial value");return m}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{some:function some(t){var a=anObject(this),o=Gi(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(o,(function(t,o,m){if(c(o,t,a))return m()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Vi=TypeError;_export({target:"Map",proto:!0,real:!0,forced:!0},{update:function update(t,a){var o=anObject(this),c=aCallable(o.get),m=aCallable(o.has),h=aCallable(o.set),v=arguments.length;aCallable(a);var b=E(m,o,t);if(!b&&v<3)throw Vi("Updating absent value");var S=b?E(c,o,t):aCallable(v>2?arguments[2]:void 0)(t,o);return E(h,o,t,a(S,t,o)),o}});var Ki=TypeError,zi=function upsert(t,a){var o,c=anObject(this),m=aCallable(c.get),h=aCallable(c.has),v=aCallable(c.set),b=arguments.length>2?arguments[2]:void 0;if(!isCallable(a)&&!isCallable(b))throw Ki("At least one callback required");return E(h,c,t)?(o=E(m,c,t),isCallable(a)&&(o=a(o),E(v,c,t,o))):isCallable(b)&&(o=b(),E(v,c,t,o)),o};_export({target:"Map",proto:!0,real:!0,forced:!0},{upsert:zi}),_export({target:"Map",proto:!0,real:!0,name:"upsert",forced:!0},{updateOrInsert:zi});var Ji=ji,Yi=/MSIE .\./.test(Q),Xi=m.Function,wrap=function(t){return Yi?function(a,o){var c=validateArgumentsLength(arguments.length,1)>2,m=isCallable(a)?a:Xi(a),h=c?pt(arguments,2):void 0;return t(c?function(){M(m,this,h)}:m,o)}:t},Zi={setTimeout:wrap(m.setTimeout),setInterval:wrap(m.setInterval)},es=Zi.setInterval;_export({global:!0,bind:!0,forced:m.setInterval!==es},{setInterval:es});var ts=Zi.setTimeout;_export({global:!0,bind:!0,forced:m.setTimeout!==ts},{setTimeout:ts});var rs=H.setTimeout,ns=Date,as=k(ns.prototype.getTime);_export({target:"Date",stat:!0},{now:function now(){return as(new ns)}});var os=H.Date.now,is=Sr.map,ss=arrayMethodHasSpeciesSupport("map");_export({target:"Array",proto:!0,forced:!ss},{map:function map(t){return is(this,t,arguments.length>1?arguments[1]:void 0)}});var cs=entryVirtual("Array").map,ls=Array.prototype,map=function(t){var a=t.map;return t===ls||G(ls,t)&&a===ls.map?cs:a},us=createCommonjsModule((function(t){var a=Object.prototype.hasOwnProperty,o="~";function Events(){}function EE(t,a,o){this.fn=t,this.context=a,this.once=o||!1}function addListener(t,a,c,m,h){if("function"!=typeof c)throw new TypeError("The listener must be a function");var v=new EE(c,m||t,h),b=o?o+a:a;return t._events[b]?t._events[b].fn?t._events[b]=[t._events[b],v]:t._events[b].push(v):(t._events[b]=v,t._eventsCount++),t}function clearEvent(t,a){0==--t._eventsCount?t._events=new Events:delete t._events[a]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(o=!1)),EventEmitter.prototype.eventNames=function eventNames(){var t,c,m=[];if(0===this._eventsCount)return m;for(c in t=this._events)a.call(t,c)&&m.push(o?c.slice(1):c);return Object.getOwnPropertySymbols?m.concat(Object.getOwnPropertySymbols(t)):m},EventEmitter.prototype.listeners=function listeners(t){var a=o?o+t:t,c=this._events[a];if(!c)return[];if(c.fn)return[c.fn];for(var m=0,h=c.length,v=new Array(h);m<h;m++)v[m]=c[m].fn;return v},EventEmitter.prototype.listenerCount=function listenerCount(t){var a=o?o+t:t,c=this._events[a];return c?c.fn?1:c.length:0},EventEmitter.prototype.emit=function emit(t,a,c,m,h,v){var b=o?o+t:t;if(!this._events[b])return!1;var S,M,C=this._events[b],T=arguments.length;if(C.fn){switch(C.once&&this.removeListener(t,C.fn,void 0,!0),T){case 1:return C.fn.call(C.context),!0;case 2:return C.fn.call(C.context,a),!0;case 3:return C.fn.call(C.context,a,c),!0;case 4:return C.fn.call(C.context,a,c,m),!0;case 5:return C.fn.call(C.context,a,c,m,h),!0;case 6:return C.fn.call(C.context,a,c,m,h,v),!0}for(M=1,S=new Array(T-1);M<T;M++)S[M-1]=arguments[M];C.fn.apply(C.context,S)}else{var w,I=C.length;for(M=0;M<I;M++)switch(C[M].once&&this.removeListener(t,C[M].fn,void 0,!0),T){case 1:C[M].fn.call(C[M].context);break;case 2:C[M].fn.call(C[M].context,a);break;case 3:C[M].fn.call(C[M].context,a,c);break;case 4:C[M].fn.call(C[M].context,a,c,m);break;default:if(!S)for(w=1,S=new Array(T-1);w<T;w++)S[w-1]=arguments[w];C[M].fn.apply(C[M].context,S)}}return!0},EventEmitter.prototype.on=function on(t,a,o){return addListener(this,t,a,o,!1)},EventEmitter.prototype.once=function once(t,a,o){return addListener(this,t,a,o,!0)},EventEmitter.prototype.removeListener=function removeListener(t,a,c,m){var h=o?o+t:t;if(!this._events[h])return this;if(!a)return clearEvent(this,h),this;var v=this._events[h];if(v.fn)v.fn!==a||m&&!v.once||c&&v.context!==c||clearEvent(this,h);else{for(var b=0,S=[],M=v.length;b<M;b++)(v[b].fn!==a||m&&!v[b].once||c&&v[b].context!==c)&&S.push(v[b]);S.length?this._events[h]=1===S.length?S[0]:S:clearEvent(this,h)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(t){var a;return t?(a=o?o+t:t,this._events[a]&&clearEvent(this,a)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=o,EventEmitter.EventEmitter=EventEmitter,t.exports=EventEmitter})),ds=Backoff;function Backoff(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var a=Math.random(),o=Math.floor(a*this.jitter*t);t=0==(1&Math.floor(10*a))?t-o:t+o}return 0|Math.min(t,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(t){this.ms=t},Backoff.prototype.setMax=function(t){this.max=t},Backoff.prototype.setJitter=function(t){this.jitter=t};var ps="object"==typeof t&&t&&t.Object===Object&&t,ms="object"==typeof self&&self&&self.Object===Object&&self,hs=ps||ms||Function("return this")(),fs=hs.Symbol,gs=Object.prototype,ys=gs.hasOwnProperty,vs=gs.toString,bs=fs?fs.toStringTag:void 0;var Ss=function getRawTag(t){var a=ys.call(t,bs),o=t[bs];try{t[bs]=void 0;var c=!0}catch(t){}var m=vs.call(t);return c&&(a?t[bs]=o:delete t[bs]),m},Ms=Object.prototype.toString;var Cs=function objectToString(t){return Ms.call(t)},Ts=fs?fs.toStringTag:void 0;var _s=function baseGetTag(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Ts&&Ts in Object(t)?Ss(t):Cs(t)};var ws=function isObject(t){var a=typeof t;return null!=t&&("object"==a||"function"==a)};var Is=function isFunction(t){if(!ws(t))return!1;var a=_s(t);return"[object Function]"==a||"[object GeneratorFunction]"==a||"[object AsyncFunction]"==a||"[object Proxy]"==a},ks={deviceId:"",timeout:8e3},xs={account:"",appkey:"",token:"",debugLevel:"off",needReconnect:!0,reconnectionAttempts:9007199254740991,isAbtestEnable:!0,abtestUrl:"https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo",abtestProjectKey:"imElite_sdk_abtest_web"},Rs=Ve.includes,Es=fails((function(){return!Array(1).includes()}));_export({target:"Array",proto:!0,forced:Es},{includes:function includes(t){return Rs(this,t,arguments.length>1?arguments[1]:void 0)}});var As=entryVirtual("Array").includes,qs=wellKnownSymbol("match"),Ps=TypeError,notARegexp=function(t){if(function(t){var a;return $(t)&&(void 0!==(a=t[qs])?!!a:"RegExp"==classofRaw(t))}(t))throw Ps("The method doesn't accept regular expressions");return t},Os=wellKnownSymbol("match"),Us=k("".indexOf);_export({target:"String",proto:!0,forced:!function(t){var a=/./;try{"/./"[t](a)}catch(o){try{return a[Os]=!1,"/./"[t](a)}catch(t){}}return!1}("includes")},{includes:function includes(t){return!!~Us(toString$1(requireObjectCoercible(this)),toString$1(notARegexp(t)),arguments.length>1?arguments[1]:void 0)}});var Bs=entryVirtual("String").includes,Fs=Array.prototype,Ls=String.prototype,includes=function(t){var a=t.includes;return t===Fs||G(Fs,t)&&a===Fs.includes?As:"string"==typeof t||t===Ls||G(Ls,t)&&a===Ls.includes?Bs:a},js=Sr.findIndex,Ns=!0;"findIndex"in[]&&Array(1).findIndex((function(){Ns=!1})),_export({target:"Array",proto:!0,forced:Ns},{findIndex:function findIndex(t){return js(this,t,arguments.length>1?arguments[1]:void 0)}});var Ds=entryVirtual("Array").findIndex,$s=Array.prototype,findIndex$1=function(t){var a=t.findIndex;return t===$s||G($s,t)&&a===$s.findIndex?Ds:a},Hs=createCommonjsModule((function(t){function _getPrototypeOf(a){var o;return t.exports=_getPrototypeOf=dt?bind$1(o=Yn).call(o):function _getPrototypeOf(t){return t.__proto__||Yn(t)},t.exports.__esModule=!0,t.exports.default=t.exports,_getPrototypeOf(a)}t.exports=_getPrototypeOf,t.exports.__esModule=!0,t.exports.default=t.exports})),Gs=createCommonjsModule((function(t){t.exports=function _isNativeFunction(t){var a;return-1!==indexOf(a=Function.toString.call(t)).call(a,"[native code]")},t.exports.__esModule=!0,t.exports.default=t.exports})),Qs=getBuiltIn("Reflect","construct"),Ws=Object.prototype,Vs=[].push,Ks=fails((function(){function F(){}return!(Qs((function(){}),[],F)instanceof F)})),zs=!fails((function(){Qs((function(){}))})),Js=Ks||zs;_export({target:"Reflect",stat:!0,forced:Js,sham:Js},{construct:function construct(t,a){aConstructor(t),anObject(a);var o=arguments.length<3?t:aConstructor(arguments[2]);if(zs&&!Ks)return Qs(t,a,o);if(t==o){switch(a.length){case 0:return new t;case 1:return new t(a[0]);case 2:return new t(a[0],a[1]);case 3:return new t(a[0],a[1],a[2]);case 4:return new t(a[0],a[1],a[2],a[3])}var c=[null];return M(Vs,c,a),new(M(yt,t,c))}var m=o.prototype,h=ot($(m)?m:Ws),v=M(t,h,a);return $(v)?v:h}});var Ys=H.Reflect.construct,Xs=createCommonjsModule((function(t){t.exports=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Ys)return!1;if(Ys.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Ys(Boolean,[],(function(){}))),!0}catch(t){return!1}},t.exports.__esModule=!0,t.exports.default=t.exports})),Zs=createCommonjsModule((function(t){function _construct(a,o,c){var m;Xs()?(t.exports=_construct=bind$1(m=Ys).call(m),t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=_construct=function _construct(t,a,o){var c=[null];c.push.apply(c,a);var m=new(bind$1(Function).apply(t,c));return o&&St(m,o.prototype),m},t.exports.__esModule=!0,t.exports.default=t.exports);return _construct.apply(null,arguments)}t.exports=_construct,t.exports.__esModule=!0,t.exports.default=t.exports})),ec=createCommonjsModule((function(t){function _wrapNativeSuper(a){var o="function"==typeof Ji?new Ji:void 0;return t.exports=_wrapNativeSuper=function _wrapNativeSuper(t){if(null===t||!Gs(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==o){if(o.has(t))return o.get(t);o.set(t,Wrapper)}function Wrapper(){return Zs(t,arguments,Hs(this).constructor)}return Wrapper.prototype=st(t.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),St(Wrapper,t)},t.exports.__esModule=!0,t.exports.default=t.exports,_wrapNativeSuper(a)}t.exports=_wrapNativeSuper,t.exports.__esModule=!0,t.exports.default=t.exports})),tc=/*#__PURE__*/function(t){function CustomError(a,o,c){var m;return void 0===o&&(o={}),void 0===c&&(c=400),(m=t.call(this,a)||this).data=o,m.code=c,m.name="customError",m}return Mt(CustomError,t),CustomError}(/*#__PURE__*/ /*@__PURE__*/getDefaultExportFromCjs(ec)(Error)),rc=/*#__PURE__*/function(t){function ValidateError(a,o,c){var m;return void 0===o&&(o={}),(m=t.call(this,a,o,414)||this).code=414,m.name="validateError",m.rules=c,m}return Mt(ValidateError,t),ValidateError}(tc),nc={200:null,406:null,808:null,810:null,201:"The client version is incorrect. You need to upgrade the SDK",302:"The user name or password is incorrect. Please check whether the appkey and token are valid and whether the account and token match",403:"Illegal operation or no permission",404:"Target object does not exist",405:"Parameter length too long",408:"Client request timed out",414:"Request parameter error",415:"Service unavailable",416:"Frequency control",417:"Repeat operation",422:"Account disabled",500:"Server internal error",503:"Server busy",508:"Expiration date",509:"Invalid",7101:"Be pulled black",700:"Partial failure of batch operation",801:"The number of people in the team has reached the upper limit",802:"No permission",803:"The team does not exist or has not changed",804:"The user is not in the team",805:"Team type mismatch",806:"The number of teams created has reached the limit",807:"Team member not valid",809:"Already in the team",811:"The number of accounts in the forced push list exceeds the limit",812:"The team is muted",813:"Due to the limited number of team, some pull people successfully",814:"Disable team message read service",815:"Maximum number of team administrators",816:"Batch operation partial failure",997:"The packet has expired",998:"Deserialize packet error",999:"Serialize packet error",9102:"Channel failure",9103:"This call has been answered / rejected at another end",10201:"Signaling: target NIM client is offline",10202:"Signaling: push is unreachable",10404:"Signaling: channel not exists",10405:"Signaling: channel already exists",10406:"Signaling: member of channel not exists",10407:"Signaling: member of channel already exists",10408:"Signaling: the invitation request does not exist or has expired",10409:"Signaling: the invitation request has been rejected",10410:"Signaling: the invitation request has been accepted",10414:"Signaling: request parameter error",10417:"Signaling: uid conflict",10419:"Signaling: the number of members of channel exceed the limit",10420:"Signaling: member is already in the channel on other client",10700:"Signaling: phased success",13002:"Abnormal chatroom status",13003:"In the blacklist",13004:"In the mute list",13006:"All members are muted, and only the administrator can speak"},ac=/*#__PURE__*/function(t){function CmdError(a,o,c,m,h){var v;return void 0===c&&(c=""),void 0===m&&(m=(new Date).getTime()),void 0===h&&(h={}),c=c||nc[a],(v=t.call(this,c,h,a)||this).name="cmdError",v.cmd=o,v.timetag=m,v}return Mt(CmdError,t),CmdError}(tc);var oc=/*#__PURE__*/function(t){function FormatError(a,o,c){var m;return(m=t.call(this,a,{},412)||this).code=412,m.name="formatError",m.key=o,m.reason=c,m}return Mt(FormatError,t),FormatError}(tc),ic=/*#__PURE__*/function(t){function UploadError(a,o,c,m,h){var v;return(v=t.call(this,a,{file:h},400)||this).name="uploadError",v.rawError=o,v.curProvider=c||1,v.mixStorePolicy=m,v}return Mt(UploadError,t),UploadError}(tc),sc=["error","warn","log","debug"],cc=function emptyFunc(){},lc=["off","error","warn","log","debug"],uc=/*#__PURE__*/function(){function Logger(t,a){this.name=a,this.strategies={debug:console.log,log:console.log,warn:console.warn,error:console.error},this.debug=cc,this.log=cc,this.warn=cc,this.error=cc,this.name=a,Logger.instancesName.push(a),includes(lc).call(lc,t)||(t="off"),this.setLogFunc(t)}var t=Logger.prototype;return t.setLogFunc=function setLogFunc(t){var a=this,o=findIndex$1(sc).call(sc,(function(a){return a===t}));forEach$1(sc).call(sc,(function(t,c){c<=o&&(a[t]=function(){var a=slice(Array.prototype).call(arguments),o=this.formatArgs(a,t);this.strategies[t](o)})}))},t.formatArgs=function formatArgs(t,a){var o=new Date,c=o.getMonth()+1+"-"+o.getDate()+" "+o.getHours()+":"+o.getMinutes()+":"+o.getSeconds()+":"+o.getMilliseconds();return"[NIM "+a+" "+this.name+" "+c+"] "+map(t).call(t,(function(t){return t instanceof tc?t.name+", "+t.code+", "+t.message:t instanceof Error?t&&t.message?t.message:t:"object"==typeof t?gi(t):t})).join(" ")},Logger}();uc.instancesName=[];var dc=createCommonjsModule((function(t,a){t.exports=function(){function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,a){for(var o=0;o<a.length;o++){var c=a[o];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}function _createClass(t,a,o){return a&&_defineProperties(t.prototype,a),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function __rest(t,a){var o={};for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&a.indexOf(c)<0&&(o[c]=t[c]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var m=0;for(c=Object.getOwnPropertySymbols(t);m<c.length;m++)a.indexOf(c[m])<0&&Object.prototype.propertyIsEnumerable.call(t,c[m])&&(o[c[m]]=t[c[m]])}return o}var t={reportUrl:"https://statistic.live.126.net/statics/report/common/form",maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,maxInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0},a="https://statistic.live.126.net/dispatcher/req",o=function emptyFn(){},c=/*#__PURE__*/function(){function Reporter(a){_classCallCheck(this,Reporter),this.enable=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=t,this.msgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=Date.now(),this.timer=null,this.setConfig(a),this.reportConfig.autoStart&&this.initUploadConfig()}return _createClass(Reporter,[{key:"setConfig",value:function setConfig(t){this.reportConfig=Object.assign({},this.reportConfig,t)}},{key:"reportImmediately",value:function reportImmediately(t,a){var o=this;this.reportConfig.request(t,Object.assign({dataType:"json",method:"POST",timeout:this.reportConfig.timeout},a)).catch((function(t){var a,c;null===(c=null===(a=o.reportConfig)||void 0===a?void 0:a.logger)||void 0===c||c.warn("Reporter immediately upload failed",t)}))}},{key:"report",value:function report(t,a){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t){var c=Date.now();o?this.lowPriorityMsgList.push({module:t,msg:a,createTime:c}):this.msgList.push({module:t,msg:a,createTime:c}),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function reportTraceStart(t,a){if(t&&!this.traceMsgCache[t]){var o=Object.assign(Object.assign({start_time:Date.now()},a),{extension:[]});this.traceMsgCache[t]=o}}},{key:"reportTraceUpdate",value:function reportTraceUpdate(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.traceMsgCache[t]){var c,m=a.operation_type,h=a.code,v=a.target,b=a.error,S=__rest(a,["operation_type","code","target","error"]),M=Date.now(),C=this.traceMsgCache[t].extension.length;c=0===C?this.traceMsgCache[t].start_time:this.traceMsgCache[t].extension[C-1].end_time,b&&b.code&&(h=b.code),this.traceMsgCache[t].extension.push({operation_type:m,code:h,succeed:o,target:v,duration:M-c,description:JSON.stringify(S),end_time:M})}}},{key:"reportTraceUpdateV2",value:function reportTraceUpdateV2(t,a){if(this.traceMsgCache[t]){var o=this.traceMsgCache[t].extension.length;a.end_time=0===o?this.traceMsgCache[t].start_time+(a.duration?a.duration:0):this.traceMsgCache[t].extension[o-1].end_time+(a.duration?a.duration:0),this.traceMsgCache[t].extension.push(a)}}},{key:"reportTraceEnd",value:function reportTraceEnd(t){var a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.traceMsgCache[t]&&("nos"!==t||!1===a?("boolean"==typeof a?this.traceMsgCache[t].succeed=!!a:this.traceMsgCache[t].state=a,this.traceMsgCache[t].duration=Date.now()-this.traceMsgCache[t].start_time,this.traceMsgCache[t].extension.forEach((function(t){delete t.end_time})),this.report(t,this.traceMsgCache[t]),this.traceMsgCache[t]=null):this.traceMsgCache[t]=null)}},{key:"pause",value:function pause(){this.enable=!1}},{key:"restore",value:function restore(){this.enable=!0,this.initConfigLoaded||this.initUploadConfig()}},{key:"destroy",value:function destroy(){var t=this;Object.keys(this.traceMsgCache).forEach((function(a){t.reportTraceEnd(a,1)})),null!==this.timer&&clearTimeout(this.timer),this.setConfig=o,this.report=o,this.reportTraceStart=o,this.reportTraceUpdate=o,this.reportTraceEnd=o,this.pause=o,this.restore=o,this.destroy=o,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.reportConfig={},this.isDestroyed=!0}},{key:"initUploadConfig",value:function initUploadConfig(){var t,o,c=this;if(!this.loading){this.loading=!0;var m=this.reportConfig.common||{};try{this.reportConfig.request(a,{method:"GET",dataType:"json",params:{deviceId:m.dev_id,sdkVer:m.sdk_ver,platform:m.platform,appkey:m.app_key},timeout:this.reportConfig.timeout}).then((function(t){var a,o;if(!c.isDestroyed){if(200===t.status&&t.data&&200===t.data.code){var m=t.data.data||{};c.reportConfig.maxSize=m.maxSize>1e3?1e3:m.maxSize,c.reportConfig.maxInterval=m.maxInterval>1e4?1e4:m.maxInterval,c.reportConfig.maxInterval=m.maxInterval<10?10:m.maxInterval,c.reportConfig.minInterval=m.minInterval<2?2:m.minInterval,c.reportConfig.maxDelay=m.maxDelay||300,c.reportConfig.maxInterval=1e3*c.reportConfig.maxInterval,c.reportConfig.minInterval=1e3*c.reportConfig.minInterval,c.reportConfig.maxDelay=1e3*c.reportConfig.maxDelay,c.enable=!0,c.initConfigLoaded=!0,c.loading=!1,c.reportHeartBeat()}null===(o=null===(a=c.reportConfig)||void 0===a?void 0:a.logger)||void 0===o||o.log("Get reporter upload config success")}})).catch((function(t){var a,o;c.loading=!1,null===(o=null===(a=c.reportConfig)||void 0===a?void 0:a.logger)||void 0===o||o.error("Get reporter upload config failed",t)}))}catch(a){this.loading=!1,null===(o=null===(t=this.reportConfig)||void 0===t?void 0:t.logger)||void 0===o||o.error("Exec reporter request failed",a)}}}},{key:"reportHeartBeat",value:function reportHeartBeat(){var t=this;this.isDestroyed||(this.timer=setTimeout((function(){t.reportHeartBeat()}),this.reportConfig.minInterval),this.doReport())}},{key:"doReport",value:function doReport(){if(!this.isDestroyed){var t=this.msgList.length+this.lowPriorityMsgList.length+this.cacheMsgList.length>2*this.reportConfig.maxSize?this.reportConfig.minInterval:this.reportConfig.maxInterval;Date.now()-this.lastReportTime>=t&&this.upload()}}},{key:"getUploadMsg",value:function getUploadMsg(){var t=this,a={},o=Date.now();this.msgList=this.msgList.filter((function(a){return o-a.createTime<t.reportConfig.maxDelay})),this.lowPriorityMsgList=this.lowPriorityMsgList.filter((function(a){return o-a.createTime<t.reportConfig.maxDelay})),this.cacheMsgList=this.cacheMsgList.filter((function(a){return o-a.createTime<t.reportConfig.maxDelay}));var c=this.msgList.slice(0,this.reportConfig.maxSize);if(this.msgList=this.msgList.slice(c.length),c.length<this.reportConfig.maxSize){var m=this.reportConfig.maxSize-c.length;c=c.concat(this.lowPriorityMsgList.slice(0,m)),this.lowPriorityMsgList=this.lowPriorityMsgList.slice(m)}if(c.length<this.reportConfig.maxSize){var h=this.reportConfig.maxSize-c.length;c=c.concat(this.cacheMsgList.slice(0,h)),this.cacheMsgList=this.cacheMsgList.slice(h)}return c.forEach((function(t){a[t.module]?a[t.module].push(t.msg):a[t.module]=[t.msg]})),{uploadMsgArr:c,uploadMsg:a}}},{key:"upload",value:function upload(){var t,a,o=this;if(this.enable&&!(this.lastReportTime&&Date.now()-this.lastReportTime<this.reportConfig.minInterval)){var c=this.getUploadMsg(),m=c.uploadMsgArr,h=c.uploadMsg;if(m.length){this.lastReportTime=Date.now();try{this.reportConfig.request(this.reportConfig.reportUrl,{dataType:"json",method:"POST",params:{common:this.reportConfig.common,event:h},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch((function(t){var a,c;o.cacheMsgList=o.cacheMsgList.concat(m).slice(0,o.reportConfig.cacheMaxSize),null===(c=null===(a=o.reportConfig)||void 0===a?void 0:a.logger)||void 0===c||c.warn("Reporter upload failed",t)}))}catch(o){null===(a=null===(t=this.reportConfig)||void 0===t?void 0:t.logger)||void 0===a||a.warn("Exec reporter request failed",o)}clearTimeout(this.timer),this.reportHeartBeat()}}}}]),Reporter}();return c}()})),pc={setLogger:function setLogger(t){throw new Error("Function not implemented.")},platform:"",WebSocket:/*#__PURE__*/function(){function AdapterSocket(t,a){throw this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,new Error("Method not implemented.")}var t=AdapterSocket.prototype;return t.close=function close(t,a){throw new Error("Method not implemented.")},t.send=function send(t){throw new Error("Method not implemented.")},t.onclose=function onclose(t){throw new Error("Method not implemented.")},t.onerror=function onerror(t){throw new Error("Method not implemented.")},t.onmessage=function onmessage(t){throw new Error("Method not implemented.")},t.onopen=function onopen(t){throw new Error("Method not implemented.")},AdapterSocket}(),localStorage:{},request:function request(t,a){throw new Error("Function not implemented.")},uploadFile:function uploadFile(t){throw new Error("Function not implemented.")},getSystemInfo:function getSystemInfo(){throw new Error("Function not implemented.")}};var mc=TypeError,createMethod$1=function(t){return function(a,o,c,m){aCallable(o);var h=toObject(a),v=j(h),b=lengthOfArrayLike(h),S=t?b-1:0,M=t?-1:1;if(c<2)for(;;){if(S in v){m=v[S],S+=M;break}if(S+=M,t?S<0:b<=S)throw mc("Reduce of empty array with no initial value")}for(;t?S>=0:b>S;S+=M)S in v&&(m=o(m,v[S],S,h));return m}},hc={left:createMethod$1(!1),right:createMethod$1(!0)}.left,fc=arrayMethodIsStrict("reduce");_export({target:"Array",proto:!0,forced:!fc||!Ia&&Y>79&&Y<83},{reduce:function reduce(t){var a=arguments.length;return hc(this,t,a,a>1?arguments[1]:void 0)}});var gc=entryVirtual("Array").reduce,yc=Array.prototype,reduce=function(t){var a=t.reduce;return t===yc||G(yc,t)&&a===yc.reduce?gc:a};var vc=function isUndefined(t){return void 0===t},bc={},Sc={};function parseCmd(t,a){var o,c,m;try{m=JSON.parse(t)}catch(o){throw a.error("Parse command error: ",t),o}var h=m.sid+"_"+m.cid,v=m.r;if(includes(o=["4_1","4_2","4_10","4_11"]).call(o,h)){var b=m.r[1].headerPacket;h=b.sid+"_"+b.cid,v=m.r[1].body}var S,M=Sc[h],C=bc[M],T=function genCmdError(t,a){var o=nc[t];return null===o?null:new ac(t,a,o,(new Date).getTime())}(m.code,M),w={cmd:M,raw:m,error:T,service:null==C?void 0:C.service,content:{}};if(w.error){if(w.error.cmd=M,w.error.callFunc="parseCmd",!(null===(c=null==C?void 0:C.ignoreErrCodes)||void 0===c?void 0:includes(c).call(c,m.code)))return w;a.warn("parseCmd:: ignore error ",w.error),w.error.ignore=!0}if(!M||!C)return w.notFound=!0,w;C.response&&forEach$1(S=C.response).call(S,(function(t,a){var o=v[a],c=t.type,m=t.name,h=t.reflectMapper;if(!vc(o))switch(c){case"Property":w.content[m]=h?deserialize(o,h):o;break;case"PropertyArray":w.content[m]=map(o).call(o,(function(t){return h?deserialize(t,h):t}));break;case"long":case"Long":case"byte":case"Byte":case"Number":w.content[m]=+o;break;default:w.content[m]=o}}));return w}function serialize(t,a){var o={};for(var c in t)void 0!==a[c]&&(o[a[c]]=t[c]);return o}function deserialize(t,a){var o={};for(var c in t)void 0!==a[c]&&(o[a[c]]=t[c]);return o}function registerParser(t){bc=fi(bc,t.cmdConfig),Sc=fi(Sc,t.cmdMap)}function invertSerializeMap(t){var a;return reduce(a=ui(t)).call(a,(function(a,o){var c,m=t[o];return a[o]=reduce(c=ui(m)).call(c,(function(t,a){return t[m[a]]=a,t}),{}),a}),{})}var Mc=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],Cc=["transport not supported","client not handshaken","unauthorized"],Tc=["reconnect"],_c=/*#__PURE__*/function(t){function NIMWebsocket(a,o,c){var m;return(m=t.call(this)||this).url=o,m.logger=c,m.websocket=null,m.core=a,m.url=o,m.status="disconnected",m.logger=c,m.connect(),m}Mt(NIMWebsocket,t);var a=NIMWebsocket.prototype;return a.connect=function connect(){var t=this;"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this.core.adapters.request("https://"+this.url+"/socket.io/1/?t="+os(),{method:"GET",dataType:"text",timeout:8e3}).then((function(a){var o=a.data.split(":"),c=o[0],m=o[1];return t.sessionId=c,t.closeTimeout=1e3*m,t._createWebsocket("wss://"+t.url+"/socket.io/1/websocket/"+c)})).catch((function(a){t.logger.error("imsocket::handshake fail. ",a&&a.message),t.status="disconnected",t.emit("handshakeFailed")}))):this.logger.warn("imsocket::socket is connecting or connected",this.status)},a.close=function close(){var t;if(this.websocket){this.status="disconnected",this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null;try{null===(t=this.websocket)||void 0===t||t.send(this.encodePacket({type:"disconnect"})),this.websocket.close()}catch(t){this.logger.warn("attempt to close websocket error",t)}this.websocket.onclose=null,this.websocket=null,this.emit("disconnect")}},a.onConnect=function onConnect(){this.status="connected",this.resetCloseTimer(),this.emit("connect")},a._createWebsocket=function _createWebsocket(t){var a,o=this;this.websocket=new pc.WebSocket(t),this.websocket.onmessage=bind$1(a=this.onMessage).call(a,this),this.websocket.onclose=function(){o.logger.log("imsocket:: websocket onclose done"),"disconnected"!==o.status&&(o.logger.log("imsocket:: close()",o.status),o.close())},this.websocket.onerror=function(t){o.logger.error("imsocket:: onerror",t)}},a.onMessage=function onMessage(t){var a;this.resetCloseTimer();var o=this.decodePacket(t.data);if(o)switch(o.type){case"connect":this.onConnect();break;case"disconnect":this.close();break;case"message":case"json":this.emit("message",o.data);break;case"event":o.name&&this.emit(o.name,o.args);break;case"error":"unauthorized"===o.reason?this.emit("connect_failed",o.reason):this.emit("error",o.reason);break;case"heartbeat":null===(a=this.websocket)||void 0===a||a.send(this.encodePacket({type:"heartbeat"}));break;default:this.logger.warn("imsocket::no handler type",o.type)}},a.encodePacket=function encodePacket(t){var a,o,c=t.type,m=t.id,h=void 0===m?"":m,v=t.endpoint,b=void 0===v?"":v,S=t.ack,M=null;if(!c)return"";switch(c){case"error":a=t.reason?indexOf(Cc).call(Cc,t.reason):"",o=t.advice?indexOf(Tc).call(Tc,t.advice):"",""===a&&""===o||(M=a+(""!==o?"+"+o:""));break;case"message":""!==t.data&&(M=t.data);break;case"event":a={name:t.name},a=t.args&&t.args.length?{name:t.name,args:t.args}:{name:t.name},M=gi(a);break;case"json":M=gi(t.data);break;case"connect":t.qs&&(M=t.qs);break;case"ack":M=t.ackId+(t.args&&t.args.length?"+"+gi(t.args):"")}var C=[indexOf(Mc).call(Mc,c),h+("data"===S?"+":""),b];return null!=M&&C.push(M),C.join(":")},a.decodePacket=function decodePacket(t){if(t)if("�"!=t.charAt(0)){var a=t.match(/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);if(a){var o,c=a[1],m=a[2],h=a[3],v=a[4],b=a[5],S={type:Mc[+c],endpoint:v};switch(m&&(S.id=m,S.ack=!h||"data"),S.type){case"error":o=b.split("+"),S.reason=Cc[+o[0]]||"";break;case"message":S.data=b||"";break;case"connect":S.qs=b||"";break;case"event":try{var M=JSON.parse(b);S.name=M.name,S.args=M.args}catch(t){this.logger.error("imsocket::parseData::type::event error",t)}S.args=S.args||[];break;case"json":try{S.data=JSON.parse(b)}catch(t){this.logger.error("imsocket::parseData::type::json error",t)}break;case"ack":if((o=b.match(/^([0-9]+)(\+)?(.*)/))&&(S.ackId=o[1],S.args=[],o[3]))try{S.args=o[3]?JSON.parse(o[3]):[]}catch(t){this.logger.error("imsocket::parseData::type::ack error",t)}}return S}}else this.logger.error("imsocket::unrecognize dataStr",slice(t).call(t,0,20))},a.send=function send(t){var a,o={data:t,type:"message",endpoint:""};null===(a=this.websocket)||void 0===a||a.send(this.encodePacket(o))},a.resetCloseTimer=function resetCloseTimer(){var t=this;this.closeTimeout&&(clearTimeout(this.closeTimer),this.closeTimer=rs((function(){t.close()}),this.closeTimeout))},NIMWebsocket}(us),wc=entryVirtual("Array").values,Ic=Array.prototype,kc={DOMTokenList:!0,NodeList:!0},values=function(t){var a=t.values;return t===Ic||G(Ic,t)&&a===Ic.values||ue(kc,Rt(t))?wc:a};_export({target:"Array",stat:!0},{isArray:Ct});var xc=H.Array.isArray,Rc=Sr.every,Ec=arrayMethodIsStrict("every");_export({target:"Array",proto:!0,forced:!Ec},{every:function every(t){return Rc(this,t,arguments.length>1?arguments[1]:void 0)}});var Ac=entryVirtual("Array").every,qc=Array.prototype,every=function(t){var a=t.every;return t===qc||G(qc,t)&&a===qc.every?Ac:a};var Pc=function isObjectLike(t){return null!=t&&"object"==typeof t};var Oc=function baseIsRegExp(t){return Pc(t)&&"[object RegExp]"==_s(t)};var Uc=function baseUnary(t){return function(a){return t(a)}},Bc=createCommonjsModule((function(t,a){var o=a&&!a.nodeType&&a,c=o&&t&&!t.nodeType&&t,m=c&&c.exports===o&&ps.process,h=function(){try{var t=c&&c.require&&c.require("util").types;return t||m&&m.binding&&m.binding("util")}catch(t){}}();t.exports=h})),Fc=Bc&&Bc.isRegExp,Lc=Fc?Uc(Fc):Oc,jc=hs["__core-js_shared__"],Nc=function(){var t=/[^.]+$/.exec(jc&&jc.keys&&jc.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();var Dc=function isMasked(t){return!!Nc&&Nc in t},$c=Function.prototype.toString;var Hc=function toSource(t){if(null!=t){try{return $c.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Gc=/^\[object .+?Constructor\]$/,Qc=Function.prototype,Wc=Object.prototype,Vc=Qc.toString,Kc=Wc.hasOwnProperty,zc=RegExp("^"+Vc.call(Kc).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Jc=function baseIsNative(t){return!(!ws(t)||Dc(t))&&(Is(t)?zc:Gc).test(Hc(t))};var Yc=function getValue(t,a){return null==t?void 0:t[a]};var Xc=function getNative(t,a){var o=Yc(t,a);return Jc(o)?o:void 0},Zc=Xc(Object,"create");var el=function hashClear(){this.__data__=Zc?Zc(null):{},this.size=0};var tl=function hashDelete(t){var a=this.has(t)&&delete this.__data__[t];return this.size-=a?1:0,a},rl=Object.prototype.hasOwnProperty;var nl=function hashGet(t){var a=this.__data__;if(Zc){var o=a[t];return"__lodash_hash_undefined__"===o?void 0:o}return rl.call(a,t)?a[t]:void 0},al=Object.prototype.hasOwnProperty;var ol=function hashHas(t){var a=this.__data__;return Zc?void 0!==a[t]:al.call(a,t)};var il=function hashSet(t,a){var o=this.__data__;return this.size+=this.has(t)?0:1,o[t]=Zc&&void 0===a?"__lodash_hash_undefined__":a,this};function Hash(t){var a=-1,o=null==t?0:t.length;for(this.clear();++a<o;){var c=t[a];this.set(c[0],c[1])}}Hash.prototype.clear=el,Hash.prototype.delete=tl,Hash.prototype.get=nl,Hash.prototype.has=ol,Hash.prototype.set=il;var sl=Hash;var cl=function listCacheClear(){this.__data__=[],this.size=0};var ll=function eq(t,a){return t===a||t!=t&&a!=a};var ul=function assocIndexOf(t,a){for(var o=t.length;o--;)if(ll(t[o][0],a))return o;return-1},dl=Array.prototype.splice;var pl=function listCacheDelete(t){var a=this.__data__,o=ul(a,t);return!(o<0)&&(o==a.length-1?a.pop():dl.call(a,o,1),--this.size,!0)};var ml=function listCacheGet(t){var a=this.__data__,o=ul(a,t);return o<0?void 0:a[o][1]};var hl=function listCacheHas(t){return ul(this.__data__,t)>-1};var fl=function listCacheSet(t,a){var o=this.__data__,c=ul(o,t);return c<0?(++this.size,o.push([t,a])):o[c][1]=a,this};function ListCache(t){var a=-1,o=null==t?0:t.length;for(this.clear();++a<o;){var c=t[a];this.set(c[0],c[1])}}ListCache.prototype.clear=cl,ListCache.prototype.delete=pl,ListCache.prototype.get=ml,ListCache.prototype.has=hl,ListCache.prototype.set=fl;var gl=ListCache,yl=Xc(hs,"Map");var vl=function mapCacheClear(){this.size=0,this.__data__={hash:new sl,map:new(yl||gl),string:new sl}};var bl=function isKeyable(t){var a=typeof t;return"string"==a||"number"==a||"symbol"==a||"boolean"==a?"__proto__"!==t:null===t};var Sl=function getMapData(t,a){var o=t.__data__;return bl(a)?o["string"==typeof a?"string":"hash"]:o.map};var Ml=function mapCacheDelete(t){var a=Sl(this,t).delete(t);return this.size-=a?1:0,a};var Cl=function mapCacheGet(t){return Sl(this,t).get(t)};var Tl=function mapCacheHas(t){return Sl(this,t).has(t)};var _l=function mapCacheSet(t,a){var o=Sl(this,t),c=o.size;return o.set(t,a),this.size+=o.size==c?0:1,this};function MapCache(t){var a=-1,o=null==t?0:t.length;for(this.clear();++a<o;){var c=t[a];this.set(c[0],c[1])}}MapCache.prototype.clear=vl,MapCache.prototype.delete=Ml,MapCache.prototype.get=Cl,MapCache.prototype.has=Tl,MapCache.prototype.set=_l;var wl=MapCache;var Il=function setCacheAdd(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var kl=function setCacheHas(t){return this.__data__.has(t)};function SetCache(t){var a=-1,o=null==t?0:t.length;for(this.__data__=new wl;++a<o;)this.add(t[a])}SetCache.prototype.add=SetCache.prototype.push=Il,SetCache.prototype.has=kl;var xl=SetCache;var Rl=function baseFindIndex(t,a,o,c){for(var m=t.length,h=o+(c?1:-1);c?h--:++h<m;)if(a(t[h],h,t))return h;return-1};var El=function baseIsNaN(t){return t!=t};var Al=function strictIndexOf(t,a,o){for(var c=o-1,m=t.length;++c<m;)if(t[c]===a)return c;return-1};var ql=function baseIndexOf(t,a,o){return a==a?Al(t,a,o):Rl(t,El,o)};var Pl=function arrayIncludes(t,a){return!!(null==t?0:t.length)&&ql(t,a,0)>-1};var Ol=function arrayIncludesWith(t,a,o){for(var c=-1,m=null==t?0:t.length;++c<m;)if(o(a,t[c]))return!0;return!1};var Ul=function arrayMap(t,a){for(var o=-1,c=null==t?0:t.length,m=Array(c);++o<c;)m[o]=a(t[o],o,t);return m};var Bl=function cacheHas(t,a){return t.has(a)};var Fl=function baseDifference(t,a,o,c){var m=-1,h=Pl,v=!0,b=t.length,S=[],M=a.length;if(!b)return S;o&&(a=Ul(a,Uc(o))),c?(h=Ol,v=!1):a.length>=200&&(h=Bl,v=!1,a=new xl(a));e:for(;++m<b;){var C=t[m],T=null==o?C:o(C);if(C=c||0!==C?C:0,v&&T==T){for(var w=M;w--;)if(a[w]===T)continue e;S.push(C)}else h(a,T,c)||S.push(C)}return S};var Ll=function identity(t){return t};var jl=function apply(t,a,o){switch(o.length){case 0:return t.call(a);case 1:return t.call(a,o[0]);case 2:return t.call(a,o[0],o[1]);case 3:return t.call(a,o[0],o[1],o[2])}return t.apply(a,o)},Nl=Math.max;var Dl=function overRest(t,a,o){return a=Nl(void 0===a?t.length-1:a,0),function(){for(var c=arguments,m=-1,h=Nl(c.length-a,0),v=Array(h);++m<h;)v[m]=c[a+m];m=-1;for(var b=Array(a+1);++m<a;)b[m]=c[m];return b[a]=o(v),jl(t,this,b)}};var $l=function constant(t){return function(){return t}},Hl=function(){try{var t=Xc(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Gl=Hl?function(t,a){return Hl(t,"toString",{configurable:!0,enumerable:!1,value:$l(a),writable:!0})}:Ll,Ql=Date.now;var Wl=function shortOut(t){var a=0,o=0;return function(){var c=Ql(),m=16-(c-o);if(o=c,m>0){if(++a>=800)return arguments[0]}else a=0;return t.apply(void 0,arguments)}}(Gl);var Vl=function baseRest(t,a){return Wl(Dl(t,a,Ll),t+"")};var Kl=function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991};var zl=function isArrayLike(t){return null!=t&&Kl(t.length)&&!Is(t)};var Jl=function isArrayLikeObject(t){return Pc(t)&&zl(t)},Yl=Vl((function(t,a){return Jl(t)?Fl(t,a):[]})),Xl=Yl;function replacer(t,a){return a instanceof RegExp?"__REGEXP "+a.toString():a}function validate(t,a,o){var c;void 0===a&&(a={});var m={};return forEach$1(c=ui(t)).call(c,(function(c){var h=t[c].type,v=o?"In "+o+", ":"";if(void 0===a[c]){if(!1===t[c].required)return void(m[c]=a[c]);throw new rc(v+'param "'+c+'" is required',{key:c},"required")}var b=Zl[h];if(b&&!b(a,c,t[c]))throw new rc(v+'param "'+c+'" expects '+gi(t[c],replacer),{key:c,value:a[c]},gi(t[c]));m[c]=a[c]})),m}var Zl={string:function string(t,a,o){var c=o.allowEmpty,m=o.max,h=o.min,v=o.regExp,b=t[a];return"string"==typeof b&&((!1!==c||""!==b)&&(!("number"==typeof m&&b.length>m)&&(!("number"==typeof h&&b.length<h)&&!(Lc(v)&&!v.test(b)))))},number:function number(t,a,o){var c=o.min,m=o.max,h=t[a];return"number"==typeof h&&(!("number"==typeof c&&h<c)&&!("number"==typeof m&&h>m))},boolean:function boolean(t,a){return"boolean"==typeof t[a]},enum:function _enum(t,a,o){var c=values(o),m=t[a];return!c||indexOf(c).call(c,m)>-1},array:function array(t,a,o){var c,m=o.itemType,h=o.rules,v=o.min,b=o.max,S=values(o),M=t[a];return!!xc(M)&&(!("number"==typeof b&&M.length>b)&&(!("number"==typeof v&&M.length<v)&&(!(m&&"enum"!==m&&!every(M).call(M,(function(t){return typeof t===m})))&&(("enum"!==m||!S||!Xl.apply(void 0,concat(c=[M]).call(c,S)).length)&&(h&&forEach$1(M).call(M,(function(t,o){return validate(h,t,a+"["+o+"]")})),!0)))))},object:function object(t,a,o){var c=o.rules,m=t[a];return c&&validate(c,m,a),!0}},eu=Xc(hs,"Set");var tu=function noop(){};var ru=function setToArray(t){var a=-1,o=Array(t.size);return t.forEach((function(t){o[++a]=t})),o},nu=eu&&1/ru(new eu([,-0]))[1]==1/0?function(t){return new eu(t)}:tu,au=nu;var ou=function baseUniq(t,a,o){var c=-1,m=Pl,h=t.length,v=!0,b=[],S=b;if(o)v=!1,m=Ol;else if(h>=200){var M=a?null:au(t);if(M)return ru(M);v=!1,m=Bl,S=new xl}else S=a?[]:b;e:for(;++c<h;){var C=t[c],T=a?a(C):C;if(C=o||0!==C?C:0,v&&T==T){for(var w=S.length;w--;)if(S[w]===T)continue e;a&&S.push(T),b.push(C)}else m(S,T,o)||(S!==b&&S.push(T),b.push(C))}return b};var iu=function uniq(t){return t&&t.length?ou(t):[]},su=Sr.filter,cu=arrayMethodHasSpeciesSupport("filter");_export({target:"Array",proto:!0,forced:!cu},{filter:function filter(t){return su(this,t,arguments.length>1?arguments[1]:void 0)}});var lu=entryVirtual("Array").filter,uu=Array.prototype,filter=function(t){var a=t.filter;return t===uu||G(uu,t)&&a===uu.filter?lu:a},du="\t\n\v\f\r                　\u2028\u2029\ufeff",pu=k("".replace),mu="["+du+"]",hu=RegExp("^"+mu+mu+"*"),fu=RegExp(mu+mu+"*$"),createMethod=function(t){return function(a){var o=toString$1(requireObjectCoercible(a));return 1&t&&(o=pu(o,hu,"")),2&t&&(o=pu(o,fu,"")),o}},gu={start:createMethod(1),end:createMethod(2),trim:createMethod(3)}.trim,yu=m.parseInt,vu=m.Symbol,bu=vu&&vu.iterator,Su=/^[+-]?0x/i,Mu=k(Su.exec),Cu=8!==yu(du+"08")||22!==yu(du+"0x16")||bu&&!fails((function(){yu(Object(bu))}))?function parseInt(t,a){var o=gu(toString$1(t));return yu(o,a>>>0||(Mu(Su,o)?16:10))}:yu;_export({global:!0,forced:parseInt!=Cu},{parseInt:Cu});var Tu,_u=H.parseInt,wu=(Tu=function _s4(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return Tu()+Tu()+Tu()+Tu()+Tu()+Tu()+Tu()+Tu()});function getEnumKeys(t){var a;return filter(a=ui(t)).call(a,(function(t){return!(+t>=0)}))}function getEnumKeyByEnumValue(t,a){var o,c=filter(o=ui(t)).call(o,(function(o){return t[o]==a}));return c.length>0?c[0]:void 0}function getAccountFromSessionId(t,a){if(void 0===a&&(a="-"),!t)throw new Error("No sessionId");var o=indexOf(t).call(t,a);if(-1===o)throw new Error("Can not find conjunctions");var c=slice(t).call(t,0,o);return{accid:slice(t).call(t,o+1),scene:"super_team"===c?"superTeam":c}}function getMiniappEnv(){return"undefined"!=typeof tt&&tt.getSystemInfo?"TT":"undefined"!=typeof swan&&swan.getSystemInfo?"BAIDU":"undefined"!=typeof my&&my.getSystemInfo?"ALI":"undefined"!=typeof wx&&wx.getSystemInfo?"WX":"unknow environment"}var Iu=TypeError,ku=Object.getOwnPropertyDescriptor,xu=x&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,a){if(Ct(t)&&!ku(t,"length").writable)throw Iu("Cannot set read only .length");return t.length=a}:function(t,a){return t.length=a},Ru=TypeError,deletePropertyOrThrow=function(t,a){if(!delete t[a])throw Ru("Cannot delete property "+tryToString(a)+" of "+tryToString(t))},Eu=arrayMethodHasSpeciesSupport("splice"),Au=Math.max,qu=Math.min;_export({target:"Array",proto:!0,forced:!Eu},{splice:function splice(t,a){var o,c,m,h,v,b,S=toObject(this),M=lengthOfArrayLike(S),C=toAbsoluteIndex(t,M),T=arguments.length;for(0===T?o=c=0:1===T?(o=0,c=M-C):(o=T-2,c=qu(Au(toIntegerOrInfinity(a),0),M-C)),doesNotExceedSafeInteger(M+o-c),m=arraySpeciesCreate(S,c),h=0;h<c;h++)(v=C+h)in S&&createProperty(m,h,S[v]);if(m.length=c,o<c){for(h=C;h<M-c;h++)b=h+o,(v=h+c)in S?S[b]=S[v]:deletePropertyOrThrow(S,b);for(h=M;h>M-c+o;h--)deletePropertyOrThrow(S,h-1)}else if(o>c)for(h=M-c;h>C;h--)b=h+o-1,(v=h+c-1)in S?S[b]=S[v]:deletePropertyOrThrow(S,b);for(h=0;h<o;h++)S[h+C]=arguments[h+2];return xu(S,M-c+o),m}});var Pu=entryVirtual("Array").splice,Ou=Array.prototype,splice=function(t){var a=t.splice;return t===Ou||G(Ou,t)&&a===Ou.splice?Pu:a},callWithSafeIterationClosing=function(t,a,o,c){try{return c?a(anObject(o)[0],o[1]):a(o)}catch(a){iteratorClose(t,"throw",a)}},Uu=Array,Bu=!checkCorrectnessOfIteration((function(t){Array.from(t)}));_export({target:"Array",stat:!0,forced:Bu},{from:function from(t){var a=toObject(t),o=jt(this),c=arguments.length,m=c>1?arguments[1]:void 0,h=void 0!==m;h&&(m=functionBindContext(m,c>2?arguments[2]:void 0));var v,b,S,M,C,T,w=getIteratorMethod$5(a),I=0;if(!w||this===Uu&&isArrayIteratorMethod(w))for(v=lengthOfArrayLike(a),b=o?new this(v):Uu(v);v>I;I++)T=h?m(a[I],I):a[I],createProperty(b,I,T);else for(C=(M=getIterator(a,w)).next,b=o?new this:[];!(S=E(C,M)).done;I++)T=h?callWithSafeIterationClosing(M,m,[S.value,I],!0):S.value,createProperty(b,I,T);return b.length=I,b}});var Fu=H.Array.from,Lu=getIteratorMethod$5;function _createForOfIteratorHelperLoose$2(t,a){var o,c=void 0!==Ln&&Lu(t)||t["@@iterator"];if(c)return bind$1(o=(c=c.call(t)).next).call(o,c);if(xc(t)||(c=function _unsupportedIterableToArray$2(t,a){var o;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$2(t,a);var c=slice(o=Object.prototype.toString.call(t)).call(o,8,-1);"Object"===c&&t.constructor&&(c=t.constructor.name);if("Map"===c||"Set"===c)return Fu(t);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray$2(t,a)}(t))||a&&t&&"number"==typeof t.length){c&&(t=c);var m=0;return function(){return m>=t.length?{done:!0}:{done:!1,value:t[m++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$2(t,a){(null==a||a>t.length)&&(a=t.length);for(var o=0,c=new Array(a);o<a;o++)c[o]=t[o];return c}var ju,Nu=/*#__PURE__*/function(){function TimerManager(){this.timerList=[],this.id=0,this.timer=null,this.timeout=0}var t=TimerManager.prototype;return t.addTimer=function addTimer(t,a,o){void 0===a&&(a=0),void 0===o&&(o=1);var c=(new Date).getTime(),m=this.id;return this.timerList.push({id:m,loop:o,count:0,timeout:c+a,interval:a,callback:t}),this.id++,this.checkTimer(c),m},t.checkTimer=function checkTimer(t){if(void 0===t&&(t=(new Date).getTime()),this.removeFinished(),0!==this.timerList.length||null==this.timer){for(var a,o,c=0,m=_createForOfIteratorHelperLoose$2(this.timerList);!(a=m()).done;){var h=a.value;(0===c||c>h.timeout)&&(c=h.timeout)}if(0!==this.timerList.length)if(null===this.timer||c<this.timeout||this.timeout<t)this.timer=rs(bind$1(o=this.nowTime).call(o,this),c-t),this.timeout=c}},t.nowTime=function nowTime(){for(var t,nowTime=(new Date).getTime(),a=_createForOfIteratorHelperLoose$2(this.timerList);!(t=a()).done;){var o=t.value;nowTime>=o.timeout&&(o.callback(),o.count++,o.timeout=nowTime+o.interval)}this.clerTime(),this.checkTimer(nowTime)},t.clerTime=function clerTime(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.deleteTimer=function deleteTimer(t){for(var a=this.timerList.length-1;a>=0;a--){var o;if(this.timerList[a].id===t)splice(o=this.timerList).call(o,a,1)}},t.removeFinished=function removeFinished(){for(var t=this.timerList.length-1;t>=0;t--){var a,o=this.timerList[t];if(o.loop>=0&&o.count>=o.loop)splice(a=this.timerList).call(a,t,1)}},t.destroy=function destroy(){this.clerTime(),this.timerList=[],this.id=0,this.timer=null},TimerManager}(),Du=/*#__PURE__*/function(){function CoreAdapters(t){this.core=t}var t=CoreAdapters.prototype;return t.request=function request(t,a){var o=this,c=(new Date).getTime();return pc.request(t,a).catch((function(m){var h,v,b=m;throw o.core.reporter.reportTraceStart("exceptions",{user_id:o.core.options.account,trace_id:null===(v=null===(h=o.core)||void 0===h?void 0:h.socket)||void 0===v?void 0:v.sessionId,start_time:c,action:1}),o.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof b.code?b.code:0,description:b.message||""+b.code,operation_type:0,target:t,context:a?gi(a):""}),o.core.reporter.reportTraceEnd("exceptions",1),m}))},t.uploadFile=function uploadFile(t){var a=this,o=(new Date).getTime();return pc.uploadFile(t).catch((function(c){var m,h,v=c;a.core.reporter.reportTraceStart("exceptions",{user_id:a.core.options.account,trace_id:null===(h=null===(m=a.core)||void 0===m?void 0:m.socket)||void 0===h?void 0:h.sessionId,start_time:o,action:1});var b="BROWSER"===pc.platform?t.chunkUploadHost:t.commonUploadHost?t.commonUploadHost+"/"+(t.nosToken&&t.nosToken.bucket):"https://nos.netease.com/nim";throw a.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof v.code?v.code:0,description:v.message||""+v.code,operation_type:1,target:b}),a.core.reporter.reportTraceEnd("exceptions",1),c}))},CoreAdapters}();!function(t){t[t.ACTIVE=1]="ACTIVE",t[t.KICKED=2]="KICKED",t[t.OFFLINE=3]="OFFLINE"}(ju||(ju={}));var $u=window&&Is(window.addEventListener)&&Is(window.removeEventListener),Hu=/*#__PURE__*/function(t){function Core(a,o){var m;(m=t.call(this)||this).status="unconnected",m.linkUrls=[],m.eventBus=new us,m.packetSer=1,m.retryCount=0,m.reconnectTimer=0,m.backoff=new ds({max:8e3,min:1600,jitter:.01}),m.sendingCmdMap=new Ji,m.pingTimer=0,m.config=ks,m.abtInfo={},validate({linkUrls:{type:"array",itemType:"string",required:!1}},a),m.options=fi(fi({},xs),a),m.adapters=new Du(c(m));var h=pc.localStorage.getItem("__NIM_DEVC_ID__");m.options.isFixedDeviceId?(h=pc.localStorage.getItem("__NIM_DEVC_ID__")||wu(),pc.localStorage.setItem("__NIM_DEVC_ID__",h)):h=wu(),m.config=fi(fi(fi({},ks),o),{deviceId:h}),m.timerManager=new Nu,m.logger=new uc(m.options.debugLevel,m.options.account);var v=pc.getSystemInfo();return m.reporter=new dc({common:{app_key:a.appkey,dev_id:h,platform:"Web",sdk_ver:"0.12.3",env:"online",os_name:v.os,os_ver:v.osVer,host_env:v.hostEnv,host_info:v.hostInfo,host_env_ver:v.hostEnvVer},request:pc.request,logger:m.logger,autoStart:"BROWSER"===pc.platform}),pc.setLogger(m.logger),m.logger.log("Core init, version ","0.12.3"," sdk version ",90903," appkey ",a.appkey),m}Mt(Core,t);var a=Core.prototype;return a.connect=function connect(t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var a,o,c,m,h,v;return ci.wrap((function _callee$(b){for(;;)switch(b.prev=b.next){case 0:if(validate({linkUrls:{type:"array",itemType:"string",required:!1}},t),/^(unconnected|waitReconnect)$/.test(this.status)){b.next=5;break}return a="Core socket status is "+this.status+", and would not connect",this.logger.warn(a),b.abrupt("return",zo.reject(a));case 5:this.status="connecting",t.linkUrls&&t.linkUrls.length>0&&(this.linkUrls=concat(o=t.linkUrls).call(o,this.linkUrls),this.linkUrls=iu(this.linkUrls)),0===this.linkUrls.length&&this.linkUrls.push("weblink.netease.im:443"),c=0;case 9:if(!(c<this.linkUrls.length)){b.next=33;break}return m=this.linkUrls[c],h=(new Date).getTime(),b.prev=12,b.next=15,this.doConnect(m);case 15:return this.reporter.reportTraceUpdate("login",{operation_type:"TCP",target:m}),this.status="connected",this.logger.log("core:: connect success with url: "+m),this.abtRequest(),b.abrupt("return",m);case 22:b.prev=22,b.t0=b.catch(12),v=b.t0,this.reporter.reportTraceUpdate("login",{operation_type:"TCP",error:"ws_handshake_failed",target:m},!1),this.reporter.reportTraceStart("exceptions",{user_id:this.options.account,start_time:h,action:0}),this.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof v.code?v.code:0,description:v.message||""+v.code,operation_type:0,target:m}),this.reporter.reportTraceEnd("exceptions",1),this.logger.warn("core:: connect failed with url: "+m,b.t0);case 30:c++,b.next=9;break;case 33:throw this.reporter.reportTraceEnd("login",!1),0===this.retryCount?this.doDisconnect(ju.ACTIVE,"SocketHandshakeFailed"):this.doDisconnect(ju.OFFLINE,"ReconnectHadRetryAllLinks"),new Error("core: socket handshake failed");case 36:case"end":return b.stop()}}),_callee,this,[[12,22]])})))},a.doConnect=function doConnect(t){var a=this;return new zo((function(o,c){var m;a.socket=new _c(a,t,a.logger),a.socket.on("connect",(function(){a.logger.log("socket on connect",t),o()})),a.socket.on("message",bind$1(m=a.onMessage).call(m,a)),a.socket.on("disconnect",(function(t){a.logger.log("core:: socket on disconnect",t),a.doDisconnect(ju.OFFLINE,"SocketOnDisconnect")})),a.socket.on("handshakeFailed",(function(){a.logger.warn("core:: socket handshake failed"),c(new tc("handshake failed",{},408))}))}))},a.resetConnectStatus=function resetConnectStatus(){clearTimeout(this.reconnectTimer),this.backoff.reset(),this.retryCount=0,this.initOnlineListener()},a.doDisconnect=function doDisconnect(t,a){if(this.logger.log("doDisconnect: type "+t+", description "+a),"unconnected"!==this.status){this.markAllCmdInvaild(new tc("Packet timeout due to instance disconnect",{},408)),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0);var o=!this.options.needReconnect||this.retryCount>=this.options.reconnectionAttempts;if(t===ju.ACTIVE||o)this.logger.log("doDisconnect: emit disconnect, type "+t,o),this.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.eventBus.emit("disconnect"),this.emit("disconnect"),this.destroyOnlineListener();else if(t===ju.KICKED){this.logger.log("doDisconnect: kicked"),this.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer);var c="string"==typeof a?{reason:"unknow",message:a}:a;this.eventBus.emit("kicked",c),this.emit("kicked",c),this.destroyOnlineListener()}else t===ju.OFFLINE?(this.logger.log("doDisconnect: start to reconnect"),this.attempToReconnect()):this.logger.log("doDisconnect: nothing to do")}else this.logger.warn("doDisconnect: already unconnected")},a.attempToReconnect=function attempToReconnect(){var t=this;if("waitReconnect"!==this.status){var a=this.backoff.duration();this.retryCount++,this.logger.log("willReconnect "+this.retryCount+" "+a),this.eventBus.emit("willReconnect",{retryCount:this.retryCount,duration:a}),this.emit("willReconnect",{retryCount:this.retryCount,duration:a}),this.status="waitReconnect",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectTimer=rs((function(){"waitReconnect"===t.status?t.connect({isAutoReconnect:!0}).catch((function(){t.logger.error("core::attempToReconnect failed "+t.retryCount)})):t.logger.warn("doDisconnect: reconnectTimer status is "+t.status+", would not go on reconnecting")}),a)}else this.logger.warn("doDisconnect: already is waiting reconnect")},a.sendCmd=function sendCmd(t,a,o){var c=this;if("logined"!==this.status&&"login"!==t&&"chatroomLogin"!==t&&"qchatLogin"!==t)return this.logger.warn("nim status is "+this.status+", so can not sendCmd "+t),zo.reject({cmd:t,error:{code:"No_connected",message:"Connection not established",timetag:(new Date).getTime()}});if(!this.socket||!this.socket.send)return zo.reject("No_socket");var m="heartbeat"!==t,h=m?this.packetSer++:0,v=function createCmd(t,a,o,c){var m=bc[t];if(!m)return o.error("createCmd:: can not find cmd config: ",t),null;var h,v={SER:a,SID:m.sid,CID:m.cid,Q:[]};return m.params&&c&&forEach$1(h=m.params).call(h,(function(t){var a=c[t.name];if(!vc(a)){var o=t.type,m=t.reflectMapper;switch(t.type){case"PropertyArray":o="ArrayMable",a=map(a).call(a,(function(t){return{t:"Property",v:m?serialize(t,m):t}}));break;case"Property":a=m?serialize(a,m):a;break;case"Bool":case"bool":a=a?"true":"false"}v.Q.push({t:o,v:a})}})),{packet:v,isNoResponse:m.isNoResponse||!1}}(t,h,this.logger,a);if(!v){var b="SendCmd "+h+" "+t+" error";return this.logger.error(b),zo.reject(b)}var S=v.packet,M=v.isNoResponse,C=gi(S);m&&("debug"===this.options.debugLevel?this.logger.debug("core::sendCmd",t,"ser:"+h,C):this.logger.log("core::sendCmd",t,"ser:"+h));var T=(new Date).getTime();return new zo((function(m,v){c.sendingCmdMap.set(h,{cmd:t,params:a,callback:[m,v],timer:M?null:rs((function(){var a,o=new ac(504,t,"Packet Timeout",(new Date).getTime(),{message:"ser "+h+" cmd "+t+" timeout"});o.callFunc="sendCmd",c.markCmdInvalid(h,o,t),c.reporter.reportTraceStart("exceptions",{user_id:c.options.account,trace_id:null===(a=c.socket)||void 0===a?void 0:a.sessionId,start_time:T,action:2}),c.reporter.reportTraceUpdateV2("exceptions",{code:408,description:"Packet timeout",operation_type:1,target:S.SID+"-"+S.CID,context:""+S.SER}),c.reporter.reportTraceEnd("exceptions",1)}),o&&o.timeout?o.timeout:c.config.timeout)});try{c.socket.send(C)}catch(a){var b=new ac(415,t,a&&a.message||"Unable to send packet",(new Date).getTime(),{message:"send json error",rawError:a});b.callFunc="sendCmd",c.markCmdInvalid(h,b,t),v(a)}}))},a.onMessage=function onMessage(t){var a=parseCmd(t,this.logger);if(a){var o=a.raw.ser;if(a.error&&this.logger.error("core:onMessage packet error",a.raw.sid+"_"+a.raw.cid+", ser:"+o+",",a.error),!a.notFound)return"heartbeat"!==a.cmd&&("debug"===this.options.debugLevel?this.logger.debug("imsocket::recvCmd ser:"+o,a.cmd,a.content):this.logger.log("imsocket::recvCmd ser:"+o,a.cmd)),a.__receiveTime=os(),a;this.logger.warn("core::onMessage packet not found",a.raw.sid+"_"+a.raw.cid+", ser:"+o)}},a.markCmdInvalid=function markCmdInvalid(t,a,o){var c=this.sendingCmdMap.get(t);if(c){var m=c.callback,h=c.timer;h&&clearTimeout(h),this.sendingCmdMap.delete(t),this.logger.warn("packet "+t+", "+o+" is invalid:",a),m[1](a)}},a.markAllCmdInvaild=function markAllCmdInvaild(t){var a;this.logger.log("markAllCmdInvaild"),forEach$1(a=this.sendingCmdMap).call(a,(function(a){var o=a.callback,c=a.timer;c&&clearTimeout(c),o[1](t)})),this.sendingCmdMap.clear()},a.ping=function ping(){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var t=this;return ci.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return clearTimeout(this.pingTimer),a.prev=1,a.next=4,this.sendCmd("heartbeat");case 4:a.next=14;break;case 6:return a.prev=6,a.t0=a.catch(1),a.next=10,this.testHeartBeat5Timeout();case 10:if(!a.sent){a.next=14;break}return this.doDisconnect(ju.OFFLINE,"PingError"),a.abrupt("return");case 14:this.pingTimer=rs((function(){t.ping()}),3e4);case 15:case"end":return a.stop()}}),_callee2,this,[[1,6]])})))},a.testHeartBeat5Timeout=function testHeartBeat5Timeout(){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var t;return ci.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){a.next=15;break}return a.prev=3,a.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return a.abrupt("return",!1);case 9:a.prev=9,a.t0=a.catch(3),this.logger.debug("core:: test heartbeat "+t+" Timeout");case 12:t++,a.next=2;break;case 15:return a.abrupt("return",!0);case 16:case"end":return a.stop()}}),_callee3,this,[[3,9]])})))},a.initOnlineListener=function initOnlineListener(){var t,a;this.onlineListener||($u?(this.onlineListener=bind$1(t=function _context7(){"logined"===this.status&&this.ping()}).call(t,this),this.offlineListener=bind$1(a=function _context8(){this.logger.log("offline"),this.doDisconnect(ju.OFFLINE,"OfflineListener")}).call(a,this),window.addEventListener("online",this.onlineListener),window.addEventListener("offline",this.offlineListener)):this.logger.warn("initOnlineListener not support add listener"))},a.destroyOnlineListener=function destroyOnlineListener(){this.onlineListener&&(window.removeEventListener("online",this.onlineListener),this.onlineListener=void 0),this.offlineListener&&(window.removeEventListener("offline",this.offlineListener),this.offlineListener=void 0)},a.disconnect=function disconnect(){switch(this.status){case"connected":case"logined":case"connecting":case"waitReconnect":return this.doDisconnect(ju.ACTIVE,"UserActiveDisconnect"),zo.resolve();case"unconnected":case"destroyed":return zo.resolve()}},a.destroy=function destroy(){var t=this;return this.disconnect().then((function(){t.status="destroyed",t.removeAllListeners(),t.eventBus.removeAllListeners(),t.reporter.destroy(),t.connect=function(){return zo.resolve()},t.disconnect=function(){return zo.resolve()},t.destroy=function(){return zo.resolve()}}))},a.abtRequest=function abtRequest(){var t,a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){var o,c;return ci.wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:if(this.options.isAbtestEnable){m.next=2;break}return m.abrupt("return");case 2:if(!this.abtInfo.experiments){m.next=4;break}return m.abrupt("return");case 4:if(this.options.abtestUrl){m.next=6;break}return m.abrupt("return");case 6:return m.prev=6,m.next=9,this.adapters.request(this.options.abtestUrl,{method:"POST",dataType:"json",headers:{sdktype:"ABTest"},params:{clientInfo:{projectKey:this.options.abtestProjectKey,appKey:this.options.appkey,osType:"Web",sdkVersion:"0.12.3",deviceId:this.config.deviceId},useLocalCache:!0}});case 9:o=m.sent,m.next=15;break;case 12:m.prev=12,m.t0=m.catch(6),this.logger.warn("ABTest request failed");case 15:this.abtInfo=(null===(a=null===(t=null==o?void 0:o.data)||void 0===t?void 0:t.data)||void 0===a?void 0:a.abtInfo)||{},this.abtInfo.experiments&&this.abtInfo.experiments.length>0&&this.reporter.reportImmediately("https://statistic.live.126.net/statics/report/abtest/result",{params:{app_key:this.options.appkey,biz_sdk_type:"IM",sdk_ver:"0.12.3",device_id:this.config.deviceId,platform:"Web",projectKey:this.options.abtestProjectKey,experiments:map(c=this.abtInfo.experiments).call(c,(function(t){return{experimentKey:t.experimentKey,schemeKey:t.schemeKey}}))},headers:{sdktype:"ABTest"},method:"POST",dataType:"json"});case 17:case"end":return m.stop()}}),_callee4,this,[[6,12]])})))},Core}(us);Hu.setAdapters=function setAdapters(t){fi(pc,t)};var Gu={"1_2":"heartbeat","2_3":"login","2_5":"kicked","2_6":"logout","2_7":"multiPortLogin","2_8":"kick"},Qu={login:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appkey:18,account:19,browser:24,session:26,deviceInfo:32,isReactNative:112,token:1e3,customTag:38,customClientType:39,sdkHumanVersion:40,sdkType:41,userAgent:42,authType:115,loginExt:116},loginRes:{lastLoginDeviceId:17,customTag:38,connectionId:102,ip:103,port:104,country:106,hasXMPush:111},loginPort:{type:3,os:4,mac:5,deviceId:13,account:19,deviceInfo:32,customTag:38,connectionId:102,ip:103,time:109},aosPushInfo:{pushType:110,hasTokenPreviously:111}},Wu=invertSerializeMap(Qu),Vu={login:{sid:2,cid:3,service:"auth",params:[{type:"Property",name:"login",reflectMapper:Qu.login}],response:[{type:"Property",name:"loginRes",reflectMapper:Wu.loginRes},{type:"PropertyArray",name:"loginPorts",reflectMapper:Wu.loginPort},{type:"Property",name:"aosPushInfo",reflectMapper:Wu.aosPushInfo}]},logout:{sid:2,cid:6,service:"auth"},heartbeat:{sid:1,cid:2,service:"auth"},kicked:{sid:2,cid:5,service:"auth",response:[{type:"Number",name:"clientType"},{type:"Number",name:"reason"},{type:"String",name:"ext"},{type:"Number",name:"customClientType"}]},multiPortLogin:{sid:2,cid:7,service:"auth",response:[{type:"Number",name:"state"},{type:"PropertyArray",name:"loginPorts",reflectMapper:Wu.loginPort}]},kick:{sid:2,cid:8,service:"auth",params:[{type:"StrArray",name:"deviceIds"}],response:[{type:"StrArray",name:"deviceIds"}]}},Ku=Array.isArray;var zu=function isSymbol(t){return"symbol"==typeof t||Pc(t)&&"[object Symbol]"==_s(t)},Ju=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Yu=/^\w*$/;var Xu=function isKey(t,a){if(Ku(t))return!1;var o=typeof t;return!("number"!=o&&"symbol"!=o&&"boolean"!=o&&null!=t&&!zu(t))||(Yu.test(t)||!Ju.test(t)||null!=a&&t in Object(a))};function memoize(t,a){if("function"!=typeof t||null!=a&&"function"!=typeof a)throw new TypeError("Expected a function");var memoized=function(){var o=arguments,c=a?a.apply(this,o):o[0],m=memoized.cache;if(m.has(c))return m.get(c);var h=t.apply(this,o);return memoized.cache=m.set(c,h)||m,h};return memoized.cache=new(memoize.Cache||wl),memoized}memoize.Cache=wl;var Zu=memoize;var ed=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,td=/\\(\\)?/g,rd=function memoizeCapped(t){var a=Zu(t,(function(t){return 500===o.size&&o.clear(),t})),o=a.cache;return a}((function(t){var a=[];return 46===t.charCodeAt(0)&&a.push(""),t.replace(ed,(function(t,o,c,m){a.push(c?m.replace(td,"$1"):o||t)})),a})),nd=rd,ad=fs?fs.prototype:void 0,od=ad?ad.toString:void 0;var id=function baseToString(t){if("string"==typeof t)return t;if(Ku(t))return Ul(t,baseToString)+"";if(zu(t))return od?od.call(t):"";var a=t+"";return"0"==a&&1/t==-Infinity?"-0":a};var sd=function toString(t){return null==t?"":id(t)};var cd=function castPath(t,a){return Ku(t)?t:Xu(t,a)?[t]:nd(sd(t))};var ld=function toKey(t){if("string"==typeof t||zu(t))return t;var a=t+"";return"0"==a&&1/t==-Infinity?"-0":a};var ud=function baseGet(t,a){for(var o=0,c=(a=cd(a,t)).length;null!=t&&o<c;)t=t[ld(a[o++])];return o&&o==c?t:void 0};var dd=function get(t,a,o){var c=null==t?void 0:ud(t,a);return void 0===c?o:c},pd={debugLevel:"off",needReconnect:!0,reconnectionAttempts:9007199254740991,lbsUrls:["https://lbs.netease.im/lbs/webconf.jsp"],linkUrl:"weblink.netease.im:443",isAbtestEnable:!0,abtestUrl:"https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo",abtestProjectKey:"imElite_sdk_abtest_web"},md={},hd=/*#__PURE__*/function(t){function NIM(a,o){var m,h;void 0===o&&(o={serverConfig:{},syncOptions:{},sessionConfig:{}}),(h=t.call(this,a)||this).instanceName="NIM",h.account="",h.options={},h.auth={},h.sync={},h.msg={},h.msgLog={},h.session={},h.cloudSession={},h.misc={},h.user={},h.friend={},h.systemMessage={},h.team={},h.event={},h.msgExtend={},h.cloudStorage={},h.passThrough={},h.superTeam={},h.plugin={},h.signaling={},h.setOptions(a),registerParser({cmdMap:Gu,cmdConfig:Vu});var v=null;return forEach$1(m=ui(md)).call(m,(function(t){var a=md[t];"sync"===t?v=a:h[t]="session"===t?new a(c(h),o.sessionConfig):"cloudStorage"===t?new a(c(h),fi({storageKeyPrefix:h.instanceName},o.serverConfig,o.cloudStorageConfig)):new a(c(h))})),v&&(h.sync=new v(c(h),o.syncOptions)),h.eventBus.on("willReconnect",(function(){h.reporter.reportTraceStart("login",{user_id:h.account,action:"auto_login"}),h.reporter.reportTraceUpdateV2("login",{code:0,description:gi(fi(fi({},h.options),{account:"***",token:"***"})),duration:0,operation_type:"conf_init",succeed:!0,target:""})})),NIM.instance=c(h),h}Mt(NIM,t),NIM.getInstance=function getInstance(t,a){if(!NIM.instance){if(t)return new NIM(t,a);throw new Error("Instance not exist, please input options")}if(t){if(NIM.instance.options.account===t.account&&NIM.instance.options.appkey===t.appkey)return NIM.instance.setOptions(t),NIM.instance;throw new Error("Unexpected login")}return NIM.instance};var a=NIM.prototype;return a.setOptions=function setOptions(t){validate({account:{type:"string"},appkey:{type:"string"},token:{type:"string"},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},t),this.logger.log("NIM::setOptions options is",t),this.account=t.account,this.options=fi(fi({},pd),t)},a.connect=function connect(a){void 0===a&&(a={});var o=st(null,{connect:{get:function get(){return t.prototype.connect}}});return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var t;return ci.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:if(/^(unconnected|waitReconnect)$/.test(this.status)){c.next=4;break}return t="NIM status is "+this.status+", and would not connect",this.logger.warn(t),c.abrupt("return",zo.reject(t));case 4:return a.isAutoReconnect||(this.reporter.reportTraceStart("login",{user_id:this.options.account,action:"manual_login"}),this.reporter.reportTraceUpdateV2("login",{code:0,description:gi(fi(fi({},this.options),{account:"***",token:"***"})),operation_type:"conf_init",succeed:!0,duration:0,target:""})),c.next=7,this.getLbsInfos();case 7:return c.next=9,o.connect.call(this,a);case 9:return c.next=11,this.login(a.isAutoReconnect);case 11:case"end":return c.stop()}}),_callee,this)})))},a.login=function login(t){return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var a;return ci.wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,this.auth.doLogin(t);case 3:a=o.sent,this.reporter.reportTraceUpdate("login",{operation_type:"protocol",target:"2-2"}),this.reporter.reportTraceEnd("login",!0),this.status="logined",o.next=19;break;case 9:if(o.prev=9,o.t0=o.catch(0),this.logger.warn("nim login:: login failed",o.t0),this.reporter.reportTraceUpdate("login",{operation_type:"protocol",error:o.t0},!1),this.reporter.reportTraceEnd("login",!1),0!==this.retryCount){o.next=17;break}throw this.doDisconnect(ju.ACTIVE,"FailedToInitializeLogin"),o.t0;case 17:return this.doDisconnect(ju.OFFLINE,"ReconnectLoginFailed"),o.abrupt("return");case 19:return o.prev=19,o.next=22,this.cloudStorage.init();case 22:o.next=27;break;case 24:o.prev=24,o.t1=o.catch(19),this.logger.error("NIM:login cloudStorage init failed ",o.t1);case 27:if(this.eventBus.emit("logined",a),this.emit("logined",a),this.logger.log("login done"),this.resetConnectStatus(),!this.sync||!this.sync.doSync){o.next=34;break}return o.next=34,this.sync.doSync();case 34:this.ping();case 35:case"end":return o.stop()}}),_callee2,this,[[0,9],[19,24]])})))},a.onMessage=function onMessage(a){var o,c,m=t.prototype.onMessage.call(this,a);if(m){var h=m.raw.ser,v=this.sendingCmdMap.get(h);if(v&&v.cmd===m.cmd){var b=v.callback,S=v.timer,M=v.params;if(clearTimeout(S),m.params=M,this.sendingCmdMap.delete(h),"heartbeat"===m.cmd)return void b[0]();var C=null===(o=this[m.service])||void 0===o?void 0:o.process(m);C&&"function"==typeof C.then?C.then((function(t){b[0](t)})).catch((function(t){b[1](t)})):(this.logger.log("imsocket:: handlerFn without promise",m.service,m.cmd),b[0]())}else null===(c=this[m.service])||void 0===c||c.process(m)}},a.getLbsInfos=function getLbsInfos(){var t;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var a,o,c,m,h,v,b,S;return ci.wrap((function _callee3$(M){for(;;)switch(M.prev=M.next){case 0:return a=this.options.lbsUrls[0],o=indexOf(a).call(a,"?")>-1?"&":"?",c=a+o+"k="+this.options.appkey+"&id="+this.options.account+"&sv=180&pv=1&networkType=0",M.prev=3,this.logger.log("getLbsInfos ",c),M.next=7,this.adapters.request(c,{method:"GET",dataType:"json",timeout:1e4});case 7:if(200===(h=M.sent).status&&h.data){M.next=11;break}throw this.logger.error("getLbsInfos::error status",h.status,h),new Error("getLbsInfos failed, status "+h.status);case 11:this.reporter.reportTraceUpdate("login",{operation_type:"HTTP",target:c}),v=h.data,b=[this.options.linkUrl],dd(v,"common.link")&&(b=concat(S=dd(v,"common.link")).call(S,b)),dd(v,'common["link.default"]')&&(b=concat(b).call(b,dd(v,'common["link.default"]'))),this.linkUrls=iu(b),h.data["nos-chunk"]&&(null===(t=this.cloudStorage)||void 0===t||t.setOptions({chunkUploadHost:h.data["nos-chunk"]})),this.logger.log("getLbsInfos success, socket link:",slice(m=this.linkUrls).call(m,0),"chunkUploadHost: ",h.data["nos-chunk"]),M.next=26;break;case 21:M.prev=21,M.t0=M.catch(3),this.logger.error("getLbsInfos::error",M.t0&&M.t0.message,M.t0),this.linkUrls=[this.options.linkUrl],this.reporter.reportTraceUpdate("login",{operation_type:"HTTP",target:c},!1);case 26:case"end":return M.stop()}}),_callee3,this,[[3,21]])})))},a.disconnect=function disconnect(){var a=this;switch(this.status){case"connected":case"logined":return this.sendCmd("logout").then((function(){t.prototype.doDisconnect.call(a,ju.ACTIVE,"UserActiveDisconnect")}));case"connecting":case"waitReconnect":return t.prototype.doDisconnect.call(this,ju.ACTIVE,"UserActiveDisconnect"),zo.resolve();case"unconnected":case"destroyed":return zo.resolve()}},a.destroy=function destroy(){return NIM.instance=null,t.prototype.destroy.call(this)},a.kick=function kick(t){return validate({deviceIds:{type:"array",itemType:"string"}},t),this.auth.kick(t)},NIM.registerService=function registerService(t,a){md[a]=t},NIM}(Hu);hd.instance=null;var fd,gd,yd,vd,bd,Sd=/*#__PURE__*/function(){function Service(t,a){this.name=t,this.core=a,this.name=t,this.logger=a.logger,this.core=a}return Service.prototype.process=function process(t){var a=this[t.cmd+"Handler"];return"function"==typeof a?a.call(this,t):t.error&&!t.error.ignore?zo.reject(t.error):zo.resolve(t)},Service}();!function(t){t[t.text=0]="text",t[t.image=1]="image",t[t.audio=2]="audio",t[t.video=3]="video",t[t.geo=4]="geo",t[t.notification=5]="notification",t[t.file=6]="file",t[t.tip=10]="tip",t[t.robot=11]="robot",t[t.g2=12]="g2",t[t.custom=100]="custom"}(fd||(fd={})),function(t){t[t.p2p=0]="p2p",t[t.team=1]="team",t[t.superTeam=5]="superTeam"}(gd||(gd={})),function(t){t[t.Android=1]="Android",t[t.iOS=2]="iOS",t[t.PC=4]="PC",t[t.WindowsPhone=8]="WindowsPhone",t[t.Web=16]="Web",t[t.Server=32]="Server",t[t.Mac=64]="Mac"}(yd||(yd={})),function(t){t[t.unread=1]="unread",t[t.read=2]="read",t[t.deleted=3]="deleted",t[t.sending=4]="sending",t[t.sendFailed=5]="sendFailed",t[t.sent=6]="sent",t[t.receipt=7]="receipt",t[t.refused=10]="refused"}(vd||(vd={})),function(t){t[t.default=0]="default",t[t.leave=1]="leave",t[t.roam=2]="roam"}(bd||(bd={}));var Md=function overArg(t,a){return function(o){return t(a(o))}},Cd=Md(Object.getPrototypeOf,Object),Td=Function.prototype,_d=Object.prototype,wd=Td.toString,Id=_d.hasOwnProperty,kd=wd.call(Object);var xd=function isPlainObject(t){if(!Pc(t)||"[object Object]"!=_s(t))return!1;var a=Cd(t);if(null===a)return!0;var o=Id.call(a,"constructor")&&a.constructor;return"function"==typeof o&&o instanceof o&&wd.call(o)==kd};function format(t,a){if(!xd(a))return{};var o=JSON.parse(gi(a)),c=doFormat(t,o);return JSON.parse(gi(fi(fi({},o),c)))}function doFormat(t,a){if(!xd(a))return{};var o={},c=ui(t);return forEach$1(c).call(c,(function(c){var m=t[c].type;if("string"!=typeof m){var h=doFormat(t[c],a);ui(h).length>0&&(o[c]=h)}else{var v=t[c],b=v.rawKey||c,S=Rd[m](a,b,v);void 0!==S&&(a[b]=void 0,o[c]=S)}})),o}var Rd={number:function number(t,a){if(void 0!==t[a])return+t[a]},string:function string(t,a){if(void 0!==t[a])return t[a]},boolean:function boolean(t,a){return+t[a]>0||0!=+t[a]&&void 0},enum:function _enum(t,a,o){return values(o)[t[a]]},object:function object(t,a){if(void 0!==t[a])try{return JSON.parse(t[a])}catch(t){return{}}}};function formatReverse(t,a){if(!xd(a))return{};var o=JSON.parse(gi(a)),c=doFormatReverse(t,o);return JSON.parse(gi(fi(fi({},o),c)))}function doFormatReverse(t,a){var o;if(!xd(a))return reduce(o=ui(t)).call(o,(function(a,o){return a[t[o].rawKey||o]=void 0,a}),{});var c={},m=ui(t);return forEach$1(m).call(m,(function(o){var m=t[o].type;if("string"!=typeof m){var h=doFormatReverse(t[o],a[o]);return fi(c,h),void(a[o]=void 0)}var v=t[o],b=v.rawKey||o,S=Ed[m](a,o,v);a[b]=void 0,c[b]=S})),c}var Ed={number:function number(t,a){return t[a]},string:function string(t,a){return t[a]},boolean:function boolean(t,a){return!0===t[a]?1:!1===t[a]?0:void 0},enum:function _enum(t,a,o){return values(o)[t[a]]},object:function object(t,a){if(void 0!==t[a])try{return gi(t[a])}catch(t){return""}}},Ad=Ed;var qd=function createBaseFor(t){return function(a,o,c){for(var m=-1,h=Object(a),v=c(a),b=v.length;b--;){var S=v[t?b:++m];if(!1===o(h[S],S,h))break}return a}}();var Pd=function baseTimes(t,a){for(var o=-1,c=Array(t);++o<t;)c[o]=a(o);return c};var Od=function baseIsArguments(t){return Pc(t)&&"[object Arguments]"==_s(t)},Ud=Object.prototype,Bd=Ud.hasOwnProperty,Fd=Ud.propertyIsEnumerable,Ld=Od(function(){return arguments}())?Od:function(t){return Pc(t)&&Bd.call(t,"callee")&&!Fd.call(t,"callee")};var jd=function stubFalse(){return!1},Nd=createCommonjsModule((function(t,a){var o=a&&!a.nodeType&&a,c=o&&t&&!t.nodeType&&t,m=c&&c.exports===o?hs.Buffer:void 0,h=(m?m.isBuffer:void 0)||jd;t.exports=h})),Dd=/^(?:0|[1-9]\d*)$/;var $d=function isIndex(t,a){var o=typeof t;return!!(a=null==a?9007199254740991:a)&&("number"==o||"symbol"!=o&&Dd.test(t))&&t>-1&&t%1==0&&t<a},Hd={};Hd["[object Float32Array]"]=Hd["[object Float64Array]"]=Hd["[object Int8Array]"]=Hd["[object Int16Array]"]=Hd["[object Int32Array]"]=Hd["[object Uint8Array]"]=Hd["[object Uint8ClampedArray]"]=Hd["[object Uint16Array]"]=Hd["[object Uint32Array]"]=!0,Hd["[object Arguments]"]=Hd["[object Array]"]=Hd["[object ArrayBuffer]"]=Hd["[object Boolean]"]=Hd["[object DataView]"]=Hd["[object Date]"]=Hd["[object Error]"]=Hd["[object Function]"]=Hd["[object Map]"]=Hd["[object Number]"]=Hd["[object Object]"]=Hd["[object RegExp]"]=Hd["[object Set]"]=Hd["[object String]"]=Hd["[object WeakMap]"]=!1;var Gd=function baseIsTypedArray(t){return Pc(t)&&Kl(t.length)&&!!Hd[_s(t)]},Qd=Bc&&Bc.isTypedArray,Wd=Qd?Uc(Qd):Gd,Vd=Object.prototype.hasOwnProperty;var Kd=function arrayLikeKeys(t,a){var o=Ku(t),c=!o&&Ld(t),m=!o&&!c&&Nd(t),h=!o&&!c&&!m&&Wd(t),v=o||c||m||h,b=v?Pd(t.length,String):[],S=b.length;for(var M in t)!a&&!Vd.call(t,M)||v&&("length"==M||m&&("offset"==M||"parent"==M)||h&&("buffer"==M||"byteLength"==M||"byteOffset"==M)||$d(M,S))||b.push(M);return b},zd=Object.prototype;var Jd=function isPrototype(t){var a=t&&t.constructor;return t===("function"==typeof a&&a.prototype||zd)},Yd=Md(Object.keys,Object),Xd=Object.prototype.hasOwnProperty;var Zd=function baseKeys(t){if(!Jd(t))return Yd(t);var a=[];for(var o in Object(t))Xd.call(t,o)&&"constructor"!=o&&a.push(o);return a};var ep=function keys(t){return zl(t)?Kd(t):Zd(t)};var tp=function baseForOwn(t,a){return t&&qd(t,a,ep)};var rp=function baseInverter(t,a,o,c){return tp(t,(function(t,m,h){a(c,o(t),m,h)})),c};var np,ap=function createInverter(t,a){return function(o,c){return rp(o,t,a(c),{})}},op=Object.prototype.toString,ip=ap((function(t,a,o){null!=a&&"function"!=typeof a.toString&&(a=op.call(a)),t[a]=o}),$l(Ll)),sp=ip({Android:1,iOS:2,PC:4,WindowsPhone:8,Web:16,Server:32,Mac:64}),cp={p2p:0,team:1,superTeam:5};function formatMultiPortLoginInfo(t,a){return t&&t.length>0?map(t).call(t,(function(t){return fi(fi({},t),{account:t.account,connectionId:t.connectionId,deviceId:t.deviceId,ip:t.ip,mac:t.mac,os:t.os,type:sp[t.type]||t.type,time:_u(t.time),online:3!==a})})):[]}ip(cp),function(t){t[t.text=0]="text",t[t.image=1]="image",t[t.audio=2]="audio",t[t.video=3]="video",t[t.geo=4]="geo",t[t.notification=5]="notification",t[t.file=6]="file",t[t.tip=10]="tip",t[t.robot=11]="robot",t[t.g2=12]="g2",t[t.custom=100]="custom"}(np||(np={}));var lp={1:{reason:"samePlatformKick",message:"The same account is not allowed to multiple login at the same time"},2:{reason:"serverKick",message:"Kicked out by IM server"},3:{reason:"otherPlatformKick",message:"Kicked out by other client of your account"},4:{reason:"silentlyKick",message:"Quietly kicked"}};var up={BROWSER:0,RN:2,UNIAPP:3,WECHAT:6},dp=/*#__PURE__*/function(t){function AuthService(a){var o;return o=t.call(this,"auth",a)||this,registerParser({cmdMap:Gu,cmdConfig:Vu}),o}Mt(AuthService,t);var a=AuthService.prototype;return a.doLogin=function doLogin(t){var a,o;return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var c,m,h,v,b,S,M,C,T,w;return ci.wrap((function _callee$(I){for(;;)switch(I.prev=I.next){case 0:return c=this.core.options,m=pc.getSystemInfo(),h=fi(fi({},c),{appLogin:t?0:1,appkey:c.appkey,account:c.account,token:c.token,deviceId:this.core.config.deviceId,clientType:16,protocolVersion:1,sdkVersion:90903,sdkHumanVersion:"0.12.3",os:m.os,browser:m.browser,session:null===(a=this.core.socket)||void 0===a?void 0:a.sessionId,sdkType:up[pc.platform]||0,userAgent:"Native/0.12.3"}),v=m.os.toLowerCase(),"UNIAPP"!==pc.platform||"ios"!==v&&"android"!==v||(h.isReactNative=1,h.clientType="ios"===v?2:1,m.pushDeviceInfo&&m.pushDeviceInfo.MANUFACTURER&&(h.deviceInfo=gi(m.pushDeviceInfo))),this.logger.log("auth::do login ",c.account,null===(o=this.core.socket)||void 0===o?void 0:o.sessionId),I.next=8,this.core.sendCmd("login",{login:h});case 8:if(!(b=I.sent).error){I.next=11;break}throw b.error;case 11:return S=b.content,M=S.loginRes,C=S.loginPorts,T=S.aosPushInfo,w=formatMultiPortLoginInfo(C,2),(w=filter(w).call(w,(function(t){return t.connectionId!==M.connectionId}))).length>0&&this.core.emit("multiPortLogin",w),I.abrupt("return",fi(fi({},M),{aosPushInfo:T}));case 16:case"end":return I.stop()}}),_callee,this)})))},a.kick=function kick(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var o;return ci.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("kick",t);case 2:return o=c.sent,c.abrupt("return",null===(a=o.content)||void 0===a?void 0:a.deviceIds);case 4:case"end":return c.stop()}}),_callee2,this)})))},a.multiPortLoginHandler=function multiPortLoginHandler(t){if(t.error)this.logger.error("multiPortLoginHandler:: error, ",t.error);else{var a=t.content,o=formatMultiPortLoginInfo(a.loginPorts,a.state);o.length>0&&this.core.emit("multiPortLogin",o)}},a.kickedHandler=function kickedHandler(t){if(t.error)this.logger.error("kickedHandler:: error, ",t.error);else{var a=function formatBeKickedTag$1(t){var a=format({clientType:{type:"enum",values:yd},customClientType:{type:"number"}},t),o=lp[a.reason];return fi(a,o=o||{reason:"unknow",message:"Unknown reason"})}(t.content);this.logger.warn("kicked::",a),this.core.doDisconnect(ju.KICKED,a)}},AuthService}(Sd),pp={"5_1":"sync"},mp={sync:{sid:5,cid:1,service:"sync",isNoResponse:!0,params:[{type:"Property",name:"sync",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,signaling:21,superTeams:22,myInfoInSuperTeams:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29}}],response:[{type:"Number",name:"timetag"}]}},hp=/*#__PURE__*/function(t){function SyncService(a,o){var c;return void 0===o&&(o={}),(c=t.call(this,"sync",a)||this).options=o,c.options=fi({myInfo:!!a.user.name,offlineMsgs:!!a.msg.name,teams:!!a.team.name,roamingMsgs:!!a.msg.name,relations:!!a.user.name,friends:!!a.friend.name,friendUsers:!!a.user.name,msgReceipts:!!a.msg.name,recallMsg:!!a.msg.name,sessionAck:!!a.session.name,superTeamSessionAck:!!a.session.name,superTeams:!!a.superTeam.name,superTeamRoamingMsgs:!!a.superTeam.name,deleteSuperTeamMsg:!!a.superTeam.name,deleteSelfMsgs:!!a.msg.name,sessionHistoryMsgsDelete:!!a.msgLog.name,signaling:!!a.signaling.name},o),c.timetags={},c.pArray=[],c.initEventListeners(),registerParser({cmdMap:pp,cmdConfig:mp}),c}Mt(SyncService,t);var a=SyncService.prototype;return a.doSync=function doSync(){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var t;return ci.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return t=this.genSyncParams(),this.logger.log("doSync: ",t),a.next=4,this.core.sendCmd("sync",{sync:t});case 4:case"end":return a.stop()}}),_callee,this)})))},a.initEventListeners=function initEventListeners(){var t=this;this.core.eventBus.on("sync/updateTimetag",(function(a){var o;forEach$1(o=ui(a)).call(o,(function(o){a[o]>(t.timetags[o]||0)&&(t.timetags[o]=a[o])}))}))},a.genSyncParams=function genSyncParams(){var t,a,o=this;return reduce(t=filter(a=ui(this.options)).call(a,(function(t){var a=t;return o.options[a]}))).call(t,(function(t,a){var c=a;return t[c]=o.timetags[c]||0,t}),{})},a.handleImmediate=function handleImmediate(t){var a;this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),this.logger.log("sync: emit syncdone",null===(a=t.content)||void 0===a?void 0:a.timetag),this.core.emit("syncdone")},a.syncHandler=function syncHandler(t){var a=this;"ALI"===getMiniappEnv()?(this.logger.log("sync: emit ALIAPP sycnHandler, handle later"),rs((function(){a.handleImmediate(t)}),100)):this.handleImmediate(t)},SyncService}(Sd),fp={"6_26":"getNosCdnHost"},gp={getNosCdnHost:{sid:6,cid:26,service:"misc",response:[{type:"Property",name:"nosConfigTag",reflectMapper:invertSerializeMap({nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4}}).nosConfigTag}]}},yp=/*#__PURE__*/function(t){function MiscService(a){var o;return(o=t.call(this,"misc",a)||this).core=a,o.nosCdnHostTimer=0,registerParser({cmdMap:fp,cmdConfig:gp}),o}return Mt(MiscService,t),MiscService}(Sd),vp=Math.floor,mergeSort=function(t,a){var o=t.length,c=vp(o/2);return o<8?insertionSort(t,a):merge(t,mergeSort(arraySliceSimple(t,0,c),a),mergeSort(arraySliceSimple(t,c),a),a)},insertionSort=function(t,a){for(var o,c,m=t.length,h=1;h<m;){for(c=h,o=t[h];c&&a(t[c-1],o)>0;)t[c]=t[--c];c!==h++&&(t[c]=o)}return t},merge=function(t,a,o,c){for(var m=a.length,h=o.length,v=0,b=0;v<m||b<h;)t[v+b]=v<m&&b<h?c(a[v],o[b])<=0?a[v++]:o[b++]:v<m?a[v++]:o[b++];return t},bp=mergeSort,Sp=Q.match(/firefox\/(\d+)/i),Mp=!!Sp&&+Sp[1],Cp=/MSIE|Trident/.test(Q),Tp=Q.match(/AppleWebKit\/(\d+)\./),_p=!!Tp&&+Tp[1],wp=[],Ip=k(wp.sort),kp=k(wp.push),xp=fails((function(){wp.sort(void 0)})),Rp=fails((function(){wp.sort(null)})),Ep=arrayMethodIsStrict("sort"),Ap=!fails((function(){if(Y)return Y<70;if(!(Mp&&Mp>3)){if(Cp)return!0;if(_p)return _p<603;var t,a,o,c,m="";for(t=65;t<76;t++){switch(a=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:o=3;break;case 68:case 71:o=4;break;default:o=2}for(c=0;c<47;c++)wp.push({k:a+c,v:o})}for(wp.sort((function(t,a){return a.v-t.v})),c=0;c<wp.length;c++)a=wp[c].k.charAt(0),m.charAt(m.length-1)!==a&&(m+=a);return"DGBEFHACIJK"!==m}}));_export({target:"Array",proto:!0,forced:xp||!Rp||!Ep||!Ap},{sort:function sort(t){void 0!==t&&aCallable(t);var a=toObject(this);if(Ap)return void 0===t?Ip(a):Ip(a,t);var o,c,m=[],h=lengthOfArrayLike(a);for(c=0;c<h;c++)c in a&&kp(m,a[c]);for(bp(m,function(t){return function(a,o){return void 0===o?-1:void 0===a?1:void 0!==t?+t(a,o)||0:toString$1(a)>toString$1(o)?1:-1}}(t)),o=lengthOfArrayLike(m),c=0;c<o;)a[c]=m[c++];for(;c<h;)deletePropertyOrThrow(a,c++);return a}});var qp=entryVirtual("Array").sort,Pp=Array.prototype,sort=function(t){var a=t.sort;return t===Pp||G(Pp,t)&&a===Pp.sort?qp:a};_export({target:"Number",stat:!0},{isNaN:function isNaN(t){return t!=t}});var Op,Up=H.Number.isNaN,Bp=ip({none:0,normal:1,all:3}),Fp={normal:0,advanced:1},Lp=ip(Fp),jp=ip({normal:0,owner:1,manager:2}),Np={noVerify:0,needVerify:1,rejectAll:2},Dp=ip(Np),$p={needVerify:0,noVerify:1},Hp=ip($p),Gp={manager:0,all:1},Qp=ip(Gp),Wp={manager:0,all:1},Vp=ip(Wp),Kp={manager:0,all:1},zp=ip(Kp);function formatTeam(t){var a,o=["teamId"],c=["level","memberNum","memberUpdateTime","createTime","updateTime"],m=["valid","validToCurrentUser","mute"],h={type:Lp,muteType:Bp,joinMode:Dp,beInviteMode:Hp,inviteMode:Qp,updateTeamMode:Vp,updateExtMode:zp};t.bits;var v=__rest(t,["bits"]);return forEach$1(o).call(o,(function(t){v[t]&&(v[t]=v[t].toString())})),forEach$1(c).call(c,(function(t){void 0!==v[t]&&(v[t]=_u(v[t]))})),forEach$1(m).call(m,(function(t){void 0!==v[t]&&(v[t]=1===_u(v[t]))})),forEach$1(a=ui(h)).call(a,(function(t){void 0!==v[t]&&(v[t]=h[t][v[t]]||v[t])})),v}function formatTeams(t){return t&&t.length>0?map(t).call(t,(function(t){return formatTeam(t)})):[]}function generateTeam(t){var a,o=fi({},t),c=["avatar","name","intro","announcement","ext"],m={type:Fp,joinMode:Np,beInviteMode:$p,inviteMode:Gp,updateTeamMode:Wp,updateExtMode:Kp};return forEach$1(c).call(c,(function(t){void 0!==o[t]&&(o[t]=o[t].toString())})),forEach$1(a=ui(m)).call(a,(function(t){void 0!==o[t]&&(o[t]=m[t][o[t]])})),o}function generatorTeamMemberForCmd(t){var a=["teamId","ext","account","nickInTeam"],o={};return void 0!==t.bitConfigMask&&(o.bits=_u(t.bitConfigMask)),forEach$1(a).call(a,(function(a){t[a]&&(o[a]=t[a].toString())})),o}function formatTeamMember(t){var a,o=["teamId"],c=["joinTime","updateTime","bitConfigMask"],m=["active","valid","mute"],h={type:jp},v=t.bits,b=__rest(t,["bits"]);return void 0!==v&&(b.muteTeam=1===_u(v),b.bitConfigMask=v),b.id=b.teamId+"-"+b.account,forEach$1(o).call(o,(function(t){b[t]&&(b[t]=b[t].toString())})),forEach$1(c).call(c,(function(t){void 0!==b[t]&&(b[t]=_u(b[t]))})),forEach$1(m).call(m,(function(t){void 0!==b[t]&&(b[t]=1===_u(b[t]))})),forEach$1(a=ui(h)).call(a,(function(t){void 0!==b[t]&&(b[t]=h[t][b[t]]||b[t])})),b}function formatTeamMembers(t){return t&&t.length>0?map(t).call(t,(function(t){return formatTeamMember(t)})):[]}function generatorMemberByTeam(t,a,o){return void 0===o&&(o="normal"),{id:t.teamId+"-"+a,teamId:t.teamId,account:a,type:o,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:t.memberUpdateTime,updateTime:t.memberUpdateTime,active:!0,valid:!0}}function generatorMembersByTeam(t,a,o){return void 0===o&&(o="normal"),a&&a.length>0?map(a).call(a,(function(a){return generatorMemberByTeam(t,a,o)})):[]}function formatUser(t){var a=fi({},t);return a.createTime&&(a.createTime=+a.createTime),a.updateTime&&(a.updateTime=+a.updateTime),a.gender&&(a.gender=Op[+a.gender]),a}!function(t){t[t.unknown=0]="unknown",t[t.male=1]="male",t[t.female=2]="female"}(Op||(Op={}));var Jp={"8_1":"createTeam","8_5":"addTeamMembers","8_6":"removeTeamMembers","8_7":"updateTeamInfo","8_8":"leaveTeam","8_9":"getTeamInfo","8_10":"getTeams","8_11":"getTeamMembers","8_12":"dismissTeam","8_13":"applyTeam","8_14":"passTeamApply","8_15":"rejectTeamApply","8_16":"addTeamManagers","8_17":"removeTeamManagers","8_18":"transferTeam","8_19":"updateMyMemberInfo","8_20":"updateNickInTeam","8_21":"acceptTeamInvite","8_22":"rejectTeamInvite","8_25":"muteTeamMember","8_27":"getMutedTeamMembers","8_28":"sendTeamMsgReceipt","8_29":"getTeamMsgReads","8_30":"getTeamMsgReadAccounts","8_31":"notifyTeamMsgReceipts","8_32":"muteTeam","8_33":"getTeamMemberInvitorAccid","8_34":"getTeamsById","8_101":"syncCreateTeam","8_109":"syncTeams","8_119":"syncUpdateTeamMember"},Yp={team:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},teamMsgReceiptTag:{teamId:0,idServer:1,read:100,unread:101,idClient:102,account:103},teamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,joinTime:10,updateTime:11,ext:12,mute:13,invitorAccid:14}},Xp=invertSerializeMap(Yp),Zp={getTeamInfo:{sid:8,cid:9,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:Xp.team}]},getTeams:{sid:8,cid:10,service:"team",params:[{type:"long",name:"timetag"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:Xp.team},{type:"Number",name:"timetag"}]},createTeam:{sid:8,cid:1,service:"team",params:[{type:"Property",name:"team",reflectMapper:Yp.team},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:Xp.team},{type:"StrArray",name:"abortedAccidList"}]},sendTeamMsgReceipt:{sid:8,cid:28,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Yp.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Xp.teamMsgReceiptTag}]},getTeamMsgReads:{sid:8,cid:29,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Yp.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Xp.teamMsgReceiptTag}]},getTeamMsgReadAccounts:{sid:8,cid:30,service:"team",params:[{type:"Property",name:"teamMsgReceiptTag",reflectMapper:Yp.teamMsgReceiptTag}],response:[{type:"Property",name:"teamMsgReceipt",reflectMapper:Xp.teamMsgReceiptTag},{type:"StrArray",name:"readAccounts"},{type:"StrArray",name:"unreadAccounts"}]},notifyTeamMsgReceipts:{sid:8,cid:31,service:"team",response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:Xp.teamMsgReceiptTag}]},dismissTeam:{sid:8,cid:12,service:"team",params:[{type:"Long",name:"teamId"}]},leaveTeam:{sid:8,cid:8,service:"team",params:[{type:"Long",name:"teamId"}]},transferTeam:{sid:8,cid:18,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"bool",name:"leave"}]},updateTeamInfo:{sid:8,cid:7,service:"team",params:[{type:"Property",name:"team",reflectMapper:Yp.team}],response:[{type:"Number",name:"id"},{type:"Number",name:"time"}]},getTeamsById:{sid:8,cid:34,service:"team",params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:Xp.team},{type:"StrArray",name:"tids"}],ignoreErrCodes:[816]},getTeamMembers:{sid:8,cid:11,service:"team",params:[{type:"Long",name:"teamId"},{type:"Long",name:"timetag"}],response:[{type:"String",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:Xp.teamMember},{type:"Number",name:"timetag"}]},getMutedTeamMembers:{sid:8,cid:27,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"String",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:Xp.teamMember}]},addTeamMembers:{sid:8,cid:5,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}],response:[{type:"Long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},removeTeamMembers:{sid:8,cid:6,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applyTeam:{sid:8,cid:13,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:Xp.team}]},addTeamManagers:{sid:8,cid:16,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeTeamManagers:{sid:8,cid:17,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateMyMemberInfo:{sid:8,cid:19,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:Yp.teamMember}]},updateNickInTeam:{sid:8,cid:20,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:Yp.teamMember}]},muteTeamMember:{sid:8,cid:25,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Int",name:"mute"}]},getTeamMemberInvitorAccid:{sid:8,cid:33,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"Object",name:"accountsMap"}]},muteTeam:{sid:8,cid:32,service:"team",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},passTeamApply:{sid:8,cid:14,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamApply:{sid:8,cid:15,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptTeamInvite:{sid:8,cid:21,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamInvite:{sid:8,cid:22,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncTeams:{sid:8,cid:109,service:"team",response:[{type:"Number",name:"timetag"},{type:"PropertyArray",name:"teams",reflectMapper:Xp.team}]},syncCreateTeam:{sid:8,cid:101,service:"team",response:[{type:"Property",name:"team",reflectMapper:Xp.team}]},syncUpdateTeamMember:{sid:8,cid:119,service:"team",response:[{type:"Property",name:"teamMember",reflectMapper:Xp.teamMember}]}},em={"3_1":"updatePushToken","3_2":"updateAppBackground","3_7":"getUsersNameCardFromServer","3_10":"updateMyNameCard","3_109":"syncMyNameCard","3_110":"onUpdateMyNameCard","3_3":"setBlack","3_103":"onUpdateBlackList","3_5":"setMute","3_105":"onUpdateMuteList","3_8":"syncRelations"},tm={user:{account:1,nick:3,avatar:4,signature:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13},relationMember:{account:0,isMuted:1,isBlack:2,createTime:3,updateTime:4}},rm=invertSerializeMap(tm),nm={updatePushToken:{sid:3,cid:1,service:"user",params:[{type:"String",name:"tokenName"},{type:"String",name:"token"},{type:"Int",name:"pushkit"}]},updateAppBackground:{sid:3,cid:2,service:"user",params:[{type:"Boolean",name:"isBackground"},{type:"Int",name:"badge"}]},syncMyNameCard:{sid:3,cid:109,service:"user",response:[{type:"Property",name:"user",reflectMapper:rm.user},{type:"Number",name:"timetag"}]},setBlack:{service:"user",sid:3,cid:3,params:[{type:"String",name:"account"},{type:"bool",name:"isAdd"}]},onUpdateBlackList:{service:"user",sid:3,cid:103,response:[{type:"String",name:"account"},{type:"Boolean",name:"isAdd"}]},setMute:{service:"user",sid:3,cid:5,params:[{type:"String",name:"account"},{type:"bool",name:"isAdd"}]},onUpdateMuteList:{service:"user",sid:3,cid:105,response:[{type:"String",name:"account"},{type:"Boolean",name:"isAdd"}]},syncRelations:{service:"user",sid:3,cid:8,params:[{type:"long",name:"timetag"}],response:[{type:"PropertyArray",name:"list",reflectMapper:rm.relationMember},{type:"Number",name:"timetag"}]},getUsersNameCardFromServer:{service:"user",sid:3,cid:7,params:[{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"users",reflectMapper:rm.user}]},updateMyNameCard:{service:"user",sid:3,cid:10,params:[{type:"Property",name:"user",reflectMapper:tm.user}],response:[{type:"Number",name:"timetag"}]},onUpdateMyNameCard:{service:"user",sid:3,cid:110,response:[{type:"Property",name:"user",reflectMapper:rm.user}]}},am={subType:{type:"string"},setting:{resendFlag:{type:"boolean"},envConfig:{type:"string"},needSaveHistory:{type:"boolean"},needRoaming:{type:"boolean"},needOffline:{type:"boolean"},needSelfSync:{type:"boolean"},needRouted:{type:"boolean"},needUpdateSession:{type:"boolean"},isMuted:{type:"boolean"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBIZID:{type:"string"},clientAntispamHitting:{type:"boolean"},antiSpamUsingYidun:{type:"boolean"},yidunCallbackURL:{type:"string"},yidunAntiCheating:{type:"string"},yidunAntiSpamExtension:{type:"string"},yidunAntiSpamResult:{type:"string"}},pushInfo:{needPush:{type:"boolean"},needPushBadge:{type:"boolean"},needPushNick:{type:"boolean"},pushApnsText:{type:"string"},pushPayload:{type:"string"}},teamSpecializationInfo:{needForcePush:{type:"boolean"},needACK:{type:"boolean"},forcePushIDsList:{type:"string"},pushContent:{type:"string"},isACKSent:{type:"boolean"},ackSnapshot:{type:"number"}},threadMessageInfo:{replyMsgFromAccount:{type:"string"},replyMsgToAccount:{type:"string"},replyMsgTime:{type:"number"},replyMsgIdServer:{type:"string"},replyMsgIdClient:{type:"string"},threadMsgFromAccount:{type:"string"},threadMsgToAccount:{type:"string"},threadMsgTime:{type:"number"},threadMsgIdServer:{type:"string"},threadMsgIdClient:{type:"string"}}},om={0:"addTeamMembers",1:"removeTeamMembers",2:"leaveTeam",3:"updateTeam",4:"dismissTeam",5:"passTeamApply",6:"transferTeam",7:"addTeamManagers",8:"removeTeamManagers",9:"acceptTeamInvite",10:"updateTeamMemberMute",101:"netcallMiss",102:"netcallBill",103:"netcallReject",401:"addSuperTeamMembers",402:"removeSuperTeamMembers",403:"leaveSuperTeam",404:"updateSuperTeam",405:"dismissSuperTeam",406:"transferSuperTeam",407:"addSuperTeamManagers",408:"removeSuperTeamManagers",409:"updateSuperTeamMembersMute",410:"passSuperTeamApply",411:"acceptSuperTeamInvite"};function getSessionId(t,a){return gd[t.scene]+"-"+(t.to===a?t.from:t.to)}function formatMsg$1(t,a){var o=a.account,c=a.featureValue,m=a.statusValue,h=a.sessionAck,v=a.msgReceiptTime,b=gd[t.scene],S=t.to===o?t.from:t.to,M=bd.default,C=vd.unread;_u(t.isInBlackList)>0?(C=vd.refused,delete t.isInBlackList):C=t.from===o?v&&v>=+t.time?vd.receipt:vd.sent:h&&h>=+t.time?vd.read:vd.unread;var T=fi(fi({},format(am,t)),{scene:b,type:fd[t.type],fromClientType:yd[t.fromClientType],flow:t.from===o?"out":"in",target:S,to:t.to,from:t.from,time:t.time?+t.time:void 0,userUpdateTime:t.userUpdateTime?+t.userUpdateTime:void 0,idClient:t.idClient,sessionId:b+"-"+S,status:vd[m||C],feature:bd[c||M]});if("string"==typeof T.attach)try{T.attach=JSON.parse(T.attach)}catch(t){}return"notification"===T.type&&(T.attach=T.attach?function formatNotificationAttach(t){var a,o={};if(o.type=om[t.id]||t.id,!t.data)return o;var c,m={ids:"accounts",id:"account",attach:"custom",channel:"channelId",calltype:"netcallType",mute:"mute",duration:"duration",time:"time",from:"from",ext:"ext"},h=t.data;return forEach$1(a=ui(m)).call(a,(function(t){void 0!==h[t]&&(o[m[t]]=h[t])})),h.tinfo&&(o.team=formatTeam(deserialize(h.tinfo,Xp.team))),h.uinfos&&(o.users=map(c=h.uinfos).call(c,(function(t){return formatUser(deserialize(t,rm.user))}))),void 0!==h.mute&&(o.mute=1===_u(h.mute)),o}(T.attach):{}),T}function formatMsgs$1(t,a){return t&&t.length>0?map(t).call(t,(function(t){return formatMsg$1(t,a)})):[]}function formatDeletedMsgs(t,a){return map(t).call(t,(function(t){var o;return o=a||(Up(_u(t.scene))?t.scene:1===_u(t.scene)?"p2p":"team"),{deletedTime:_u(t.time),from:t.from,idClient:t.deletedIdClient||t.idClient,idServer:t.deletedIdServer||t.idServer,scene:o,time:_u(t.time),to:t.to}}))}var im=Array.prototype.reverse;var sm=function reverse(t){return null==t?t:im.call(t)},cm=/*#__PURE__*/function(){function ModuleService(t){this.core=t}return ModuleService.prototype.processBroadcastMsg=function processBroadcastMsg(t){var a=map(t).call(t,(function(t){return fi(fi({},t),{time:_u(t.time)})}));return this.core.sendCmd("batchMarkRead",{sid:7,cid:17,ids:map(a).call(a,(function(t){return t.id}))}),a},ModuleService}(),lm={"4_4":"syncOfflineMsgs","4_9":"syncRoamingMsgs","4_17":"syncRoamingMsgs","4_21":"syncDeleteSelfMsgs","7_1":"sendMsg","8_23":"getHistoryTeamMsgs","21_14":"getHistorySuperTeamMsgs","8_2":"sendTeamMsg","21_2":"sendSuperTeamMsg","7_11":"sendMsgReceipt","7_13":"recallMsg","7_24":"deleteSelfMsgs","21_17":"recallSuperTeamMsg","7_2":"onMsg","8_3":"onMsg","21_3":"onMsg","7_101":"onMsg","8_102":"onMsg","21_102":"onMsg","8_4":"nimOnTeamMsgs","4_16":"syncBroadcastMsg","7_17":"onBroadcastMsg","7_123":"onDeleteSelfMsg","7_124":"onDeleteSelfMsgs"},um={scene:0,to:1,from:2,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,type:8,body:9,attach:10,idClient:11,idServer:12,resendFlag:13,userUpdateTime:14,ext:15,pushPayload:16,pushApnsText:17,forcePushIDsList:18,pushContent:19,needForcePush:20,needAntiSpam:21,antiSpamContent:22,antiSpamBIZID:23,clientAntispamHitting:24,antiSpamUsingYidun:25,needACK:26,yidunCallbackURL:27,needUpdateSession:28,replyMsgFromAccount:29,replyMsgToAccount:30,replyMsgTime:31,replyMsgIdServer:32,replyMsgIdClient:33,threadMsgFromAccount:34,threadMsgToAccount:35,threadMsgTime:36,threadMsgIdServer:37,threadMsgIdClient:38,isDeleted:39,callbackExt:40,subType:41,yidunAntiCheating:42,envConfig:43,yidunAntiSpamExtension:44,yidunAntiSpamResult:45,needSaveHistory:100,needRoaming:101,needSelfSync:102,isMuted:104,needRouted:105,isInBlackList:106,needPush:107,needOffline:108,needPushBadge:109,needPushNick:110,isReplyMsg:111,ackSnapshot:112},dm={msg:um,recallMsgTag:{time:0,type:1,to:2,from:3,ps:4,attach:5,apnsText:8,pushPayload:9,deletedIdClient:10,deletedIdServer:11,opeAccount:16,env:21},deleteSelfMsgTag:{scene:1,from:2,to:3,idServer:4,idClient:5,time:6,deletedTime:7,ext:8},msgReceiptTag:{to:1,from:2,time:7,idClient:11},broadcastMsg:{id:1,fromAccid:2,time:4,body:5}},pm=invertSerializeMap(dm),mm={sendMsg:{sid:7,cid:1,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:dm.msg}],response:[{type:"Property",name:"msg",reflectMapper:pm.msg}],ignoreErrCodes:[7101]},sendTeamMsg:{sid:8,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:dm.msg}],response:[{type:"Property",name:"msg",reflectMapper:pm.msg}]},sendSuperTeamMsg:{sid:21,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:dm.msg}],response:[{type:"Property",name:"msg",reflectMapper:pm.msg}]},onMsg:{sid:7,cid:2,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:pm.msg}]},nimOnTeamMsgs:{sid:8,cid:4,service:"msg",response:[{type:"PropertyArray",name:"datas",reflectMapper:pm.msg}]},getHistoryTeamMsgs:{sid:8,cid:23,service:"msg",params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:pm.msg}]},getHistorySuperTeamMsgs:{sid:21,cid:14,params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:pm.msg}],service:"msg"},recallMsg:{sid:7,cid:13,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:dm.recallMsgTag}]},deleteSelfMsgs:{sid:7,cid:24,service:"msg",params:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:dm.deleteSelfMsgTag}],response:[{type:"Long",name:"timetag"}]},recallSuperTeamMsg:{sid:21,cid:17,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:dm.recallMsgTag}]},sendMsgReceipt:{sid:7,cid:11,service:"msg",params:[{type:"Property",name:"msgReceiptTag",reflectMapper:dm.msgReceiptTag}],response:[{type:"Property",name:"msgReceiptTag",reflectMapper:pm.msgReceiptTag}]},batchMarkRead:{sid:4,cid:5,service:"msg",isNoResponse:!0,params:[{type:"byte",name:"sid"},{type:"byte",name:"cid"},{type:"LongArray",name:"ids"}]},syncMsgReceipts:{sid:4,cid:12,service:"msg",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:pm.msgReceiptTag},{type:"Number",name:"timetag"}]},syncOfflineMsgs:{sid:4,cid:4,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:pm.msg}]},syncRoamingMsgs:{sid:4,cid:9,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:pm.msg}]},syncBroadcastMsg:{sid:4,cid:16,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:pm.broadcastMsg}]},onBroadcastMsg:{sid:7,cid:17,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:pm.broadcastMsg}]},onDeleteSelfMsg:{sid:7,cid:123,service:"msg",response:[{type:"Property",name:"deletedMsg",reflectMapper:pm.deleteSelfMsgTag}]},onDeleteSelfMsgs:{sid:7,cid:124,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:pm.deleteSelfMsgTag}]},syncDeleteSelfMsgs:{sid:4,cid:21,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:pm.deleteSelfMsgTag}]}},hm=/*#__PURE__*/function(t){function MsgService(a){var o;return(o=t.call(this,"msg",a)||this).service=new cm(a),registerParser({cmdMap:lm,cmdConfig:mm}),o}Mt(MsgService,t);var a=MsgService.prototype;return a.sendTextMsg=function sendTextMsg(t){return validate({body:{type:"string",allowEmpty:!1}},t),this.sendMsg(fi(fi({},t),{type:"text"}))},a.sendTipMsg=function sendTipMsg(t){return validate({body:{type:"string",allowEmpty:!1}},t),this.sendMsg(fi(fi({},t),{type:"tip"}))},a.sendGeoLocationMsg=function sendGeoLocationMsg(t){return validate({attach:{type:"object",rules:{title:{type:"string",allowEmpty:!1},lat:{type:"number"},lng:{type:"number"}}}},t),this.sendMsg(fi(fi({},t),{type:"geo",attach:gi(t.attach)}))},a.sendCustomMsg=function sendCustomMsg(t){return validate({attach:{type:"string",allowEmpty:!1}},t),this.sendMsg(fi(fi({},t),{type:"custom"}))},a.sendMsg=function sendMsg(t){var a,o=this;validate({scene:{type:"enum",values:getEnumKeys(gd)},type:{type:"enum",values:getEnumKeys(fd)},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},setting:{type:"object",rules:{resendFlag:{type:"boolean",required:!1},needSaveHistory:{type:"boolean",required:!1},needRoaming:{type:"boolean",required:!1},needOffline:{type:"boolean",required:!1},needSelfSync:{type:"boolean",required:!1},needRouted:{type:"boolean",required:!1},needUpdateSession:{type:"boolean",required:!1}},required:!1},antiSpamInfo:{type:"object",required:!1,rules:{clientAntispamHitting:{type:"boolean",required:!1},antiSpamUsingYidun:{type:"boolean",required:!1}}},pushInfo:{type:"object",required:!1,rules:{needPush:{type:"boolean",required:!1},pushApnsText:{type:"string",allowEmpty:!1,required:!1},pushPayload:{type:"string",allowEmpty:!1,max:2048,required:!1}}},teamSpecializationInfo:{type:"object",required:!1,rules:{needForcePush:{type:"boolean",required:!1},needACK:{type:"boolean",required:!1},forcePushIDsList:{type:"string",allowEmpty:!1,required:!1},pushContent:{type:"string",allowEmpty:!1,max:150,required:!1}}}},t);var c,m="p2p"===t.scene?"sendMsg":"team"===t.scene?"sendTeamMsg":"sendSuperTeamMsg",h=function generatorMsgForCmd$2(t,a,o,c){t.onSendBefore,t.onUploadStart,t.onUploadDone;var m=t.replyMsg,h=__rest(t,["onSendBefore","onUploadStart","onUploadDone","replyMsg"]),v=fi(fi({},formatReverse(am,h)),{scene:gd[t.scene],type:fd[t.type],from:a,fromClientType:16,fromDeviceId:o,fromNick:null==c?void 0:c.nick,userUpdateTime:null==c?void 0:c.updateTime,status:vd[vd.sending]});if(v.idClient=v.resendFlag?t.idClient:wu(),!v.idClient)throw new oc("idClient is required to resend a message","idClient","required");return v.scene===gd.team&&v.needForcePush&&(v.pushContent=v.pushContent||v.pushApnsText,v.forcePushIDsList=v.forcePushIDsList?v.forcePushIDsList:"#%@all@%#"),m&&(v.replyMsgFromAccount=m.from,v.replyMsgToAccount=m.to,v.replyMsgTime=+m.time,v.replyMsgIdServer=m.idServer,v.replyMsgIdClient=m.idClient,v.threadMsgFromAccount=m.from,v.threadMsgToAccount=m.to,v.threadMsgTime=+m.time,v.threadMsgIdServer=m.idServer,v.threadMsgIdClient=m.idClient,m.threadMessageInfo&&m.threadMessageInfo.threadMsgIdServer&&(v.threadMsgFromAccount=m.threadMessageInfo.threadMsgFromAccount,v.threadMsgToAccount=m.threadMessageInfo.threadMsgToAccount,v.threadMsgTime=m.threadMessageInfo.threadMsgTime,v.threadMsgIdServer=m.threadMessageInfo.threadMsgIdServer,v.threadMsgIdClient=m.threadMessageInfo.threadMsgIdClient)),v}(t,this.core.account,this.core.config.deviceId,null===(a=this.core.user)||void 0===a?void 0:a.myInfo),v=formatMsg$1(fi(fi({},h),{time:(new Date).getTime()}),{account:this.core.account,featureValue:bd.default,statusValue:vd.sending});try{t.onSendBefore&&t.onSendBefore(v)}catch(t){this.logger.error("sendMsg: options.onSendBefore error",t)}return this.core.eventBus.emit("session/updateForNewMsg",v),this.core.sendCmd(m,{msg:h}).then((function(a){var m=a.content,b=a.error,S=formatMsg$1(fi(fi({},h),m.msg),{account:o.core.account,featureValue:bd.default,statusValue:vd.sent});if(c=m.msg,o.core.eventBus.emit("session/updateForNewMsg",S),o.core.reporter.report("msgSend",{msgId:S.idServer,clientId:S.idClient,msgTime:S.time,fromAccid:"p2p"===t.scene?o.core.account:"",toAccid:S.to,type:gd[S.scene],roomId:"",tid:"p2p"===t.scene?"":S.to,result:200,faiReason:"",rt:os()-v.time}),b)throw b;return S})).catch((function(a){var m=formatMsg$1(fi(fi(fi({},h),c),{time:(new Date).getTime()}),{account:o.core.account,featureValue:bd.default,statusValue:7101===a.code?vd.refused:vd.sendFailed});throw a.msg=m,o.core.eventBus.emit("session/updateForNewMsg",m),o.core.reporter.report("msgSend",{msgId:m.idServer,clientId:m.idClient,msgTime:m.time,fromAccid:"p2p"===t.scene?o.core.account:"",toAccid:m.to,type:gd[m.scene],roomId:"",tid:"p2p"===t.scene?"":m.to,result:null==a?void 0:a.code,faiReason:(null==a?void 0:a.message)||"",rt:os()-v.time}),a}))},a.resendMsg=function resendMsg(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var a,o;return ci.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:if(validate({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}}},t),a=t.msg,o=fi(fi({},a),{attach:a.attach?gi(a.attach):void 0,setting:{resendFlag:!0}}),a.from===this.core.account){c.next=5;break}throw new Error("You can only resend messages that you sent: "+a.idClient);case 5:return c.abrupt("return",this.sendMsg(o));case 6:case"end":return c.stop()}}),_callee,this)})))},a.forwardMsg=function forwardMsg(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var a,o;return ci.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return validate({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}},scene:{type:"enum",values:getEnumKeys(gd)},to:{type:"string",allowEmpty:!1}},t),a=t.msg,o=fi(fi({},a),{scene:t.scene,to:t.to,attach:a.attach?gi(a.attach):void 0}),c.abrupt("return",this.sendMsg(o));case 4:case"end":return c.stop()}}),_callee2,this)})))},a.sendImageMsg=function sendImageMsg(t){return this.doSendFile(fi(fi({},t),{type:"image"}))},a.sendFileMsg=function sendFileMsg(t){return this.doSendFile(fi(fi({},t),{type:"file"}))},a.sendAudioMsg=function sendAudioMsg(t){return this.doSendFile(fi(fi({},t),{type:"audio"}))},a.sendVideoMsg=function sendVideoMsg(t){return this.doSendFile(fi(fi({},t),{type:"video"}))},a.doSendFile=function doSendFile(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var a;return ci.wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:if(validate({scene:{type:"enum",values:getEnumKeys(gd)},to:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},t),a=t.attach){o.next=27;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){o.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return o.prev=5,this.core.reporter.reportTraceStart("nos",{user_id:this.core.account,action:"upload"}),o.next=9,this.core.cloudStorage.uploadFile(t);case 9:a=o.sent,this.core.reporter.reportTraceEnd("nos",!0),o.next=19;break;case 13:throw o.prev=13,o.t0=o.catch(5),this.core.reporter.reportTraceUpdate("nos",{operation_type:"transfer",error:o.t0},!1),this.core.reporter.reportTraceEnd("nos",!1),this.logger.error("sendFile:: upload File error or abort",o.t0),o.t0;case 19:o.prev=19,t.onUploadDone&&t.onUploadDone(a),o.next=27;break;case 23:throw o.prev=23,o.t1=o.catch(19),this.logger.error("sendFile options.onUploadDone err",o.t1),o.t1;case 27:return o.abrupt("return",this.sendMsg(fi(fi({},t),{attach:gi(a),type:t.type})));case 28:case"end":return o.stop()}}),_callee3,this,[[5,13],[19,23]])})))},a.recallMsg=function recallMsg(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){var a,o,c;return ci.wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:return validate({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},scene:{type:"enum",values:getEnumKeys(gd)},time:{type:"number"}}},apnsText:{type:"string",allowEmpty:!1,required:!1},ps:{type:"string",allowEmpty:!1,required:!1}},t),a=t.msg,o={p2p:"recallMsg",team:"recallMsg",superTeam:"recallSuperTeamMsg"},c={p2p:7,team:8,superTeam:12},m.next=6,this.core.sendCmd(o[a.scene],{recallMsgTag:{time:a.time,type:c[a.scene],to:a.to,from:a.from,ps:t.ps,attach:t.attach,apnsText:t.apnsText,pushPayload:t.pushPayload,deletedIdClient:a.idClient,deletedIdServer:a.idServer,opeAccount:a.from,env:t.env}});case 6:return this.core.eventBus.emit("session/updateForDeletedMsg",formatDeletedMsgs([a])),m.abrupt("return",a);case 8:case"end":return m.stop()}}),_callee4,this)})))},a.deleteSelfMsgs=function deleteSelfMsgs(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){var a,o,c;return ci.wrap((function _callee5$(m){for(;;)switch(m.prev=m.next){case 0:return validate({msgs:{type:"array",rules:{scene:{type:"enum",values:["p2p","team"]},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},time:{type:"number",allowEmpty:!1}}},ext:{type:"string",allowEmpty:!1,required:!1}},t),a=t.msgs,o=map(a).call(a,(function(a){return{scene:"p2p"===a.scene?1:2,from:a.from,to:a.to,idServer:a.idServer,idClient:a.idClient,time:a.time,ext:t.ext}})),m.next=5,this.core.sendCmd("deleteSelfMsgs",{deletedMsgs:o});case 5:return c=formatDeletedMsgs(o),this.core.eventBus.emit("session/updateForDeletedMsg",c),m.abrupt("return",c);case 8:case"end":return m.stop()}}),_callee5,this)})))},a.sendMsgReceipt=function sendMsgReceipt(t){var a,o;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){var c,m,h,v;return ci.wrap((function _callee6$(b){for(;;)switch(b.prev=b.next){case 0:if(validate({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},target:{type:"string",allowEmpty:!1},time:{type:"number"}}}},t),"p2p"===(c=t.msg).scene&&"in"===c.flow){b.next=5;break}return this.logger.warn("Msg scene: "+c.scene+", flow: "+c.flow+" is not allowed to send msg receipt"),b.abrupt("return",void 0);case 5:return m={to:c.target,idClient:c.idClient,time:c.time},b.next=8,this.core.sendCmd("sendMsgReceipt",{msgReceiptTag:m});case 8:return h=b.sent,v=_u(null===(o=null===(a=h.content)||void 0===a?void 0:a.msgReceiptTag)||void 0===o?void 0:o.time),b.abrupt("return",fi(fi({},m),{time:v?Math.min(v,m.time):m.time}));case 11:case"end":return b.stop()}}),_callee6,this)})))},a.sendTeamMsgReceipt=function sendTeamMsgReceipt(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee7(){var a;return ci.wrap((function _callee7$(o){for(;;)switch(o.prev=o.next){case 0:return validate({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}},max:50}},t),a=t.teamMsgReceipts,this.core.sendCmd("sendTeamMsgReceipt",{teamMsgReceipts:a}),o.abrupt("return",void 0);case 4:case"end":return o.stop()}}),_callee7,this)})))},a.getTeamMsgReads=function getTeamMsgReads(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee8(){var o,c,m;return ci.wrap((function _callee8$(h){for(;;)switch(h.prev=h.next){case 0:return validate({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},t),o=t.teamMsgReceipts,h.next=4,this.core.sendCmd("getTeamMsgReads",{teamMsgReceipts:o});case 4:return c=h.sent,m=(m=null===(a=c.content)||void 0===a?void 0:a.teamMsgReceipts)?map(m).call(m,(function(t){return fi(fi({},t),{read:_u(t.read),unread:_u(t.unread)})})):[],h.abrupt("return",m);case 8:case"end":return h.stop()}}),_callee8,this)})))},a.getTeamMsgReadAccounts=function getTeamMsgReadAccounts(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee9(){var a,o;return ci.wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamMsgReceipt:{type:"object",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},t),a=t.teamMsgReceipt,c.next=4,this.core.sendCmd("getTeamMsgReadAccounts",{teamMsgReceiptTag:a});case 4:return o=c.sent,c.abrupt("return",o.content);case 6:case"end":return c.stop()}}),_callee9,this)})))},a.markMsgsAck=function markMsgsAck(t){if(t&&t.length>0){var a=[],o=[];forEach$1(t).call(t,(function(t){"p2p"===t.scene&&"in"===t.flow?a.push(t):"team"===t.scene&&"in"===t.flow&&o.push(t)})),a.length>0&&this.core.sendCmd("batchMarkRead",{sid:7,cid:2,ids:map(a).call(a,(function(t){return t.idServer}))}),o.length>0&&this.core.sendCmd("batchMarkRead",{sid:8,cid:3,ids:map(o).call(o,(function(t){return t.idServer}))})}},a.onMsgHandler=function onMsgHandler(t){var a;if(t.error)this.logger.error("msgHandler::recvError",t.error);else{var o=os(),c=getSessionId(t.content.msg,this.core.account),m=null===(a=this.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:c}),h=formatMsg$1(t.content.msg,m?{account:this.core.account,sessionAck:m.ack,msgReceiptTime:m.msgReceiptTime}:{account:this.core.account});if("debug"===this.core.options.debugLevel?this.logger.debug("msgHandler::recvMsg",h.idClient,h.idServer,h):this.logger.log("msgHandler::recvMsg",h.idClient,h.idServer),this.markMsgsAck([h]),"notification"===h.type)this.core.eventBus.emit("session/updateForNewMsg",h),this.core.eventBus.emit("team/onNotification",h);else{if("out"!==h.flow){var v="p2p"===h.scene,b={msgId:h.idServer,clientId:h.idClient,receiveTime:t.__receiveTime,serverTime:h.time,callbackTime:os(),preHandleTime:o,fromAccid:h.from,toAccid:this.core.account,type:gd[h.scene],tid:v?"":h.to,result:200,failReason:"",rt:os()-h.time};this.core.reporter.report("msgReceive",b,!0)}this.core.eventBus.emit("session/updateForNewMsg",h),this.core.emit("msg",h)}}},a.nimOnTeamMsgsHandler=function nimOnTeamMsgsHandler(t){var a,o=this;forEach$1(a=t.content.datas).call(a,(function(a){o.onMsgHandler(fi({},t,{content:{msg:a}}))}))},a.syncRoamingMsgsHandler=function syncRoamingMsgsHandler(t){var a,o=t.content.msgs||[];if(0!==o.length){var c=getSessionId(o[0],this.core.account),m=null===(a=this.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:c}),h=(o=formatMsgs$1(o,m?{account:this.core.account,featureValue:bd.roam,sessionAck:m.ack,msgReceiptTime:m.msgReceiptTime}:{account:this.core.account,featureValue:bd.roam}))[0].time,v={timetag:h,sessionId:c,msgs:sm(o)};this.core.eventBus.emit("session/syncMsgs",v),this.core.emit("syncRoamingMsgs",v),this.core.eventBus.emit("sync/updateTimetag",{roamingMsgs:h})}},a.syncOfflineMsgsHandler=function syncOfflineMsgsHandler(t){var a,o=this,c=t.content.msgs||[];if(0!==c.length){var m={},h=[];forEach$1(c).call(c,(function(t){var a=getSessionId(t,o.core.account),c=o.core.session.getSessionWithUncomplete({id:a}),v=formatMsg$1(t,c?{account:o.core.account,featureValue:bd.leave,sessionAck:c.ack,msgReceiptTime:c.msgReceiptTime}:{account:o.core.account,featureValue:bd.leave});h.push(v),m[v.sessionId]?m[v.sessionId].push(v):m[v.sessionId]=[v]})),this.markMsgsAck(h);var v=0;forEach$1(a=ui(m)).call(a,(function(t){var a,c=sort(a=m[t]).call(a,(function(t,a){return a.time-t.time}));c[0].time>v&&(v=c[0].time);var h={timetag:c[0].time,sessionId:t,msgs:c};o.core.eventBus.emit("session/syncMsgs",h),o.core.emit("syncOfflineMsgs",h)})),this.core.eventBus.emit("sync/updateTimetag",{offlineMsgs:v})}},a.syncDeleteSelfMsgsHandler=function syncDeleteSelfMsgsHandler(t){var a,o=null===(a=t.content)||void 0===a?void 0:a.deletedMsgs;o&&o.length>0||this.logger.warn("syncDeleteSelfMsgs:: no msgs");var c=o[o.length-1].time;this.core.eventBus.emit("sync/updateTimetag",{deleteSelfMsgs:c})},a.onDeleteSelfMsgHandler=function onDeleteSelfMsgHandler(t){var a=formatDeletedMsgs([t.content.deletedMsg]);this.core.eventBus.emit("session/updateForDeletedMsg",a),this.core.emit("deleteSelfMsgs",a)},a.onDeleteSelfMsgsHandler=function onDeleteSelfMsgsHandler(t){var a=formatDeletedMsgs(t.content.deletedMsgs);this.core.eventBus.emit("session/updateForDeletedMsg",a),this.core.emit("deleteSelfMsgs",a)},a.onBroadcastMsgHandler=function onBroadcastMsgHandler(t){var a=t.content.msg,o=this.service.processBroadcastMsg([a]);this.core.emit("broadcastMsgs",o)},a.syncBroadcastMsgHandler=function syncBroadcastMsgHandler(t){var a=t.content.msgs,o=this.service.processBroadcastMsg(a);this.core.emit("broadcastMsgs",o)},MsgService}(Sd);var fm=function baseAssignValue(t,a,o){"__proto__"==a&&Hl?Hl(t,a,{configurable:!0,enumerable:!0,value:o,writable:!0}):t[a]=o},gm=Object.prototype.hasOwnProperty;var ym=function assignValue(t,a,o){var c=t[a];gm.call(t,a)&&ll(c,o)&&(void 0!==o||a in t)||fm(t,a,o)};var vm=function baseSet(t,a,o,c){if(!ws(t))return t;for(var m=-1,h=(a=cd(a,t)).length,v=h-1,b=t;null!=b&&++m<h;){var S=ld(a[m]),M=o;if("__proto__"===S||"constructor"===S||"prototype"===S)return t;if(m!=v){var C=b[S];void 0===(M=c?c(C,S,b):void 0)&&(M=ws(C)?C:$d(a[m+1])?[]:{})}ym(b,S,M),b=b[S]}return t};var bm=function basePickBy(t,a,o){for(var c=-1,m=a.length,h={};++c<m;){var v=a[c],b=ud(t,v);o(b,v)&&vm(h,cd(v,t),b)}return h};var Sm=function baseHasIn(t,a){return null!=t&&a in Object(t)};var Mm=function hasPath(t,a,o){for(var c=-1,m=(a=cd(a,t)).length,h=!1;++c<m;){var v=ld(a[c]);if(!(h=null!=t&&o(t,v)))break;t=t[v]}return h||++c!=m?h:!!(m=null==t?0:t.length)&&Kl(m)&&$d(v,m)&&(Ku(t)||Ld(t))};var Cm=function hasIn(t,a){return null!=t&&Mm(t,a,Sm)};var Tm=function basePick(t,a){return bm(t,a,(function(a,o){return Cm(t,o)}))};var _m=function arrayPush(t,a){for(var o=-1,c=a.length,m=t.length;++o<c;)t[m+o]=a[o];return t},wm=fs?fs.isConcatSpreadable:void 0;var Im=function isFlattenable(t){return Ku(t)||Ld(t)||!!(wm&&t&&t[wm])};var km=function baseFlatten(t,a,o,c,m){var h=-1,v=t.length;for(o||(o=Im),m||(m=[]);++h<v;){var b=t[h];a>0&&o(b)?a>1?baseFlatten(b,a-1,o,c,m):_m(m,b):c||(m[m.length]=b)}return m};var xm=function flatten(t){return(null==t?0:t.length)?km(t,1):[]};var Rm=function flatRest(t){return Wl(Dl(t,void 0,xm),t+"")}((function(t,a){return null==t?{}:Tm(t,a)}));_export({global:!0},{globalThis:m});var Em=m,Am=Am||function(t){var a;"undefined"!=typeof window&&window.crypto&&(a=window.crypto),"undefined"!=typeof self&&self.crypto&&(a=self.crypto),void 0!==Em&&Em.crypto&&(a=Em.crypto),!a&&"undefined"!=typeof window&&window.msCrypto&&(a=window.msCrypto),!a&&"undefined"!=typeof global&&global.crypto&&(a=global.crypto);var o=function cryptoSecureRandomInt(){if(a){if("function"==typeof a.getRandomValues)try{return a.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof a.randomBytes)try{return a.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")},c=st||function(){function F(){}return function(t){var a;return F.prototype=t,a=new F,F.prototype=null,a}}(),m={},h=m.lib={},v=h.Base={extend:function extend(t){var a=c(this);return t&&a.mixIn(t),a.hasOwnProperty("init")&&this.init!==a.init||(a.init=function(){a.$super.init.apply(this,arguments)}),a.init.prototype=a,a.$super=this,a},create:function create(){var t=this.extend();return t.init.apply(t,arguments),t},init:function init(){},mixIn:function mixIn(t){for(var a in t)t.hasOwnProperty(a)&&(this[a]=t[a]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function clone(){return this.init.prototype.extend(this)}},b=h.WordArray=v.extend({init:function init(t,a){t=this.words=t||[],this.sigBytes=null!=a?a:4*t.length},toString:function toString(t){return(t||M).stringify(this)},concat:function concat(t){var a=this.words,o=t.words,c=this.sigBytes,m=t.sigBytes;if(this.clamp(),c%4)for(var h=0;h<m;h++){var v=o[h>>>2]>>>24-h%4*8&255;a[c+h>>>2]|=v<<24-(c+h)%4*8}else for(var b=0;b<m;b+=4)a[c+b>>>2]=o[b>>>2];return this.sigBytes+=m,this},clamp:function clamp(){var a=this.words,o=this.sigBytes;a[o>>>2]&=4294967295<<32-o%4*8,a.length=t.ceil(o/4)},clone:function clone(){var t,clone=v.clone.call(this);return clone.words=slice(t=this.words).call(t,0),clone},random:function random(t){for(var a=[],c=0;c<t;c+=4)a.push(o());return new b.init(a,t)}}),S=m.enc={},M=S.Hex={stringify:function stringify(t){for(var a=t.words,o=t.sigBytes,c=[],m=0;m<o;m++){var h=a[m>>>2]>>>24-m%4*8&255;c.push((h>>>4).toString(16)),c.push((15&h).toString(16))}return c.join("")},parse:function parse(t){for(var a=t.length,o=[],c=0;c<a;c+=2)o[c>>>3]|=_u(t.substr(c,2),16)<<24-c%8*4;return new b.init(o,a/2)}},C=S.Latin1={stringify:function stringify(t){for(var a=t.words,o=t.sigBytes,c=[],m=0;m<o;m++){var h=a[m>>>2]>>>24-m%4*8&255;c.push(String.fromCharCode(h))}return c.join("")},parse:function parse(t){for(var a=t.length,o=[],c=0;c<a;c++)o[c>>>2]|=(255&t.charCodeAt(c))<<24-c%4*8;return new b.init(o,a)}},T=S.Utf8={stringify:function stringify(t){try{return decodeURIComponent(escape(C.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function parse(t){return C.parse(unescape(encodeURIComponent(t)))}},w=h.BufferedBlockAlgorithm=v.extend({reset:function reset(){this._data=new b.init,this._nDataBytes=0},_append:function _append(t){var a;"string"==typeof t&&(t=T.parse(t)),concat(a=this._data).call(a,t),this._nDataBytes+=t.sigBytes},_process:function _process(a){var o,c=this._data,m=c.words,h=c.sigBytes,v=this.blockSize,S=h/(4*v),M=(S=a?t.ceil(S):t.max((0|S)-this._minBufferSize,0))*v,C=t.min(4*M,h);if(M){for(var T=0;T<M;T+=v)this._doProcessBlock(m,T);o=splice(m).call(m,0,M),c.sigBytes-=C}return new b.init(o,C)},clone:function clone(){var clone=v.clone.call(this);return clone._data=this._data.clone(),clone},_minBufferSize:0});h.Hasher=w.extend({cfg:v.extend(),init:function init(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function reset(){w.reset.call(this),this._doReset()},update:function update(t){return this._append(t),this._process(),this},finalize:function finalize(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function _createHelper(t){return function(a,o){return new t.init(o).finalize(a)}},_createHmacHelper:function _createHmacHelper(t){return function(a,o){return new I.HMAC.init(t,o).finalize(a)}}});var I=m.algo={};return m}(Math),qm=Am,Pm=qm.lib,Om=Pm.WordArray,Um=Pm.Hasher,Bm=qm.algo,Fm=[],Lm=Bm.SHA1=Um.extend({_doReset:function _doReset(){this._hash=new Om.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function _doProcessBlock(t,a){for(var o=this._hash.words,c=o[0],m=o[1],h=o[2],v=o[3],b=o[4],S=0;S<80;S++){if(S<16)Fm[S]=0|t[a+S];else{var M=Fm[S-3]^Fm[S-8]^Fm[S-14]^Fm[S-16];Fm[S]=M<<1|M>>>31}var C=(c<<5|c>>>27)+b+Fm[S];C+=S<20?1518500249+(m&h|~m&v):S<40?1859775393+(m^h^v):S<60?(m&h|m&v|h&v)-1894007588:(m^h^v)-899497514,b=v,v=h,h=m<<30|m>>>2,m=c,c=C}o[0]=o[0]+c|0,o[1]=o[1]+m|0,o[2]=o[2]+h|0,o[3]=o[3]+v|0,o[4]=o[4]+b|0},_doFinalize:function _doFinalize(){var t=this._data,a=t.words,o=8*this._nDataBytes,c=8*t.sigBytes;return a[c>>>5]|=128<<24-c%32,a[14+(c+64>>>9<<4)]=Math.floor(o/4294967296),a[15+(c+64>>>9<<4)]=o,t.sigBytes=4*a.length,this._process(),this._hash},clone:function clone(){var clone=Um.clone.call(this);return clone._hash=this._hash.clone(),clone}});qm.SHA1=Um._createHelper(Lm),qm.HmacSHA1=Um._createHmacHelper(Lm),Am.SHA1,function(t){var a=t,o=a.lib.Base,c=a.enc.Utf8;a.algo.HMAC=o.extend({init:function init(t,a){t=this._hasher=new t.init,"string"==typeof a&&(a=c.parse(a));var o=t.blockSize,m=4*o;a.sigBytes>m&&(a=t.finalize(a)),a.clamp();for(var h=this._oKey=a.clone(),v=this._iKey=a.clone(),b=h.words,S=v.words,M=0;M<o;M++)b[M]^=1549556828,S[M]^=909522486;h.sigBytes=v.sigBytes=m,this.reset()},reset:function reset(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function update(t){return this._hasher.update(t),this},finalize:function finalize(t){var a,o=this._hasher,c=o.finalize(t);return o.reset(),o.finalize(concat(a=this._oKey.clone()).call(a,c))}})}(Am);var jm=Am,Nm=jm.lib,Dm=Nm.Base,$m=Nm.WordArray,Hm=jm.algo,Gm=Hm.MD5,Qm=Hm.EvpKDF=Dm.extend({cfg:Dm.extend({keySize:4,hasher:Gm,iterations:1}),init:function init(t){this.cfg=this.cfg.extend(t)},compute:function compute(t,a){for(var o,c=this.cfg,m=c.hasher.create(),h=$m.create(),v=h.words,b=c.keySize,S=c.iterations;v.length<b;){o&&m.update(o),o=m.update(t).finalize(a),m.reset();for(var M=1;M<S;M++)o=m.finalize(o),m.reset();concat(h).call(h,o)}return h.sigBytes=4*b,h}});jm.EvpKDF=function(t,a,o){return Qm.create(o).compute(t,a)},Am.EvpKDF;var Wm=Am,Vm=Wm.lib.WordArray;Wm.enc.Base64={stringify:function stringify(t){var a=t.words,o=t.sigBytes,c=this._map;t.clamp();for(var m=[],h=0;h<o;h+=3)for(var v=(a[h>>>2]>>>24-h%4*8&255)<<16|(a[h+1>>>2]>>>24-(h+1)%4*8&255)<<8|a[h+2>>>2]>>>24-(h+2)%4*8&255,b=0;b<4&&h+.75*b<o;b++)m.push(c.charAt(v>>>6*(3-b)&63));var S=c.charAt(64);if(S)for(;m.length%4;)m.push(S);return m.join("")},parse:function parse(t){var a=t.length,o=this._map,c=this._reverseMap;if(!c){c=this._reverseMap=[];for(var m=0;m<o.length;m++)c[o.charCodeAt(m)]=m}var h=o.charAt(64);if(h){var v=indexOf(t).call(t,h);-1!==v&&(a=v)}return function parseLoop(t,a,o){for(var c=[],m=0,h=0;h<a;h++)if(h%4){var v=o[t.charCodeAt(h-1)]<<h%4*2|o[t.charCodeAt(h)]>>>6-h%4*2;c[m>>>2]|=v<<24-m%4*8,m++}return Vm.create(c,m)}(t,a,c)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},Am.enc.Base64;var Km=Am,zm=Km.lib,Jm=zm.WordArray,Ym=zm.Hasher,Xm=Km.algo,Zm=[];!function(){for(var t=0;t<64;t++)Zm[t]=4294967296*Math.abs(Math.sin(t+1))|0}();var eh=Xm.MD5=Ym.extend({_doReset:function _doReset(){this._hash=new Jm.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function _doProcessBlock(t,a){for(var o=0;o<16;o++){var c=a+o,m=t[c];t[c]=16711935&(m<<8|m>>>24)|4278255360&(m<<24|m>>>8)}var h=this._hash.words,v=t[a+0],b=t[a+1],S=t[a+2],M=t[a+3],C=t[a+4],T=t[a+5],w=t[a+6],I=t[a+7],k=t[a+8],x=t[a+9],R=t[a+10],E=t[a+11],A=t[a+12],q=t[a+13],P=t[a+14],O=t[a+15],U=h[0],B=h[1],L=h[2],j=h[3];U=FF(U,B,L,j,v,7,Zm[0]),j=FF(j,U,B,L,b,12,Zm[1]),L=FF(L,j,U,B,S,17,Zm[2]),B=FF(B,L,j,U,M,22,Zm[3]),U=FF(U,B,L,j,C,7,Zm[4]),j=FF(j,U,B,L,T,12,Zm[5]),L=FF(L,j,U,B,w,17,Zm[6]),B=FF(B,L,j,U,I,22,Zm[7]),U=FF(U,B,L,j,k,7,Zm[8]),j=FF(j,U,B,L,x,12,Zm[9]),L=FF(L,j,U,B,R,17,Zm[10]),B=FF(B,L,j,U,E,22,Zm[11]),U=FF(U,B,L,j,A,7,Zm[12]),j=FF(j,U,B,L,q,12,Zm[13]),L=FF(L,j,U,B,P,17,Zm[14]),U=GG(U,B=FF(B,L,j,U,O,22,Zm[15]),L,j,b,5,Zm[16]),j=GG(j,U,B,L,w,9,Zm[17]),L=GG(L,j,U,B,E,14,Zm[18]),B=GG(B,L,j,U,v,20,Zm[19]),U=GG(U,B,L,j,T,5,Zm[20]),j=GG(j,U,B,L,R,9,Zm[21]),L=GG(L,j,U,B,O,14,Zm[22]),B=GG(B,L,j,U,C,20,Zm[23]),U=GG(U,B,L,j,x,5,Zm[24]),j=GG(j,U,B,L,P,9,Zm[25]),L=GG(L,j,U,B,M,14,Zm[26]),B=GG(B,L,j,U,k,20,Zm[27]),U=GG(U,B,L,j,q,5,Zm[28]),j=GG(j,U,B,L,S,9,Zm[29]),L=GG(L,j,U,B,I,14,Zm[30]),U=HH(U,B=GG(B,L,j,U,A,20,Zm[31]),L,j,T,4,Zm[32]),j=HH(j,U,B,L,k,11,Zm[33]),L=HH(L,j,U,B,E,16,Zm[34]),B=HH(B,L,j,U,P,23,Zm[35]),U=HH(U,B,L,j,b,4,Zm[36]),j=HH(j,U,B,L,C,11,Zm[37]),L=HH(L,j,U,B,I,16,Zm[38]),B=HH(B,L,j,U,R,23,Zm[39]),U=HH(U,B,L,j,q,4,Zm[40]),j=HH(j,U,B,L,v,11,Zm[41]),L=HH(L,j,U,B,M,16,Zm[42]),B=HH(B,L,j,U,w,23,Zm[43]),U=HH(U,B,L,j,x,4,Zm[44]),j=HH(j,U,B,L,A,11,Zm[45]),L=HH(L,j,U,B,O,16,Zm[46]),U=II(U,B=HH(B,L,j,U,S,23,Zm[47]),L,j,v,6,Zm[48]),j=II(j,U,B,L,I,10,Zm[49]),L=II(L,j,U,B,P,15,Zm[50]),B=II(B,L,j,U,T,21,Zm[51]),U=II(U,B,L,j,A,6,Zm[52]),j=II(j,U,B,L,M,10,Zm[53]),L=II(L,j,U,B,R,15,Zm[54]),B=II(B,L,j,U,b,21,Zm[55]),U=II(U,B,L,j,k,6,Zm[56]),j=II(j,U,B,L,O,10,Zm[57]),L=II(L,j,U,B,w,15,Zm[58]),B=II(B,L,j,U,q,21,Zm[59]),U=II(U,B,L,j,C,6,Zm[60]),j=II(j,U,B,L,E,10,Zm[61]),L=II(L,j,U,B,S,15,Zm[62]),B=II(B,L,j,U,x,21,Zm[63]),h[0]=h[0]+U|0,h[1]=h[1]+B|0,h[2]=h[2]+L|0,h[3]=h[3]+j|0},_doFinalize:function _doFinalize(){var t=this._data,a=t.words,o=8*this._nDataBytes,c=8*t.sigBytes;a[c>>>5]|=128<<24-c%32;var m=Math.floor(o/4294967296),h=o;a[15+(c+64>>>9<<4)]=16711935&(m<<8|m>>>24)|4278255360&(m<<24|m>>>8),a[14+(c+64>>>9<<4)]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),t.sigBytes=4*(a.length+1),this._process();for(var v=this._hash,b=v.words,S=0;S<4;S++){var M=b[S];b[S]=16711935&(M<<8|M>>>24)|4278255360&(M<<24|M>>>8)}return v},clone:function clone(){var clone=Ym.clone.call(this);return clone._hash=this._hash.clone(),clone}});function FF(t,a,o,c,m,h,v){var b=t+(a&o|~a&c)+m+v;return(b<<h|b>>>32-h)+a}function GG(t,a,o,c,m,h,v){var b=t+(a&c|o&~c)+m+v;return(b<<h|b>>>32-h)+a}function HH(t,a,o,c,m,h,v){var b=t+(a^o^c)+m+v;return(b<<h|b>>>32-h)+a}function II(t,a,o,c,m,h,v){var b=t+(o^(a|~c))+m+v;return(b<<h|b>>>32-h)+a}Km.MD5=Ym._createHelper(eh),Km.HmacMD5=Ym._createHmacHelper(eh),Am.MD5,function(t){t.lib.Cipher||function(){var a=t,o=a.lib,c=o.Base,m=o.WordArray,h=o.BufferedBlockAlgorithm,v=a.enc;v.Utf8;var b=v.Base64,S=a.algo.EvpKDF,M=o.Cipher=h.extend({cfg:c.extend(),createEncryptor:function createEncryptor(t,a){return this.create(this._ENC_XFORM_MODE,t,a)},createDecryptor:function createDecryptor(t,a){return this.create(this._DEC_XFORM_MODE,t,a)},init:function init(t,a,o){this.cfg=this.cfg.extend(o),this._xformMode=t,this._key=a,this.reset()},reset:function reset(){h.reset.call(this),this._doReset()},process:function process(t){return this._append(t),this._process()},finalize:function finalize(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function selectCipherStrategy(t){return"string"==typeof t?A:R}return function(t){return{encrypt:function encrypt(a,o,c){return selectCipherStrategy(o).encrypt(t,a,o,c)},decrypt:function decrypt(a,o,c){return selectCipherStrategy(o).decrypt(t,a,o,c)}}}}()});o.StreamCipher=M.extend({_doFinalize:function _doFinalize(){return this._process(!0)},blockSize:1});var C=a.mode={},T=o.BlockCipherMode=c.extend({createEncryptor:function createEncryptor(t,a){return this.Encryptor.create(t,a)},createDecryptor:function createDecryptor(t,a){return this.Decryptor.create(t,a)},init:function init(t,a){this._cipher=t,this._iv=a}}),w=C.CBC=function(){var t=T.extend();function xorBlock(t,a,o){var c,m=this._iv;m?(c=m,this._iv=void 0):c=this._prevBlock;for(var h=0;h<o;h++)t[a+h]^=c[h]}return t.Encryptor=t.extend({processBlock:function processBlock(t,a){var o=this._cipher,c=o.blockSize;xorBlock.call(this,t,a,c),o.encryptBlock(t,a),this._prevBlock=slice(t).call(t,a,a+c)}}),t.Decryptor=t.extend({processBlock:function processBlock(t,a){var o=this._cipher,c=o.blockSize,m=slice(t).call(t,a,a+c);o.decryptBlock(t,a),xorBlock.call(this,t,a,c),this._prevBlock=m}}),t}(),I=(a.pad={}).Pkcs7={pad:function pad(t,a){for(var o=4*a,c=o-t.sigBytes%o,h=c<<24|c<<16|c<<8|c,v=[],b=0;b<c;b+=4)v.push(h);var S=m.create(v,c);concat(t).call(t,S)},unpad:function unpad(t){var a=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=a}};o.BlockCipher=M.extend({cfg:M.cfg.extend({mode:w,padding:I}),reset:function reset(){var t;M.reset.call(this);var a=this.cfg,o=a.iv,c=a.mode;this._xformMode==this._ENC_XFORM_MODE?t=c.createEncryptor:(t=c.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==t?this._mode.init(this,o&&o.words):(this._mode=t.call(c,this,o&&o.words),this._mode.__creator=t)},_doProcessBlock:function _doProcessBlock(t,a){this._mode.processBlock(t,a)},_doFinalize:function _doFinalize(){var t,a=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(a.pad(this._data,this.blockSize),t=this._process(!0)):(t=this._process(!0),a.unpad(t)),t},blockSize:4});var k=o.CipherParams=c.extend({init:function init(t){this.mixIn(t)},toString:function toString(t){return(t||this.formatter).stringify(this)}}),x=(a.format={}).OpenSSL={stringify:function stringify(t){var a,o,c,h=t.ciphertext,v=t.salt;v?a=concat(o=concat(c=m.create([1398893684,1701076831])).call(c,v)).call(o,h):a=h;return a.toString(b)},parse:function parse(t){var a,o=b.parse(t),c=o.words;return 1398893684==c[0]&&1701076831==c[1]&&(a=m.create(slice(c).call(c,2,4)),splice(c).call(c,0,4),o.sigBytes-=16),k.create({ciphertext:o,salt:a})}},R=o.SerializableCipher=c.extend({cfg:c.extend({format:x}),encrypt:function encrypt(t,a,o,c){c=this.cfg.extend(c);var m=t.createEncryptor(o,c),h=m.finalize(a),v=m.cfg;return k.create({ciphertext:h,key:o,iv:v.iv,algorithm:t,mode:v.mode,padding:v.padding,blockSize:t.blockSize,formatter:c.format})},decrypt:function decrypt(t,a,o,c){return c=this.cfg.extend(c),a=this._parse(a,c.format),t.createDecryptor(o,c).finalize(a.ciphertext)},_parse:function _parse(t,a){return"string"==typeof t?a.parse(t,this):t}}),E=(a.kdf={}).OpenSSL={execute:function execute(t,a,o,c){var h;c||(c=m.random(8));var v=S.create({keySize:a+o}).compute(t,c),b=m.create(slice(h=v.words).call(h,a),4*o);return v.sigBytes=4*a,k.create({key:v,iv:b,salt:c})}},A=o.PasswordBasedCipher=R.extend({cfg:R.cfg.extend({kdf:E}),encrypt:function encrypt(t,a,o,c){var m=(c=this.cfg.extend(c)).kdf.execute(o,t.keySize,t.ivSize);c.iv=m.iv;var h=R.encrypt.call(this,t,a,m.key,c);return h.mixIn(m),h},decrypt:function decrypt(t,a,o,c){c=this.cfg.extend(c),a=this._parse(a,c.format);var m=c.kdf.execute(o,t.keySize,t.ivSize,a.salt);return c.iv=m.iv,R.decrypt.call(this,t,a,m.key,c)}})}()}(Am);var th=Am,rh=th.lib.StreamCipher,nh=th.algo,ah=nh.RC4=rh.extend({_doReset:function _doReset(){for(var t=this._key,a=t.words,o=t.sigBytes,c=this._S=[],m=0;m<256;m++)c[m]=m;m=0;for(var h=0;m<256;m++){var v=m%o,b=a[v>>>2]>>>24-v%4*8&255;h=(h+c[m]+b)%256;var S=c[m];c[m]=c[h],c[h]=S}this._i=this._j=0},_doProcessBlock:function _doProcessBlock(t,a){t[a]^=generateKeystreamWord.call(this)},keySize:8,ivSize:0});function generateKeystreamWord(){for(var t=this._S,a=this._i,o=this._j,c=0,m=0;m<4;m++){o=(o+t[a=(a+1)%256])%256;var h=t[a];t[a]=t[o],t[o]=h,c|=t[(t[a]+t[o])%256]<<24-8*m}return this._i=a,this._j=o,c}th.RC4=rh._createHelper(ah);var oh=nh.RC4Drop=ah.extend({cfg:ah.cfg.extend({drop:192}),_doReset:function _doReset(){ah._doReset.call(this);for(var t=this.cfg.drop;t>0;t--)generateKeystreamWord.call(this)}});th.RC4Drop=rh._createHelper(oh);var ih=Am.RC4,sh=Am.enc.Utf8,ch=/*#__PURE__*/function(t){function UserService(a){var o;return(o=t.call(this,"user",a)||this).myInfo=formatUser({}),registerParser({cmdMap:em,cmdConfig:nm}),o}Mt(UserService,t);var a=UserService.prototype;return a.setBlack=function setBlack(t){return validate({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},t),this.core.sendCmd("setBlack",t).then((function(){}))},a.setMute=function setMute(t){return validate({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},t),this.core.sendCmd("setMute",t).then((function(){}))},a.getRelations=function getRelations(){return this.core.sendCmd("syncRelations",{timetag:0})},a.getBlackList=function getBlackList(){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var t;return ci.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("syncRelations",{timetag:0});case 2:return t=a.sent,a.abrupt("return",t.blackList||[]);case 4:case"end":return a.stop()}}),_callee,this)})))},a.getMuteList=function getMuteList(){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var t;return ci.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("syncRelations",{timetag:0});case 2:return t=a.sent,a.abrupt("return",t.muteList||[]);case 4:case"end":return a.stop()}}),_callee2,this)})))},a.updatePushToken=function updatePushToken(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var a,o;return ci.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return validate({tokenName:{type:"string",allowEmpty:!1,required:!0},token:{type:"string",allowEmpty:!1,required:!0},pushkit:{type:"number",required:!1}},t),a=sh.parse("557d1e3cafa43e2589a588270c53d56f"),o=sh.stringify(ih.decrypt(t.token,a)),c.next=5,this.core.sendCmd("updatePushToken",fi(fi({},t),{token:o}));case 5:case"end":return c.stop()}}),_callee3,this)})))},a.updateAppBackground=function updateAppBackground(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){return ci.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return validate({isBackground:{type:"boolean",required:!0},badge:{type:"number",required:!1}},t),a.next=3,this.core.sendCmd("updateAppBackground",{isBackground:t.isBackground,badge:t.badge||0});case 3:case"end":return a.stop()}}),_callee4,this)})))},a.getUsersNameCardFromServer=function getUsersNameCardFromServer(t){var a=this;return validate({accounts:{type:"array",max:150,itemType:"string"}},t),this.core.sendCmd("getUsersNameCardFromServer",Rm(t,["accounts"])).then((function(o){var c,m=o.content;return a.logger.log("user:: getUsers done",t.accounts),m&&m.users?map(c=m.users).call(c,(function(t){return formatUser(t)})):[]}))},a.updateMyNameCard=function updateMyNameCard(t){var a=this;if(validate({nick:{type:"string",required:!1},avatar:{type:"string",required:!1},signature:{type:"string",required:!1},gender:{type:"enum",values:getEnumKeys(Op),required:!1},email:{type:"string",required:!1},birth:{type:"string",required:!1},tel:{type:"string",required:!1},ext:{type:"string",required:!1}},t),0===ui(t).length)return zo.resolve(this.myInfo);var o=Rm(t,["nick","avatar","signature","email","birth","tel","ext"]);return t.gender&&(o.gender=Op[t.gender]),this.core.sendCmd("updateMyNameCard",{user:o}).then((function(c){var m=c.content;return m&&m.timetag&&a.core.eventBus.emit("sync/updateTimetag",{myInfo:+m.timetag}),t.gender&&(o.gender=t.gender),a.myInfo=fi({},a.myInfo,o),a.myInfo}))},a.onUpdateBlackListHandler=function onUpdateBlackListHandler(t){var a=t.content;a.account?this.core.emit("updateBlackList",a):this.logger.warn("onUpdateBlackListHandler: no account")},a.onUpdateMuteListHandler=function onUpdateMuteListHandler(t){var a=t.content;a.account?this.core.emit("updateMuteList",a):this.logger.warn("onUpdateBlackListHandler: no account")},a.syncRelationsHandler=function syncRelationsHandler(t){var a=t.content,o=a.list,c=a.timetag,m={blackList:[],muteList:[]};return c&&this.core.eventBus.emit("sync/updateTimetag",{relations:c}),o&&o.length&&forEach$1(o).call(o,(function(t){var a=function formatRelationMember(t){var a={account:t.account,updateTime:+t.updateTime,createTime:+t.createTime};return"1"===t.isMuted&&(a.isMuted=!0),"1"===t.isBlack&&(a.isBlack=!0),a}(t);a.isBlack&&m.blackList.push(a),a.isMuted&&m.muteList.push(a)})),this.core.emit("relations",m),zo.resolve(m)},a.syncMyNameCardHandler=function syncMyNameCardHandler(t){t.content.user&&(this.myInfo=formatUser(t.content.user),this.core.emit("syncMyNameCard",this.myInfo),this.core.eventBus.emit("sync/updateTimetag",{myInfo:t.content.timetag}))},a.onUpdateMyNameCardHandler=function onUpdateMyNameCardHandler(t){var a=t.content.user;a?(fi(this.myInfo,formatUser(a)),this.core.emit("updateMyNameCard",this.myInfo)):this.logger.warn("onUpdateMyNameCardHandler no user info")},UserService}(Sd);var lh=function stackClear(){this.__data__=new gl,this.size=0};var uh=function stackDelete(t){var a=this.__data__,o=a.delete(t);return this.size=a.size,o};var dh=function stackGet(t){return this.__data__.get(t)};var ph=function stackHas(t){return this.__data__.has(t)};var mh=function stackSet(t,a){var o=this.__data__;if(o instanceof gl){var c=o.__data__;if(!yl||c.length<199)return c.push([t,a]),this.size=++o.size,this;o=this.__data__=new wl(c)}return o.set(t,a),this.size=o.size,this};function Stack(t){var a=this.__data__=new gl(t);this.size=a.size}Stack.prototype.clear=lh,Stack.prototype.delete=uh,Stack.prototype.get=dh,Stack.prototype.has=ph,Stack.prototype.set=mh;var hh=Stack;var fh=function arraySome(t,a){for(var o=-1,c=null==t?0:t.length;++o<c;)if(a(t[o],o,t))return!0;return!1};var gh=function equalArrays(t,a,o,c,m,h){var v=1&o,b=t.length,S=a.length;if(b!=S&&!(v&&S>b))return!1;var M=h.get(t),C=h.get(a);if(M&&C)return M==a&&C==t;var T=-1,w=!0,I=2&o?new xl:void 0;for(h.set(t,a),h.set(a,t);++T<b;){var k=t[T],x=a[T];if(c)var R=v?c(x,k,T,a,t,h):c(k,x,T,t,a,h);if(void 0!==R){if(R)continue;w=!1;break}if(I){if(!fh(a,(function(t,a){if(!Bl(I,a)&&(k===t||m(k,t,o,c,h)))return I.push(a)}))){w=!1;break}}else if(k!==x&&!m(k,x,o,c,h)){w=!1;break}}return h.delete(t),h.delete(a),w},yh=hs.Uint8Array;var vh=function mapToArray(t){var a=-1,o=Array(t.size);return t.forEach((function(t,c){o[++a]=[c,t]})),o},bh=fs?fs.prototype:void 0,Sh=bh?bh.valueOf:void 0;var Mh=function equalByTag(t,a,o,c,m,h,v){switch(o){case"[object DataView]":if(t.byteLength!=a.byteLength||t.byteOffset!=a.byteOffset)return!1;t=t.buffer,a=a.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=a.byteLength||!h(new yh(t),new yh(a)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ll(+t,+a);case"[object Error]":return t.name==a.name&&t.message==a.message;case"[object RegExp]":case"[object String]":return t==a+"";case"[object Map]":var b=vh;case"[object Set]":var S=1&c;if(b||(b=ru),t.size!=a.size&&!S)return!1;var M=v.get(t);if(M)return M==a;c|=2,v.set(t,a);var C=gh(b(t),b(a),c,m,h,v);return v.delete(t),C;case"[object Symbol]":if(Sh)return Sh.call(t)==Sh.call(a)}return!1};var Ch=function baseGetAllKeys(t,a,o){var c=a(t);return Ku(t)?c:_m(c,o(t))};var Th=function arrayFilter(t,a){for(var o=-1,c=null==t?0:t.length,m=0,h=[];++o<c;){var v=t[o];a(v,o,t)&&(h[m++]=v)}return h};var _h=function stubArray(){return[]},wh=Object.prototype.propertyIsEnumerable,Ih=Object.getOwnPropertySymbols,kh=Ih?function(t){return null==t?[]:(t=Object(t),Th(Ih(t),(function(a){return wh.call(t,a)})))}:_h,xh=kh;var Rh=function getAllKeys(t){return Ch(t,ep,xh)},Eh=Object.prototype.hasOwnProperty;var Ah=function equalObjects(t,a,o,c,m,h){var v=1&o,b=Rh(t),S=b.length;if(S!=Rh(a).length&&!v)return!1;for(var M=S;M--;){var C=b[M];if(!(v?C in a:Eh.call(a,C)))return!1}var T=h.get(t),w=h.get(a);if(T&&w)return T==a&&w==t;var I=!0;h.set(t,a),h.set(a,t);for(var k=v;++M<S;){var x=t[C=b[M]],R=a[C];if(c)var E=v?c(R,x,C,a,t,h):c(x,R,C,t,a,h);if(!(void 0===E?x===R||m(x,R,o,c,h):E)){I=!1;break}k||(k="constructor"==C)}if(I&&!k){var A=t.constructor,q=a.constructor;A==q||!("constructor"in t)||!("constructor"in a)||"function"==typeof A&&A instanceof A&&"function"==typeof q&&q instanceof q||(I=!1)}return h.delete(t),h.delete(a),I},qh=Xc(hs,"DataView"),Ph=Xc(hs,"Promise"),Oh=Xc(hs,"WeakMap"),Uh=Hc(qh),Bh=Hc(yl),Fh=Hc(Ph),Lh=Hc(eu),jh=Hc(Oh),Nh=_s;(qh&&"[object DataView]"!=Nh(new qh(new ArrayBuffer(1)))||yl&&"[object Map]"!=Nh(new yl)||Ph&&"[object Promise]"!=Nh(Ph.resolve())||eu&&"[object Set]"!=Nh(new eu)||Oh&&"[object WeakMap]"!=Nh(new Oh))&&(Nh=function(t){var a=_s(t),o="[object Object]"==a?t.constructor:void 0,c=o?Hc(o):"";if(c)switch(c){case Uh:return"[object DataView]";case Bh:return"[object Map]";case Fh:return"[object Promise]";case Lh:return"[object Set]";case jh:return"[object WeakMap]"}return a});var Dh=Nh,$h=Object.prototype.hasOwnProperty;var Hh=function baseIsEqualDeep(t,a,o,c,m,h){var v=Ku(t),b=Ku(a),S=v?"[object Array]":Dh(t),M=b?"[object Array]":Dh(a),C="[object Object]"==(S="[object Arguments]"==S?"[object Object]":S),T="[object Object]"==(M="[object Arguments]"==M?"[object Object]":M),w=S==M;if(w&&Nd(t)){if(!Nd(a))return!1;v=!0,C=!1}if(w&&!C)return h||(h=new hh),v||Wd(t)?gh(t,a,o,c,m,h):Mh(t,a,S,o,c,m,h);if(!(1&o)){var I=C&&$h.call(t,"__wrapped__"),k=T&&$h.call(a,"__wrapped__");if(I||k){var x=I?t.value():t,R=k?a.value():a;return h||(h=new hh),m(x,R,o,c,h)}}return!!w&&(h||(h=new hh),Ah(t,a,o,c,m,h))};var Gh=function baseIsEqual(t,a,o,c,m){return t===a||(null==t||null==a||!Pc(t)&&!Pc(a)?t!=t&&a!=a:Hh(t,a,o,c,baseIsEqual,m))};var Qh=function baseIsMatch(t,a,o,c){var m=o.length,h=m,v=!c;if(null==t)return!h;for(t=Object(t);m--;){var b=o[m];if(v&&b[2]?b[1]!==t[b[0]]:!(b[0]in t))return!1}for(;++m<h;){var S=(b=o[m])[0],M=t[S],C=b[1];if(v&&b[2]){if(void 0===M&&!(S in t))return!1}else{var T=new hh;if(c)var w=c(M,C,S,t,a,T);if(!(void 0===w?Gh(C,M,3,c,T):w))return!1}}return!0};var Wh=function isStrictComparable(t){return t==t&&!ws(t)};var Vh=function getMatchData(t){for(var a=ep(t),o=a.length;o--;){var c=a[o],m=t[c];a[o]=[c,m,Wh(m)]}return a};var Kh=function matchesStrictComparable(t,a){return function(o){return null!=o&&(o[t]===a&&(void 0!==a||t in Object(o)))}};var zh=function baseMatches(t){var a=Vh(t);return 1==a.length&&a[0][2]?Kh(a[0][0],a[0][1]):function(o){return o===t||Qh(o,t,a)}};var Jh=function baseMatchesProperty(t,a){return Xu(t)&&Wh(a)?Kh(ld(t),a):function(o){var c=dd(o,t);return void 0===c&&c===a?Cm(o,t):Gh(a,c,3)}};var Yh=function baseProperty(t){return function(a){return null==a?void 0:a[t]}};var Xh=function basePropertyDeep(t){return function(a){return ud(a,t)}};var Zh=function property(t){return Xu(t)?Yh(ld(t)):Xh(t)};var ef=function baseIteratee(t){return"function"==typeof t?t:null==t?Ll:"object"==typeof t?Ku(t)?Jh(t[0],t[1]):zh(t):Zh(t)},tf=/\s/;var rf=function trimmedEndIndex(t){for(var a=t.length;a--&&tf.test(t.charAt(a)););return a},nf=/^\s+/;var af=function baseTrim(t){return t?t.slice(0,rf(t)+1).replace(nf,""):t},sf=/^[-+]0x[0-9a-f]+$/i,cf=/^0b[01]+$/i,lf=/^0o[0-7]+$/i,uf=parseInt;var df=function toNumber(t){if("number"==typeof t)return t;if(zu(t))return NaN;if(ws(t)){var a="function"==typeof t.valueOf?t.valueOf():t;t=ws(a)?a+"":a}if("string"!=typeof t)return 0===t?t:+t;t=af(t);var o=cf.test(t);return o||lf.test(t)?uf(t.slice(2),o?2:8):sf.test(t)?NaN:+t};var pf=function toFinite(t){return t?Infinity===(t=df(t))||-Infinity===t?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var mf=function toInteger(t){var a=pf(t),o=a%1;return a==a?o?a-o:a:0},hf=Math.max;var ff=function findIndex(t,a,o){var c=null==t?0:t.length;if(!c)return-1;var m=null==o?0:mf(o);return m<0&&(m=hf(c+m,0)),Rl(t,ef(a),m)},gf={"4_12":"syncMsgReceipts","4_14":"syncSessionAck","4_20":"syncSuperTeamSessionAck","4_22":"nimSyncSessionsWithMoreRoaming","4_25":"syncSessionReliableInfo","7_12":"multiSyncMsgReceipt","7_16":"markSessionAck","7_25":"markMultSessionsAck","7_116":"syncMarkSessionAck","21_25":"markSuperTeamSessionAck","21_32":"markMultSuperTeamSessionsAck","21_125":"syncMarkSuperTeamSessionAck","4_23":"nimSyncStickTopSessions","23_12":"nimAddStickTopSession","23_13":"nimDeleteStickTopSession","23_14":"nimUpdateStickTopSession","23_112":"nimMultiSyncAddStickTopSession","23_113":"nimMultiSyncDeleteStickTopSession","23_114":"nimMultiSyncUpdateStickTopSession"},yf={msgReceiptTag:{to:1,from:2,time:7,idClient:11},stickTopSessionTag:{id:1,ext:2,createTime:3,updateTime:4},sessionAckTag:{scene:1,to:2,timetag:3},sessionReliableSyncTag:{scene:1,sessionId:2,syncStatus:3,syncEndMsgId:4,syncEndMsgidClient:5,syncEndMsgTime:6,syncStartMsgid:7,syncStartMsgidClient:8,syncStartMsgTime:9,nextMsgid:10,nextMsgidClient:11,nextMsgTime:12,roamMsgSync:13,offlineMsgSync:14,netCallOfflineMsgSync:15}},vf=invertSerializeMap(yf),bf={syncMsgReceipts:{sid:4,cid:12,service:"session",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:vf.msgReceiptTag},{type:"Number",name:"timetag"}]},syncSessionAck:{sid:4,cid:14,service:"session",response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Number",name:"timetag"}]},syncSuperTeamSessionAck:{sid:4,cid:20,service:"session",response:[{type:"LongLongMap",name:"superTeam"},{type:"Number",name:"timetag"}]},multiSyncMsgReceipt:{sid:7,cid:12,service:"session",response:[{type:"Property",name:"msgReceiptTag",reflectMapper:vf.msgReceiptTag}]},markSessionAck:{sid:7,cid:16,service:"session",params:[{type:"byte",name:"scene"},{type:"String",name:"to"},{type:"long",name:"timetag"}]},syncMarkSessionAck:{sid:7,cid:116,service:"session",response:[{type:"byte",name:"scene"},{type:"String",name:"to"},{type:"long",name:"timetag"}]},syncMarkSuperTeamSessionAck:{sid:21,cid:125,service:"session",response:[{type:"String",name:"to"},{type:"long",name:"timetag"}]},markMultSessionsAck:{sid:7,cid:25,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:yf.sessionAckTag}]},markSuperTeamSessionAck:{sid:21,cid:25,service:"session",params:[{type:"long",name:"to"},{type:"long",name:"timetag"}]},nimAddStickTopSession:{sid:23,cid:12,service:"session",params:[{type:"Property",name:"tag",reflectMapper:yf.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:vf.stickTopSessionTag}]},nimDeleteStickTopSession:{sid:23,cid:13,service:"session",params:[{type:"Property",name:"tag",reflectMapper:yf.stickTopSessionTag}],response:[{type:"Number",name:"timetag"}]},nimUpdateStickTopSession:{sid:23,cid:14,service:"session",params:[{type:"Property",name:"tag",reflectMapper:yf.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:vf.stickTopSessionTag}]},nimMultiSyncAddStickTopSession:{sid:23,cid:112,service:"session",response:[{type:"Property",name:"data",reflectMapper:vf.stickTopSessionTag}]},nimMultiSyncDeleteStickTopSession:{sid:23,cid:113,service:"session",response:[{type:"Number",name:"timetag"},{type:"Property",name:"data",reflectMapper:vf.stickTopSessionTag}]},nimMultiSyncUpdateStickTopSession:{sid:23,cid:114,service:"session",response:[{type:"Property",name:"data",reflectMapper:vf.stickTopSessionTag}]},nimSyncStickTopSessions:{sid:4,cid:23,service:"session",response:[{type:"Number",name:"timetag"},{type:"Boolean",name:"isThereAnyChange"},{type:"PropertyArray",name:"datas",reflectMapper:vf.stickTopSessionTag}]},markMultSuperTeamSessionsAck:{sid:21,cid:32,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:yf.sessionAckTag}]},nimSyncSessionsWithMoreRoaming:{sid:21,cid:22,service:"session",response:[{type:"PropertyArray",name:"datas",reflectMapper:{0:"scene",1:"to",2:"from",7:"time",12:"idServer"}}]},syncSessionReliableInfo:{sid:4,cid:25,service:"session",response:[{type:"Property",name:"context",reflectMapper:{1:"timetag",2:"type"}},{type:"PropertyArray",name:"datas",reflectMapper:vf.sessionReliableSyncTag}]}},Sf={id:{type:"string"},ext:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function formatStickTop(t,a,o){void 0===o&&(o=!0);var c=format(Sf,t);return c.isStickOnTop=o,c.id=a.id,fi(fi({},a),{stickTopInfo:a.stickTopInfo?fi({},a.stickTopInfo,c):c})}var Mf={scene:{type:"enum",values:gd},time:{type:"number"}};var Cf=/*#__PURE__*/function(){function StickTopService(t){this.core=t}var t=StickTopService.prototype;return t.getSession=function getSession(t){return this.core.session.getSessionWithUncomplete({id:t})||this.core.session.createSession(t)},t.addStickTopSession=function addStickTopSession(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var a,o,c,m,h,v;return ci.wrap((function _callee$(b){for(;;)switch(b.prev=b.next){case 0:return validate({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a=getAccountFromSessionId(t.id),o=a.scene,c=a.accid,b.next=4,this.core.sendCmd("nimAddStickTopSession",{tag:{id:("superTeam"===o?"super_team":o)+"|"+c,ext:t.ext}});case 4:return m=b.sent,h=this.getSession(t.id),v=formatStickTop(m.content.data,h),b.abrupt("return",v);case 8:case"end":return b.stop()}}),_callee,this)})))},t.deleteStickTopSession=function deleteStickTopSession(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var a,o,c,m,h,v;return ci.wrap((function _callee2$(b){for(;;)switch(b.prev=b.next){case 0:return validate({id:{type:"string",allowEmpty:!1}},t),a=getAccountFromSessionId(t.id),o=a.scene,c=a.accid,b.next=4,this.core.sendCmd("nimDeleteStickTopSession",{tag:{id:("superTeam"===o?"super_team":o)+"|"+c}});case 4:return m=b.sent,h=this.getSession(t.id),v=formatStickTop({updateTime:m.content.timetag},h,!1),b.abrupt("return",v);case 8:case"end":return b.stop()}}),_callee2,this)})))},t.updateStickTopSession=function updateStickTopSession(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var a,o,c,m,h,v;return ci.wrap((function _callee3$(b){for(;;)switch(b.prev=b.next){case 0:return validate({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a=getAccountFromSessionId(t.id),o=a.scene,c=a.accid,b.next=4,this.core.sendCmd("nimUpdateStickTopSession",{tag:{id:("superTeam"===o?"super_team":o)+"|"+c,ext:t.ext}});case 4:return m=b.sent,h=this.getSession(t.id),v=formatStickTop(m.content.data,h),b.abrupt("return",v);case 8:case"end":return b.stop()}}),_callee3,this)})))},t.stickTopSessionHandler=function stickTopSessionHandler(t,a){void 0===a&&(a=!0);var o=getAccountFromSessionId(t.id,"|"),c=o.scene+"-"+o.accid;return formatStickTop(t,this.getSession(c),a)},StickTopService}(),Tf=/*#__PURE__*/function(){function UnreadModuleService(t){this.core=t,this.logger=t.logger}var t=UnreadModuleService.prototype;return t.canSessionResetUnreadCount=function canSessionResetUnreadCount(t){var a=t.id;if(void 0===t.lastMsg)throw new Error("Session::canSessionResetUnreadCount: session "+a+" is not completly, lastMsg undefined");return null!==t.lastMsg||t.unread>0?!(t.ack&&t.lastMsg&&t.ack>=t.lastMsg.time)||(this.logger.log("Session::canSessionResetUnreadCount: session "+a+" reset failed, ack time is greater than last message time"),!1):(this.logger.log("Session::canSessionResetUnreadCount: session "+a+" doesn't need to be updated, lastMsg null and unread 0"),!1)},t.filterSessionForResetUnreadCount=function filterSessionForResetUnreadCount(t){var a=this,o={cmd:"markMultSuperTeamSessionsAck",params:[]},c={cmd:"markMultSessionsAck",params:[]};return forEach$1(t).call(t,(function(t){var m;try{if(!a.canSessionResetUnreadCount(t))return;var h=getAccountFromSessionId(t.id),v=h.accid,b=h.scene,S={to:v,sessionId:t.id,timetag:(null===(m=null==t?void 0:t.lastMsg)||void 0===m?void 0:m.time)||t.updateTime||0},M=function generateSceneForCmd(t){return formatReverse({scene:{type:"enum",values:gd}},t)}({scene:b});"superTeam"===b?o.params.push(S):c.params.push(fi(fi({},S),M))}catch(t){a.logger.warn(t)}})),{superTeam:o,p2pOrTeam:c}},UnreadModuleService}();var _f=function baseSlice(t,a,o){var c=-1,m=t.length;a<0&&(a=-a>m?0:m+a),(o=o>m?m:o)<0&&(o+=m),m=a>o?0:o-a>>>0,a>>>=0;for(var h=Array(m);++c<m;)h[c]=t[c+a];return h};var wf=function isIterateeCall(t,a,o){if(!ws(o))return!1;var c=typeof a;return!!("number"==c?zl(o)&&$d(a,o.length):"string"==c&&a in o)&&ll(o[a],t)},If=Math.ceil,kf=Math.max;var xf=function chunk(t,a,o){a=(o?wf(t,a,o):void 0===a)?1:kf(mf(a),0);var c=null==t?0:t.length;if(!c||a<1)return[];for(var m=0,h=0,v=Array(If(c/a));m<c;)v[h++]=_f(t,m,m+=a);return v};function _createForOfIteratorHelperLoose$1(t,a){var o,c=void 0!==Ln&&Lu(t)||t["@@iterator"];if(c)return bind$1(o=(c=c.call(t)).next).call(o,c);if(xc(t)||(c=function _unsupportedIterableToArray$1(t,a){var o;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$1(t,a);var c=slice(o=Object.prototype.toString.call(t)).call(o,8,-1);"Object"===c&&t.constructor&&(c=t.constructor.name);if("Map"===c||"Set"===c)return Fu(t);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray$1(t,a)}(t))||a&&t&&"number"==typeof t.length){c&&(t=c);var m=0;return function(){return m>=t.length?{done:!0}:{done:!1,value:t[m++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$1(t,a){(null==a||a>t.length)&&(a=t.length);for(var o=0,c=new Array(a);o<a;o++)c[o]=t[o];return c}var Rf,Ef,Af=/*#__PURE__*/function(t){function SessionService(a,o){var c;return(c=t.call(this,"session",a)||this).list=new Ji,c.unreadCountFilterFn=function(t){return!0},c.lastMessageFilterFn=function(t){return!0},c.initEventListeners(),registerParser({cmdMap:gf,cmdConfig:bf}),"function"==typeof(null==o?void 0:o.unreadCountFilterFn)&&(c.unreadCountFilterFn=o.unreadCountFilterFn),"function"==typeof(null==o?void 0:o.lastMessageFilterFn)&&(c.lastMessageFilterFn=o.lastMessageFilterFn),c.stickTopService=new Cf(a),c.unreadModule=new Tf(a),c}Mt(SessionService,t);var a=SessionService.prototype;return a.initEventListeners=function initEventListeners(){var t,a,o,c=this;this.core.eventBus.on("session/syncMsgs",bind$1(t=this.onSyncMsgs).call(t,this)),this.core.eventBus.on("session/updateForNewMsg",bind$1(a=this.updateSessionWithMsg).call(a,this)),this.core.eventBus.on("session/updateForClearMsg",(function(t,a){void 0===a&&(a=!0),t&&t.length>0&&forEach$1(t).call(t,(function(t){c.updateSession({id:t.sessionId,lastMsg:null,unread:0,unreadMsgs:[]},a)}))})),this.core.eventBus.on("session/updateForDeletedMsg",bind$1(o=this.updateSessionForDeletedMsg).call(o,this))},a.createSession=function createSession(t,a){try{var o=getAccountFromSessionId(t);return{id:t,scene:o.scene,to:o.accid,lastMsg:a,updateTime:a?a.time:0,unread:0,unreadMsgs:[],ack:0}}catch(a){throw this.logger.error("Failed to create session with "+t,a),new Error("Failed to create session with "+t)}},a.getSession=function getSession(t){validate({id:{type:"string",allowEmpty:!1}},t);var a=this.list.get(t.id);if(this.isSessionComplete(a))return a},a.getSessionWithUncomplete=function getSessionWithUncomplete(t){return this.list.get(t.id)},a.getSessions=function getSessions(t){validate({limit:{type:"number",required:!1},lastSessionId:{type:"string",allowEmpty:!1,required:!1},desc:{type:"boolean",required:!1}},t);var a=[],o=t.limit,c=void 0===o?100:o,m=t.desc,h=void 0===m||m,v=t.lastSessionId,b=0;if(h){for(var S,M,C=_createForOfIteratorHelperLoose$1(this.list);!(M=C()).done;){var T=M.value,w=T[0],I=T[1];if(v===w)break;this.isSessionComplete(I)&&a.push(I)}return reverse$1(S=slice(a).call(a,-c)).call(S)}for(var k,x=_createForOfIteratorHelperLoose$1(this.list);!(k=x()).done;){var R=k.value,E=R[0],A=R[1];if(v)E===v&&(v=void 0);else if(this.isSessionComplete(A)){if(++b>c)break;a.push(A)}}return a},a.resetSessionUnreadCount=function resetSessionUnreadCount(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var o,c,m,h,v,b,S,M,C=this;return ci.wrap((function _callee$(T){for(;;)switch(T.prev=T.next){case 0:if(validate({id:{type:"string",allowEmpty:!1}},t),validate({id:{type:"string",allowEmpty:!1}},t),o=t.id,c=this.list.get(o)){T.next=7;break}throw this.logger.warn("resetSessionUnreadCount: can not find session "+o),new Error("Session::canSessionResetUnreadCount: can not find session "+o);case 7:m=!1;try{m=this.unreadModule.canSessionResetUnreadCount(c)}catch(t){this.logger.warn(t)}if(!1!==m){T.next=11;break}return T.abrupt("return");case 11:return h=getAccountFromSessionId(o),v=h.accid,b=h.scene,S={to:v,timetag:(null===(a=null==c?void 0:c.lastMsg)||void 0===a?void 0:a.time)||c.updateTime||0},M="markSuperTeamSessionAck","superTeam"!==b&&(S.scene="p2p"===b?0:1,M="markSessionAck"),T.abrupt("return",this.core.sendCmd(M,S).then((function(){var t=C.storeUnreadByAck(o,S.timetag);t&&C.core.emit("updateSession",t)})));case 16:case"end":return T.stop()}}),_callee,this)})))},a.resetMultiSessionUnreadCount=function resetMultiSessionUnreadCount(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var a,o,c,m,h,v,b,S,M,C,T,w,I,k,x=this;return ci.wrap((function _callee2$(R){for(;;)switch(R.prev=R.next){case 0:validate({ids:{type:"array",itemType:"string",min:1}},t),c=filter(a=map(o=t.ids).call(o,(function(t){return x.list.get(t)}))).call(a,(function(a,o){return!!a||(x.logger.warn("Session::canSessionResetUnreadCount: can not find session "+t.ids[o]),!1)})),m=this.unreadModule.filterSessionForResetUnreadCount(c),h=m.superTeam,v=m.p2pOrTeam,b=xf(h.params,10),S=xf(v.params,10),M=_createForOfIteratorHelperLoose$1(b);case 6:if((C=M()).done){R.next=13;break}return T=C.value,R.next=10,this.core.sendCmd(h.cmd,{datas:T});case 10:forEach$1(T).call(T,(function(t){var a=x.storeUnreadByAck(t.sessionId,t.timetag);a&&x.core.emit("updateSession",a)}));case 11:R.next=6;break;case 13:w=_createForOfIteratorHelperLoose$1(S);case 14:if((I=w()).done){R.next=21;break}return k=I.value,R.next=18,this.core.sendCmd(v.cmd,{datas:k});case 18:forEach$1(k).call(k,(function(t){var a=x.storeUnreadByAck(t.sessionId,t.timetag);a&&x.core.emit("updateSession",a)}));case 19:R.next=14;break;case 21:case"end":return R.stop()}}),_callee2,this)})))},a.resetAllSessionsUnreadCount=function resetAllSessionsUnreadCount(){var t,a=[];return forEach$1(t=this.list).call(t,(function(t){a.push(t.id)})),this.resetMultiSessionUnreadCount({ids:a})},a.deleteSession=function deleteSession(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){return ci.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:if(validate({id:{type:"string",allowEmpty:!1},isSyncToServer:{type:"boolean",required:!1}},t),this.list.delete(t.id),!this.core.msgLog||!t.isSyncToServer){a.next=5;break}return a.next=5,this.core.msgLog.deleteRoamingMsgs({ids:[t.id]});case 5:case"end":return a.stop()}}),_callee3,this)})))},a.deleteAllSessionsFromLocal=function deleteAllSessionsFromLocal(){this.list.clear()},a.addStickTopSession=function addStickTopSession(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){var a;return ci.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.stickTopService.addStickTopSession(t);case 2:return a=o.sent,this.list.set(a.id,a),o.abrupt("return",a);case 5:case"end":return o.stop()}}),_callee4,this)})))},a.deleteStickTopSession=function deleteStickTopSession(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){var a;return ci.wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.stickTopService.deleteStickTopSession(t);case 2:return a=o.sent,this.list.set(a.id,a),o.abrupt("return",a);case 5:case"end":return o.stop()}}),_callee5,this)})))},a.updateStickTopSession=function updateStickTopSession(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){var a;return ci.wrap((function _callee6$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.stickTopService.updateStickTopSession(t);case 2:return a=o.sent,this.list.set(a.id,a),o.abrupt("return",a);case 5:case"end":return o.stop()}}),_callee6,this)})))},a.nimMultiSyncAddStickTopSessionHandler=function nimMultiSyncAddStickTopSessionHandler(t){var a=this.stickTopService.stickTopSessionHandler(t.content.data);this.list.set(a.id,a),this.core.emit("updateSession",a)},a.nimMultiSyncDeleteStickTopSessionHandler=function nimMultiSyncDeleteStickTopSessionHandler(t){var a=this.stickTopService.stickTopSessionHandler({id:t.content.data.id,updateTime:t.content.timetag},!1);this.list.set(a.id,a),this.core.emit("updateSession",a)},a.nimMultiSyncUpdateStickTopSessionHandler=function nimMultiSyncUpdateStickTopSessionHandler(t){var a=this.stickTopService.stickTopSessionHandler(t.content.data);this.list.set(a.id,a),this.core.emit("updateSession",a)},a.nimSyncStickTopSessionsHandler=function nimSyncStickTopSessionsHandler(t){var a=this,o=t.content.datas;forEach$1(o).call(o,(function(t){var o=a.stickTopService.stickTopSessionHandler(t);a.list.set(o.id,o)}))},a.updateSessionWithMsg=function updateSessionWithMsg(t){var a=!0,o=!0;try{a=!!this.unreadCountFilterFn(t)}catch(t){this.logger.error("session:updateSessionWithMsg, unreadCountFilterFn error",t)}try{o=!!this.lastMessageFilterFn(t)}catch(t){this.logger.error("session:updateSessionWithMsg, lastMessageFilterFn error",t)}var c=this.list.get(t.sessionId)||this.createSession(t.sessionId),m=!1;if(this.logger.log("session:updateSessionWithMsg, pending ",t.sessionId,t.idClient,t.idServer,o,a),o&&(!c.lastMsg||c.lastMsg.time<t.time||t.status===vd[vd.sending]||c.lastMsg.status===vd[vd.sending])&&(c.lastMsg=t,c.updateTime=t.time,m=!0),a&&t.status===vd[vd.unread]&&t.time>(c.ack||0)){c.unread++;var h=c.unreadMsgs||[];h.unshift(t),sort(h).call(h,(function(t,a){return a.time-t.time})),m=!0}m&&(this.logger.log("session:updateSessionWithMsg updating ",c.id,c.unread,c.lastMsg&&c.lastMsg.idClient),this.list.set(c.id,c),this.core.emit("updateSession",c))},a.storeUnreadByAck=function storeUnreadByAck(t,a){var o=this.list.get(t)||this.createSession(t);if(!(o.ack&&a<o.ack)){var c=o.unreadMsgs||[],m=[],h=0;return o.unreadMsgs=[],c.length>0&&(forEach$1(c).call(c,(function(t){t.time>a&&(h++,m.push(t))})),o.unreadMsgs=sort(m).call(m,(function(t,a){return a.time-t.time}))),o.ack=a,o.unread=h,o.lastMsg&&"unread"===o.lastMsg.status&&a>=o.lastMsg.time&&(o.lastMsg.status="read"),this.list.set(t,o),o}this.logger.warn("storeUnreadByAck: not need update ack",t,a,o.ack)},a.updateSession=function updateSession(t,a){void 0===a&&(a=!0);var o=t.id,c=this.list.get(o)||this.createSession(t.id),m=fi(c,t);return this.list.set(o,m),this.logger.log("updateSession: update",a,Rm(t,["id","ack","unread"]),m.lastMsg&&m.lastMsg.idClient),a&&this.core.emit("updateSession",m),m},a.isSessionComplete=function isSessionComplete(t){return!!t&&(!!(t.id&&t.scene&&t.to)&&void 0!==t.lastMsg)},a.syncSessionAckHandler=function syncSessionAckHandler(t){var a,o,c=this,m=t.content.p2p||{},h=t.content.team.m_map||{};this.logger.log("syncSessionAck::",m,h),forEach$1(a=ui(m)).call(a,(function(t){c.updateSession({id:"p2p-"+t,ack:m[t]},!1)})),forEach$1(o=ui(h)).call(o,(function(t){c.updateSession({id:"team-"+t,ack:h[t]},!1)}))},a.syncSuperTeamSessionAckHandler=function syncSuperTeamSessionAckHandler(t){var a,o=this,c=t.content.superTeam.m_map;this.logger.log("syncSuperTeamSessionAck::",c),forEach$1(a=ui(c)).call(a,(function(t){o.updateSession({id:"superTeam-"+t,ack:c[t]},!1)}))},a.syncMarkSessionAckHandler=function syncMarkSessionAckHandler(t){var a=t.content,o=(0===a.scene?"p2p":1===a.scene?"team":"superTeam")+"-"+a.to,c=this.list.get(o);if(c&&c.ack&&a.timetag<c.ack)this.logger.warn("syncMarkSessionAckHandler: "+o+" do not need update ack",c.ack,a.timetag);else{var m=this.storeUnreadByAck(o,a.timetag);m&&this.core.emit("updateSession",m)}},a.syncMarkSuperTeamSessionAckHandler=function syncMarkSuperTeamSessionAckHandler(t){t.content.scene=5,this.syncMarkSessionAckHandler(t)},a.onSyncDone=function onSyncDone(){var t,a,o,c=this,m=[];forEach$1(t=this.list).call(t,(function(t,a){m.push(c.storeUnreadByAck(a,t.ack||0))})),this.list.clear(),forEach$1(a=sort(m).call(m,(function(t,a){return t.updateTime-a.updateTime}))).call(a,(function(t){c.list.set(t.id,t)})),(m=sort(o=filter(m).call(m,(function(t){return c.isSessionComplete(t)}))).call(o,(function(t,a){return a.updateTime-t.updateTime}))).length>0&&this.core.emit("sessions",m)},a.onSyncMsgs=function onSyncMsgs(t){var a,o=this,c=this.list.get(t.sessionId),m=[];try{var h;m=filter(h=t.msgs).call(h,(function(t){return o.unreadCountFilterFn(JSON.parse(gi(t)))}))}catch(t){this.logger.error("session:onSyncMsgs, unreadCountFilterFn error ",t)}var v,b=[];try{var S;b=filter(S=t.msgs).call(S,(function(t){return o.lastMessageFilterFn(JSON.parse(gi(t)))}))}catch(t){this.logger.error("session:onSyncMsgs, lastMessageFilterFn error ",t)}b&&b.length>0&&(v=b[b.length-1],v=b[0].time>v.time?b[0]:v);var M=v?v.time:0;c||(c=v?this.createSession(t.sessionId,v):this.createSession(t.sessionId)),c.unreadMsgs=c.unreadMsgs?filter(a=concat(m).call(m,c.unreadMsgs)).call(a,(function(t){return t.status===vd[vd.unread]})):filter(m).call(m,(function(t){return t.status===vd[vd.unread]})),c.updateTime&&c.updateTime>=M||(c.updateTime=M),c.lastMsg&&c.lastMsg.time>=M||(c.lastMsg=v),this.list.set(c.id,c)},a.updateSessionForDeletedMsg=function updateSessionForDeletedMsg(t){var a,o=this,c={};forEach$1(t).call(t,(function(t){var a=t.to===o.core.account?t.from:t.to,m=t.scene+"-"+a,h=o.list.get(m);if(h){if((h.ack||0)<t.time&&t.from!==o.core.account&&h.unread>0&&(h.unread=h.unread-1,h.unreadMsgs&&h.unreadMsgs.length>0)){var v,b=ff(h.unreadMsgs,{idClient:t.idClient});b>=0&&splice(v=h.unreadMsgs).call(v,b,1)}h.lastMsg&&h.lastMsg.idClient===t.idClient&&(h.lastMsg=null),c[h.id]=!0}})),forEach$1(a=ui(c)).call(a,(function(t){var a=o.list.get(t);a&&o.core.emit("updateSession",a)}))},a.multiSyncMsgReceiptHandler=function multiSyncMsgReceiptHandler(t){var a,o=null===(a=t.content)||void 0===a?void 0:a.msgReceiptTag;o&&this.updateSessionMsgReceiptTime([o],!0)},a.syncMsgReceiptsHandler=function syncMsgReceiptsHandler(t){var a,o=null===(a=t.content)||void 0===a?void 0:a.msgReceipts;o&&this.updateSessionMsgReceiptTime(o,!1)},a.updateSessionMsgReceiptTime=function updateSessionMsgReceiptTime(t,a){var o=this;void 0===a&&(a=!0),t&&t.length>0&&forEach$1(t).call(t,(function(t){var c=o.list.get("p2p-"+t.from);c||(c=o.createSession("p2p-"+t.from));var m=_u(t.time);c.msgReceiptTime&&c.msgReceiptTime>=m||(c.msgReceiptTime=m,c.lastMsg&&"sent"===c.lastMsg.status&&m>=c.lastMsg.time&&(c.lastMsg.status="receipt"),o.logger.log("session: update session "+c.id+" msgReceiptTime: "+c.msgReceiptTime),o.list.set(c.id,c),a&&o.core.emit("updateSession",c))}))},a.nimSyncSessionsWithMoreRoamingHandler=function nimSyncSessionsWithMoreRoamingHandler(t){var a=function formatMoreRoamingSession(t,a){return map(t).call(t,(function(t){var o=format(Mf,t);return o.sessionId=getSessionId(t,a),o}))}(t.content.datas,this.core.account);this.logger.log("session:syncSessionsWithMoreRoaming",a)},SessionService}(Sd),qf=/*#__PURE__*/function(){function ModuleService(t){this.core=t}var t=ModuleService.prototype;return t.notifyAddTeamMembers=function notifyAddTeamMembers(t,a){this.core.emit("addTeamMembers",{team:t,accounts:a,members:generatorMembersByTeam(t,a)})},t.notifyUpdateTeamManagers=function notifyUpdateTeamManagers(t,a,o,c){this.core.emit("updateTeamManagers",{team:{teamId:t,memberUpdateTime:c},accounts:a,isManager:o,members:map(a).call(a,(function(a){return{id:t+"-"+a,account:a,type:"manager",updateTime:c}}))})},t.notifyRemoveTeamMembers=function notifyRemoveTeamMembers(t,a){this.core.emit("removeTeamMembers",{team:t,accounts:a})},t.notifyTransferTeam=function notifyTransferTeam(t,a,o){this.core.emit("transferTeam",{team:t,from:{id:t.teamId+"-"+a,type:"normal",account:a,updateTime:t.memberUpdateTime},to:{id:t.teamId+"-"+o,type:"owner",account:o,updateTime:t.memberUpdateTime}})},t.notifyUpdateTeamMembersMute=function notifyUpdateTeamMembersMute(t,a,o){this.core.emit("updateTeamMembersMute",{team:t,accounts:a,members:map(a).call(a,(function(a){return{id:t.teamId+"-"+a,account:a,teamId:t.teamId,mute:o,updateTime:t.memberUpdateTime}})),mute:o})},ModuleService}(),Pf=/*#__PURE__*/function(t){function TeamService(a){var o;return(o=t.call(this,"team",a)||this).service=new qf(a),o.core.eventBus.on("team/onNotification",(function(t){return o.notificationHandler(t)})),registerParser({cmdMap:Jp,cmdConfig:Zp}),o}Mt(TeamService,t);var a=TeamService.prototype;return a.getTeamInfo=function getTeamInfo(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var a,o;return ci.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),c.next=3,this.core.sendCmd("getTeamInfo",{teamId:t.teamId});case 3:return a=c.sent,o=a.content.team,c.abrupt("return",formatTeam(o));case 6:case"end":return c.stop()}}),_callee,this)})))},a.getTeams=function getTeams(){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var t,a;return ci.wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.sendCmd("getTeams",{timetag:0});case 2:return t=o.sent,a=t.content.teams,o.abrupt("return",formatTeams(a));case 5:case"end":return o.stop()}}),_callee2,this)})))},a.getTeamsById=function getTeamsById(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var a,o;return ci.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamIds:{type:"array",itemType:"string"}},t),c.next=3,this.core.sendCmd("getTeamsById",{teamIds:t.teamIds});case 3:return a=c.sent,o=formatTeams(a.content.teams),c.abrupt("return",{teams:o,tids:a.content.tids});case 6:case"end":return c.stop()}}),_callee3,this)})))},a.createTeam=function createTeam(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){var a,o,c;return ci.wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:return validate({type:{type:"enum",values:["advanced","normal"]},name:{type:"string",allowEmpty:!1},level:{type:"number",required:!1},accounts:{type:"array",itemType:"string",required:!1},ps:{type:"string",allowEmpty:!1,max:5e3,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!1,required:!1},announcement:{type:"string",allowEmpty:!1,required:!1},avatar:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",allowEmpty:!1,required:!1}},t),a=generateTeam(t),m.next=4,this.core.sendCmd("createTeam",{team:a,accounts:t.accounts||[],ps:t.ps||""});case 4:return o=m.sent,c=formatTeam(o.content.team),m.abrupt("return",c);case 7:case"end":return m.stop()}}),_callee4,this)})))},a.dismissTeam=function dismissTeam(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){return ci.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),a.next=3,this.core.sendCmd("dismissTeam",{teamId:t.teamId});case 3:case"end":return a.stop()}}),_callee5,this)})))},a.leaveTeam=function leaveTeam(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){return ci.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),a.next=3,this.core.sendCmd("leaveTeam",{teamId:t.teamId});case 3:case"end":return a.stop()}}),_callee6,this)})))},a.transferTeam=function transferTeam(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee7(){return ci.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},t),a.next=3,this.core.sendCmd("transferTeam",t);case 3:case"end":return a.stop()}}),_callee7,this)})))},a.updateTeamInfo=function updateTeamInfo(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee8(){var a;return ci.wrap((function _callee8$(o){for(;;)switch(o.prev=o.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!1,required:!1},announcement:{type:"string",allowEmpty:!1,required:!1},avatar:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",allowEmpty:!1,required:!1}},t),a=generateTeam(t),o.next=4,this.core.sendCmd("updateTeamInfo",{team:a});case 4:return o.abrupt("return",formatTeam(a));case 5:case"end":return o.stop()}}),_callee8,this)})))},a.getTeamMembers=function getTeamMembers(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee9(){var o,c;return ci.wrap((function _callee9$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",required:!1}},t),m.next=3,this.core.sendCmd("getTeamMembers",{teamId:t.teamId,timetag:0});case 3:if(o=m.sent,c=formatTeamMembers(null===(a=o.content)||void 0===a?void 0:a.teamMembers),t.accounts&&t.accounts.length>0){m.next=7;break}return m.abrupt("return",c);case 7:return m.abrupt("return",filter(c).call(c,(function(a){var o;return null===(o=t.accounts)||void 0===o?void 0:includes(o).call(o,a.account)})));case 8:case"end":return m.stop()}}),_callee9,this)})))},a.getMutedTeamMembers=function getMutedTeamMembers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee10(){var a,o;return ci.wrap((function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),c.next=3,this.core.sendCmd("getMutedTeamMembers",{teamId:t.teamId});case 3:return a=c.sent,o=a.content,c.abrupt("return",formatTeamMembers(o.teamMembers));case 6:case"end":return c.stop()}}),_callee10,this)})))},a.addTeamMembers=function addTeamMembers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee11(){return ci.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},t),a.next=3,this.core.sendCmd("addTeamMembers",{teamId:t.teamId,accounts:t.accounts,ps:t.ps||"",attach:t.ext||""});case 3:case"end":return a.stop()}}),_callee11,this)})))},a.removeTeamMembers=function removeTeamMembers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee12(){return ci.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("removeTeamMembers",{teamId:t.teamId,accounts:t.accounts});case 3:case"end":return a.stop()}}),_callee12,this)})))},a.applyTeam=function applyTeam(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee13(){var a;return ci.wrap((function _callee13$(o){for(;;)switch(o.prev=o.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},t),o.next=3,this.core.sendCmd("applyTeam",{teamId:t.teamId,ps:t.ps||""});case 3:return a=o.sent,o.abrupt("return",formatTeam(a.content.team));case 5:case"end":return o.stop()}}),_callee13,this)})))},a.addTeamManagers=function addTeamManagers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee14(){return ci.wrap((function _callee14$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},t),a.next=3,this.core.sendCmd("addTeamManagers",t);case 3:case"end":return a.stop()}}),_callee14,this)})))},a.removeTeamManagers=function removeTeamManagers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee15(){return ci.wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},t),a.next=3,this.core.sendCmd("removeTeamManagers",t);case 3:case"end":return a.stop()}}),_callee15,this)})))},a.updateMyMemberInfo=function updateMyMemberInfo(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee16(){var a,o;return ci.wrap((function _callee16$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!1,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},t),a=generatorTeamMemberForCmd({teamId:t.teamId,nickInTeam:t.nickInTeam,bitConfigMask:t.bitConfigMask,ext:t.ext}),c.next=4,this.core.sendCmd("updateMyMemberInfo",{teamMember:a});case 4:return o=formatTeamMember(fi({updateTime:(new Date).getTime(),account:this.core.account},a)),this.core.emit("updateTeamMember",o),c.abrupt("return",o);case 7:case"end":return c.stop()}}),_callee16,this)})))},a.updateMemberNick=function updateMemberNick(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee17(){var a,o;return ci.wrap((function _callee17$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!1}},t),a=generatorTeamMemberForCmd({teamId:t.teamId,nickInTeam:t.nickInTeam,account:t.account}),c.next=4,this.core.sendCmd("updateNickInTeam",{teamMember:a});case 4:return o=formatTeamMember(fi({updateTime:(new Date).getTime()},a)),c.abrupt("return",o);case 6:case"end":return c.stop()}}),_callee17,this)})))},a.muteTeamMember=function muteTeamMember(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee18(){return ci.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},mute:{type:"boolean"}},t),a.next=3,this.core.sendCmd("muteTeamMember",{teamId:t.teamId,account:t.account,mute:t.mute?1:0});case 3:case"end":return a.stop()}}),_callee18,this)})))},a.getTeamMemberInvitorAccid=function getTeamMemberInvitorAccid(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee19(){var o,c;return ci.wrap((function _callee19$(m){for(;;)switch(m.prev=m.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:200}},t),o={teamId:t.teamId},t.accounts&&t.accounts.length>0&&(o.accounts=t.accounts),m.next=5,this.core.sendCmd("getTeamMemberInvitorAccid",o);case 5:return c=m.sent,m.abrupt("return",(null===(a=c.content)||void 0===a?void 0:a.accountsMap)||{});case 7:case"end":return m.stop()}}),_callee19,this)})))},a.muteTeam=function muteTeam(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee20(){return ci.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},t),a.next=3,this.core.sendCmd("muteTeam",{teamId:t.teamId,mute:t.mute?1:0});case 3:case"end":return a.stop()}}),_callee20,this)})))},a.passTeamApply=function passTeamApply(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee21(){return ci.wrap((function _callee21$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("passTeamApply",t);case 3:case"end":return a.stop()}}),_callee21,this)})))},a.rejectTeamApply=function rejectTeamApply(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee22(){return ci.wrap((function _callee22$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},t),a.next=3,this.core.sendCmd("rejectTeamApply",{teamId:t.teamId,from:t.from,ps:t.ps||""});case 3:case"end":return a.stop()}}),_callee22,this)})))},a.acceptTeamInvite=function acceptTeamInvite(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee23(){return ci.wrap((function _callee23$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("acceptTeamInvite",t);case 3:case"end":return a.stop()}}),_callee23,this)})))},a.rejectTeamInvite=function rejectTeamInvite(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee24(){return ci.wrap((function _callee24$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},t),a.next=3,this.core.sendCmd("rejectTeamInvite",{teamId:t.teamId,from:t.from,ps:t.ps||""});case 3:case"end":return a.stop()}}),_callee24,this)})))},a.notifyTeamMsgReceiptsHandler=function notifyTeamMsgReceiptsHandler(t){var a,o=null===(a=t.content)||void 0===a?void 0:a.teamMsgReceipts;o&&o.length>0&&this.core.emit("teamMsgReceipts",o)},a.syncTeamsHandler=function syncTeamsHandler(t){var a=t.content;this.core.eventBus.emit("sync/updateTimetag",{teams:_u(a.timetag)});var o=null==a?void 0:a.teams;if(o&&o.length){var c=formatTeams(o);this.core.emit("teams",c)}},a.syncCreateTeamHandler=function syncCreateTeamHandler(t){var a=t.content,o=formatTeam(null==a?void 0:a.team),c=generatorMemberByTeam(o,o.owner,"owner");this.core.emit("createTeam",o,c)},a.syncUpdateTeamMemberHandler=function syncUpdateTeamMemberHandler(t){var a=t.content,o=formatTeamMember(null==a?void 0:a.teamMember);o.updateTime||(o.updateTime=(new Date).getTime()),this.core.emit("updateTeamMember",o)},a.notificationHandler=function notificationHandler(t){var a=t.attach,o=t.scene,c=t.from,m=t.to,h=t.time,v=t.idServer,b=t.idClient,S=a.team,M=a.account,C=a.accounts,T=a.type;if("team"===o)switch("debug"===this.core.options.debugLevel?this.logger.debug("team::recvNotification",v,b,a):this.logger.log("team::recvNotification",v,b,m,T,M,C),T){case"updateTeam":S.updateTime=h,this.core.emit("updateTeam",S);break;case"addTeamMembers":this.service.notifyAddTeamMembers(S,C);break;case"acceptTeamInvite":this.service.notifyAddTeamMembers(S,[c]);break;case"passTeamApply":this.service.notifyAddTeamMembers(S,[M]);break;case"addTeamManagers":this.service.notifyUpdateTeamManagers(m,C,!0,h);break;case"removeTeamManagers":this.service.notifyUpdateTeamManagers(m,C,!1,h);break;case"removeTeamMembers":this.service.notifyRemoveTeamMembers(S,C);break;case"leaveTeam":this.service.notifyRemoveTeamMembers(S,[c]);break;case"dismissTeam":this.core.emit("dismissTeam",{teamId:m});break;case"transferTeam":this.service.notifyTransferTeam(S,c,M);break;case"updateTeamMemberMute":this.service.notifyUpdateTeamMembersMute(S,[M],a.mute)}},TeamService}(Sd);!function(t){t[t.none=0]="none",t[t.pass=1]="pass",t[t.decline=2]="decline",t[t.read=3]="read",t[t.deleted=4]="deleted",t[t.invalid=5]="invalid"}(Rf||(Rf={})),function(t){t[t.default=0]="default",t[t.leave=1]="leave",t[t.roam=2]="roam"}(Ef||(Ef={}));var Of={applyTeam:0,rejectTeamApply:1,teamInvite:2,rejectTeamInvite:3,friendRequest:5,deleteFriend:6,recallMsgP2p:7,recallMsgTeam:8,recallMsgSuperTeam:12,deleteMsgP2pOneWay:13,deleteMsgTeamOneWay:14,applySuperTeam:15,rejectSuperTeamApply:16,superTeamInvite:17,rejectSuperTeamInvite:18,customP2p:100,customTeam:101,customSuperTeam:103},Uf={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"};var Bf={setting:{needSaveOffline:{type:"boolean"},isRoutable:{type:"boolean"},envConfig:{type:"string"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"boolean"}},pushInfo:{needPush:{type:"boolean"},needPushBadge:{type:"boolean"},needPushNick:{type:"boolean"},pushApnsText:{type:"string"},pushPayload:{type:"string"},needForcePush:{type:"boolean"},forcePushIDsList:{type:"string"},pushContent:{type:"string",rawKey:"forcePushContent"}},recallMessageInfo:{idClient:{type:"string",rawKey:"deletedIdClient"},idServer:{type:"string",rawKey:"deletedIdServer"},createTime:{type:"number",rawKey:"deletedMsgTime"},fromNick:{type:"string",rawKey:"deletedMsgFromNick"},opeAccount:{type:"string"}}};function formatSystemMessage(t,a,o){var c=+t.type,m=getEnumKeyByEnumValue(Of,c);o=o||Ef.default;var h=fi(fi({},format(Bf,t)),{type:m,time:+t.time,to:t.to,from:t.from,idServer:t.idServer,state:Rf[Rf.none],feature:Ef[o]});if("string"==typeof h.attach)try{h.attach=JSON.parse(h.attach)}catch(t){a.error("formatSystemMessage: "+h.idServer+" parse attach error",t&&t.message)}return 5===c&&h.attach?(h.attach.type=Uf[+h.attach.vt],"passFriendApply"===h.attach.type?h.state=Rf[Rf.pass]:"rejectFriendApply"===h.attach.type&&(h.state=Rf[Rf.decline])):c<=3&&h.attach&&(h.attach=function formatTeamAttach(t){var a=t.attach,o=t.tinfo,c=__rest(t,["attach","tinfo"]);return c.ext=a,void 0!==o&&(c.team=formatTeam(deserialize(t.tinfo,Xp.team))),c}(h.attach)),h}function generatorSysMsgForCmd$1(t){var a=fi({},t);return fi(fi({},formatReverse(Bf,a)),{type:Of[a.type],to:a.to,attach:a.attach})}var Ff={"4_6":"syncOfflineSysMsgs","4_18":"syncOfflineSysMsgs","4_19":"syncRecallMsgOfflineAndRoaming","4_101":"syncOfflineSysMsgs","7_3":"onSysMsg","7_7":"sendCustomSysMsg","7_14":"onRecallMsg","21_18":"onRecallMsg","21_117":"onRecallMsg","7_15":"syncRecallMsgOfflineAndRoaming","21_19":"onSysMsg","21_16":"sendSuperTeamCustomSysMsg","101_3":"onSysMsg","101_7":"sendFilterCustomSysMsg"},Lf={sysMsg:{time:0,type:1,to:2,from:3,content:4,attach:5,idServer:6,needSaveOffline:7,pushApnsText:8,pushPayload:9,deletedIdClient:10,deletedIdServer:11,needcAntiSpam:12,antiSpamContent:13,deletedMsgTime:14,deletedMsgFromNick:15,opeAccount:16,forcePushIDsList:18,forcePushContent:19,needForcePush:20,envConfig:21,callbackExt:22,isRoutable:105,needPush:107,needPushBadge:109,needPushNick:110}},jf=invertSerializeMap(Lf),Nf={onSysMsg:{service:"systemMessage",sid:7,cid:3,response:[{type:"Property",name:"sysMsg",reflectMapper:jf.sysMsg}]},sendCustomSysMsg:{service:"systemMessage",sid:7,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:Lf.sysMsg}]},sendSuperTeamCustomSysMsg:{service:"systemMessage",sid:21,cid:16,params:[{type:"Property",name:"sysMsg",reflectMapper:Lf.sysMsg}]},sendFilterCustomSysMsg:{service:"systemMessage",sid:101,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:Lf.sysMsg}]},batchMarkRead:{service:"systemMessage",sid:4,cid:5,isNoResponse:!0,params:[{type:"byte",name:"sid"},{type:"byte",name:"cid"},{type:"LongArray",name:"ids"}]},onRecallMsg:{sid:7,cid:14,service:"systemMessage",response:[{type:"Property",name:"sysMsg",reflectMapper:jf.sysMsg}]},syncRecallMsgOfflineAndRoaming:{sid:7,cid:15,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:jf.sysMsg},{type:"Number",name:"timetag"},{type:"Number",name:"type"}]},syncOfflineSysMsgs:{sid:4,cid:9,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:jf.sysMsg}]}},Df=/*#__PURE__*/function(t){function SystemMessageService(a){var o;return(o=t.call(this,"systemMessage",a)||this).sysMsgUnread={total:0,friend:0,msg:0,team:0,superTeam:0},o.core.eventBus.on("logined",(function(){o.initEventListeners()})),registerParser({cmdMap:Ff,cmdConfig:Nf}),o}Mt(SystemMessageService,t);var a=SystemMessageService.prototype;return a.initEventListeners=function initEventListeners(){var t=this;this.core.eventBus.on("systemMessage/passFriendApply",(function(a){t.core.emit("updateSystemMessages",[{idServer:a.idServer,from:a.account,state:"pass",type:"friendRequest"}])})),this.core.eventBus.on("systemMessage/rejectFriendApply",(function(a){t.core.emit("updateSystemMessages",[{idServer:a.idServer,from:a.account,state:"decline",type:"friendRequest"}])}))},a.doMarkSysMsgAck=function doMarkSysMsgAck(t){var a=[],o=[],c=["applySuperTeam","rejectSuperTeamApply","superTeamInvite","rejectSuperTeamInvite","customSuperTeam"];forEach$1(t).call(t,(function(t){t.idServer&&(includes(c).call(c,t.type)?o.push(t.idServer):a.push(t.idServer))})),a.length>0&&this.core.sendCmd("batchMarkRead",{sid:"7",cid:"3",ids:a}),o.length>0&&this.core.sendCmd("batchMarkRead",{sid:"21",cid:"19",ids:o})},a.sendCustomSysMsg=function sendCustomSysMsg(t){var a=this;validate({to:{type:"string",allowEmpty:!1},type:{type:"enum",values:["customP2p","customTeam","customSuperTeam"]},attach:{type:"string",allowEmpty:!1},setting:{type:"object",rules:{needSaveOffline:{type:"boolean",required:!1},env:{type:"string",allowEmpty:!1,required:!1}},required:!1},pushInfo:{type:"object",required:!1,rules:{needPush:{type:"boolean",required:!1},pushApnsText:{type:"string",required:!1},pushPayload:{type:"string",required:!1}}}},t);var o="customSuperTeam"===t.type?"sendSuperTeamCustomSysMsg":"sendCustomSysMsg";return this.core.sendCmd(o,{sysMsg:generatorSysMsgForCmd$1(t)}).then((function(){a.logger.log("sendCustomSysMsg success")})).catch((function(t){throw a.logger.error("sendCustomSysMsg failed",t.message),t}))},a.onSysMsgHandler=function onSysMsgHandler(t){var a=t.content.sysMsg;if(a){var o=formatSystemMessage(a,this.logger,Ef.default);this.core.emit("sysMsg",o),this.doMarkSysMsgAck([o])}else this.logger.warn("onSysMsg no content.sysMsg")},a.syncOfflineSysMsgsHandler=function syncOfflineSysMsgsHandler(t){var a,o=this;if(t.content.sysMsgs&&t.content.sysMsgs.length>0){var c=map(a=t.content.sysMsgs).call(a,(function(t){return formatSystemMessage(t,o.logger,Ef.leave)}));this.core.emit("syncSysMsgs",c),this.doMarkSysMsgAck(c)}},a.onRecallMsgHandler=function onRecallMsgHandler(t){var a=t.content.sysMsg;if(a){var o=formatDeletedMsgs([a],function getSceneFromRecallSysMsg(t){return t===Of.recallMsgP2p?"p2p":t===Of.recallMsgTeam?"team":t===Of.recallMsgSuperTeam?"superTeam":""}(+a.type));this.core.eventBus.emit("session/updateForDeletedMsg",o);var c=formatSystemMessage(a,this.logger,Ef.default);this.core.emit("sysMsg",c),this.doMarkSysMsgAck([c])}else this.logger.warn("onSysMsg no content.sysMsg")},a.syncRecallMsgOfflineAndRoamingHandler=function syncRecallMsgOfflineAndRoamingHandler(t){var a=this,o=t.content,c=o.timetag,m=o.type,h=o.sysMsgs,v=_u(m),b=1===v?Ef.leave:Ef.roam,S=map(h).call(h,(function(t){return formatSystemMessage(t,a.logger,b)}));1===v&&this.doMarkSysMsgAck(S),this.core.eventBus.emit("sync/updateTimetag",{recallMsg:c}),this.core.emit("syncSysMsgs",S)},SystemMessageService}(Sd);function reverseFriend(t){var a=["bitsExtension","createTime","updateTime","passRelationShip","relationShip","source"],o=fi({},t);return forEach$1(a).call(a,(function(t){void 0!==o[t]&&(o[t]=_u(o[t]))})),void 0!==o.relationShip&&(o.valid=1===o.relationShip),o}var $f={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"};var Hf={"12_4":"getFriends","12_1":"friendReuqest","12_2":"deleteFriend","12_3":"updateFriend","12_5":"syncFriends","12_6":"syncFriendUsers","12_101":"syncFriendRequest","12_102":"syncDeleteFriend","12_103":"syncUpdateFriend"},Gf={updateFriendTag:{account:4,alias:8,ext:10},delFriendParams:{delAlias:1},friendTag:{account:4,relationShip:5,passRelationShip:6,source:7,alias:8,bitsExtension:9,ext:10,createTime:11,updateTime:12,serverex:13},userTag:{account:1,nick:3,avatar:4,sign:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13}},Qf=invertSerializeMap(Gf),Wf={getFriends:{sid:12,cid:4,service:"friend",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"friends",reflectMapper:Qf.friendTag},{type:"Number",name:"timetag"}]},friendReuqest:{sid:12,cid:1,service:"friend",params:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}]},deleteFriend:{sid:12,cid:2,service:"friend",params:[{type:"String",name:"account"},{type:"Property",name:"delFriendParams",reflectMapper:Gf.delFriendParams}]},updateFriend:{sid:12,cid:3,service:"friend",params:[{type:"Property",name:"updateFriendTag",reflectMapper:Gf.updateFriendTag}]},syncFriends:{sid:12,cid:5,service:"friend",response:[{type:"PropertyArray",name:"friends",entity:"friendTag",reflectMapper:Qf.friendTag},{type:"Number",name:"timetag"}]},syncFriendUsers:{sid:12,cid:6,service:"friend",response:[{type:"PropertyArray",name:"users",entity:"userTag",reflectMapper:Qf.userTag},{type:"Number",name:"timetag"}]},syncFriendRequest:{sid:12,cid:101,service:"friend",params:[{type:"String",name:"account"},{type:"Number",name:"type"},{type:"String",name:"ps"}],response:[{type:"String",name:"account"},{type:"Number",name:"type"},{type:"String",name:"ps"}]},syncDeleteFriend:{sid:12,cid:102,service:"friend",response:[{type:"String",name:"account"}]},syncUpdateFriend:{sid:12,cid:103,service:"friend",response:[{type:"Property",name:"friend",reflectMapper:Qf.friendTag}]}},Vf=/*#__PURE__*/function(t){function FriendService(a){var o;return o=t.call(this,"friend",a)||this,registerParser({cmdMap:Hf,cmdConfig:Wf}),o}Mt(FriendService,t);var a=FriendService.prototype;return a.getFriends=function getFriends(){var t;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var a,o;return ci.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("getFriends",{timetag:0});case 2:return a=c.sent,o=(null===(t=a.content)||void 0===t?void 0:t.friends)||[],o=map(o).call(o,(function(t){return reverseFriend(t)})),c.abrupt("return",o);case 6:case"end":return c.stop()}}),_callee,this)})))},a.addFriend=function addFriend(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var a;return ci.wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return validate({account:{type:"string",allowEmpty:!1},ps:{type:"string",allowEmpty:!1,required:!1}},t),o.next=3,this.core.sendCmd("friendReuqest",{account:t.account,type:1,ps:t.ps||""});case 3:return a=(new Date).getTime(),o.abrupt("return",{account:t.account,createTime:a,updateTime:a,valid:!0,source:0,passRelationShip:1,relationShip:1,bitsExtension:0});case 5:case"end":return o.stop()}}),_callee2,this)})))},a.applyFriend=function applyFriend(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){return ci.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return validate({account:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("friendReuqest",{account:t.account,type:2,ps:t.ps||""});case 3:case"end":return a.stop()}}),_callee3,this)})))},a.passFriendApply=function passFriendApply(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){var a=this;return ci.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return validate({account:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("friendReuqest",{account:t.account,type:3,ps:t.ps||""}).then((function(o){return a.core.eventBus.emit("systemMessage/passFriendApply",t),o}));case 3:case"end":return o.stop()}}),_callee4,this)})))},a.rejectFriendApply=function rejectFriendApply(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){var a=this;return ci.wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return validate({account:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("friendReuqest",{account:t.account,type:4,ps:t.ps||""}).then((function(o){return a.core.eventBus.emit("systemMessage/rejectFriendApply",t),o}));case 3:case"end":return o.stop()}}),_callee5,this)})))},a.deleteFriend=function deleteFriend(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){return ci.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return validate({account:{type:"string",allowEmpty:!1},delAlias:{type:"boolean"}},t),a.next=3,this.core.sendCmd("deleteFriend",{account:t.account,delFriendParams:{delAlias:!0===t.delAlias?1:0}});case 3:case"end":return a.stop()}}),_callee6,this)})))},a.updateFriend=function updateFriend(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee7(){return ci.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({account:{type:"string",allowEmpty:!1},alias:{type:"string"},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("updateFriend",{updateFriendTag:t});case 3:case"end":return a.stop()}}),_callee7,this)})))},a.syncFriendRequestHandler=function syncFriendRequestHandler(t){var a=function formatFriendRequest(t){var a=fi({},t);try{a.ps=a.ps&&JSON.parse(a.ps)}catch(t){}if(a.type=$f[a.type],"addFriend"===a.type||"passFriendApply"===a.type){var o=(new Date).getTime();a.friend={account:t.account,alias:"",createTime:o,ext:"",updateTime:o,valid:!0}}return a}(t.content);this.core.emit("syncFriend",a)},a.syncDeleteFriendHandler=function syncDeleteFriendHandler(t){var a=t.content.account;this.logger.log("friend::emit syncFriendAction: deleteFriend "+a),this.core.emit("syncFriend",{type:"deleteFriend",account:a})},a.syncUpdateFriendHandler=function syncUpdateFriendHandler(t){var a=reverseFriend(t.content.friend);this.logger.log("friend::emit syncFriendAction: updateFriend, ",null==a?void 0:a.account),this.core.emit("syncFriend",{type:"updateFriend",friend:a})},a.syncFriendsHandler=function syncFriendsHandler(t){var a=t.content;this.core.eventBus.emit("sync/updateTimetag",{friends:_u(a.timetag)});var o=null==a?void 0:a.friends;if(o&&o.length){var c=map(o).call(o,(function(t){return reverseFriend(t)}));this.core.emit("friends",c)}},a.syncFriendUsersHandler=function syncFriendUsersHandler(t){var a=t.content;this.core.eventBus.emit("sync/updateTimetag",{friendUsers:_u(a.timetag)});var o=null==a?void 0:a.users;if(o&&o.length){var c=map(o).call(o,(function(t){return formatUser(t)}));this.core.emit("users",c)}},FriendService}(Sd),Kf={1:"Android",2:"iOS",4:"PC",8:"WindowsPhone",16:"Web",32:"Server",64:"Mac"};function formatSubscribes(t){return t&&t.length>0?map(t).call(t,(function(t){return function formatSubscribe(t){var a=fi({},t),o=["subscribeTime","time"];return forEach$1(o).call(o,(function(t){a[t]&&(a[t]=_u(a[t]))})),a}(t)})):[]}function formatEvent(t){if(!t)return t;var a=t.serverExt,o=__rest(t,["serverExt"]),c=["time","type","value"];if(forEach$1(c).call(c,(function(t){o[t]&&(o[t]=_u(o[t]))})),o.clientType&&(o.clientType=Kf[o.clientType]||""),a)try{o.ext=JSON.parse(a),"string"==typeof o.ext[0]&&(o.ext=o.ext[0])}catch(t){}return o}var zf={"14_1":"publishEvent","14_2":"pushEvent","14_3":"subscribeEvent","14_4":"unSubscribeEventsByAccounts","14_5":"unSubscribeEventsByType","14_6":"querySubscribeEventsByAccounts","14_7":"querySubscribeEventsByType","14_9":"pushEvents"},Jf={msgEvent:{type:1,value:2,idClient:3,ext:4,validTime:5,broadcastType:6,sync:7,validTimeType:8,durable:9,time:10,idServer:11,clientType:12,serverConfig:13,serverExt:14,appid:101,account:103,enableMultiClient:104,consid:106},msgEventSubscribe:{type:1,subscribeTime:2,sync:3,to:102,from:104,time:105}},Yf=invertSerializeMap(Jf),Xf={publishEvent:{sid:14,cid:1,service:"event",params:[{type:"Property",name:"msgEvent",reflectMapper:Jf.msgEvent}],response:[{type:"Property",name:"msgEvent",reflectMapper:Yf.msgEvent}]},pushEvent:{sid:14,cid:2,service:"event",response:[{type:"Property",name:"msgEvent",reflectMapper:Yf.msgEvent}]},subscribeEvent:{sid:14,cid:3,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Jf.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByAccounts:{sid:14,cid:4,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Jf.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByType:{sid:14,cid:5,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Jf.msgEventSubscribe}]},querySubscribeEventsByAccounts:{sid:14,cid:6,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Jf.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:Yf.msgEventSubscribe}]},querySubscribeEventsByType:{sid:14,cid:7,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:Jf.msgEventSubscribe}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:Yf.msgEventSubscribe}]},pushEvents:{sid:14,cid:9,service:"event",response:[{type:"PropertyArray",name:"msgEvents",reflectMapper:Yf.msgEvent}]}},Zf=/*#__PURE__*/function(t){function EventService(a){var o;return o=t.call(this,"event",a)||this,registerParser({cmdMap:zf,cmdConfig:Xf}),o}Mt(EventService,t);var a=EventService.prototype;return a.publishEvent=function publishEvent(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var o,c,m;return ci.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:return validate({type:{type:"number"},value:{type:"number"},ext:{type:"string",required:!1},validTime:{type:"number",min:60,max:2592e3,required:!1},broadcastType:{type:"number",required:!1},sync:{type:"boolean",required:!1}},t),o=fi(fi({validTime:604800},t),{idClient:wu(),sync:!0===t.sync?1:0}),h.next=4,this.core.sendCmd("publishEvent",{msgEvent:o});case 4:return c=h.sent,m=(null===(a=c.content)||void 0===a?void 0:a.msgEvent)||{},h.abrupt("return",formatEvent(m));case 7:case"end":return h.stop()}}),_callee,this)})))},a.subscribeEvent=function subscribeEvent(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var o,c,m;return ci.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:return validate({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100},subscribeTime:{type:"number",min:60,max:2592e3,required:!1}},t),o=fi(fi({subscribeTime:2592e3},t),{sync:!0===t.sync?1:0}),h.next=4,this.core.sendCmd("subscribeEvent",{msgEventSubscribe:o,accounts:t.accounts});case 4:return c=h.sent,m=(null===(a=c.content)||void 0===a?void 0:a.accounts)||[],h.abrupt("return",{failedAccounts:m});case 7:case"end":return h.stop()}}),_callee2,this)})))},a.unSubscribeEvents=function unSubscribeEvents(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var o,c,m;return ci.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:if(validate({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},t),o={type:t.type},!(t.accounts&&t.accounts.length>0)){h.next=9;break}return h.next=5,this.core.sendCmd("unSubscribeEventsByAccounts",{msgEventSubscribe:o,accounts:t.accounts});case 5:m=h.sent,c=(null===(a=m.content)||void 0===a?void 0:a.accounts)||[],h.next=12;break;case 9:return h.next=11,this.core.sendCmd("unSubscribeEventsByType",{msgEventSubscribe:o});case 11:c=[];case 12:return h.abrupt("return",{failedAccounts:c});case 13:case"end":return h.stop()}}),_callee3,this)})))},a.querySubscribeEvents=function querySubscribeEvents(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){var o;return ci.wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:if(validate({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},t),!(t.accounts&&t.accounts.length>0)){c.next=7;break}return c.next=4,this.core.sendCmd("querySubscribeEventsByAccounts",{msgEventSubscribe:{type:t.type},accounts:t.accounts});case 4:o=c.sent,c.next=10;break;case 7:return c.next=9,this.core.sendCmd("querySubscribeEventsByType",{msgEventSubscribe:{type:t.type}});case 9:o=c.sent;case 10:return c.abrupt("return",formatSubscribes(null===(a=o.content)||void 0===a?void 0:a.msgEventSubscribes));case 11:case"end":return c.stop()}}),_callee4,this)})))},a.pushEventHandler=function pushEventHandler(t){var a,o=(null===(a=t.content)||void 0===a?void 0:a.msgEvent)||{};this.core.emit("pushEvents",[formatEvent(o)])},a.pushEventsHandler=function pushEventsHandler(t){var a,o=(null===(a=t.content)||void 0===a?void 0:a.msgEvents)||{};this.core.emit("pushEvents",function formatEvents(t){return xc(t)&&t.length>0?map(t).call(t,(function(t){return formatEvent(t)})):[]}(o))},EventService}(Sd);function generateThreadMsgsParams(t){var a={scene:cp[t.scene],from:t.threadMsgFromAccount,to:t.threadMsgToAccount,time:t.threadMsgTime,idServer:t.threadMsgIdServer},o={limit:t.limit<100?t.limit:100,beginTime:"number"==typeof t.beginTime?t.beginTime:0,reverse:!0===reverse$1(t)?1:0};return t.lastMsgId&&(o.lastMsgId=t.lastMsgId),{msg:a,threadMsgReq:o}}var eg,tg={"23_1":"getThreadMsgs","23_2":"getMsgsByIdServer"},rg={msg:um,threadMsgReq:{beginTime:1,endTime:2,lastMsgId:3,limit:4,reverse:5},threadMsgsMeta:{total:1,lastMsgTime:2}},ng=invertSerializeMap(rg),ag={getThreadMsgs:{sid:23,cid:1,service:"msgExtend",params:[{type:"Property",name:"msg",reflectMapper:rg.msg},{type:"Property",name:"threadMsgReq",reflectMapper:rg.threadMsgReq}],response:[{type:"Property",name:"threadMsg",reflectMapper:ng.msg},{type:"Property",name:"threadMsgsMeta",reflectMapper:ng.threadMsgsMeta},{type:"PropertyArray",name:"msgs",reflectMapper:ng.msg}]},getMsgsByIdServer:{sid:23,cid:2,service:"msgExtend",params:[{type:"PropertyArray",name:"reqMsgs",reflectMapper:rg.msg}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:ng.msg}]}},og=/*#__PURE__*/function(t){function MsgExtendService(a){var o;return o=t.call(this,"msgExtend",a)||this,registerParser({cmdMap:tg,cmdConfig:ag}),o}Mt(MsgExtendService,t);var a=MsgExtendService.prototype;return a.getThreadMsgs=function getThreadMsgs(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var o,c,m,h,v,b,S;return ci.wrap((function _callee$(M){for(;;)switch(M.prev=M.next){case 0:return validate({scene:{type:"enum",values:getEnumKeys(gd)},threadMsgFromAccount:{type:"string",allowEmpty:!1},threadMsgIdServer:{type:"string",allowEmpty:!1},threadMsgTime:{type:"number"},threadMsgToAccount:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},lastMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1}},t),M.next=3,this.core.sendCmd("getThreadMsgs",generateThreadMsgsParams(t));case 3:return o=M.sent,c=o.content,m=c.msgs,h=c.threadMsg,v=o.content.threadMsgsMeta,b=getSessionId(h,this.core.account),S=null===(a=this.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:b}),m=formatMsgs$1(m,S?{account:this.core.account,sessionAck:S.ack,msgReceiptTime:S.msgReceiptTime}:{account:this.core.account}),h=formatMsg$1(h,S?{account:this.core.account,sessionAck:S.ack,msgReceiptTime:S.msgReceiptTime}:{account:this.core.account}),M.abrupt("return",{msgs:m,threadMsg:h,total:_u(v.total),timetag:_u(v.lastMsgTime)});case 11:case"end":return M.stop()}}),_callee,this)})))},a.getMsgsByIdServer=function getMsgsByIdServer(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var a,o,c,m,h=this;return ci.wrap((function _callee2$(v){for(;;)switch(v.prev=v.next){case 0:return validate({reqMsgs:{type:"array",rules:{scene:{type:"enum",values:getEnumKeys(gd)},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},time:{type:"number"}},min:1,max:100}},t),v.next=3,this.core.sendCmd("getMsgsByIdServer",{reqMsgs:map(a=t.reqMsgs).call(a,(function(t){return fi(fi({},t),{scene:getEnumKeyByEnumValue(gd,t.scene)})}))});case 3:return c=v.sent,m=map(o=c.content.msgs).call(o,(function(t){var a,o=getSessionId(t,h.core.account),c=null===(a=h.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:o});return formatMsg$1(t,c?{account:h.core.account,sessionAck:c.ack,msgReceiptTime:c.msgReceiptTime}:{account:h.core.account})})),v.abrupt("return",m);case 6:case"end":return v.stop()}}),_callee2,this)})))},MsgExtendService}(Sd);!function(t){t[t.ASC=1]="ASC",t[t.DESC=2]="DESC"}(eg||(eg={}));var ig,sg={"7_6":"getHistoryMsgs","7_9":"deleteRoamingMsgs","4_24":"syncClearServerHistoryMsgs","7_18":"clearHistoryMsgsFromServer","7_118":"multiSyncClearServerHistoryMsgs","7_26":"nimFtsCloudMsgLogsAggWithSession","7_27":"nimFtsCloudMsgLogs"},cg={msg:um,clearHistoryMsgsFromServerReqTag:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,ext:7},clearMsgsParamsWithSync:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,fromAccid:5,time:6,ext:7},ftsReqTag:{keyword:1,fromTime:2,toTime:3,sessionLimit:4,msglogsLimit:5,orderRule:6,p2pSessionList:7,teamSessionList:8,senderList:9,msgTypeList:10,msgSubTypeList:11}},lg=invertSerializeMap(cg),ug={deleteRoamingMsgs:{sid:7,cid:9,service:"msgLog",params:[{type:"StrArray",name:"ids"}]},getHistoryMsgs:{sid:7,cid:6,params:[{type:"String",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:lg.msg}],service:"msgLog"},clearHistoryMsgsFromServer:{sid:7,cid:18,params:[{type:"Property",name:"clearHistoryMsgsFromServerReqTag",reflectMapper:cg.clearHistoryMsgsFromServerReqTag}],response:[{type:"Long",name:"timetag"}],service:"msgLog"},multiSyncClearServerHistoryMsgs:{sid:7,cid:118,response:[{type:"Property",name:"data",reflectMapper:lg.clearMsgsParamsWithSync}],service:"msgLog"},syncClearServerHistoryMsgs:{sid:4,cid:24,service:"msgLog",response:[{type:"PropertyArray",name:"datas",reflectMapper:lg.clearMsgsParamsWithSync}]},nimFtsCloudMsgLogsAggWithSession:{sid:7,cid:26,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:cg.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:lg.msg}]},nimFtsCloudMsgLogs:{sid:7,cid:27,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:cg.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:lg.msg}]}};!function(t){t[t.p2p=1]="p2p",t[t.team=2]="team"}(ig||(ig={}));var dg={type:{type:"enum",values:ig},isDeleteRoam:{type:"boolean"},isSyncSelf:{type:"boolean"},time:{type:"number"}};function formatClearResult(t){var a=format(dg,t);return{sessionId:"p2p"===a.type?"p2p-"+a.otherAccid:"team-"+a.toTid,time:a.time}}var pg={orderRule:{type:"enum",values:eg}};function generateFtsTagForCmd(t){var a,o=format(pg,t);xc(o.msgTypeList)&&(o.msgTypeList=map(a=o.msgTypeList).call(a,(function(t){return fd[t]})).join(","));var c=["p2pSessionList","teamSessionList","senderList","msgSubTypeList"];return forEach$1(c).call(c,(function(t){xc(o[t])&&(o[t]=o[t].join(","))})),o}var mg=/*#__PURE__*/function(t){function MsgLogService(a){var o;return o=t.call(this,"msgLog",a)||this,registerParser({cmdMap:sg,cmdConfig:ug}),o}Mt(MsgLogService,t);var a=MsgLogService.prototype;return a.deleteRoamingMsgs=function deleteRoamingMsgs(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var a,o;return ci.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:validate({ids:{type:"array",itemType:"string"}},t),a=[],c.prev=2,a=map(o=t.ids).call(o,(function(t){var a=getAccountFromSessionId(t);return a.scene+"|"+a.accid})),c.next=10;break;case 6:throw c.prev=6,c.t0=c.catch(2),this.logger.error("Failed to delete roaming msgs with "+t.ids,c.t0),new Error("Failed to create session with "+t.ids);case 10:return c.next=12,this.core.sendCmd("deleteRoamingMsgs",{ids:a});case 12:case"end":return c.stop()}}),_callee,this,[[2,6]])})))},a.getHistoryMsgs=function getHistoryMsgs(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var o,c,m,h,v,b,S;return ci.wrap((function _callee2$(M){for(;;)switch(M.prev=M.next){case 0:return validate({scene:{type:"enum",values:ui(cp)},to:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1},lastMsgId:{type:"string",required:!1,allowEmpty:!1},asc:{type:"boolean",required:!1},msgTypes:{type:"array",itemType:"string",required:!1}},t),c="p2p"===t.scene?"getHistoryMsgs":"team"===t.scene?"getHistoryTeamMsgs":"getHistorySuperTeamMsgs",M.next=4,this.core.sendCmd(c,fi(fi({beginTime:0,endTime:0,lastMsgId:0,limit:100,reverse:!1},t),{msgTypes:t.msgTypes?map(o=t.msgTypes).call(o,(function(t){return np[t]})):[]}));case 4:if(m=M.sent,(h=m.content).msgs&&h.msgs.length>0){M.next=8;break}return M.abrupt("return",[]);case 8:if(v=getSessionId(h.msgs[0],this.core.account),b=null===(a=this.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:v}),S=formatMsgs$1(h.msgs,b?{account:this.core.account,sessionAck:b.ack,msgReceiptTime:b.msgReceiptTime}:{account:this.core.account}),!0!==t.asc){M.next=13;break}return M.abrupt("return",sort(S).call(S,(function(t,a){return t.time-a.time})));case 13:return M.abrupt("return",S);case 14:case"end":return M.stop()}}),_callee2,this)})))},a.clearHistoryMsgsFromServer=function clearHistoryMsgsFromServer(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var a,o,c;return ci.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:return validate({scene:{type:"enum",values:["p2p","team"]},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},isSyncSelf:{type:"boolean",required:!1}},t),(a=fi(fi({isDeleteRoam:1},t),{type:"team"===t.scene?2:1,isSyncSelf:!0===t.isSyncSelf?1:0}))[2===a.type?"toTid":"otherAccid"]=t.to,m.next=5,this.core.sendCmd("clearHistoryMsgsFromServer",{clearHistoryMsgsFromServerReqTag:a});case 5:return o=m.sent,c=o.content,this.core.eventBus.emit("session/updateForClearMsg",[{sessionId:t.scene+"-"+t.to}],!0),m.abrupt("return",c);case 9:case"end":return m.stop()}}),_callee3,this)})))},a.multiSyncClearServerHistoryMsgsHandler=function multiSyncClearServerHistoryMsgsHandler(t){var a=formatClearResult(t.content.data);this.core.eventBus.emit("session/updateForClearMsg",[a],!0),this.core.emit("clearServerHistoryMsgs",[a])},a.ftsCloudMsgLogs=function ftsCloudMsgLogs(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){return ci.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.baseFtsCloudMsgLogs(t,"nimFtsCloudMsgLogs"));case 1:case"end":return a.stop()}}),_callee4,this)})))},a.ftsCloudMsgLogsAggWithSession=function ftsCloudMsgLogsAggWithSession(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){return ci.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.baseFtsCloudMsgLogs(t,"nimFtsCloudMsgLogsAggWithSession"));case 1:case"end":return a.stop()}}),_callee5,this)})))},a.baseFtsCloudMsgLogs=function baseFtsCloudMsgLogs(t,a){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){var o,c,m,h=this;return ci.wrap((function _callee6$(v){for(;;)switch(v.prev=v.next){case 0:if(validate({keyword:{type:"string",allowEmpty:!1},fromTime:{type:"number",required:!1},toTime:{type:"number",required:!1},sessionLimit:{type:"number",required:!1},msglogsLimit:{type:"number",required:!1},orderRule:{type:"enum",values:getEnumKeys(eg),required:!1},p2pSessionList:{type:"array",itemType:"string",required:!1},teamSessionList:{type:"array",itemType:"string",required:!1},senderList:{type:"array",itemType:"string",required:!1},msgTypeList:{type:"array",itemType:"enum",values:getEnumKeys(fd),required:!1},msgSubTypeList:{type:"array",itemType:"number",required:!1}},t),!(t.fromTime&&t.toTime&&t.toTime<t.fromTime)){v.next=3;break}throw new rc("Request parameter error: toTime should be greater than fromTime",t,"");case 3:return c=generateFtsTagForCmd(t),v.next=6,this.core.sendCmd(a,{tag:c});case 6:return m=v.sent,v.abrupt("return",map(o=m.content.datas).call(o,(function(t){var a,o=getSessionId(t,h.core.account),c=null===(a=h.core.session)||void 0===a?void 0:a.getSessionWithUncomplete({id:o});return formatMsg$1(t,c?{account:h.core.account,sessionAck:c.ack,msgReceiptTime:c.msgReceiptTime}:{account:h.core.account})})));case 8:case"end":return v.stop()}}),_callee6,this)})))},a.syncClearServerHistoryMsgsHandler=function syncClearServerHistoryMsgsHandler(t){var a=function formatClearResults(t){return xc(t)&&t.length>0?map(t).call(t,(function(t){return formatClearResult(t)})):[]}(t.content.datas);this.core.emit("clearServerHistoryMsgs",a)},MsgLogService}(Sd),hg={"22_1":"requestProxy","22_2":"onRequestProxy"},fg={requestProxyTag:{zone:1,path:2,method:3,header:4,body:5},requestProxyMsgTag:{from:1,body:2,time:3}},gg=invertSerializeMap(fg),yg={requestProxy:{sid:22,cid:1,service:"passThrough",params:[{type:"Property",name:"requestProxyTag",reflectMapper:fg.requestProxyTag}],response:[{type:"Property",name:"requestProxyTag",reflectMapper:gg.requestProxyTag}]},onRequestProxy:{sid:22,cid:2,service:"passThrough",response:[{type:"Property",name:"proxyMsg",reflectMapper:gg.requestProxyMsgTag}]}},vg=/*#__PURE__*/function(t){function PassThroughService(a){var o;return(o=t.call(this,"passThrough",a)||this).core=a,registerParser({cmdMap:hg,cmdConfig:yg}),o}Mt(PassThroughService,t);var a=PassThroughService.prototype;return a.request=function request(t){return validate({path:{type:"string",allowEmpty:!1}},t),this.core.sendCmd("requestProxy",{requestProxyTag:t}).then((function(t){return t.content.proxyTag}))},a.onRequestProxyHandler=function onRequestProxyHandler(t){var a=t.content.proxyMsg;a&&a.time&&(a.time=+a.time),this.core.emit("proxyMsg",a)},PassThroughService}(Sd),bg=ip({none:0,normal:1,all:3}),Sg=ip({normal:0,advanced:1}),Mg=ip({normal:0,owner:1,manager:2}),Cg={noVerify:0,needVerify:1,rejectAll:2},Tg=ip(Cg),_g={needVerify:0,noVerify:1},wg=ip(_g),Ig={manager:0,all:1},kg=ip(Ig),xg={manager:0,all:1},Rg=ip(xg),Eg={manager:0,all:1},Ag=ip(Eg);function formatSuperTeam(t){var a,o=["teamId"],c=["level","memberNum","memberUpdateTime","createTime","updateTime"],m=["valid","validToCurrentUser","mute"],h={type:Sg,muteType:bg,joinMode:Tg,beInviteMode:wg,inviteMode:kg,updateTeamMode:Rg,updateExtMode:Ag};t.bits;var v=__rest(t,["bits"]);return forEach$1(o).call(o,(function(t){v[t]&&(v[t]=v[t].toString())})),forEach$1(c).call(c,(function(t){void 0!==v[t]&&(v[t]=_u(v[t]))})),forEach$1(m).call(m,(function(t){void 0!==v[t]&&(v[t]=1===_u(v[t]))})),forEach$1(a=ui(h)).call(a,(function(t){void 0!==v[t]&&(v[t]=h[t][v[t]]||v[t])})),v}function formatSuperTeams(t){return t&&t.length>0?map(t).call(t,(function(t){return formatSuperTeam(t)})):[]}function generateSuperTeam(t){var a,o=fi({},t),c=["avatar","name","intro","announcement","ext"],m={joinMode:Cg,beInviteMode:_g,inviteMode:Ig,updateTeamMode:xg,updateExtMode:Eg};return forEach$1(c).call(c,(function(t){void 0!==o[t]&&(o[t]=o[t].toString())})),forEach$1(a=ui(m)).call(a,(function(t){void 0!==o[t]&&(o[t]=m[t][o[t]])})),o}function generatorSuperTeamMemberForCmd(t){var a=["teamId","ext","account","nickInTeam"],o={};return void 0!==t.bitConfigMask&&(o.bits=_u(t.bitConfigMask)),forEach$1(a).call(a,(function(a){t[a]&&(o[a]=t[a].toString())})),o}function formatSuperTeamMember(t){var a,o=["teamId"],c=["joinTime","updateTime","bitConfigMask"],m=["active","valid","mute"],h={type:Mg},v=t.bits,b=__rest(t,["bits"]);return void 0!==v&&(b.muteTeam=1===_u(v),b.bitConfigMask=v),b.id=b.teamId+"-"+b.account,forEach$1(o).call(o,(function(t){b[t]&&(b[t]=b[t].toString())})),forEach$1(c).call(c,(function(t){void 0!==b[t]&&(b[t]=_u(b[t]))})),forEach$1(m).call(m,(function(t){void 0!==b[t]&&(b[t]=1===_u(b[t]))})),forEach$1(a=ui(h)).call(a,(function(t){void 0!==b[t]&&(b[t]=h[t][b[t]]||b[t])})),b}function formatSuperTeamMembers(t){return t&&t.length>0?map(t).call(t,(function(t){return formatSuperTeamMember(t)})):[]}function generatorMemberBySuperTeam(t,a,o){return void 0===o&&(o="normal"),{id:t.teamId+"-"+a,teamId:t.teamId,account:a,type:o,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:t.memberUpdateTime,updateTime:t.memberUpdateTime,active:!0,valid:!0}}function generatorMembersBySuperTeam(t,a,o){return void 0===o&&(o="normal"),a&&a.length>0?map(a).call(a,(function(a){return generatorMemberBySuperTeam(t,a,o)})):[]}var qg=/*#__PURE__*/function(){function ModuleService(t){this.core=t}var t=ModuleService.prototype;return t.notifyAddSuperTeamMembers=function notifyAddSuperTeamMembers(t,a){this.core.emit("addSuperTeamMembers",{team:t,accounts:a,members:generatorMembersBySuperTeam(t,a)})},t.notifyUpdateSuperTeamManagers=function notifyUpdateSuperTeamManagers(t,a,o,c){this.core.emit("updateSuperTeamManagers",{team:{teamId:t,memberUpdateTime:c},accounts:a,isManager:o,members:map(a).call(a,(function(a){return{id:t+"-"+a,type:"manager",account:a,updateTime:c}}))})},t.notifyRemoveSuperTeamMembers=function notifyRemoveSuperTeamMembers(t,a){this.core.emit("removeSuperTeamMembers",{team:t,accounts:a})},t.notifyTransferSuperTeam=function notifyTransferSuperTeam(t,a,o){this.core.emit("transferSuperTeam",{team:t,from:{id:t.teamId+"-"+a,account:a,type:"normal",updateTime:t.memberUpdateTime},to:{id:t.teamId+"-"+o,account:o,type:"owner",updateTime:t.memberUpdateTime}})},t.notifyUpdateSuperTeamMembersMute=function notifyUpdateSuperTeamMembersMute(t,a,o){this.core.emit("updateSuperTeamMembersMute",{team:t,accounts:a,members:map(a).call(a,(function(a){return{id:t.teamId+"-"+a,account:a,teamId:t.teamId,mute:o,updateTime:t.memberUpdateTime}})),mute:o})},ModuleService}(),Pg={"21_5":"addSuperTeamMembers","21_6":"removeSuperTeamMembers","21_7":"leaveSuperTeam","21_8":"updateSuperTeamInfo","21_9":"getSuperTeamInfo","21_12":"getSuperTeams","21_15":"getSuperTeamMembers","21_10":"updateMySuperTeamMemberInfo","21_20":"applySuperTeam","21_21":"passSuperTeamApply","21_22":"rejectSuperTeamApply","21_23":"acceptSuperTeamInvite","21_24":"rejectSuperTeamInvite","21_26":"addSuperTeamManagers","21_27":"removeSuperTeamManagers","21_28":"muteSuperTeam","21_29":"muteSuperTeamMembers","21_30":"updateSuperTeamMemberNick","21_31":"transferSuperTeam","21_33":"getSuperTeamMembersByAccounts","21_34":"queryMuteSuperTeamMembers","21_101":"syncCreateSuperTeam","21_109":"syncSuperTeams","21_110":"syncUpdateSuperTeamMember"},Og={superTeam:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},superTeamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,updateTime:11,ext:12,mute:13,invitorAccid:14,joinTime:15}},Ug=invertSerializeMap(Og),Bg={getSuperTeamInfo:{sid:21,cid:9,service:"superTeam",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"superTeam",reflectMapper:Ug.superTeam}]},getSuperTeams:{sid:21,cid:12,service:"superTeam",params:[{type:"long",name:"timetag"}],response:[{type:"PropertyArray",name:"superTeams",reflectMapper:Ug.superTeam},{type:"Number",name:"timetag"}]},updateSuperTeamInfo:{sid:21,cid:8,service:"superTeam",params:[{type:"Property",name:"superTeam",reflectMapper:Og.superTeam}],response:[{type:"Number",name:"time"}]},addSuperTeamMembers:{sid:21,cid:5,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"StrArray",name:"abortedAccidList"},{type:"Long",name:"time"}]},removeSuperTeamMembers:{sid:21,cid:6,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},addSuperTeamManagers:{sid:21,cid:26,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeSuperTeamManagers:{sid:21,cid:27,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applySuperTeam:{sid:21,cid:20,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"superTeam",reflectMapper:Ug.superTeam}]},transferSuperTeam:{sid:21,cid:31,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"bool",name:"leave"}]},muteSuperTeam:{sid:21,cid:28,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},muteSuperTeamMembers:{sid:21,cid:29,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"Int",name:"mute"}]},updateSuperTeamMemberNick:{sid:21,cid:30,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:Og.superTeamMember}]},updateMySuperTeamMemberInfo:{sid:21,cid:10,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:Og.superTeamMember}]},getSuperTeamMembersByAccounts:{sid:21,cid:33,service:"superTeam",params:[{type:"StrArray",name:"memberIds"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:Ug.superTeamMember}]},getSuperTeamMembers:{sid:21,cid:15,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:Ug.superTeamMember}]},queryMuteSuperTeamMembers:{sid:21,cid:34,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:Ug.superTeamMember}]},leaveSuperTeam:{sid:21,cid:7,service:"superTeam",params:[{type:"Long",name:"teamId"}]},passSuperTeamApply:{sid:21,cid:21,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamApply:{sid:21,cid:22,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptSuperTeamInvite:{sid:21,cid:23,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamInvite:{sid:21,cid:24,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncSuperTeams:{sid:21,cid:109,service:"superTeam",response:[{type:"PropertyArray",name:"teams",reflectMapper:Ug.superTeam},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},syncCreateSuperTeam:{sid:21,cid:101,service:"superTeam",response:[{type:"Property",name:"superTeam",reflectMapper:Ug.superTeam}]},syncUpdateSuperTeamMember:{sid:21,cid:110,service:"superTeam",response:[{type:"Property",name:"teamMember",reflectMapper:Ug.superTeamMember}]}},Fg=/*#__PURE__*/function(t){function SuperTeamService(a){var o;return(o=t.call(this,"superTeam",a)||this).service=new qg(a),registerParser({cmdMap:Pg,cmdConfig:Bg}),o.core.eventBus.on("team/onNotification",(function(t){return o.notificationHandler(t)})),o}Mt(SuperTeamService,t);var a=SuperTeamService.prototype;return a.getSuperTeamInfo=function getSuperTeamInfo(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var a,o;return ci.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),c.next=3,this.core.sendCmd("getSuperTeamInfo",{teamId:t.teamId});case 3:return a=c.sent,o=a.content.superTeam,c.abrupt("return",formatSuperTeam(o));case 6:case"end":return c.stop()}}),_callee,this)})))},a.getSuperTeams=function getSuperTeams(){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var t,a;return ci.wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.sendCmd("getSuperTeams",{timetag:0});case 2:return t=o.sent,a=t.content.superTeams,o.abrupt("return",formatSuperTeams(a));case 5:case"end":return o.stop()}}),_callee2,this)})))},a.updateSuperTeamInfo=function updateSuperTeamInfo(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var a;return ci.wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!1,required:!1},announcement:{type:"string",allowEmpty:!1,required:!1},avatar:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",allowEmpty:!1,required:!1}},t),a=generateSuperTeam(t),o.next=4,this.core.sendCmd("updateSuperTeamInfo",{superTeam:a});case 4:return o.abrupt("return",formatSuperTeam(a));case 5:case"end":return o.stop()}}),_callee3,this)})))},a.addSuperTeamMembers=function addSuperTeamMembers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){return ci.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},t),a.next=3,this.core.sendCmd("addSuperTeamMembers",{teamId:t.teamId,accounts:t.accounts,ps:t.ps||"",attach:t.ext||""});case 3:case"end":return a.stop()}}),_callee4,this)})))},a.removeSuperTeamMembers=function removeSuperTeamMembers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){return ci.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("removeSuperTeamMembers",{teamId:t.teamId,accounts:t.accounts});case 3:case"end":return a.stop()}}),_callee5,this)})))},a.addSuperTeamManagers=function addSuperTeamManagers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){return ci.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},t),a.next=3,this.core.sendCmd("addSuperTeamManagers",t);case 3:case"end":return a.stop()}}),_callee6,this)})))},a.removeSuperTeamManagers=function removeSuperTeamManagers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee7(){return ci.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},t),a.next=3,this.core.sendCmd("removeSuperTeamManagers",t);case 3:case"end":return a.stop()}}),_callee7,this)})))},a.applySuperTeam=function applySuperTeam(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee8(){var a;return ci.wrap((function _callee8$(o){for(;;)switch(o.prev=o.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},t),o.next=3,this.core.sendCmd("applySuperTeam",{teamId:t.teamId,ps:t.ps||""});case 3:return a=o.sent,o.abrupt("return",formatSuperTeam(a.content.superTeam));case 5:case"end":return o.stop()}}),_callee8,this)})))},a.transferSuperTeam=function transferSuperTeam(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee9(){return ci.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},t),a.next=3,this.core.sendCmd("transferSuperTeam",t);case 3:case"end":return a.stop()}}),_callee9,this)})))},a.muteSuperTeam=function muteSuperTeam(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee10(){return ci.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},t),a.next=3,this.core.sendCmd("muteSuperTeam",{teamId:t.teamId,mute:t.mute?1:0});case 3:case"end":return a.stop()}}),_callee10,this)})))},a.muteSuperTeamMembers=function muteSuperTeamMembers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee11(){return ci.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string"},mute:{type:"boolean"}},t),a.next=3,this.core.sendCmd("muteSuperTeamMembers",{teamId:t.teamId,accounts:t.accounts,mute:t.mute?1:0});case 3:case"end":return a.stop()}}),_callee11,this)})))},a.updateMemberNick=function updateMemberNick(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee12(){var a,o;return ci.wrap((function _callee12$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!1}},t),a=generatorSuperTeamMemberForCmd({teamId:t.teamId,nickInTeam:t.nickInTeam,account:t.account}),c.next=4,this.core.sendCmd("updateSuperTeamMemberNick",{teamMember:a});case 4:return o=formatSuperTeamMember(fi({updateTime:(new Date).getTime()},a)),c.abrupt("return",o);case 6:case"end":return c.stop()}}),_callee12,this)})))},a.updateMyMemberInfo=function updateMyMemberInfo(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee13(){var a,o;return ci.wrap((function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!1,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},t),a=generatorSuperTeamMemberForCmd({teamId:t.teamId,nickInTeam:t.nickInTeam,bitConfigMask:t.bitConfigMask,ext:t.ext}),c.next=4,this.core.sendCmd("updateMySuperTeamMemberInfo",{teamMember:a});case 4:return o=formatSuperTeamMember(fi({updateTime:(new Date).getTime(),account:this.core.account},a)),this.core.emit("updateSuperTeamMember",o),c.abrupt("return",o);case 7:case"end":return c.stop()}}),_callee13,this)})))},a.getSuperTeamMembersByAccounts=function getSuperTeamMembersByAccounts(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee14(){var o,c,m;return ci.wrap((function _callee14$(h){for(;;)switch(h.prev=h.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:20,min:1}},t),c=map(o=t.accounts).call(o,(function(a){return t.teamId+"|"+a})),h.next=4,this.core.sendCmd("getSuperTeamMembersByAccounts",{memberIds:c});case 4:return m=h.sent,h.abrupt("return",formatSuperTeamMembers(null===(a=m.content)||void 0===a?void 0:a.superTeamMembers));case 6:case"end":return h.stop()}}),_callee14,this)})))},a.getSuperTeamMembers=function getSuperTeamMembers(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee15(){var o;return ci.wrap((function _callee15$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,max:1e3,required:!1},reverse:{type:"boolean",required:!1}},t),c.next=3,this.core.sendCmd("getSuperTeamMembers",fi({joinTime:0,limit:100,reverse:!1},t));case 3:return o=c.sent,c.abrupt("return",formatSuperTeamMembers(null===(a=o.content)||void 0===a?void 0:a.superTeamMembers));case 5:case"end":return c.stop()}}),_callee15,this)})))},a.queryMuteMembers=function queryMuteMembers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee16(){var a,o;return ci.wrap((function _callee16$(c){for(;;)switch(c.prev=c.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},t),c.next=3,this.core.sendCmd("queryMuteSuperTeamMembers",fi({limit:100,joinTime:0,reverse:!1},t));case 3:return a=c.sent,o=a.content,c.abrupt("return",formatSuperTeamMembers(o.superTeamMembers));case 6:case"end":return c.stop()}}),_callee16,this)})))},a.leaveSuperTeam=function leaveSuperTeam(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee17(){return ci.wrap((function _callee17$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},t),a.next=3,this.core.sendCmd("leaveSuperTeam",{teamId:t.teamId});case 3:case"end":return a.stop()}}),_callee17,this)})))},a.passSuperTeamApply=function passSuperTeamApply(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee18(){return ci.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("passSuperTeamApply",t);case 3:case"end":return a.stop()}}),_callee18,this)})))},a.rejectSuperTeamApply=function rejectSuperTeamApply(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee19(){return ci.wrap((function _callee19$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},t),a.next=3,this.core.sendCmd("rejectSuperTeamApply",{teamId:t.teamId,from:t.from,ps:t.ps||""});case 3:case"end":return a.stop()}}),_callee19,this)})))},a.acceptSuperTeamInvite=function acceptSuperTeamInvite(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee20(){return ci.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("acceptSuperTeamInvite",t);case 3:case"end":return a.stop()}}),_callee20,this)})))},a.rejectSuperTeamInvite=function rejectSuperTeamInvite(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee21(){return ci.wrap((function _callee21$(a){for(;;)switch(a.prev=a.next){case 0:return validate({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},t),a.next=3,this.core.sendCmd("rejectSuperTeamInvite",{teamId:t.teamId,from:t.from,ps:t.ps||""});case 3:case"end":return a.stop()}}),_callee21,this)})))},a.syncSuperTeamsHandler=function syncSuperTeamsHandler(t){var a=t.content;this.core.eventBus.emit("sync/updateTimetag",{superTeams:_u(a.timetag)});var o=null==a?void 0:a.superTeams;if(o&&o.length){var c=formatSuperTeams(o);this.core.emit("superTeams",c)}},a.syncCreateSuperTeamHandler=function syncCreateSuperTeamHandler(t){var a=t.content,o=formatSuperTeam(null==a?void 0:a.superTeam),c=generatorMemberBySuperTeam(o,o.owner,"owner");this.core.emit("createSuperTeam",o,c)},a.syncUpdateSuperTeamMemberHandler=function syncUpdateSuperTeamMemberHandler(t){var a=t.content,o=formatSuperTeamMember(null==a?void 0:a.teamMember);o.updateTime||(o.updateTime=(new Date).getTime()),this.core.emit("updateSuperTeamMember",o)},a.notificationHandler=function notificationHandler(t){var a=t.attach,o=t.scene,c=t.from,m=t.to,h=t.time,v=t.idServer,b=t.idClient,S=a.team,M=a.account,C=a.accounts,T=a.type;if("superTeam"===o)switch("debug"===this.core.options.debugLevel?this.logger.debug("superTeam::recvNotification",v,b,a):this.logger.log("superTeam::recvNotification",v,b,m,T,M,C),T){case"updateSuperTeam":S.updateTime=h,this.core.emit("updateSuperTeam",S);break;case"addSuperTeamMembers":this.service.notifyAddSuperTeamMembers(S,C);break;case"acceptSuperTeamInvite":this.service.notifyAddSuperTeamMembers(S,[c]);break;case"passSuperTeamApply":this.service.notifyAddSuperTeamMembers(S,[M]);break;case"addSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(m,C,!0,h);break;case"removeSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(m,C,!1,h);break;case"removeSuperTeamMembers":this.service.notifyRemoveSuperTeamMembers(S,C);break;case"leaveSuperTeam":this.service.notifyRemoveSuperTeamMembers(S,[c]);break;case"dismissSuperTeam":this.core.emit("dismissSuperTeam",{teamId:m});break;case"transferSuperTeam":this.service.notifyTransferSuperTeam(S,c,M);break;case"updateSuperTeamMembersMute":this.service.notifyUpdateSuperTeamMembersMute(S,C,a.mute)}},SuperTeamService}(Sd),Lg={"13_1":"getChatroomAddress","24_1":"getQChatAddress"},jg={getChatroomAddress:{sid:13,cid:1,service:"plugin",params:[{type:"Long",name:"chatroomId"},{type:"Boolean",name:"isWeixinApp"},{type:"Number",name:"ipType"}],response:[{type:"StrArray",name:"address"}]},getQChatAddress:{sid:24,cid:1,service:"plugin",params:[{type:"Property",name:"getQChatAddressTag",reflectMapper:{ipType:1}}],response:[{type:"StrArray",name:"address"}]}},Ng=/*#__PURE__*/function(t){function PluginService(a){var o;return(o=t.call(this,"plugin",a)||this).core=a,registerParser({cmdMap:Lg,cmdConfig:jg}),o}Mt(PluginService,t);var a=PluginService.prototype;return a.getChatroomAddress=function getChatroomAddress(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var a;return ci.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return validate({chatroomId:{type:"string",allowEmpty:!1},ipType:{type:"number",required:!1}},t),o.next=3,this.core.sendCmd("getChatroomAddress",{chatroomId:t.chatroomId,isWeixinApp:"WXAPP"===pc.platform,ipType:t.ipType||0});case 3:return a=o.sent,o.abrupt("return",a.content.address);case 5:case"end":return o.stop()}}),_callee,this)})))},a.getQChatAddress=function getQChatAddress(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var a;return ci.wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return validate({ipType:{type:"number",required:!1}},t),o.next=3,this.core.sendCmd("getQChatAddress",{getQChatAddressTag:{ipType:(null==t?void 0:t.ipType)||0}});case 3:return a=o.sent,o.abrupt("return",a.content.address);case 5:case"end":return o.stop()}}),_callee2,this)})))},PluginService}(Sd),Dg=Sr.some,$g=arrayMethodIsStrict("some");_export({target:"Array",proto:!0,forced:!$g},{some:function some(t){return Dg(this,t,arguments.length>1?arguments[1]:void 0)}});var Hg=entryVirtual("Array").some,Gg=Array.prototype,some=function(t){var a=t.some;return t===Gg||G(Gg,t)&&a===Gg.some?Hg:a},Qg=Object.getOwnPropertySymbols?function(t){for(var a=[];t;)_m(a,xh(t)),t=Cd(t);return a}:_h;var Wg=function nativeKeysIn(t){var a=[];if(null!=t)for(var o in Object(t))a.push(o);return a},Vg=Object.prototype.hasOwnProperty;var Kg=function baseKeysIn(t){if(!ws(t))return Wg(t);var a=Jd(t),o=[];for(var c in t)("constructor"!=c||!a&&Vg.call(t,c))&&o.push(c);return o};var zg=function keysIn(t){return zl(t)?Kd(t,!0):Kg(t)};var Jg=function getAllKeysIn(t){return Ch(t,zg,Qg)};var Yg,Xg,Zg=function pickBy(t,a){if(null==t)return{};var o=Ul(Jg(t),(function(t){return[t]}));return a=ef(a),bm(t,o,(function(t,o){return a(t,o[0])}))},ey={"6_2":"getNosToken","6_22":"getOriginUrl","6_26":"getNosCdnHost","6_27":"getGrayscaleConfig","6_28":"getMixStorePolicy","6_29":"getMixStoreToken","6_30":"getFileAuthToken"},ty={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},mixStoreTokenReqTag:{provider:0,tokenCount:1,fileExpireSec:2,tag:3,returnBody:4},nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4},grayConfigTag:{config:0,ttl:1},mixStorePolicyTag:{providers:0,ttl:1,mixEnable:2,nosPolicy:3,s3Policy:4},mixStoreTokenResTag:{provider:0,accessKeyId:1,secretAccessKey:2,sessionToken:3,token:4,expireTime:5,bucket:6,objectName:7,fileExpireSec:8,tag:9,shortUrl:10,region:11},nosSafeUrlTag:{safeUrl:0,originUrl:1},mixStoreAuthTokenReqTag:{type:1,urls:2},mixStoreAuthTokenResTag:{type:1,tokens:2,token:3,ttl:4}},ry=invertSerializeMap(ty),ny={getNosToken:{sid:6,cid:2,service:"cloudStorage",response:[{type:"Property",name:"nosToken",reflectMapper:ry.nosToken}],params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken",reflectMapper:ty.nosToken}]},getOriginUrl:{sid:6,cid:22,service:"cloudStorage",response:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:ry.nosSafeUrlTag}],params:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:ty.nosSafeUrlTag}]},getNosCdnHost:{sid:6,cid:26,service:"misc",response:[{type:"Property",name:"nosConfigTag",reflectMapper:ry.nosConfigTag}]},getGrayscaleConfig:{sid:6,cid:27,service:"cloudStorage",response:[{type:"Property",name:"grayConfigTag",reflectMapper:ry.grayConfigTag}],params:[{type:"Property",name:"config"}]},getMixStorePolicy:{sid:6,cid:28,service:"cloudStorage",params:[{type:"LongArray",name:"supportType"}],response:[{type:"Property",name:"mixStorePolicyTag",reflectMapper:ry.mixStorePolicyTag}]},getMixStoreToken:{sid:6,cid:29,service:"cloudStorage",params:[{type:"Property",name:"mixStoreTokenReqTag",reflectMapper:ty.mixStoreTokenReqTag}],response:[{type:"Property",name:"mixStoreTokenResTag",reflectMapper:ry.mixStoreTokenResTag}]},getFileAuthToken:{sid:6,cid:30,service:"cloudStorage",params:[{type:"Property",name:"mixStoreAuthTokenReqTag",reflectMapper:ty.mixStoreAuthTokenReqTag}],response:[{type:"Property",name:"mixStoreAuthTokenResTag",reflectMapper:ry.mixStoreAuthTokenResTag}]}};!function(t){t[t.nos=1]="nos",t[t.s3=2]="s3"}(Yg||(Yg={})),function(t){t[t.dontNeed=-1]="dontNeed",t[t.time=2]="time",t[t.urls=3]="urls"}(Xg||(Xg={}));var ay,oy,iy={chunkUploadHost:"https://wanproxy-web.127.net",commonUploadHost:"https://nos.netease.com",chunkMaxSize:4194304e4,commonMaxSize:104857600,uploadReplaceFormat:"https://{host}/{object}",cdn:{defaultCdnDomain:"nim.nosdn.127.net",cdnDomain:"",bucket:"",objectNamePrefix:""},downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHostList:["nos.netease.com"],nosCdnEnable:!0,isNeedToGetUploadPolicyFromServer:!0},sy={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}},cy={accessKeyId:"",secretAccessKey:"",sessionToken:"",region:"",maxRetries:0,bucket:"",objectName:"",token:"",shortUrl:""};function getUploadResponseFormat(t){return void 0===t&&(t="file"),gi(sy[t]||{}).replace(/"/gi,'\\"')}!function(t){t[t.nos=1]="nos",t[t.s3=2]="s3"}(ay||(ay={})),function(t){t[t.dontNeed=-1]="dontNeed",t[t.time=2]="time",t[t.urls=3]="urls"}(oy||(oy={}));var ly,uy,dy,py=/*#__PURE__*/function(){function CloudStorageService(t,a){void 0===a&&(a={}),this.GRAYKEY="AllGrayscaleConfig",this.MIXSTOREKEY="AllMixStorePolicy",this.config={},this.nosCdnHostTimer=0,this.grayConfig={mixStoreEnable:!1,timeStamp:0,ttl:0},this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.curProvider=ay.nos,this.s3=null,this.mixStoreErrorCount=10,this.nosErrorCount=0,this.circuitTimer=0,this.name="cloudStorage",this.logger=t.logger,this.core=t,registerParser({cmdMap:ey,cmdConfig:ny}),this.setOptions(a)}var t=CloudStorageService.prototype;return t.setOptions=function setOptions(t){void 0===t&&(t={});var a=t.storageKeyPrefix||"NIMClient";this.GRAYKEY=a+"-AllGrayscaleConfig",this.MIXSTOREKEY=a+"-AllMixStorePolicy";var o=t.s3,c=__rest(t,["s3"]),m=fi({},iy,this.config);if(c&&Object.prototype.hasOwnProperty.call(c,"cdn")){var h={cdn:fi(fi({},m.cdn),c.cdn)};this.config=fi({},m,c,h)}else this.config=fi({},m,c);o&&(this.s3=o)},t.init=function init(){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){return ci.wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:if(this.grayConfig=null,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.curProvider=ay.nos,this.mixStoreErrorCount=10,!this.config.isNeedToGetUploadPolicyFromServer){t.next=9;break}return t.next=7,this.getGrayscaleConfig(this.core.options.appkey);case 7:return t.next=9,this.getNosCdnHost();case 9:case"end":return t.stop()}}),_callee,this)})))},t.uploadFile=function uploadFile(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var a,o,c;return ci.wrap((function _callee2$(m){for(;;)switch(m.prev=m.next){case 0:if(validate({maxSize:{type:"number",required:!1},type:{type:"enum",values:["file","image","audio","video"]}},t),t.fileInput||t.file||t.filePath){m.next=3;break}throw new Error("uploadFile needs target file object or a filePath");case 3:if(!t.type||"file"===t.type){m.next=7;break}if("string"!=typeof(a=dd(t,"file.type"))||-1!==indexOf(a).call(a,t.type)){m.next=7;break}throw new Error('The meta type "'+a+'" does not match "'+t.type+'"');case 7:if(this.grayConfig&&this.grayConfig.mixStoreEnable&&this.mixStorePolicy.providers.length){m.next=10;break}return this.logger.log("uploadFile:: uploadFile begin, use old nos"),m.abrupt("return",this.nosUpload(t));case 10:return this.logger.log("uploadFile:: uploadFile begin,Current settings grayConfig mixStoreEnable:"+this.grayConfig.mixStoreEnable+" curProvider:"+this.curProvider),this.s3||(this.curProvider=ay.nos),o=cy,m.prev=13,m.next=16,this.core.sendCmd("getMixStoreToken",{mixStoreTokenReqTag:{provider:this.curProvider,tokenCount:1,tag:"qchat",returnBody:getUploadResponseFormat(t.type)}});case 16:c=m.sent,o=c.content.mixStoreTokenResTag,m.next=24;break;case 20:throw m.prev=20,m.t0=m.catch(13),this.core.logger.error("uploadFile:: getMixStoreToken error",m.t0),new ic("getMixStoreToken error",m.t0,this.curProvider,this.mixStorePolicy);case 24:return m.abrupt("return",this.curProvider===ay.s3?this.s3Upload(t,o):this.nosUpload(t,o));case 25:case"end":return m.stop()}}),_callee2,this,[[13,20]])})))},t.nosUpload=function nosUpload(t,a){var o,c;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var m,h,v,b,S,M,C,T,w,I,k,x,R;return ci.wrap((function _callee3$(E){for(;;)switch(E.prev=E.next){case 0:if(m=dd(this.core,"config.cdn.bucket"),h={tag:t.nosScenes||m||"nim",expireSec:t.nosSurvivalTime},a){E.next=13;break}return E.prev=3,E.next=6,this.core.sendCmd("getNosToken",{responseBody:getUploadResponseFormat(t.type),nosToken:h});case 6:v=E.sent,E.next=13;break;case 9:throw E.prev=9,E.t0=E.catch(3),this.core.logger.error("uploadFile:: getNosToken error",E.t0),new ic("getNosToken error",E.t0,1);case 13:return E.prev=13,S=v?v.content.nosToken:a,this.core.logger.debug("uploadFile:: uploadFile params",{nosToken:S,chunkUploadHost:this.config.chunkUploadHost,commonUploadHost:this.config.commonUploadHost,platform:pc.platform}),E.next=18,this.core.adapters.uploadFile(fi(fi({},t),{nosToken:S,chunkUploadHost:this.config.chunkUploadHost,commonUploadHost:this.config.commonUploadHost,maxSize:t.maxSize||this.config.chunkMaxSize}));case 18:b=E.sent,E.next=42;break;case 21:if(E.prev=21,E.t1=E.catch(13),this.core.logger.error("uploadFile::nos uploadFile error",E.t1),!a){E.next=41;break}if(0!==this.nosErrorCount){E.next=37;break}E.prev=26,this._addCircuitTimer(),E.next=33;break;case 30:throw E.prev=30,E.t2=E.catch(26),new ic("upload file error",E.t2,this.curProvider,this.mixStorePolicy,t.file||t.filePath);case 33:return this.nosErrorCount=null===(o=this.mixStorePolicy.nosPolicy)||void 0===o?void 0:o.uploadConfig.retryPolicy.retry,E.abrupt("return",this.uploadFile(t));case 37:return this.nosErrorCount--,E.abrupt("return",this.nosUpload(t,a));case 39:E.next=42;break;case 41:throw new ic("nos uploadFile error",E.t1,1);case 42:if(M=null==b?void 0:b.type,C=M&&indexOf(M).call(M,"/")>-1?slice(M).call(M,0,indexOf(M).call(M,"/")):"",T={image:"imageInfo",video:"vinfo",audio:"vinfo"},w=this.config.uploadReplaceFormat.replace("{host}",this.config.cdn.cdnDomain||this.config.cdn.defaultCdnDomain).replace("{object}",v?v.content.nosToken.objectName:null==a?void 0:a.objectName),a&&a.shortUrl&&(w=a.shortUrl),T[C]){E.next=49;break}return E.abrupt("return",fi({url:w},b));case 49:if(E.prev=49,!(indexOf(w).call(w,"_im_url=1")<0)){E.next=54;break}return E.next=53,this.core.adapters.request(w+"?"+T[C],{method:"GET",dataType:"json",timeout:5e3});case 53:I=E.sent;case 54:E.next=60;break;case 56:return E.prev=56,E.t3=E.catch(49),this.core.logger.error("uploadFile:: fetch file info error",E.t3),E.abrupt("return",fi({url:w},b));case 60:if(!I){E.next=67;break}return k=I.data,x="imageInfo"===T[C]?k:null===(c=null==k?void 0:k.GetVideoInfo)||void 0===c?void 0:c.VideoInfo,R={url:w,name:b.name,size:b.size,ext:b.ext,w:x.Width,h:x.Height,orientation:x.Orientation,dur:x.Duration,audioCodec:x.AudioCodec,videoCodec:x.VideoCodec,container:x.Container},E.abrupt("return",Zg(R,(function(t,a){return void 0!==a})));case 67:return E.abrupt("return",fi({url:w},b));case 68:case"end":return E.stop()}}),_callee3,this,[[3,9],[13,21],[26,30],[49,56]])})))},t.getNosCdnHost=function getNosCdnHost(){var t;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){var a,o,c,m=this;return ci.wrap((function _callee4$(h){for(;;)switch(h.prev=h.next){case 0:return h.prev=0,h.next=3,this.core.sendCmd("getNosCdnHost");case 3:a=h.sent,h.next=10;break;case 6:return h.prev=6,h.t0=h.catch(0),this.logger.error("getNosCdnHost::error",h.t0),h.abrupt("return");case 10:if(a){h.next=12;break}return h.abrupt("return");case 12:o=null===(t=null==a?void 0:a.content)||void 0===t?void 0:t.nosConfigTag,0!==(c=_u(null==o?void 0:o.expire))&&o.cdnDomain?-1===c?(this.config.cdn.bucket=o.bucket,this.config.cdn.cdnDomain=o.cdnDomain,this.config.cdn.objectNamePrefix=o.objectNamePrefix):(this.config.cdn.bucket=o.bucket,this.config.cdn.cdnDomain=o.cdnDomain,this.config.cdn.objectNamePrefix=o.objectNamePrefix,this.nosCdnHostTimer=this.core.timerManager.addTimer((function(){m.getNosCdnHost()}),1e3*c)):(this.config.cdn.bucket="",this.config.cdn.cdnDomain="",this.config.cdn.objectNamePrefix="");case 15:case"end":return h.stop()}}),_callee4,this,[[0,6]])})))},t.getGrayscaleConfig=function getGrayscaleConfig(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){var o,c;return ci.wrap((function _callee5$(m){for(;;)switch(m.prev=m.next){case 0:if(pc.localStorage)try{pc.localStorage.getItem&&pc.localStorage.getItem(this.GRAYKEY)&&(this.grayConfig=JSON.parse(pc.localStorage.getItem(this.GRAYKEY))[t])}catch(t){pc.localStorage.getItem(this.GRAYKEY)&&this.core.logger.error("uploadFile:: JSON.parse grayscaleConfig error ",t)}if(this.grayConfig&&!(this.grayConfig.timeStamp+1e3*this.grayConfig.ttl<(new Date).getTime())){m.next=17;break}return m.next=4,this.core.sendCmd("getGrayscaleConfig",{config:{}});case 4:if(!(o=m.sent).content||!o.content.grayConfigTag){m.next=16;break}this.logger.log("uploadFile::getAppGrayConfigRequest success ");try{this.grayConfig=JSON.parse(o.content.grayConfigTag.config),this.grayConfig.ttl=JSON.parse(o.content.grayConfigTag.ttl)}catch(t){this.logger.error("getGrayscaleConfig error",t)}if(this.grayConfig){m.next=10;break}return m.abrupt("return");case 10:c=pc.localStorage.getItem(this.GRAYKEY)?JSON.parse(pc.localStorage.getItem(this.GRAYKEY)):{},this.grayConfig.timeStamp=(new Date).getTime(),c[t]=this.grayConfig,pc.localStorage.setItem(this.GRAYKEY,gi(c)),m.next=17;break;case 16:this.logger.debug("uploadFile:: result grayConfig:",o.content);case 17:if(!(null===(a=this.grayConfig)||void 0===a?void 0:a.mixStoreEnable)){m.next=20;break}return m.next=20,this._getMixStorePolicy(t);case 20:case"end":return m.stop()}}),_callee5,this)})))},t._getMixStorePolicy=function _getMixStorePolicy(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){var a,o,c,m,h,v,b;return ci.wrap((function _callee6$(S){for(;;)switch(S.prev=S.next){case 0:if(a=(new Date).getTime(),pc.localStorage)try{this.mixStorePolicy=JSON.parse(pc.localStorage.getItem(this.MIXSTOREKEY))[t],this.curProvider=_u(this.mixStorePolicy.providers[0]),this.mixStorePolicy.timeStamp&&this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl>a&&(c=this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl-a,this.core.timerManager.addTimer(bind$1(o=this._getMixStorePolicy).call(o,this,t),c))}catch(a){pc.localStorage.getItem(this.MIXSTOREKEY)&&JSON.parse(pc.localStorage.getItem(this.MIXSTOREKEY))[t]&&this.core.logger.error("uploadFile:: JSON.parse mixStorePolicy error ",a)}if(this.mixStorePolicy&&!(this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl<=a)){S.next=30;break}return S.prev=3,S.next=6,this.core.sendCmd("getMixStorePolicy",{supportType:this.s3?[1,2]:[1]});case 6:h=S.sent,v=h.content.mixStorePolicyTag,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.mixStorePolicy.ttl=Number(v.ttl),this.mixStorePolicy.providers=v.providers.split(","),this.circuitTimer&&this.core.timerManager.deleteTimer(this.circuitTimer),this.curProvider=_u(this.mixStorePolicy.providers[0]),this.mixStorePolicy.nosPolicy=v.nosPolicy?JSON.parse(v.nosPolicy):null,this.mixStorePolicy.s3Policy=v.s3Policy?JSON.parse(v.s3Policy):null,null===this.mixStorePolicy.s3Policy?this.mixStorePolicy.providers=["1"]:null===this.mixStorePolicy.nosPolicy?this.mixStorePolicy.providers=["2"]:this.mixStorePolicy.providers=this.mixStorePolicy.s3Policy.priority<this.mixStorePolicy.nosPolicy.priority?["2","1"]:["1","2"],this.core.timerManager.addTimer(bind$1(m=this._getMixStorePolicy).call(m,this,t),1e3*this.mixStorePolicy.ttl),b=pc.localStorage.getItem(this.MIXSTOREKEY)?JSON.parse(pc.localStorage.getItem(this.MIXSTOREKEY)):{},this.mixStorePolicy.timeStamp=(new Date).getTime(),b[t]=this.mixStorePolicy,pc.localStorage.setItem(this.MIXSTOREKEY,gi(b)),S.next=30;break;case 23:if(S.prev=23,S.t0=S.catch(3),this.logger.error("getMixStorePolicy error",S.t0),0!==this.mixStoreErrorCount){S.next=28;break}throw new Error("getMixStorePolicy all count error");case 28:this._getMixStorePolicy(t),this.mixStoreErrorCount--;case 30:this.mixStorePolicy.nosPolicy&&(this.nosErrorCount=this.mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry);case 31:case"end":return S.stop()}}),_callee6,this,[[3,23]])})))},t.s3Upload=function s3Upload(t,a){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee7(){var o,c,m,h,v,b,S,M,C,T,w=this;return ci.wrap((function _callee7$(I){for(;;)switch(I.prev=I.next){case 0:if(!t.file){I.next=4;break}o=t.file,I.next=19;break;case 4:if("string"!=typeof t.fileInput){I.next=14;break}if(this.logger.warn("fileInput will abandon,Please use file or filepath"),!((c=document.getElementById(t.fileInput))&&c.files&&c.files[0])){I.next=11;break}o=c.files[0],I.next=12;break;case 11:throw new Error("Can not get file from fileInput");case 12:I.next=19;break;case 14:if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0])){I.next=18;break}o=t.fileInput.files[0],I.next=19;break;case 18:throw new Error("Can not get file from fileInput "+t.fileInput);case 19:if(this.mixStorePolicy.s3Policy){I.next=21;break}throw new Error("dont get s3 policy");case 21:return m={accessKeyId:a.accessKeyId,secretAccessKey:a.secretAccessKey,sessionToken:a.sessionToken,region:a.region,maxRetries:this.mixStorePolicy.s3Policy.uploadConfig.retryPolicy.retry},h=this.s3,(v=new h).config.update(m),b=decodeURIComponent(a.bucket),S=decodeURIComponent(a.objectName),C={Bucket:b,Key:S,Body:M=o,Metadata:{token:a.token},ContentType:M.type||"application/octet-stream"},this.core.logger.debug("uploadFile:: s3 upload params:",C),T=v.upload(C),I.abrupt("return",new zo((function(o){var c=(new Date).getTime();T.send((function(m,h){var v,b;if(m){w.logger.error("uploadFile:","api::s3:upload file failed",m),w.core.reporter.reportTraceStart("exceptions",{user_id:w.core.options.account,trace_id:null===(b=null===(v=w.core)||void 0===v?void 0:v.socket)||void 0===b?void 0:b.sessionId,start_time:c,action:1}),w.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof m.status?m.status:"number"==typeof m.code?m.code:0,description:m.message||""+m.code,operation_type:1,target:m.hostname}),w.core.reporter.reportTraceEnd("exceptions",1);try{w._addCircuitTimer()}catch(m){throw new ic("upload file error",m,w.curProvider,w.mixStorePolicy,t.file||t.filePath)}o(w.uploadFile(t))}else{var S=w.mixStorePolicy.s3Policy.cdnSchema;S=(S=S.replace("{cdnDomain}",w.mixStorePolicy.s3Policy.dlcdn)).replace("{objectName}",h.Key),o({size:M.size,name:M.name,url:a.shortUrl?a.shortUrl:S,ext:M.name.split(".")[1]||"unknown"})}}))})));case 32:case"end":return I.stop()}}),_callee7,this)})))},t.getPrivateUrl=function getPrivateUrl(t){var a;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(t))return this.logger.error("illegal file url:"+t),"";var o=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(t);o[0];var c=o[1];o[2];var m=o[3];o[4];var h=o[5];if(o[6],o[7],null===(a=this.grayConfig)||void 0===a?void 0:a.mixStoreEnable){var v=this._getUrlType(t);return v===ay.s3&&this.mixStorePolicy.s3Policy&&(t=this.mixStorePolicy.s3Policy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",h)),v===ay.nos&&this.mixStorePolicy.nosPolicy&&(t=this.mixStorePolicy.nosPolicy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",h)),t}var b=this.config,S=b.downloadUrl,M=b.downloadHostList,C=b.nosCdnEnable,T=this.config.cdn.cdnDomain,w=this.config.cdn.objectNamePrefix?decodeURIComponent(this.config.cdn.objectNamePrefix):"",I=decodeURIComponent(h),k=indexOf(I).call(I,w);if(T&&k>-1&&C)return""+c+T+"/"+slice(I).call(I,k);if(includes(M).call(M,m)&&includes(h).call(h,"/")){var x=indexOf(h).call(h,"/"),R=h.substring(0,x),E=h.substring(x+1);return S.replace("{bucket}",R).replace("{object}",E)}var A=filter(M).call(M,(function(t){return"string"==typeof m&&includes(m).call(m,t)}))[0],q=A?m.replace(A,"").replace(/\W/g,""):null;return q?S.replace("{bucket}",q).replace("{object}",h):t},t.getOriginUrl=function getOriginUrl(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee8(){var a;return ci.wrap((function _callee8$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.sendCmd("getOriginUrl",{nosSafeUrlTag:{safeUrl:t}});case 2:return a=o.sent,o.abrupt("return",a.content.nosSafeUrlTag.originUrl);case 4:case"end":return o.stop()}}),_callee8,this)})))},t.getFileToken=function getFileToken(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee9(){var a,o,c,m,h,v=this;return ci.wrap((function _callee9$(b){for(;;)switch(b.prev=b.next){case 0:if(validate({type:{type:"number",min:2,max:3},urls:{type:"array",required:!1,itemType:"string"}},t),a=this.mixStorePolicy.nosPolicy?this.mixStorePolicy.nosPolicy.authPolicy.policyType:null,o=this.mixStorePolicy.s3Policy?this.mixStorePolicy.s3Policy.authPolicy.policyType:null,a!==String(oy.dontNeed)||o!==String(oy.dontNeed)){b.next=8;break}throw this.logger.error("don't need token"),new Error("don't need token");case 8:if(t.type!==oy.time){b.next=17;break}if(!(a&&indexOf(a).call(a,String(oy.time))>=0||o&&indexOf(o).call(o,String(oy.time))>0)){b.next=13;break}return b.abrupt("return",this.getFileAuthToken(t));case 13:throw this.logger.error("don't support time token "),new Error("don't support type time token ");case 15:b.next=33;break;case 17:if(t.urls&&t.urls.length){b.next=20;break}throw this.logger.error("urls is required when urls token"),new Error("urls is required when urls token");case 20:if(m=[],h=[],forEach$1(c=t.urls).call(c,(function(t){var a=v._getUrlType(t);a===ay.nos&&h.push(t),a===ay.s3&&m.push(t)})),(!o||0!==m.length&&indexOf(o).call(o,String(oy.urls))<0)&&(this.logger.warn("s3 url don't support url token"),m=[]),(!a||0!==h.length&&indexOf(a).call(a,String(oy.urls))<0)&&(this.logger.warn("nos url don't support url token"),h=[]),0!==m.length||0!==h.length){b.next=30;break}throw this.logger.error("not support urls"),new Error("not support urls");case 30:if(0!==m.length&&0!==h.length){b.next=33;break}return t.urls=gi(t.urls),b.abrupt("return",this.getFileAuthToken(t));case 33:case"end":return b.stop()}}),_callee9,this)})))},t.getFileAuthToken=function getFileAuthToken(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee10(){var a;return ci.wrap((function _callee10$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.sendCmd("getFileAuthToken",{mixStoreAuthTokenReqTag:t});case 2:return a=o.sent,o.abrupt("return",a.content.mixStoreAuthTokenResTag);case 4:case"end":return o.stop()}}),_callee10,this)})))},t._getUrlType=function _getUrlType(t){var a,o;return this.mixStorePolicy.nosPolicy&&some(a=this.mixStorePolicy.nosPolicy.dlcdns).call(a,(function(a){return indexOf(t).call(t,a)>=0}))?ay.nos:this.mixStorePolicy.s3Policy&&some(o=this.mixStorePolicy.s3Policy.dlcdns).call(o,(function(a){return indexOf(t).call(t,a)>=0}))?ay.s3:null},t._addCircuitTimer=function _addCircuitTimer(){var t=this,a=this.mixStorePolicy.providers,o=a[(indexOf(a).call(a,String(this.curProvider))+1)%a.length];if(o===a[0])throw new Error("uploadFile all policy fail");var c=dd(this.mixStorePolicy,"s3Policy.uploadConfig.retryPolicy");if(c&&c.retryNext&&o&&(this.logger.log("uploadFile:: upload policy will change,now policy:"+this.curProvider+" nextProvider:"+o),this.curProvider=_u(o),this.mixStorePolicy.nosPolicy&&this.mixStorePolicy.s3Policy)){var m=this.mixStorePolicy[this.curProvider===ay.nos?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!m||0===m)return;this.circuitTimer=this.core.timerManager.addTimer((function(){t.logger.log("uploadFile:: upload policy will change,now policy:"+t.curProvider+" nextProvider:"+_u(t.mixStorePolicy.providers[0])),t.curProvider=_u(t.mixStorePolicy.providers[0]),t.core.timerManager.deleteTimer(t.circuitTimer)}),1e3*m)}},t.process=function process(t){var a=this[t.cmd+"Handler"];return"function"==typeof a?a.call(this,t):t.error&&!t.error.ignore?zo.reject(t.error):zo.resolve(t)},CloudStorageService}();!function(t){t[t.audio=1]="audio",t[t.video=2]="video",t[t.custom=3]="custom"}(ly||(ly={})),function(t){t[t.kClose=1]="kClose",t[t.kJoin=2]="kJoin",t[t.kInvite=3]="kInvite",t[t.kCancelInvite=4]="kCancelInvite",t[t.kReject=5]="kReject",t[t.kAccept=6]="kAccept",t[t.kLeave=7]="kLeave",t[t.kCustom=8]="kCustom"}(uy||(uy={})),function(t){t[t.kDefault=0]="kDefault",t[t.kLeave=1]="kLeave",t[t.kSelfSync=3]="kSelfSync"}(dy||(dy={}));var hy={"15_1":"signalingCreate","15_2":"signalingDelay","15_3":"signalingClose","15_4":"signalingJoin","15_5":"signalingLeave","15_6":"signalingInvite","15_7":"signalingCancelInvite","15_8":"signalingReject","15_9":"signalingAccept","15_10":"signalingSendCustomCommand","15_11":"signalingRecvNotification","15_12":"signalingMultiSyncNotification","15_13":"signalingSyncNotification","15_14":"singalingSyncChannels","15_15":"signalingQueryInfo","15_16":"signalingCallEx","15_17":"signalingJoinAndAccept"},fy={avSignalTag:{type:1,name:2,channelId:3,createTime:4,expireTime:5,creatorAccid:6,ext:7,invalid:8,fromAccid:10,toAccid:11,requestId:12,needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needBadge:17,members:18,attach:19,attachExt:20,needOffline:21,msgId:22,uid:23,time:24,nertcChannelName:25,nertcTokenTtl:26,nertcToken:27,nertcJoinRoomQueryParamMap:28,nertcJoinRoomResponse:29,callStatus:30}},gy=invertSerializeMap(fy),yy={signalingCreate:{sid:15,cid:1,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:fy.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:gy.avSignalTag}]},signalingDelay:{sid:15,cid:2,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:fy.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:gy.avSignalTag}]},signalingClose:{sid:15,cid:3,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:fy.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:gy.avSignalTag}]},signalingJoin:{sid:15,cid:4,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:fy.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:gy.avSignalTag}]},signalingLeave:{sid:15,cid:5,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:fy.avSignalTag}]},signalingInvite:{sid:15,cid:6,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:fy.avSignalTag}]},signalingCancelInvite:{sid:15,cid:7,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:fy.avSignalTag}]},signalingReject:{sid:15,cid:8,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:fy.avSignalTag}]},signalingAccept:{sid:15,cid:9,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:fy.avSignalTag}]},signalingSendCustomCommand:{sid:15,cid:10,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:fy.avSignalTag}]},signalingRecvNotification:{sid:15,cid:11,service:"signaling",response:[{type:"Property",name:"data",reflectMapper:gy.avSignalTag}]},signalingMultiSyncNotification:{sid:15,cid:12,service:"signaling",response:[{type:"Property",name:"data",reflectMapper:gy.avSignalTag}]},signalingSyncNotification:{sid:15,cid:13,service:"signaling",response:[{type:"PropertyArray",name:"datas",reflectMapper:gy.avSignalTag}]},singalingSyncChannels:{sid:15,cid:14,service:"signaling",response:[{type:"PropertyArray",name:"datas",reflectMapper:gy.avSignalTag}]},signalingQueryInfo:{sid:15,cid:15,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:fy.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:gy.avSignalTag}]},signalingCallEx:{sid:15,cid:16,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:fy.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:gy.avSignalTag}]},signalingJoinAndAccept:{sid:15,cid:17,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:fy.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:gy.avSignalTag}]},signalingBatchMarkRead:{sid:4,cid:5,isNoResponse:!0,service:"signaling",params:[{type:"byte",name:"sid"},{type:"byte",name:"cid"},{type:"LongArray",name:"ids"}]}},vy={type:{type:"number"},createTime:{type:"number"},expireTime:{type:"number"},invalid:{type:"boolean"},pushInfo:{needPush:{type:"boolean"},pushTitle:{type:"string"},pushContent:{type:"string"},pushPayload:{type:"string"},needBadge:{type:"boolean"}},pluginSetting:{nertcInfo:{nertcChannelName:{type:"string"},nertcTokenTtl:{type:"number"},nertcToken:{type:"string"},nertcJoinRoomQueryParamMap:{type:"string"},callStatus:{type:"number"}}},attach:{type:"object"},members:{type:"object"},needOffline:{type:"boolean"},uid:{type:"number"},time:{type:"number"}};function formatSignaling(t){var a,o=format(vy,t),c=[];o.members&&o.members.length>0&&(c=map(a=o.members).call(a,(function(t){return function formatSignalingChannelMember(t){return format(vy,deserialize(t,{1:"accid",2:"uid",3:"createTime",4:"expireTime"}))}(t)})),delete o.members);return c.length>0?{channelInfo:o,memberList:c}:{channelInfo:o}}function generateSignalingForCmd(t){return formatReverse(vy,t)}var by=function arrayEach(t,a){for(var o=-1,c=null==t?0:t.length;++o<c&&!1!==a(t[o],o,t););return t};var Sy=function copyObject(t,a,o,c){var m=!o;o||(o={});for(var h=-1,v=a.length;++h<v;){var b=a[h],S=c?c(o[b],t[b],b,o,t):void 0;void 0===S&&(S=t[b]),m?fm(o,b,S):ym(o,b,S)}return o};var My=function baseAssign(t,a){return t&&Sy(a,ep(a),t)};var Cy=function baseAssignIn(t,a){return t&&Sy(a,zg(a),t)},Ty=createCommonjsModule((function(t,a){var o=a&&!a.nodeType&&a,c=o&&t&&!t.nodeType&&t,m=c&&c.exports===o?hs.Buffer:void 0,h=m?m.allocUnsafe:void 0;t.exports=function cloneBuffer(t,a){if(a)return t.slice();var o=t.length,c=h?h(o):new t.constructor(o);return t.copy(c),c}}));var _y=function copyArray(t,a){var o=-1,c=t.length;for(a||(a=Array(c));++o<c;)a[o]=t[o];return a};var wy=function copySymbols(t,a){return Sy(t,xh(t),a)};var Iy=function copySymbolsIn(t,a){return Sy(t,Qg(t),a)},ky=Object.prototype.hasOwnProperty;var xy=function initCloneArray(t){var a=t.length,o=new t.constructor(a);return a&&"string"==typeof t[0]&&ky.call(t,"index")&&(o.index=t.index,o.input=t.input),o};var Ry=function cloneArrayBuffer(t){var a=new t.constructor(t.byteLength);return new yh(a).set(new yh(t)),a};var Ey=function cloneDataView(t,a){var o=a?Ry(t.buffer):t.buffer;return new t.constructor(o,t.byteOffset,t.byteLength)},Ay=/\w*$/;var qy=function cloneRegExp(t){var a=new t.constructor(t.source,Ay.exec(t));return a.lastIndex=t.lastIndex,a},Py=fs?fs.prototype:void 0,Oy=Py?Py.valueOf:void 0;var Uy=function cloneSymbol(t){return Oy?Object(Oy.call(t)):{}};var By=function cloneTypedArray(t,a){var o=a?Ry(t.buffer):t.buffer;return new t.constructor(o,t.byteOffset,t.length)};var Fy=function initCloneByTag(t,a,o){var c=t.constructor;switch(a){case"[object ArrayBuffer]":return Ry(t);case"[object Boolean]":case"[object Date]":return new c(+t);case"[object DataView]":return Ey(t,o);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return By(t,o);case"[object Map]":case"[object Set]":return new c;case"[object Number]":case"[object String]":return new c(t);case"[object RegExp]":return qy(t);case"[object Symbol]":return Uy(t)}},Ly=Object.create,jy=function(){function object(){}return function(t){if(!ws(t))return{};if(Ly)return Ly(t);object.prototype=t;var a=new object;return object.prototype=void 0,a}}();var Ny=function initCloneObject(t){return"function"!=typeof t.constructor||Jd(t)?{}:jy(Cd(t))};var Dy=function baseIsMap(t){return Pc(t)&&"[object Map]"==Dh(t)},$y=Bc&&Bc.isMap,Hy=$y?Uc($y):Dy;var Gy=function baseIsSet(t){return Pc(t)&&"[object Set]"==Dh(t)},Qy=Bc&&Bc.isSet,Wy=Qy?Uc(Qy):Gy,Vy={};Vy["[object Arguments]"]=Vy["[object Array]"]=Vy["[object ArrayBuffer]"]=Vy["[object DataView]"]=Vy["[object Boolean]"]=Vy["[object Date]"]=Vy["[object Float32Array]"]=Vy["[object Float64Array]"]=Vy["[object Int8Array]"]=Vy["[object Int16Array]"]=Vy["[object Int32Array]"]=Vy["[object Map]"]=Vy["[object Number]"]=Vy["[object Object]"]=Vy["[object RegExp]"]=Vy["[object Set]"]=Vy["[object String]"]=Vy["[object Symbol]"]=Vy["[object Uint8Array]"]=Vy["[object Uint8ClampedArray]"]=Vy["[object Uint16Array]"]=Vy["[object Uint32Array]"]=!0,Vy["[object Error]"]=Vy["[object Function]"]=Vy["[object WeakMap]"]=!1;var Ky=function baseClone(t,a,o,c,m,h){var v,b=1&a,S=2&a,M=4&a;if(o&&(v=m?o(t,c,m,h):o(t)),void 0!==v)return v;if(!ws(t))return t;var C=Ku(t);if(C){if(v=xy(t),!b)return _y(t,v)}else{var T=Dh(t),w="[object Function]"==T||"[object GeneratorFunction]"==T;if(Nd(t))return Ty(t,b);if("[object Object]"==T||"[object Arguments]"==T||w&&!m){if(v=S||w?{}:Ny(t),!b)return S?Iy(t,Cy(v,t)):wy(t,My(v,t))}else{if(!Vy[T])return m?t:{};v=Fy(t,T,b)}}h||(h=new hh);var I=h.get(t);if(I)return I;h.set(t,v),Wy(t)?t.forEach((function(c){v.add(baseClone(c,a,o,c,t,h))})):Hy(t)&&t.forEach((function(c,m){v.set(m,baseClone(c,a,o,m,t,h))}));var k=C?void 0:(M?S?Jg:Rh:S?zg:ep)(t);return by(k||t,(function(c,m){k&&(c=t[m=c]),ym(v,m,baseClone(c,a,o,m,t,h))})),v};var zy,Jy,Yy=function cloneDeep(t){return Ky(t,5)},Xy=/*#__PURE__*/function(t){function SignalingService(a){var o;return(o=t.call(this)||this).timer=0,o.pollingInterval=12e4,o.name="signaling",o.logger=a.logger,o.core=a,o.channels={},registerParser({cmdMap:hy,cmdConfig:yy}),o}Mt(SignalingService,t);var a=SignalingService.prototype;return a.callEx=function callEx(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var o,c,m,h;return ci.wrap((function _callee$(v){for(;;)switch(v.prev=v.next){case 0:return validate({type:{type:"number"},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},needOffline:{type:"boolean",required:!1},pushInfo:{type:"object",required:!1,rules:{needPush:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},needBadge:{type:"boolean",required:!1}}},pluginSetting:{type:"object",required:!1,rules:{nertcInfo:{type:"object",required:!1}}}},t),v.next=3,this.core.sendCmd("signalingCallEx",{tag:generateSignalingForCmd(t)});case 3:return o=v.sent,c=(null===(a=o.content)||void 0===a?void 0:a.data)||{},m=formatSignaling(c),this.channels[m.channelInfo.channelId]=Yy(m.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(bind$1(h=this.aotoDelay).call(h,this),this.pollingInterval,-1)),v.abrupt("return",m);case 9:case"end":return v.stop()}}),_callee,this)})))},a.joinAndAccept=function joinAndAccept(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var o,c,m,h,v,b;return ci.wrap((function _callee2$(S){for(;;)switch(S.prev=S.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},uid:{type:"number",required:!1},pluginSetting:{type:"object",required:!1,rules:{nertcInfo:{type:"object",required:!1}}}},t),o=t.fromAccid,(c=__rest(t,["fromAccid"])).toAccid=o,S.next=5,this.core.sendCmd("signalingJoinAndAccept",{tag:generateSignalingForCmd(c)});case 5:return m=S.sent,h=(null===(a=m.content)||void 0===a?void 0:a.data)||{},v=formatSignaling(h),this.channels[v.channelInfo.channelId]=Yy(v.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(bind$1(b=this.aotoDelay).call(b,this),this.pollingInterval,-1)),S.abrupt("return",v);case 11:case"end":return S.stop()}}),_callee2,this)})))},a.create=function create(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var o,c;return ci.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:return validate({type:{type:"number"},ext:{type:"string",required:!1}},t),m.next=3,this.core.sendCmd("signalingCreate",{tag:generateSignalingForCmd(t)});case 3:return o=m.sent,c=(null===(a=o.content)||void 0===a?void 0:a.data)||{},m.abrupt("return",formatSignaling(c));case 6:case"end":return m.stop()}}),_callee3,this)})))},a.close=function close(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){return ci.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},t),a.next=3,this.core.sendCmd("signalingClose",{tag:generateSignalingForCmd(t)});case 3:case"end":return a.stop()}}),_callee4,this)})))},a.queryInfo=function queryInfo(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){var o,c;return ci.wrap((function _callee5$(m){for(;;)switch(m.prev=m.next){case 0:return validate({name:{type:"string",allowEmpty:!1}},t),m.next=3,this.core.sendCmd("signalingQueryInfo",{tag:t});case 3:return o=m.sent,c=(null===(a=o.content)||void 0===a?void 0:a.data)||{},m.abrupt("return",formatSignaling(c));case 6:case"end":return m.stop()}}),_callee5,this)})))},a.join=function join(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){var o,c,m,h;return ci.wrap((function _callee6$(v){for(;;)switch(v.prev=v.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},uid:{type:"number",min:0,required:!1},needOffline:{type:"boolean",required:!1}},t),v.next=3,this.core.sendCmd("signalingJoin",{tag:generateSignalingForCmd(t)});case 3:return o=v.sent,c=(null===(a=o.content)||void 0===a?void 0:a.data)||{},m=formatSignaling(c),this.channels[m.channelInfo.channelId]=Yy(m.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(bind$1(h=this.aotoDelay).call(h,this),this.pollingInterval,-1)),v.abrupt("return",m);case 9:case"end":return v.stop()}}),_callee6,this)})))},a.aotoDelay=function aotoDelay(){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee7(){var t,a,o,c,m;return ci.wrap((function _callee7$(h){for(;;)switch(h.prev=h.next){case 0:if(0!==(t=ui(this.channels)).length){h.next=4;break}return this.timer&&this.core.timerManager.deleteTimer(this.timer),h.abrupt("return");case 4:this.logger.log("signling:autoDelay",t),a=0;case 6:if(!(a<t.length)){h.next=23;break}return o=t[a],h.prev=8,h.next=11,this.core.sendCmd("signalingDelay",{tag:{channelId:o}});case 11:c=h.sent,m=formatSignaling(c.content.data),this.channels[o]=m.channelInfo,h.next=20;break;case 16:h.prev=16,h.t0=h.catch(8),this.logger.warn("signling:autoDelay "+o+" failed",h.t0),delete this.channels[o];case 20:a++,h.next=6;break;case 23:case"end":return h.stop()}}),_callee7,this,[[8,16]])})))},a.leave=function leave(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee8(){return ci.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},t),a.next=3,this.core.sendCmd("signalingLeave",{tag:generateSignalingForCmd(t)});case 3:delete this.channels[t.channelId];case 4:case"end":return a.stop()}}),_callee8,this)})))},a.invite=function invite(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee9(){return ci.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},pushInfo:{type:"object",required:!1,rules:{needPush:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1},pushContent:{type:"string"},pushPayload:{type:"string",required:!1},needBadge:{type:"boolean",required:!1}}}},t),a.next=3,this.core.sendCmd("signalingInvite",{tag:generateSignalingForCmd(t)});case 3:case"end":return a.stop()}}),_callee9,this)})))},a.cancelInvite=function cancelInvite(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee10(){return ci.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},t),a.next=3,this.core.sendCmd("signalingCancelInvite",{tag:generateSignalingForCmd(t)});case 3:case"end":return a.stop()}}),_callee10,this)})))},a.reject=function reject(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee11(){var a,o;return ci.wrap((function _callee11$(c){for(;;)switch(c.prev=c.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},t),a=t.fromAccid,(o=__rest(t,["fromAccid"])).toAccid=a,c.next=5,this.core.sendCmd("signalingReject",{tag:generateSignalingForCmd(o)});case 5:case"end":return c.stop()}}),_callee11,this)})))},a.accept=function accept(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee12(){var a,o,c,m,h;return ci.wrap((function _callee12$(v){for(;;)switch(v.prev=v.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},autoJoin:{type:"boolean",required:!1},uid:{type:"number",min:0,required:!1},joinAttachExt:{type:"string",required:!1}},t),a=t.autoJoin,o=t.joinAttachExt,c=t.fromAccid,(m=__rest(t,["autoJoin","joinAttachExt","fromAccid"])).toAccid=c,v.next=5,this.core.sendCmd("signalingAccept",{tag:generateSignalingForCmd(m)});case 5:if(this.logger.log("Signaling:accept, accept success, autoJoin "+t.autoJoin),!a){v.next=10;break}return h={channelId:t.channelId,needOffline:t.needOffline,attachExt:o,uid:t.uid},v.next=10,this.join(h);case 10:case"end":return v.stop()}}),_callee12,this)})))},a.sendCustomCommand=function sendCustomCommand(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee13(){return ci.wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},attachExt:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("signalingSendCustomCommand",{tag:generateSignalingForCmd(t)});case 3:case"end":return a.stop()}}),_callee13,this)})))},a.signalingRecvNotificationHandler=function signalingRecvNotificationHandler(t){this.doNotify(t.content.data);var a=t.raw.r[0];a&&this.core.sendCmd("signalingBatchMarkRead",{sid:15,cid:11,ids:[a]})},a.signalingMultiSyncNotificationHandler=function signalingMultiSyncNotificationHandler(t){this.doNotify(t.content.data,dy.kSelfSync)},a.doNotify=function doNotify(t,a){void 0===a&&(a=dy.kDefault);var o=function formatSignalingNotification(t,a){void 0===a&&(a=dy.kDefault);var o=format(vy,t),c=o.attach,m=o.time,h=o.msgId;o.fromAccid,o.toAccid,o.members,o.requestId,o.pushInfo;var v=__rest(o,["attach","time","msgId","fromAccid","toAccid","members","requestId","pushInfo"]),b=c.type,S=o.ext;return delete o.attach,{metaData:{eventType:b,channelInfo:v,feature:a,ext:S,time:m,msgId:h},rawData:o}}(t,a),c=o.metaData,m=o.rawData,h=m.fromAccid,v=m.toAccid,b=m.members,S=m.requestId,M=m.pushInfo,C=m.msgId;switch(c.eventType){case uy.kClose:this.emit("signalingClose",{fromAccid:h,metaData:c});break;case uy.kJoin:this.emit("signalingJoin",{member:b,metaData:c});break;case uy.kInvite:this.emit("signalingInvite",{fromAccid:h,toAccid:v,requestId:S,pushInfo:M,metaData:c});break;case uy.kCancelInvite:this.emit("signalingCancelInvite",{fromAccid:h,toAccid:v,requestId:S,metaData:c});break;case uy.kReject:this.emit("signalingReject",{toAccid:v,requestId:S,metaData:c});break;case uy.kAccept:this.emit("signalingAccept",{toAccid:v,requestId:S,metaData:c});break;case uy.kLeave:this.emit("signalingLeave",{fromAccid:h,metaData:c});break;case uy.kCustom:this.emit("signalingCustomCommand",{fromAccid:h,metaData:c});break;default:this.logger.warn("signaling:notification, no such a type "+c.eventType,m)}return C},a.signalingSyncNotificationHandler=function signalingSyncNotificationHandler(t){var a,o,c=this;if(t.content.datas&&t.content.datas.length>0){var m=filter(a=map(o=t.content.datas).call(o,(function(t){return c.doNotify(t)}))).call(a,(function(t){return t}));m.length>0&&this.core.sendCmd("signalingBatchMarkRead",{sid:15,cid:11,ids:m})}},a.singalingSyncChannelsHandler=function singalingSyncChannelsHandler(t){var a;if(this.timer=0,this.channels={},t.content.datas&&t.content.datas.length>0){var o=map(a=t.content.datas).call(a,(function(t){return formatSignaling(t)}));this.emit("singalingSyncChannels",o)}},a.process=function process(t){var a=this[t.cmd+"Handler"];return"function"==typeof a?(a.call(this,t),zo.resolve(t)):t.error&&!t.error.ignore?zo.reject(t.error):zo.resolve(t)},SignalingService}(us.EventEmitter);function formatChatroom(t){var a=fi({},t),o=["announcement","broadcastUrl","ext"],c=["createTime","updateTime","onlineMemberNum"],m=["mute"];return forEach$1(o).call(o,(function(t){void 0===a[t]&&(a[t]="")})),forEach$1(c).call(c,(function(t){void 0!==a[t]&&(a[t]=_u(a[t]))})),forEach$1(m).call(m,(function(t){void 0!==a[t]&&(a[t]=1===_u(a[t]))})),a}!function(t){t[t.Android=1]="Android",t[t.iOS=2]="iOS",t[t.PC=4]="PC",t[t.WindowsPhone=8]="WindowsPhone",t[t.Web=16]="Web",t[t.Server=32]="Server",t[t.Mac=64]="Mac"}(zy||(zy={})),function(t){t[t.text=0]="text",t[t.image=1]="image",t[t.audio=2]="audio",t[t.video=3]="video",t[t.geo=4]="geo",t[t.notification=5]="notification",t[t.file=6]="file",t[t.tip=10]="tip",t[t.robot=11]="robot",t[t.g2=12]="g2",t[t.custom=100]="custom"}(Jy||(Jy={}));var Zy=ip({unset:"-2",restricted:"-1",common:"0",owner:"1",manager:"2",guest:"3",anonymous:"4"});function formatChatroomMember(t){var a,o=fi({},t),c=["chatroomId"],m=["level","enterTime","updateTime","tempMuteDuration"],h=["online","guest","blacked","muted","valid","tempMuted"],v={tempMuted:!1,tempMuteDuration:0};return forEach$1(a=ui(v)).call(a,(function(t){o[t]=o[t]||v[t]})),forEach$1(c).call(c,(function(t){void 0!==o[t]&&(o[t]=o[t].toString())})),forEach$1(m).call(m,(function(t){void 0!==o[t]&&(o[t]=_u(o[t]))})),forEach$1(h).call(h,(function(t){void 0!==o[t]&&(o[t]=1===_u(o[t]))})),void 0!==o.type&&(o.type=Zy[o.type]),o.avatar,o.online||delete o.enterTime,o.guest&&(o.type="guest",delete o.valid,delete o.guest),"common"!==o.type&&delete o.level,o}function formatChatroomMembers(t){return t&&t.length>0?map(t).call(t,(function(t){return formatChatroomMember(t)})):[]}function generatorMsgForCmd$1(t,a,o){t.onSendBefore;var c=__rest(t,["onSendBefore"]),m=["subType"],h=["body","antiSpamContent","antiSpamBusinessId","ext"],v=["resend","needAntiSpam","antiSpamUsingYidun","skipHistory","highPriority","clientAntiSpam"];return t.resend||(c.idClient=wu()),c.type=Jy[t.type],c.from=a,c.fromClientType=16,c.fromDeviceId=o,c.status=c.status||"sending",forEach$1(v).call(v,(function(a){void 0!==t[a]&&(c[a]=t[a]?1:0)})),forEach$1(m).call(m,(function(a){void 0!==t[a]&&(c[a]=_u(t[a]))})),forEach$1(h).call(h,(function(a){void 0!==t[a]&&(c[a]="string"==typeof t[a]?t[a]:gi(t[a]))})),c}var ev={301:"memberEnter",302:"memberExit",303:"blackMember",304:"unblackMember",305:"gagMember",306:"ungagMember",307:"addManager",308:"removeManager",309:"addCommon",310:"removeCommon",311:"closeChatroom",312:"updateChatroom",313:"kickMember",314:"addTempMute",315:"removeTempMute",316:"updateMemberInfo",317:"updateQueue",318:"muteRoom",319:"unmuteRoom",320:"batchUpdateQueue",321:"addTempMuteTag",322:"removeTempMuteTag",323:"deleteChatroomMsg",325:"updateChatroomTags"};function formatChatroomMsg(t,a){t.onUploadDone,t.onUploadProgress,t.onUploadStart;var o=__rest(t,["onUploadDone","onUploadProgress","onUploadStart"]),c=["time","userUpdateTime"],m=["resend","needAntiSpam","antiSpamUsingYidun","skipHistory","highPriority","clientAntiSpam"];if(forEach$1(c).call(c,(function(t){void 0!==o[t]&&(o[t]=_u(o[t]))})),forEach$1(m).call(m,(function(t){void 0!==o[t]&&(o[t]=1===_u(o[t]))})),o.type=getEnumKeyByEnumValue(Jy,o.type),o.fromClientType=getEnumKeyByEnumValue(zy,o.fromClientType),o.flow=o.from===a?"out":"in",o.status=o.status||"success","string"==typeof o.body)try{o.body=JSON.parse(o.body)}catch(t){}return"notification"===o.type&&(o.attach=o.body?function formatNotificationBody(t){var a,o={};if(o.type=ev[t.id]||t.id,!t.data)return t;o=fi(o,t.data);var c={operator:"from",opeNick:"fromNick",target:"to",tarNick:"toNick"};forEach$1(a=ui(c)).call(a,(function(t){void 0!==o[t]&&(o[c[t]]=o[t],delete o[t])}));var m=["muteDuration"];if(forEach$1(m).call(m,(function(t){void 0!==o[t]&&(o[t]=_u(o[t]))})),!o.queueChange)return o;var h={};try{h=JSON.parse(o.queueChange)}catch(t){return o}switch(h._e){case"OFFER":h={type:"OFFER",elementKey:h.key,elementValue:h.content};break;case"POLL":h={type:"POLL",elementKey:h.key,elementValue:h.content};break;case"DROP":h={type:"DROP"};break;case"PARTCLEAR":case"BATCH_UPDATE":h={type:h._e,elementKv:h.kvObject}}return o.queueChange=h,o}(o.body):{},o.body=""),o}function formatChatroomMsgs(t,a){return t&&t.length>0?map(t).call(t,(function(t){return formatChatroomMsg(t,a)})):[]}var tv={1:{code:"chatroomClosed",message:"Chatroom is closed"},2:{code:"managerKick",message:"Kicked out by owners or administrators"},3:{code:"samePlatformKick",message:"The same account is not allowed to multiple login at the same time"},4:{code:"silentlyKick",message:"Quietly kicked"},5:{code:"blacked",message:"Was blacklisted"}};var rv,nv=/*#__PURE__*/function(){function Service(t,a){this.name=t,this.core=a,this.name=t,this.logger=a.logger,this.core=a}return Service.prototype.process=function process(t){var a=this[t.cmd+"Handler"];return"function"==typeof a?a.call(this,t):t.error&&!t.error.ignore?zo.reject(t.error):zo.resolve(t)},Service}(),av=/*#__PURE__*/function(t){function ChatroomService(a){return t.call(this,"chatroom",a)||this}Mt(ChatroomService,t);var a=ChatroomService.prototype;return a.getInfo=function getInfo(){var t;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var a;return ci.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.sendCmd("getChatroom");case 2:return a=o.sent,o.abrupt("return",formatChatroom(null===(t=a.content)||void 0===t?void 0:t.chatroom));case 4:case"end":return o.stop()}}),_callee,this)})))},a.updateInfo=function updateInfo(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){return ci.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({chatroom:{type:"object",rules:{name:{type:"string",required:!1},announcement:{type:"string",required:!1},broadcastUrl:{type:"string",required:!1},ext:{type:"string",required:!1},queuelevel:{type:"number",min:0,max:1,required:!1}}},needNotify:{type:"boolean"},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("updateChatroom",fi(fi({},t),{ext:t.ext||""}));case 3:case"end":return a.stop()}}),_callee2,this)})))},a.beKickedFromChatroomHandler=function beKickedFromChatroomHandler(t){var a=t.content,o=a.reason,c=a.ext,m=function formatKickedReason(t){var a=tv[t];return{reason:a?a.code:"unknow",message:a?a.message:"Unknown reason"}}(o);this.logger.warn("beKickedFromChatroomHandler:: ",m.reason,m.message,c),this.core.doDisconnect(ju.KICKED,m)},a.updateChatroomTagHandler=function updateChatroomTagHandler(t){var a,o=t.content;this.logger.log("updateChatroomTagHandler:: ",o);var c=null===(a=null==o?void 0:o.updateTags)||void 0===a?void 0:a.currentTags;try{c=JSON.parse(c)}catch(t){this.logger.error("updateChatroomTagHandler:: ",t)}this.core.emit("tagsUpdate",c)},ChatroomService}(nv),ov=/*#__PURE__*/function(t){function ChatroomMsgService(a){return t.call(this,"chatroomMsg",a)||this}Mt(ChatroomMsgService,t);var a=ChatroomMsgService.prototype;return a.sendTextMsg=function sendTextMsg(t){return validate({body:{type:"string",allowEmpty:!1}},t),this.sendMsg(fi(fi({},t),{type:"text"}))},a.sendGeoLocationMsg=function sendGeoLocationMsg(t){return validate({body:{type:"object",rules:{title:{type:"string",allowEmpty:!1},lat:{type:"number"},lng:{type:"number"}}}},t),this.sendMsg(fi(fi({},t),{type:"geo",body:gi(t.body)}))},a.sendTipMsg=function sendTipMsg(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){return ci.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return validate({body:{type:"string",allowEmpty:!1}},t),a.abrupt("return",this.sendMsg(fi(fi({},t),{type:"tip"})));case 2:case"end":return a.stop()}}),_callee,this)})))},a.sendCustomMsg=function sendCustomMsg(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){return ci.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({body:{type:"string",allowEmpty:!1}},t),a.abrupt("return",this.sendMsg(fi(fi({},t),{type:"custom"})));case 2:case"end":return a.stop()}}),_callee2,this)})))},a.sendImageMsg=function sendImageMsg(t){return this.doSendFile(fi(fi({},t),{type:"image"}))},a.sendFileMsg=function sendFileMsg(t){return this.doSendFile(fi(fi({},t),{type:"file"}))},a.sendAudioMsg=function sendAudioMsg(t){return this.doSendFile(fi(fi({},t),{type:"audio"}))},a.sendVideoMsg=function sendVideoMsg(t){return this.doSendFile(fi(fi({},t),{type:"video"}))},a.doSendFile=function doSendFile(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var a;return ci.wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:if(validate({type:{type:"string",allowEmpty:!1},body:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},t),a=t.body){o.next=27;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){o.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return o.prev=5,this.core.reporter.reportTraceStart("nos",{user_id:this.core.account,action:"upload"}),o.next=9,this.core.cloudStorage.uploadFile(t);case 9:a=o.sent,this.core.reporter.reportTraceEnd("nos",!0),o.next=19;break;case 13:throw o.prev=13,o.t0=o.catch(5),this.core.reporter.reportTraceUpdate("nos",{operation_type:"transfer",error:o.t0},!1),this.core.reporter.reportTraceEnd("nos",!1),this.logger.error("sendFile:: upload File error or abort",o.t0),o.t0;case 19:o.prev=19,t.onUploadDone&&t.onUploadDone(a),o.next=27;break;case 23:throw o.prev=23,o.t1=o.catch(19),this.logger.error("sendFile options.onUploadDone err",o.t1),o.t1;case 27:return o.abrupt("return",this.sendMsg(fi(fi({},t),{body:gi(a),type:t.type})));case 28:case"end":return o.stop()}}),_callee3,this,[[5,13],[19,23]])})))},a.queryMessageHistory=function queryMessageHistory(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){var a,o,c;return ci.wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:return validate({timetag:{type:"number",required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1},msgTypes:{type:"array",itemType:"string",required:!1}},t),m.next=3,this.core.sendCmd("chatroomQueryMessageHistory",fi(fi({timetag:0,limit:100,reverse:!1},t),{msgTypes:t.msgTypes?map(a=t.msgTypes).call(a,(function(t){return Jy[t]})):[]}));case 3:return o=m.sent,c=o.content.chatroomMsgs,m.abrupt("return",formatChatroomMsgs(c,this.core.account));case 6:case"end":return m.stop()}}),_callee4,this)})))},a.getHistoryMsgsByTags=function getHistoryMsgsByTags(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){var a,o,c,m,h;return ci.wrap((function _callee5$(v){for(;;)switch(v.prev=v.next){case 0:return validate({tags:{type:"array",itemType:"string",required:!0},types:{type:"array",itemType:"string",required:!1},fromTime:{type:"number",min:0,required:!1},toTime:{type:"number",min:0,required:!1},limit:{type:"number",min:0,required:!1},reverse:{type:"number",required:!1}},t),c=fi(fi({fromTime:0,toTime:0,limit:100,reverse:0},t),{types:t.types?map(a=filter(o=t.types).call(o,(function(t){return void 0!==Jy[t]}))).call(a,(function(t){return Jy[t]})):[]}),v.next=4,this.core.sendCmd("getHistoryMsgsByTags",{chatRoomTagHistoryMsgRequestTag:fi(c,{tags:gi(c.tags),types:gi(c.types)})});case 4:return m=v.sent,h=m.content.chatroomMsgs,v.abrupt("return",formatChatroomMsgs(h,this.core.account));case 7:case"end":return v.stop()}}),_callee5,this)})))},a.onChatroomMsgHandler=function onChatroomMsgHandler(t){var a=t.content,o=os(),c=formatChatroomMsg(null==a?void 0:a.chatroomMsg,this.core.account);if("debug"===this.core.options.debugLevel?this.logger.debug("onChatroomMsgHandler::recvMsg",c.type,c.idClient,c):this.logger.log("onChatroomMsgHandler::recvMsg",c.type,c.idClient),this.core.emit("chatroomMsg",c),"out"!==c.flow){var m={msgId:"",clientId:c.idClient,receiveTime:t.__receiveTime,serverTime:c.time,callbackTime:os(),preHandleTime:o,fromAccid:c.from,toAccid:this.core.account,type:4,roomId:c.chatroomId,tid:"",result:200,failReason:"",rt:os()-c.time};this.core.reporter.report("msgReceive",m,!0)}},a.sendMsg=function sendMsg(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){var a,o,c,m,h;return ci.wrap((function _callee6$(v){for(;;)switch(v.prev=v.next){case 0:validate({type:{type:"enum",values:getEnumKeys(Jy)},subType:{type:"number",min:1,required:!1}},t),a=generatorMsgForCmd$1(t,this.core.account,this.core.config.deviceId),o=formatChatroomMsg(fi(fi({},a),{status:"sending",time:(new Date).getTime()}),this.core.account);try{t.onSendBefore&&t.onSendBefore(o)}catch(t){this.core.logger.error("sendMsg: options.onSendBefore error",t)}return v.prev=4,v.next=7,this.core.sendCmd("sendChatroomMsg",{chatroomMsg:a});case 7:return c=v.sent,m=formatChatroomMsg(fi(fi(fi({},a),c.content.chatroomMsg),{status:"success"}),this.core.account),this.core.reporter.report("msgSend",{msgId:"",clientId:m.idClient,msgTime:m.time,fromAccid:this.core.account,toAccid:"",type:4,roomId:m.chatroomId,tid:"",result:200,faiReason:"",rt:os()-o.time}),v.abrupt("return",m);case 13:throw v.prev=13,v.t0=v.catch(4),h=formatChatroomMsg(fi(fi({},a),{status:"fail"}),this.core.account),v.t0.msg=h,this.core.reporter.report("msgSend",{msgId:"",clientId:h.idClient,fromAccid:this.core.account,toAccid:"",type:4,roomId:h.chatroomId,tid:"",result:null===v.t0||void 0===v.t0?void 0:v.t0.code,faiReason:(null===v.t0||void 0===v.t0?void 0:v.t0.message)||"",rt:os()-a.time}),v.t0;case 19:case"end":return v.stop()}}),_callee6,this,[[4,13]])})))},ChatroomMsgService}(nv);!function(t){t[t.regular=0]="regular",t[t.temp=1]="temp",t[t.regularOnline=2]="regularOnline",t[t.regularReverse=3]="regularReverse"}(rv||(rv={}));var iv,sv,cv,lv=/*#__PURE__*/function(t){function ChatroomMemberService(a){return t.call(this,"chatroomMember",a)||this}Mt(ChatroomMemberService,t);var a=ChatroomMemberService.prototype;return a.updateMyRoomRole=function updateMyRoomRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){return ci.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return validate({member:{type:"object",rules:{nick:{type:"string",required:!1},avatar:{type:"string",required:!1},ext:{type:"string",required:!1}}},needNotify:{type:"boolean"},ext:{type:"string",required:!1},needSave:{type:"boolean",required:!1}},t),a.next=3,this.core.sendCmd("chatroomUpdateMyRoomRole",fi(fi({},t),{chatroomMember:t.member,ext:t.ext||""}));case 3:case"end":return a.stop()}}),_callee,this)})))},a.setMemberManager=function setMemberManager(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){return ci.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.markChatroomMember(fi(fi({},t),{type:1}));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee2,this)})))},a.setMemberNormal=function setMemberNormal(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){return ci.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.markChatroomMember(fi(fi({},t),{type:2}));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee3,this)})))},a.setMemberMute=function setMemberMute(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){return ci.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.markChatroomMember(fi(fi({},t),{type:-2}));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee4,this)})))},a.setMemberBlackList=function setMemberBlackList(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){return ci.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.markChatroomMember(fi(fi({},t),{type:-1}));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee5,this)})))},a.queryMembers=function queryMembers(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){var o;return ci.wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:return validate({type:{type:"enum",values:getEnumKeys(rv)},time:{type:"number",required:!1},limit:{type:"number",required:!1}},t),c.next=3,this.core.sendCmd("chatroomQueryMembers",fi(fi({time:0,limit:100},t),{type:rv[t.type]}));case 3:return o=c.sent,c.abrupt("return",formatChatroomMembers(null===(a=o.content)||void 0===a?void 0:a.members));case 5:case"end":return c.stop()}}),_callee6,this)})))},a.queryMembersByAccounts=function queryMembersByAccounts(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee7(){var o;return ci.wrap((function _callee7$(c){for(;;)switch(c.prev=c.next){case 0:return validate({accounts:{type:"array",min:1,max:20,itemType:"string"}},t),c.next=3,this.core.sendCmd("chatroomQueryMembersByAccounts",t);case 3:return o=c.sent,c.abrupt("return",formatChatroomMembers(null===(a=o.content)||void 0===a?void 0:a.members));case 5:case"end":return c.stop()}}),_callee7,this)})))},a.setMemberTempMute=function setMemberTempMute(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee8(){return ci.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return validate({account:{type:"string",allowEmpty:!1},duration:{type:"number",min:0},needNotify:{type:"boolean",required:!1},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("chatroomSetMemberTempMute",fi(fi({},t),{ext:t.ext||""}));case 3:case"end":return a.stop()}}),_callee8,this)})))},a.kickMember=function kickMember(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee9(){return ci.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({account:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("chatroomKickMember",fi(fi({},t),{ext:t.ext||""}));case 3:case"end":return a.stop()}}),_callee9,this)})))},a.queryMembersCountByTag=function queryMembersCountByTag(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee10(){var a;return ci.wrap((function _callee10$(o){for(;;)switch(o.prev=o.next){case 0:return validate({tag:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("chatroomQueryMembersCountByTag",fi({},t));case 3:return a=o.sent,o.abrupt("return",a.content.count);case 5:case"end":return o.stop()}}),_callee10,this)})))},a.queryMembersByTag=function queryMembersByTag(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee11(){var o;return ci.wrap((function _callee11$(c){for(;;)switch(c.prev=c.next){case 0:return validate({tag:{type:"string",allowEmpty:!1},time:{type:"number",required:!1},limit:{type:"number",max:100,required:!1}},t),c.next=3,this.core.sendCmd("chatroomQueryMembersByTag",{chatroomTagMemberReq:fi({time:0,limit:100},t)});case 3:return o=c.sent,c.abrupt("return",formatChatroomMembers(null===(a=o.content)||void 0===a?void 0:a.members));case 5:case"end":return c.stop()}}),_callee11,this)})))},a.setMembersTempMuteByTag=function setMembersTempMuteByTag(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee12(){return ci.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return validate({tag:{type:"string",allowEmpty:!1},duration:{type:"number",min:0},needNotify:{type:"boolean"},notifyTargetTags:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("chatroomSetMembersTempMuteByTag",{chatroomTagMuteReq:fi(fi({},t),{needNotify:t.needNotify?1:0,ext:t.ext||""})});case 3:case"end":return a.stop()}}),_callee12,this)})))},a.markChatroomMember=function markChatroomMember(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee13(){var o;return ci.wrap((function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:return validate({account:{type:"string"},isAdd:{type:"boolean"},ext:{type:"string",required:!1},level:{type:"number",required:!1}},t),c.next=3,this.core.sendCmd("markChatroomMember",fi(fi({level:0},t),{ext:t.ext||""}));case 3:return o=c.sent,c.abrupt("return",formatChatroomMember(null===(a=o.content)||void 0===a?void 0:a.chatroomMember));case 5:case"end":return c.stop()}}),_callee13,this)})))},ChatroomMemberService}(nv),uv=/*#__PURE__*/function(t){function ChatroomQueueService(a){return t.call(this,"chatroomQueue",a)||this}Mt(ChatroomQueueService,t);var a=ChatroomQueueService.prototype;return a.init=function init(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){return ci.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return validate({maxItemCount:{type:"number",min:0,max:1e3}},t),a.next=3,this.core.sendCmd("chatroomQueueInit",t);case 3:case"end":return a.stop()}}),_callee,this)})))},a.update=function update(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){return ci.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({elementKey:{type:"string",allowEmpty:!1},elementValue:{type:"string",max:4096,allowEmpty:!1},transient:{type:"boolean",required:!1},account:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("chatroomQueueOffer",fi(fi({},t),{transient:!!t.transient}));case 3:case"end":return a.stop()}}),_callee2,this)})))},a.poll=function poll(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var a;return ci.wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return validate({key:{type:"string",required:!1}},t),t.key||(t.key=""),o.next=4,this.core.sendCmd("chatroomQueuePoll",t||{});case 4:return a=o.sent,o.abrupt("return",a.content);case 6:case"end":return o.stop()}}),_callee3,this)})))},a.batchUpdate=function batchUpdate(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){var a;return ci.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return validate({itemList:{type:"object"},needNotify:{type:"boolean",required:!1},notifyExtension:{type:"string",required:!1}},t),o.next=3,this.core.sendCmd("chatroomQueueChange",fi(fi({},t),{needNotify:!!t.needNotify}));case 3:return a=o.sent,o.abrupt("return",a.content.invalidKeyList);case 5:case"end":return o.stop()}}),_callee4,this)})))},a.fetch=function fetch(){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){var t;return ci.wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("chatroomQueueList");case 2:return t=a.sent,a.abrupt("return",t.content.itemList);case 4:case"end":return a.stop()}}),_callee5,this)})))},a.pickHeader=function pickHeader(){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){var t,a,o,c;return ci.wrap((function _callee6$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("chatroomQueuePeak");case 2:return a=m.sent,o=a.content.elementKey,c=a.content.elementValue,m.abrupt("return",((t={})[o]=c,t));case 6:case"end":return m.stop()}}),_callee6,this)})))},a.clear=function clear(){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee7(){return ci.wrap((function _callee7$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("chatroomQueueDrop");case 2:case"end":return t.stop()}}),_callee7,this)})))},ChatroomQueueService}(nv),dv={"1_2":"heartbeat","13_2":"chatroomLogin","13_3":"beKickedFromChatroom","13_4":"chatroomExit","13_6":"sendChatroomMsg","13_7":"onChatroomMsg","13_8":"chatroomQueryMembers","13_9":"chatroomQueryMessageHistory","13_11":"markChatroomMember","13_12":"closeChatroom","13_13":"getChatroom","13_14":"updateChatroom","13_15":"chatroomUpdateMyRoomRole","13_16":"chatroomQueryMembersByAccounts","13_17":"chatroomKickMember","13_19":"chatroomSetMemberTempMute","13_20":"chatroomQueueOffer","13_21":"chatroomQueuePoll","13_22":"chatroomQueueList","13_23":"chatroomQueuePeak","13_24":"chatroomQueueDrop","13_25":"chatroomQueueInit","13_26":"chatroomQueueChange","13_30":"chatroomSetMembersTempMuteByTag","13_31":"chatroomQueryMembersByTag","13_32":"chatroomQueryMembersCountByTag","13_36":"getHistoryMsgsByTags","13_101":"updateChatroomTag"},pv={chatroomLogin:{appkey:1,account:2,deviceId:3,chatroomId:5,appLogin:8,chatroomNick:20,chatroomAvatar:21,chatroomExt:22,chatroomEnterExt:23,session:26,isAnonymous:38,tags:39,notifyTargetTags:40,authType:41,loginExt:42},chatroomIMLogin:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appkey:18,account:19,browser:24,session:26,deviceInfo:32,token:1e3,customTag:38,customClientType:39,sdkHumanVersion:40,sdkType:41,userAgent:42,isReactNative:112,authType:115,loginExt:116},chatroomMsg:{idClient:1,type:2,body:3,ext:4,resend:5,userUpdateTime:6,fromNick:7,fromAvatar:8,fromExt:9,needAntiSpam:10,antiSpamContent:11,skipHistory:12,messageBody:13,antiSpamBusinessId:14,clientAntiSpam:15,antiSpamUsingYidun:16,time:20,from:21,chatroomId:22,fromClientType:23,highPriority:25,callbackExt:27,subType:28,yidunAntiCheating:29,env:30,notifyTargetTags:31,yidunAntiSpamExt:32,yidunAntiSpamRes:33},chatroom:{id:1,name:3,announcement:4,broadcastUrl:5,ext:12,createTime:14,updateTime:15,queuelevel:16,creator:100,onlineMemberNum:101,mute:102},chatroomMember:{chatroomId:1,account:2,type:3,level:4,nick:5,avatar:6,ext:7,online:8,guest:9,enterTime:10,blacked:12,muted:13,valid:14,updateTime:15,tempMuted:16,tempMuteDuration:17},chatroomTagMemberReq:{tag:1,time:2,limit:3},chatroomTagMuteReq:{tag:1,duration:2,needNotify:3,ext:4,notifyTargetTags:5},chatroomCdnInfo:{enable:1,cdnUrls:2,timestamp:3,interval:4,decryptType:5,decryptKey:6,timeout:7},chatRoomTagHistoryMsgRequestTag:{tags:1,types:2,fromTime:3,toTime:4,limit:5,reverse:6},updateTags:{currentTags:1}},mv=invertSerializeMap(pv),hv={heartbeat:{sid:1,cid:2,service:"chatroom"},chatroomLogin:{sid:13,cid:2,service:"chatroom",params:[{type:"Byte",name:"type"},{type:"Property",name:"chatroomLogin",reflectMapper:pv.chatroomLogin},{type:"Property",name:"chatroomIMLogin",reflectMapper:pv.chatroomIMLogin}],response:[{type:"Property",name:"chatroom",reflectMapper:mv.chatroom},{type:"Property",name:"chatroomMember",reflectMapper:mv.chatroomMember},{type:"Property",name:"chatroomCdnInfo",reflectMapper:mv.chatroomCdnInfo}]},chatroomExit:{sid:13,cid:4,service:"chatroom"},sendChatroomMsg:{sid:13,cid:6,service:"chatroomMsg",params:[{type:"Property",name:"chatroomMsg",reflectMapper:pv.chatroomMsg}],response:[{type:"Property",name:"chatroomMsg",reflectMapper:mv.chatroomMsg}]},chatroomQueryMessageHistory:{sid:13,cid:9,service:"chatroomMsg",params:[{type:"Long",name:"timetag"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"chatroomMsgs",reflectMapper:mv.chatroomMsg}]},getHistoryMsgsByTags:{sid:13,cid:36,service:"chatroomMsg",params:[{type:"Property",name:"chatRoomTagHistoryMsgRequestTag",reflectMapper:pv.chatRoomTagHistoryMsgRequestTag}],response:[{type:"PropertyArray",name:"chatroomMsgs",reflectMapper:mv.chatroomMsg}]},getChatroom:{sid:13,cid:13,service:"chatroom",response:[{type:"Property",name:"chatroom",reflectMapper:mv.chatroom}]},updateChatroom:{sid:13,cid:14,service:"chatroom",params:[{type:"Property",name:"chatroom",reflectMapper:pv.chatroom},{type:"Bool",name:"needNotify"},{type:"String",name:"ext"}]},chatroomUpdateMyRoomRole:{sid:13,cid:15,service:"chatroomMember",params:[{type:"Property",name:"chatroomMember",reflectMapper:pv.chatroomMember},{type:"Bool",name:"needNotify"},{type:"String",name:"ext"},{type:"Bool",name:"needSave"}]},markChatroomMember:{sid:13,cid:11,service:"chatroomMember",params:[{type:"String",name:"account"},{type:"Int",name:"type"},{type:"Bool",name:"isAdd"},{type:"Int",name:"level"},{type:"String",name:"ext"}],response:[{type:"Property",name:"chatroomMember",reflectMapper:mv.chatroomMember}]},chatroomQueryMembers:{sid:13,cid:8,service:"chatroomMember",params:[{type:"Byte",name:"type"},{type:"Long",name:"time"},{type:"Int",name:"limit"}],response:[{type:"PropertyArray",name:"members",reflectMapper:mv.chatroomMember}]},chatroomQueryMembersByAccounts:{sid:13,cid:16,service:"chatroomMember",params:[{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"members",reflectMapper:mv.chatroomMember}]},chatroomKickMember:{sid:13,cid:17,service:"chatroomMember",params:[{type:"string",name:"account"},{type:"string",name:"ext"}]},chatroomSetMemberTempMute:{sid:13,cid:19,service:"chatroomMember",params:[{type:"String",name:"account"},{type:"Long",name:"duration"},{type:"bool",name:"needNotify"},{type:"String",name:"ext"}]},closeChatroom:{sid:13,cid:12,service:"chatroom",params:[{type:"String",name:"ext"}]},chatroomQueryMembersCountByTag:{sid:13,cid:32,service:"chatroomMember",params:[{type:"String",name:"tag"}],response:[{type:"Long",name:"count"}]},chatroomQueryMembersByTag:{sid:13,cid:31,service:"chatroomMember",params:[{type:"Property",name:"chatroomTagMemberReq",reflectMapper:pv.chatroomTagMemberReq}],response:[{type:"PropertyArray",name:"members",reflectMapper:mv.chatroomMember}]},chatroomSetMembersTempMuteByTag:{sid:13,cid:30,service:"chatroomMember",params:[{type:"Property",name:"chatroomTagMuteReq",reflectMapper:pv.chatroomTagMuteReq}]},chatroomQueueOffer:{sid:13,cid:20,service:"chatroomQueue",params:[{type:"String",name:"elementKey"},{type:"String",name:"elementValue"},{type:"bool",name:"transient"},{type:"String",name:"account"}]},chatroomQueuePoll:{sid:13,cid:21,service:"chatroomQueue",params:[{type:"String",name:"key"}],response:[{type:"String",name:"elementKey"},{type:"String",name:"elementValue"}]},chatroomQueueChange:{sid:13,cid:26,service:"chatroomQueue",params:[{type:"StrStrMap",name:"itemList"},{type:"bool",name:"needNotify"},{type:"String",name:"notifyExtension"}],response:[{type:"StrArray",name:"invalidKeyList"}]},chatroomQueueList:{sid:13,cid:22,service:"chatroomQueue",response:[{type:"KVArray",name:"itemList"}]},chatroomQueuePeak:{sid:13,cid:23,service:"chatroomQueue",response:[{type:"String",name:"elementKey"},{type:"String",name:"elementValue"}]},chatroomQueueDrop:{sid:13,cid:24,service:"chatroomQueue"},chatroomQueueInit:{sid:13,cid:25,service:"chatroomQueue",params:[{type:"Int",name:"maxItemCount"}]},onChatroomMsg:{sid:13,cid:7,service:"chatroomMsg",response:[{type:"Property",name:"chatroomMsg",reflectMapper:mv.chatroomMsg}]},beKickedFromChatroom:{sid:13,cid:3,service:"chatroom",response:[{type:"Number",name:"reason"},{type:"String",name:"ext"}]},updateChatroomTag:{sid:13,cid:101,service:"chatroom",response:[{type:"Property",name:"updateTags",reflectMapper:mv.updateTags}]}},fv={BROWSER:0,RN:2,UNIAPP:3,WECHAT:6},gv={debugLevel:"off",needReconnect:!0,reconnectionAttempts:9007199254740991,autoMarkRead:!0,isAbtestEnable:!0,abtestUrl:"https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo",abtestProjectKey:"imElite_sdk_abtest_web"},yv=/*#__PURE__*/function(t){function Chatroom(a,o){var m;return void 0===o&&(o={}),(m=t.call(this,a)||this).instanceName="Chatroom",m.account="",m.options={},m.chatroom={},m.chatroomMsg={},m.chatroomMember={},m.chatroomQueue={},m.cloudStorage={},m.setOptions(a),registerParser({cmdMap:dv,cmdConfig:hv}),registerParser({cmdMap:ey,cmdConfig:ny}),m.chatroom=new av(c(m)),m.chatroomMsg=new ov(c(m)),m.chatroomMember=new lv(c(m)),m.chatroomQueue=new uv(c(m)),m.cloudStorage=new py(c(m),fi({storageKeyPrefix:m.instanceName},o.cloudStorageConfig)),Chatroom.instance=c(m),m}Mt(Chatroom,t),Chatroom.getInstance=function getInstance(t,a){if(!Chatroom.instance){if(t)return new Chatroom(t,a);throw new Error("Instance not exist, please input options")}if(t){if(Chatroom.instance.options.account===t.account&&Chatroom.instance.options.appkey===t.appkey)return Chatroom.instance.setOptions(t),Chatroom.instance;throw new Error("Unexpected login")}return Chatroom.instance};var a=Chatroom.prototype;return a.setOptions=function setOptions(t){validate({account:{type:"string"},appkey:{type:"string"},token:{type:"string"},chatroomId:{type:"string"},chatroomAddresses:{type:"array",itemType:"string",min:1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},isAnonymous:{type:"boolean",required:!1},tags:{type:"array",itemType:"string",required:!1}},t),this.logger.log("chatroom::setOptions options is",t),this.account=t.account,this.options=fi(fi({},gv),t)},a.connect=function connect(a){void 0===a&&(a={});var o=st(null,{connect:{get:function get(){return t.prototype.connect}}});return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var t,c,m,h,v;return ci.wrap((function _callee$(b){for(;;)switch(b.prev=b.next){case 0:if(/^(unconnected|waitReconnect)$/.test(this.status)){b.next=4;break}return t="Chatroom status is "+this.status+", and would not connect",this.logger.warn(t),b.abrupt("return",zo.reject(t));case 4:return c=a.isAutoReconnect||!1,m=os(),b.next=8,o.connect.call(this,{linkUrls:this.options.chatroomAddresses,isAutoReconnect:c});case 8:return h=b.sent,b.prev=9,b.next=12,this.login(c);case 12:v=b.sent,this.reporter.report("chatroomLogin",{accid:this.account,roomId:this.options.chatroomId,serverIps:this.options.chatroomAddresses,currentServerIp:h,rt:os()-m,result:200,failReason:"",time:os()}),b.next=25;break;case 16:if(b.prev=16,b.t0=b.catch(9),this.logger.error("chatroom login error",b.t0),this.reporter.report("chatroomLogin",{accid:this.account,roomId:this.options.chatroomId,serverIps:this.options.chatroomAddresses,currentServerIp:h,rt:os()-m,result:b.t0&&b.t0.error&&b.t0.error.code,failReason:b.t0&&b.t0.error&&b.t0.error.message,time:os()}),0!==this.retryCount){b.next=23;break}throw this.doDisconnect(ju.ACTIVE,"FailedToInitializeLogin"),b.t0;case 23:return this.doDisconnect(ju.OFFLINE,"ReconnectLoginFailed"),b.abrupt("return");case 25:return b.prev=25,b.next=28,this.cloudStorage.init();case 28:b.next=33;break;case 30:b.prev=30,b.t1=b.catch(25),this.logger.error("NIM:login cloudStorage init failed ",b.t1);case 33:this.eventBus.emit("logined",v),this.emit("logined",v),this.resetConnectStatus(),this.ping();case 37:case"end":return b.stop()}}),_callee,this,[[9,16],[25,30]])})))},a.login=function login(t){var a,o;return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var c,m,h,v,b,S,M;return ci.wrap((function _callee2$(C){for(;;)switch(C.prev=C.next){case 0:return c=this.options,m=pc.getSystemInfo(),h=fi(fi({},c),{appLogin:t?0:1,deviceId:this.config.deviceId,clientType:16,protocolVersion:1,sdkVersion:90903,sdkHumanVersion:"0.12.3",os:m.os,browser:m.browser,session:null===(a=this.socket)||void 0===a?void 0:a.sessionId,sdkType:fv[pc.platform]||0,userAgent:"Native/0.12.3"}),v=fi(fi({},c),{appkey:c.appkey,account:c.account,deviceId:this.config.deviceId,session:null===(o=this.socket)||void 0===o?void 0:o.sessionId,appLogin:1}),c.isAnonymous&&(v.isAnonymous=1,v.account=v.account||"nimanon_"+wu(),h.account=v.account,v.chatroomNick=v.account||"nimanon_"+wu(),v.chatroomAvatar=v.chatroomAvatar||" "),c.tags&&c.tags.length>0&&(v.tags=gi(c.tags)),C.next=8,this.sendCmd("chatroomLogin",{type:1,chatroomLogin:v,chatroomIMLogin:h});case 8:return b=C.sent,this.status="logined",S=formatChatroom(b.content.chatroom),M=formatChatroomMember(b.content.chatroomMember),C.abrupt("return",{chatroom:S,member:M});case 13:case"end":return C.stop()}}),_callee2,this)})))},a.onMessage=function onMessage(a){var o,c,m=t.prototype.onMessage.call(this,a);if(m){var h=m.raw.ser,v=this.sendingCmdMap.get(h);if(v&&v.cmd===m.cmd){var b=v.callback,S=v.timer,M=v.params;if(clearTimeout(S),m.params=M,this.sendingCmdMap.delete(h),"heartbeat"===m.cmd)return void b[0]();var C=null===(o=this[m.service])||void 0===o?void 0:o.process(m);C&&"function"==typeof C.then?C.then((function(t){b[0](t)})).catch((function(t){b[1](t)})):(this.logger.log("imsocket:: handlerFn without promise",m.service,m.cmd),b[0]())}else null===(c=this[m.service])||void 0===c||c.process(m)}},a.disconnect=function disconnect(){var a=this;switch(this.status){case"connected":case"logined":return this.sendCmd("chatroomExit").then((function(){t.prototype.doDisconnect.call(a,ju.ACTIVE,"UserActiveDisconnect")}));case"connecting":case"waitReconnect":return t.prototype.doDisconnect.call(this,ju.ACTIVE,"UserActiveDisconnect"),zo.resolve();case"unconnected":case"destroyed":return zo.resolve()}},a.destroy=function destroy(){return Chatroom.instance=null,t.prototype.destroy.call(this)},Chatroom}(Hu);yv.instance=null,function(t){t[t.ASC=1]="ASC",t[t.DESC=2]="DESC"}(iv||(iv={})),function(t){t[t.reorderWeight=0]="reorderWeight",t[t.createTime=1]="createTime",t[t.totalMember=2]="totalMember"}(sv||(sv={})),function(t){t[t.square=1]="square",t[t.person=2]="person"}(cv||(cv={}));var vv=/*#__PURE__*/function(){function Service(t,a){this.name=t,this.core=a,this.name=t,this.logger=a.logger,this.core=a}return Service.prototype.process=function process(t){var a=this[t.cmd+"Handler"];return"function"==typeof a?a.call(this,t):t.error&&!t.error.ignore?zo.reject(t.error):zo.resolve(t)},Service}(),bv={"24_15":"qchatSubscribe","24_27":"qchatGetUnreadInfo","24_48":"qchatCreateChannel","24_49":"qchatDeleteChannel","24_50":"qchatUpdateChannel","24_51":"qchatGetChannels","24_52":"qchatGetChannelsByPage","24_53":"qchatGetMembersByPage","24_54":"qchatUpdateWhiteBlackRole","24_55":"qchatGetWhiteBlackRolesPage","24_56":"qchatUpdateWhiteBlackMembers","24_57":"qchatGetWhiteBlackMembersPage","24_58":"qchatGetExistingWhiteBlackRoles","24_59":"qchatGetExistingWhiteBlackMembers","24_60":"qchatUpdateCategoryInfoOfChannel","24_109":"qchatCreateChannelCategory","24_110":"qchatRemoveChannelCategory","24_111":"qchatUpdateChannelCategory","24_112":"qchatGetChannelCategoriesByID","24_113":"qchatUpdateChannelCategoryWhiteBlackRole","24_114":"qchatGetChannelCategoryWhiteBlackRolesPage","24_115":"qchatUpdateChannelCategoryWhiteBlackMembers","24_116":"qchatGetChannelCategoryWhiteBlackMembersPage","24_117":"qchatGetChannelCategoryWhiteBlackRoles","24_118":"qchatGetChannelCategoryWhiteBlackMembers","24_119":"qchatGetChannelCategoriesPage","24_120":"qchatGetChannelCategoryChannelsPage","24_93":"qchatGetChannelSearchByPage","24_95":"qchatChannelMemberSearch","25_8":"qchatGetRoleIdsByServerId","25_9":"qchatSubscribeAsVisitor"},Sv={serverId:1,channelId:2,ackTimestamp:3,unreadCount:4,mentionedCount:5,maxCount:6,lastMsgTime:7},Mv={channelInfo:{channelId:1,serverId:2,name:4,topic:5,ext:6,type:7,validFlag:8,createTime:9,updateTime:10,owner:11,viewMode:12,categoryId:13,syncMode:14,reorderWeight:15,visitorMode:16},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11},qchatSubReqTag:{type:1,opeType:2},qchatChannelIdInfoTag:{serverId:1,channelId:2},unreadInfo:Sv,qchatGetChannelListPageTag:{serverId:1,timetag:2,limit:3},qchatGetMembersByPageTag:{serverId:1,channelId:2,timetag:3,limit:4},qchatUpdateWhiteBlackRoleTag:{serverId:1,channelId:2,type:3,opeType:4,roleId:5},qchatGetWhiteBlackRolesPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatUpdateWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,opeType:4,toAccids:5},qchatGetWhiteBlackMembersPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatGetExistingWhiteBlackRolesTag:{serverId:1,channelId:2,type:3,roleIds:4},qchatGetExistingWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,accids:4},QChatChannelCategoryInfo:{categoryId:1,serverId:2,name:4,ext:5,owner:6,viewMode:7,validFlag:8,createTime:9,updateTime:10,channelNumber:11},qchatUpdateChannelCategoryWhiteBlackRoleTag:{serverId:1,categoryId:2,type:3,opeType:4,roleId:5},qchatGetChannelCategoryWhiteBlackRolesPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatUpdateChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,opeType:4,toAccids:5},qchatGetChannelCategoryWhiteBlackMembersPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatGetChannelCategoryWhiteBlackRolesTag:{serverId:1,categoryId:2,type:3,roleIds:4},qchatGetChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,accids:4},qchatGetChannelCategoriesPageTag:{serverId:1,timetag:2,limit:3},qchatGetChannelCategoryChannelsPageTag:{serverId:1,categoryId:2,timetag:3,limit:4},qchatGetChannelSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverId:6,sort:7,cursor:8},qchatUpdateChannelTag:{channelId:1,name:4,topic:5,ext:6,viewMode:12,visitorMode:16},serverRoles:{serverId:1,roleIds:2,timeTag:3},qchatChannelMemberSearchTag:{serverId:1,channelId:2,keyword:3,limit:4},qchatChannelMemberInfo:{serverId:1,channelId:2,avatar:3,accid:4,nick:5,createTime:6,updateTime:7}},Cv=invertSerializeMap(Mv),Tv={qchatCreateChannel:{sid:24,cid:48,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:Mv.channelInfo},{type:"Property",name:"antispamTag",reflectMapper:Mv.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:Cv.channelInfo}]},qchatDeleteChannel:{sid:24,cid:49,service:"qchatChannel",params:[{type:"Long",name:"channelId"}]},qchatUpdateChannel:{sid:24,cid:50,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:Mv.qchatUpdateChannelTag},{type:"Property",name:"antispamTag",reflectMapper:Mv.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:Cv.channelInfo}]},qchatGetChannels:{sid:24,cid:51,service:"qchatChannel",params:[{type:"LongArray",name:"channelIds"}],response:[{type:"PropertyArray",name:"channelList",reflectMapper:Cv.channelInfo}]},qchatGetChannelsByPage:{sid:24,cid:52,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelListPageTag",reflectMapper:Mv.qchatGetChannelListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Cv.channelInfo}]},qchatGetMembersByPage:{sid:24,cid:53,service:"qchatChannel",params:[{type:"Property",name:"qchatGetMembersByPageTag",reflectMapper:Mv.qchatGetMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Cv.memberInfo}]},qchatUpdateWhiteBlackRole:{sid:24,cid:54,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackRoleTag",reflectMapper:Mv.qchatUpdateWhiteBlackRoleTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Cv.memberInfo}]},qchatGetWhiteBlackRolesPage:{sid:24,cid:55,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackRolesPageTag",reflectMapper:Mv.qchatGetWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Cv.serverRole}]},qchatUpdateWhiteBlackMembers:{sid:24,cid:56,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackMembersTag",reflectMapper:Mv.qchatUpdateWhiteBlackMembersTag}]},qchatGetWhiteBlackMembersPage:{sid:24,cid:57,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackMembersPageTag",reflectMapper:Mv.qchatGetWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Cv.memberInfo}]},qchatGetExistingWhiteBlackRoles:{sid:24,cid:58,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackRolesTag",reflectMapper:Mv.qchatGetExistingWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Cv.serverRole}]},qchatGetExistingWhiteBlackMembers:{sid:24,cid:59,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackMembersTag",reflectMapper:Mv.qchatGetExistingWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Cv.memberInfo}]},qchatUpdateCategoryInfoOfChannel:{sid:24,cid:60,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateCategoryInfoOfChannelTag",reflectMapper:Mv.channelInfo}],response:[{type:"Property",name:"channelInfo",reflectMapper:Cv.channelInfo}]},qchatCreateChannelCategory:{sid:24,cid:109,service:"qchatChannel",params:[{type:"Property",name:"qchatCreateChannelCategoryTag",reflectMapper:Mv.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:Cv.QChatChannelCategoryInfo}]},qchatRemoveChannelCategory:{sid:24,cid:110,service:"qchatChannel",params:[{type:"Long",name:"categoryId"}]},qchatUpdateChannelCategory:{sid:24,cid:111,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryTag",reflectMapper:Mv.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:Cv.QChatChannelCategoryInfo}]},qchatGetChannelCategoriesByID:{sid:24,cid:112,service:"qchatChannel",params:[{type:"LongArray",name:"categoryIds"}],response:[{type:"PropertyArray",name:"channelCategoryList",reflectMapper:Cv.QChatChannelCategoryInfo}]},qchatUpdateChannelCategoryWhiteBlackRole:{sid:24,cid:113,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackRoleTag",reflectMapper:Mv.qchatUpdateChannelCategoryWhiteBlackRoleTag}]},qchatGetChannelCategoryWhiteBlackRolesPage:{sid:24,cid:114,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesPageTag",reflectMapper:Mv.qchatGetChannelCategoryWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Cv.serverRole}]},qchatUpdateChannelCategoryWhiteBlackMembers:{sid:24,cid:115,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackMembersTag",reflectMapper:Mv.qchatUpdateChannelCategoryWhiteBlackMembersTag}]},qchatGetChannelCategoryWhiteBlackMembersPage:{sid:24,cid:116,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersPageTag",reflectMapper:Mv.qchatGetChannelCategoryWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Cv.memberInfo}]},qchatGetChannelCategoryWhiteBlackRoles:{sid:24,cid:117,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesTag",reflectMapper:Mv.qchatGetChannelCategoryWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Cv.serverRole}]},qchatGetChannelCategoryWhiteBlackMembers:{sid:24,cid:118,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersTag",reflectMapper:Mv.qchatGetChannelCategoryWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Cv.memberInfo}]},qchatGetChannelCategoriesPage:{sid:24,cid:119,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoriesPageTag",reflectMapper:Mv.qchatGetChannelCategoriesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Cv.QChatChannelCategoryInfo}]},qchatGetChannelCategoryChannelsPage:{sid:24,cid:120,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryChannelsPageTag",reflectMapper:Mv.qchatGetChannelCategoryChannelsPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Cv.channelInfo}]},qchatSubscribe:{sid:24,cid:15,service:"qchatChannel",params:[{type:"Property",name:"qchatSubReqTag",reflectMapper:Mv.qchatSubReqTag},{type:"PropertyArray",name:"channels",reflectMapper:Mv.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:Cv.unreadInfo},{type:"PropertyArray",name:"failedChannels",reflectMapper:Cv.qchatChannelIdInfoTag}]},qchatGetUnreadInfo:{sid:24,cid:27,service:"qchatChannel",params:[{type:"PropertyArray",name:"channels",reflectMapper:Mv.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:Cv.unreadInfo}]},qchatGetChannelSearchByPage:{sid:24,cid:93,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelSearchByPageTag",reflectMapper:Mv.qchatGetChannelSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:Cv.channelInfo}]},qchatGetRoleIdsByServerId:{sid:25,cid:8,service:"qchatChannel",params:[{type:"Property",name:"qchatGetRoleIdsByServerIdTag",reflectMapper:{serverIdTimeTags:1}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:Cv.serverRoles},{type:"LongArray",name:"failServerIds"}]},qchatChannelMemberSearch:{sid:24,cid:95,service:"qchatChannel",params:[{type:"Property",name:"qchatChannelMemberSearchTag",reflectMapper:Mv.qchatChannelMemberSearchTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Cv.qchatChannelMemberInfo}]},qchatSubscribeAsVisitor:{sid:25,cid:9,service:"qchatChannel",params:[{type:"Property",name:"tag",reflectMapper:Mv.qchatSubReqTag},{type:"PropertyArray",name:"datas",reflectMapper:Mv.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"failedArr",reflectMapper:Cv.qchatChannelIdInfoTag}]}},_v={"24_31":"qchatCreateServer","24_32":"qchatDeleteServer","24_33":"qchatUpdateServer","24_34":"qchatGetServers","24_35":"qchatGetServersByPage","24_36":"qchatInviteServerMembers","24_37":"qchatAcceptServerInvite","24_38":"qchatRejectInviteServer","24_39":"qchatApplyServerJoin","24_40":"qchatAcceptServerApply","24_41":"qchatRejectServerApply","24_42":"qchatKickServerMembers","24_43":"qchatLeaveServer","24_44":"qchatUpdateMyMemberInfo","24_45":"qchatUpdateServerMemberInfo","24_46":"qchatGetServerMembers","24_47":"qchatGetServerMembersByPage","24_104":"qchatUpdateServerMemberBan","24_105":"qchatGetBannedMembersByPage","24_91":"qchatServerSearchByPage","24_92":"qchatServerMemberSearchByPage","24_122":"qchatGenerateInviteCode","24_123":"qchatJoinByInviteCode","24_124":"qchatGetInviteApplyRecordOfServer","24_125":"qchatGetInviteApplyRecordOfSelf","25_5":"qchatClearServersUnread","25_7":"qchatSubscribeChannelsByServers","25_10":"qchatEnterAsVisitor","25_11":"qchatLeaveAsVisitor"},wv={serverInfo:{serverId:1,name:3,icon:4,ext:5,owner:6,memberNumber:7,inviteMode:8,applyMode:9,validFlag:10,createTime:11,updateTime:12,channelNumber:13,categoryNumber:14,searchType:15,searchEnable:16,reorderWeight:17},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},otherMemberInfo:{serverId:1,accid:3,nick:4,avatar:5,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},getServerListPageTag:{timestamp:1,limit:2},getServerMemberListPageTag:{serverId:1,timetag:2,limit:3},updateServerMemberBanTag:{serverId:1,opeType:2,accid:3,ext:4},getBannedMembersByPageTag:{serverId:1,timetag:2,limit:3},serverMemberBanInfo:{serverId:1,appid:2,accid:3,ext:4,banTime:5,validFlag:6,createTime:7,updateTime:8},serverSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverType:6,searchType:7,sort:8,cursor:9},serverMemberSearchByPageTag:{serverId:1,keyword:3,limit:4},inviteRespParamTag:{requestId:1},applyRespParamTag:{requestId:1,expireTime:2},inviteApplyRecord:{accid:1,type:2,serverId:3,status:4,requestId:5,createTime:6,updateTime:7,expireTime:8,data:9,recordId:10},clearServersUnreadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},unreadInfo:Sv},Iv=invertSerializeMap(wv),kv={qchatCreateServer:{sid:24,cid:31,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:wv.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:wv.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:Iv.serverInfo}]},qchatDeleteServer:{sid:24,cid:32,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateServer:{sid:24,cid:33,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:wv.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:wv.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:Iv.serverInfo}]},qchatGetServers:{sid:24,cid:34,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"serverList",reflectMapper:Iv.serverInfo}]},qchatGetServersByPage:{sid:24,cid:35,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:wv.getServerListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Iv.serverInfo}]},qchatInviteServerMembers:{sid:24,cid:36,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"StrArray",name:"failByOverAccids"},{type:"StrArray",name:"failByBanAccids"},{type:"Property",name:"record",reflectMapper:Iv.applyRespParamTag}]},qchatAcceptServerInvite:{sid:24,cid:37,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:wv.inviteRespParamTag}]},qchatRejectInviteServer:{sid:24,cid:38,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:wv.inviteRespParamTag}]},qchatApplyServerJoin:{sid:24,cid:39,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"Property",name:"data",reflectMapper:Iv.applyRespParamTag}]},qchatAcceptServerApply:{sid:24,cid:40,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:wv.applyRespParamTag}]},qchatRejectServerApply:{sid:24,cid:41,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:wv.applyRespParamTag}]},qchatKickServerMembers:{sid:24,cid:42,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"}]},qchatLeaveServer:{sid:24,cid:43,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateMyMemberInfo:{sid:24,cid:44,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:wv.memberInfo},{type:"Property",name:"antispamTag",reflectMapper:wv.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:Iv.memberInfo}]},qchatUpdateServerMemberInfo:{sid:24,cid:45,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:wv.otherMemberInfo},{type:"Property",name:"antispamTag",reflectMapper:wv.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:Iv.memberInfo}]},qchatGetServerMembers:{sid:24,cid:46,service:"qchatServer",params:[{type:"StrArray",name:"accids"}],response:[{type:"PropertyArray",name:"accidList",reflectMapper:Iv.memberInfo}]},qchatGetServerMembersByPage:{sid:24,cid:47,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:wv.getServerMemberListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Iv.memberInfo}]},qchatUpdateServerMemberBan:{sid:24,cid:104,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:wv.updateServerMemberBanTag}]},qchatGetBannedMembersByPage:{sid:24,cid:105,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:wv.getBannedMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Iv.serverMemberBanInfo}]},qchatServerSearchByPage:{sid:24,cid:91,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:wv.serverSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:Iv.serverInfo}]},qchatServerMemberSearchByPage:{sid:24,cid:92,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:wv.serverMemberSearchByPageTag}],response:[{type:"PropertyArray",name:"members",reflectMapper:Iv.serverMemberBanInfo}]},qchatGenerateInviteCode:{sid:24,cid:122,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,ttl:2}}],response:[{type:"Property",name:"data",reflectMapper:{1:"serverId",2:"requestId",3:"inviteCode",4:"expireTime"}}]},qchatJoinByInviteCode:{sid:24,cid:123,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,inviteCode:2,ps:3}}]},qchatGetInviteApplyRecordOfServer:{sid:24,cid:124,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,fromTime:2,toTime:3,reverse:4,limit:5,cursor:6}}],response:[{type:"PropertyArray",name:"data",reflectMapper:Iv.inviteApplyRecord}]},qchatGetInviteApplyRecordOfSelf:{sid:24,cid:125,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{fromTime:1,toTime:2,reverse:3,limit:4,cursor:5}}],response:[{type:"PropertyArray",name:"data",reflectMapper:Iv.inviteApplyRecord}]},qchatClearServersUnread:{sid:25,cid:5,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"Property",name:"clearServersUnreadTag",reflectMapper:Iv.clearServersUnreadTag}]},qchatSubscribeChannelsByServers:{sid:25,cid:7,service:"qchatServer",params:[{type:"int",name:"type"},{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:Iv.unreadInfo},{type:"LongArray",name:"failServerIds"}]},qchatEnterAsVisitor:{sid:25,cid:10,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"LongArray",name:"failServerIds"}]},qchatLeaveAsVisitor:{sid:25,cid:11,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"LongArray",name:"failServerIds"}]}},xv={serverId:{type:"string"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"},owner:{type:"string"},memberNumber:{type:"number"},inviteMode:{type:"number"},applyMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"},categoryNumber:{type:"number"},searchType:{type:"number"},searchEnable:{type:"boolean"},reorderWeight:{type:"string"}},Rv={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},Ev={serverId:{type:"string"},appid:{type:"string"},accid:{type:"string"},ext:{type:"string"},banTime:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}};function formatServer(t){return format(xv,t)}function formatServers(t){return xc(t)&&t.length>0?map(t).call(t,(function(t){return formatServer(t)})):[]}function formatMember$1(t){return format(Rv,t)}function formatMembers$1(t){return xc(t)&&t.length>0?map(t).call(t,(function(t){return formatMember$1(t)})):[]}function formatServerMemberBanInfos(t){return xc(t)&&t.length>0?map(t).call(t,(function(t){return function formatServerMemberBanInfo(t){return format(Ev,t)}(t)})):[]}function generateAntispamTag(t){var a,o,c;if(!t.antispamTag)return{};var m=fi({},t.antispamTag);return(null===(a=t.antispamTag)||void 0===a?void 0:a.antiSpamBusinessId)&&"string"!=typeof(null===(o=t.antispamTag)||void 0===o?void 0:o.antiSpamBusinessId)&&(m.antiSpamBusinessId=gi(null===(c=t.antispamTag)||void 0===c?void 0:c.antiSpamBusinessId)),m}var Av={accid:{type:"string"},type:{type:"number"},serverId:{type:"string"},status:{type:"number"},requestId:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"},expireTime:{type:"number"},data:{type:"object"}};function formatInviteApplyRecord(t){return format(Av,t)}function formatInviteApplyRecords(t){return xc(t)&&t.length>0?map(t).call(t,(function(t){return formatInviteApplyRecord(t)})):[]}var qv,Pv,Ov,Uv,Bv={successServerIds:{type:"object"},failServerIds:{type:"object"},ackTimestamp:{type:"number"}};function formatClearServersUnread(t){return format(Bv,t)}!function(t){t[t.reorderWeight=0]="reorderWeight",t[t.createTime=1]="createTime"}(qv||(qv={})),function(t){t[t.white=1]="white",t[t.black=2]="black"}(Pv||(Pv={})),function(t){t[t.add=1]="add",t[t.remove=2]="remove"}(Ov||(Ov={})),function(t){t[t.message=0]="message",t[t.media=1]="media",t[t.ext=100]="ext"}(Uv||(Uv={}));var Fv={channelId:{type:"string"},serverId:{type:"string"},name:{type:"string"},topic:{type:"string"},ext:{type:"string"},type:{type:"enum",values:Uv},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},viewMode:{type:"number"},categoryId:{type:"string"},syncMode:{type:"number"},visitorMode:{type:"number"},reorderWeight:{type:"string"}},Lv={serverId:{type:"string"},channelId:{type:"string"},ackTimestamp:{type:"number"},unreadCount:{type:"number"},mentionedCount:{type:"number"},maxCount:{type:"number"},lastMsgTime:{type:"number"}},jv={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:Pv},opeType:{type:"enum",values:Ov},toAccids:{type:"object"}},Nv={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:Pv},opeType:{type:"enum",values:Ov},roleId:{type:"string"}},Dv={categoryId:{type:"string"},serverId:{type:"string"},name:{type:"string"},ext:{type:"string"},owner:{type:"string"},viewMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"}},$v={serverId:{type:"string"},channelId:{type:"string"},accid:{type:"string"},avatar:{type:"string"},nick:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function formatUpdateWhiteBlackRole(t){return format(Nv,t)}function formatChannel(t){return format(Fv,t)}function formatChannels(t){return xc(t)&&t.length>0?map(t).call(t,(function(t){return formatChannel(t)})):[]}function formatUnreadInfo(t){return format(Lv,t)}function formatUnreadInfos(t){return xc(t)&&t.length>0?map(t).call(t,(function(t){return formatUnreadInfo(t)})):[]}function formatChannelCategory(t){return format(Dv,t)}function formatChannelCategorys(t){return xc(t)&&t.length>0?map(t).call(t,(function(t){return formatChannelCategory(t)})):[]}function formatChannelMembers(t){return xc(t)&&t.length>0?map(t).call(t,(function(t){return function formatChannelMember(t){return format($v,t)}(t)})):[]}var Hv=Vl((function(t,a){return Jl(t)?Fl(t,km(a,1,Jl,!0)):[]})),Gv=Hv;function _createForOfIteratorHelperLoose(t,a){var o,c=void 0!==Ln&&Lu(t)||t["@@iterator"];if(c)return bind$1(o=(c=c.call(t)).next).call(o,c);if(xc(t)||(c=function _unsupportedIterableToArray(t,a){var o;if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,a);var c=slice(o=Object.prototype.toString.call(t)).call(o,8,-1);"Object"===c&&t.constructor&&(c=t.constructor.name);if("Map"===c||"Set"===c)return Fu(t);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray(t,a)}(t))||a&&t&&"number"==typeof t.length){c&&(t=c);var m=0;return function(){return m>=t.length?{done:!0}:{done:!1,value:t[m++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray(t,a){(null==a||a>t.length)&&(a=t.length);for(var o=0,c=new Array(a);o<a;o++)c[o]=t[o];return c}var Qv,Wv,Vv,Kv,zv=/*#__PURE__*/function(t){function QChatServerService(a){var o;return(o=t.call(this,"qchatServer",a)||this).core=a,registerParser({cmdMap:_v,cmdConfig:kv}),o}Mt(QChatServerService,t);var a=QChatServerService.prototype;return a.createServer=function createServer(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var a;return ci.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return validate({icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatCreateServer",{serverInfo:fi(fi({},t),{searchEnable:!1===t.searchEnable?0:1}),antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatServer(a.content.serverInfo));case 5:case"end":return o.stop()}}),_callee,this)})))},a.deleteServer=function deleteServer(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){return ci.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatDeleteServer",t);case 3:case"end":return a.stop()}}),_callee2,this)})))},a.updateServer=function updateServer(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var a;return ci.wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",min:1},icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateServer",{serverInfo:fi(fi({},t),{searchEnable:!1===t.searchEnable?0:1}),antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatServer(a.content.serverInfo));case 5:case"end":return o.stop()}}),_callee3,this)})))},a.getServers=function getServers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){var a;return ci.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverIds:{type:"array",itemType:"string",min:1}},t),o.next=3,this.core.sendCmd("qchatGetServers",t);case 3:return a=o.sent,o.abrupt("return",formatServers(a.content.serverList));case 5:case"end":return o.stop()}}),_callee4,this)})))},a.getServersByPage=function getServersByPage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){var a,o,c,m;return ci.wrap((function _callee5$(h){for(;;)switch(h.prev=h.next){case 0:return validate({timestamp:{type:"number"},limit:{type:"number",min:1,required:!1}},t),h.next=3,this.core.sendCmd("qchatGetServersByPage",{tag:t});case 3:return a=h.sent,o=a.content,c=o.datas,m=o.listQueryTag,h.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:_u(m.nextTimetag)},datas:formatServers(c)});case 6:case"end":return h.stop()}}),_callee5,this)})))},a.inviteServerMembers=function inviteServerMembers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){var a,o;return ci.wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},t),c.next=3,this.core.sendCmd("qchatInviteServerMembers",t);case 3:return a=c.sent,o=a.content.record||{},c.abrupt("return",{failByOverAccids:a.content.failByOverAccids,failByBanAccids:a.content.failByBanAccids,recordInfo:formatInviteApplyRecord(o)});case 6:case"end":return c.stop()}}),_callee6,this)})))},a.acceptServerInvite=function acceptServerInvite(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee7(){return ci.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatAcceptServerInvite",t);case 3:case"end":return a.stop()}}),_callee7,this)})))},a.rejectInviteServer=function rejectInviteServer(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee8(){return ci.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatRejectInviteServer",t);case 3:case"end":return a.stop()}}),_callee8,this)})))},a.applyServerJoin=function applyServerJoin(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee9(){var a;return ci.wrap((function _callee9$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},t),o.next=3,this.core.sendCmd("qchatApplyServerJoin",t);case 3:return a=o.sent,o.abrupt("return",formatInviteApplyRecord(a.content.data));case 5:case"end":return o.stop()}}),_callee9,this)})))},a.acceptServerApply=function acceptServerApply(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee10(){return ci.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatAcceptServerApply",t);case 3:case"end":return a.stop()}}),_callee10,this)})))},a.rejectServerApply=function rejectServerApply(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee11(){return ci.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatRejectServerApply",t);case 3:case"end":return a.stop()}}),_callee11,this)})))},a.kickServerMembers=function kickServerMembers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee12(){return ci.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatKickServerMembers",t);case 3:case"end":return a.stop()}}),_callee12,this)})))},a.leaveServer=function leaveServer(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee13(){return ci.wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatLeaveServer",t);case 3:case"end":return a.stop()}}),_callee13,this)})))},a.updateMyMemberInfo=function updateMyMemberInfo(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee14(){var a;return ci.wrap((function _callee14$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",required:!1},nick:{type:"string",required:!1},avatar:{type:"string",required:!1},ext:{type:"string",required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateMyMemberInfo",{memberInfo:t,antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatMember$1(a.content.memberInfo));case 5:case"end":return o.stop()}}),_callee14,this)})))},a.updateServerMemberInfo=function updateServerMemberInfo(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee15(){var a;return ci.wrap((function _callee15$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},nick:{type:"string",required:!1},avatar:{type:"string",required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateServerMemberInfo",{memberInfo:t,antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatMember$1(a.content.memberInfo));case 5:case"end":return o.stop()}}),_callee15,this)})))},a.getServerMembers=function getServerMembers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee16(){var a,o,c,m,h;return ci.wrap((function _callee16$(v){for(;;)switch(v.prev=v.next){case 0:if(validate({accids:{type:"array"}},t),a=[],t.accids.length)for(o=_createForOfIteratorHelperLoose(t.accids);!(c=o()).done;)m=c.value,a.push(m.serverId+"|"+m.accid);return v.next=5,this.core.sendCmd("qchatGetServerMembers",{accids:a});case 5:return h=v.sent,v.abrupt("return",formatMembers$1(h.content.accidList));case 7:case"end":return v.stop()}}),_callee16,this)})))},a.getServerMembersByPage=function getServerMembersByPage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee17(){var a,o,c,m;return ci.wrap((function _callee17$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),h.next=3,this.core.sendCmd("qchatGetServerMembersByPage",{tag:t});case 3:return a=h.sent,o=a.content,c=o.datas,m=o.listQueryTag,h.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:_u(m.nextTimetag)},datas:formatMembers$1(c)});case 6:case"end":return h.stop()}}),_callee17,this)})))},a.subscribeServer=function subscribeServer(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee18(){var a,o,c,m;return ci.wrap((function _callee18$(h){for(;;)switch(h.prev=h.next){case 0:if(validate({type:{type:"number",min:4,max:4,required:!1},opeType:{type:"number",min:1,max:2}},t),t.type||(t.type=4),!t.servers.length){h.next=10;break}return o=fi(fi({},t),{channels:map(a=t.servers).call(a,(function(t){return{serverId:t.serverId,channelId:""}}))}),h.next=6,this.core.qchatChannel.subscribeModuleService.subscribe(o);case 6:return c=h.sent,m=c.failedChannels,this.core.qchatChannel.subscribeModuleService.cacheSubscribe(o),h.abrupt("return",{failedServers:m});case 10:case"end":return h.stop()}}),_callee18,this)})))},a.banServerMember=function banServerMember(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee19(){return ci.wrap((function _callee19$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:fi(fi({},t),{opeType:1})});case 3:case"end":return a.stop()}}),_callee19,this)})))},a.unbanServerMember=function unbanServerMember(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee20(){return ci.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:fi(fi({},t),{opeType:2})});case 3:case"end":return a.stop()}}),_callee20,this)})))},a.getBannedMembersByPage=function getBannedMembersByPage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee21(){var a,o,c,m;return ci.wrap((function _callee21$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),h.next=3,this.core.sendCmd("qchatGetBannedMembersByPage",{tag:t});case 3:return a=h.sent,o=a.content,c=o.datas,m=o.listQueryTag,h.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:_u(m.nextTimetag)},datas:formatServerMemberBanInfos(c)});case 6:case"end":return h.stop()}}),_callee21,this)})))},a.serverSearchByPage=function serverSearchByPage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee22(){var a,o,c,m;return ci.wrap((function _callee22$(h){for(;;)switch(h.prev=h.next){case 0:if(validate({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},serverType:{type:"array",itemType:"number",min:0,required:!1},order:{type:"enum",values:getEnumKeys(iv),required:!1},searchType:{type:"enum",values:getEnumKeys(cv)},sort:{type:"enum",values:getEnumKeys(sv),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),!(t.startTime&&t.endTime&&t.startTime>=t.endTime)){h.next=3;break}throw new rc("startTime more than endTime",t,"timeRule");case 3:return h.next=5,this.core.sendCmd("qchatServerSearchByPage",{tag:fi(fi({},t),{order:t.order&&iv[t.order],searchType:cv[t.searchType],sort:sort(t)&&sv[sort(t)],serverType:gi(t.serverType)})});case 5:return a=h.sent,o=a.content,c=o.datas,m=o.listQueryTag,h.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:_u(m.nextTimetag),cursor:m.cursor},datas:formatServers(c)});case 8:case"end":return h.stop()}}),_callee22,this)})))},a.serverMemberSearchByPage=function serverMemberSearchByPage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee23(){var a;return ci.wrap((function _callee23$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatServerMemberSearchByPage",{tag:t});case 3:return a=o.sent,o.abrupt("return",formatMembers$1(a.content.members));case 5:case"end":return o.stop()}}),_callee23,this)})))},a.generateInviteCode=function generateInviteCode(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee24(){var a;return ci.wrap((function _callee24$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},ttl:{type:"number",min:0,required:!1}},t),o.next=3,this.core.sendCmd("qchatGenerateInviteCode",{tag:t});case 3:return a=o.sent,o.abrupt("return",format({expireTime:{type:"number"}},a.content.data));case 5:case"end":return o.stop()}}),_callee24,this)})))},a.joinByInviteCode=function joinByInviteCode(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee25(){return ci.wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},inviteCode:{type:"string",allowEmpty:!1},ps:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("qchatJoinByInviteCode",{tag:t});case 3:case"end":return a.stop()}}),_callee25,this)})))},a.getInviteApplyRecordOfServer=function getInviteApplyRecordOfServer(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee26(){var a;return ci.wrap((function _callee26$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfServer",{tag:fi(fi({},t),{reverse:reverse$1(t)?1:0})});case 3:return a=o.sent,o.abrupt("return",formatInviteApplyRecords(a.content.data));case 5:case"end":return o.stop()}}),_callee26,this)})))},a.getInviteApplyRecordOfSelf=function getInviteApplyRecordOfSelf(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee27(){var a;return ci.wrap((function _callee27$(o){for(;;)switch(o.prev=o.next){case 0:return validate({fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfSelf",{tag:fi(fi({},t),{reverse:reverse$1(t)?1:0})});case 3:return a=o.sent,o.abrupt("return",formatInviteApplyRecords(a.content.data));case 5:case"end":return o.stop()}}),_callee27,this)})))},a.markRead=function markRead(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee28(){var a,o,c,m;return ci.wrap((function _callee28$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverIds:{type:"array",itemType:"string",required:!0}},t),h.next=3,this.core.sendCmd("qchatClearServersUnread",t);case 3:return a=h.sent,o=formatClearServersUnread(a.content.clearServersUnreadTag),c=o.successServerIds,m=o.ackTimestamp,this.logger.log("qchatServer::clearServersUnread:: begin auto clear servers unreadInfo"),this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",c,m),h.abrupt("return",o);case 9:case"end":return h.stop()}}),_callee28,this)})))},a.subscribeAllChannel=function subscribeAllChannel(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee29(){var a,o,c,m,h=this;return ci.wrap((function _callee29$(v){for(;;)switch(v.prev=v.next){case 0:return validate({type:{type:"number",required:!0},serverIds:{type:"array",itemType:"string",required:!0,max:10}},t),v.next=3,this.core.sendCmd("qchatSubscribeChannelsByServers",t,{timeout:3e4});case 3:(o=v.sent).content.unreadInfos=formatUnreadInfos(o.content.unreadInfos),this.core.eventBus.emit("qchatChannel/cacheUnreadCount",o.content.unreadInfos),c={type:t.type,opeType:1,channels:map(a=o.content.unreadInfos).call(a,(function(t){return{serverId:t.serverId,channelId:t.channelId}}))},this.core.eventBus.emit("qchatChannel/cacheSubscribe",c),this.core.eventBus.emit("qchatChannel/getRoleIdsByServerId",t.serverIds),this.core.emit("unreadInfos",o.content.unreadInfos);try{o.content.failServerIds=JSON.parse(o.content.failServerIds),forEach$1(m=Gv(t.serverIds,o.content.failServerIds)).call(m,(function(t){h.core.emit("serverUnreadInfo",h.core.qchatChannel.subscribeModuleService.getServerUnreadInfo(t))}))}catch(t){this.core.logger.error("qchatServer::subscribeAllChannel: JSON parse failServerIds error",t)}return v.abrupt("return",o.content);case 12:case"end":return v.stop()}}),_callee29,this)})))},a.enterAsVisitor=function enterAsVisitor(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee30(){var a,o,c;return ci.wrap((function _callee30$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverIds:{type:"array",itemType:"string",min:1}},t),m.next=3,this.core.sendCmd("qchatEnterAsVisitor",{tag:{serverIds:gi(t.serverIds)}});case 3:a=m.sent,o=[];try{o=JSON.parse(a.content.failServerIds)}catch(t){o=[]}return c=Gv(t.serverIds,o),this.core.qchatChannel.subscribeForVisitorService.cacheServer(c),m.abrupt("return",{failedServers:o});case 9:case"end":return m.stop()}}),_callee30,this)})))},a.leaveAsVisitor=function leaveAsVisitor(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee31(){var a,o,c,m=this;return ci.wrap((function _callee31$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverIds:{type:"array",itemType:"string",min:1}},t),h.next=3,this.core.sendCmd("qchatLeaveAsVisitor",{tag:{serverIds:gi(t.serverIds)}});case 3:a=h.sent,o=[];try{o=JSON.parse(a.content.failServerIds)}catch(t){o=[]}return c=Gv(t.serverIds,o),forEach$1(c).call(c,(function(t){m.core.qchatChannel.subscribeForVisitorService.deleteServer(t)})),h.abrupt("return",{failedServers:o});case 9:case"end":return h.stop()}}),_callee31,this)})))},a.subscribeAsVisitor=function subscribeAsVisitor(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee32(){return ci.wrap((function _callee32$(a){for(;;)switch(a.prev=a.next){case 0:if(validate({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},serverIds:{type:"array",itemType:"string",min:1}},t),!t.serverIds.length){a.next=5;break}return a.next=4,this.core.qchatChannel.subscribeForVisitorService.subscribeServerAsVisitor(t);case 4:return a.abrupt("return",a.sent);case 5:return a.abrupt("return",{failedServers:[]});case 6:case"end":return a.stop()}}),_callee32,this)})))},QChatServerService}(vv);!function(t){t[t.everyone=1]="everyone",t[t.custom=2]="custom"}(Qv||(Qv={})),function(t){t[t.normal=0]="normal",t[t.owner=1]="owner"}(Wv||(Wv={})),function(t){t[t.ignore=0]="ignore",t[t.deny=-1]="deny",t[t.allow=1]="allow"}(Vv||(Vv={})),function(t){t[t.manageServer=1]="manageServer",t[t.manageChannel=2]="manageChannel",t[t.manageRole=3]="manageRole",t[t.sendMsg=4]="sendMsg",t[t.accountInfoSelf=5]="accountInfoSelf",t[t.inviteServer=6]="inviteServer",t[t.kickServer=7]="kickServer",t[t.accountInfoOther=8]="accountInfoOther",t[t.recallMsg=9]="recallMsg",t[t.deleteMsg=10]="deleteMsg",t[t.remindOther=11]="remindOther",t[t.remindEveryone=12]="remindEveryone",t[t.manageBlackWhiteList=13]="manageBlackWhiteList",t[t.banServerMember=14]="banServerMember",t[t.RTCChannelConnect=15]="RTCChannelConnect",t[t.RTCChannelDisconnectOther=16]="RTCChannelDisconnectOther",t[t.RTCChannelOpenMicrophone=17]="RTCChannelOpenMicrophone",t[t.RTCChannelOpenCamera=18]="RTCChannelOpenCamera",t[t.RTCChannelOpenCloseOtherMicrophone=19]="RTCChannelOpenCloseOtherMicrophone",t[t.RTCChannelOpenCloseOtherCamera=20]="RTCChannelOpenCloseOtherCamera",t[t.RTCChannelOpenCloseEveryoneMicrophone=21]="RTCChannelOpenCloseEveryoneMicrophone",t[t.RTCChannelOpenCloseEveryoneCamera=22]="RTCChannelOpenCloseEveryoneCamera",t[t.RTCChannelOpenShareScreen=23]="RTCChannelOpenShareScreen",t[t.RTCChannelCloseOtherShareScreen=24]="RTCChannelCloseOtherShareScreen",t[t.manageInviteApply=25]="manageInviteApply",t[t.manageInviteApplyHistory=26]="manageInviteApplyHistory",t[t.mentionedRole=27]="mentionedRole"}(Kv||(Kv={}));var Jv={type:{type:"enum",values:Qv},memberType:{type:"enum",values:Wv},createTime:{type:"number"},updateTime:{type:"number"},priority:{type:"number"},memberCount:{type:"number"},joinTime:{type:"number"}},Yv={roleId:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},type:{type:"enum",values:Qv},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"}},Xv={id:{type:"string"},accid:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},memberType:{type:"enum",values:Wv},joinTime:{type:"number"},inviter:{type:"string"}};function generatorRoleForCmd(t){var a=fi({},t),o=formatReverse(Jv,a);return o.auths&&(o.auths=function generateRoleAuthsForCmd(t){var a,o=reduce(a=ui(t)).call(a,(function(a,o){var c=Kv[o];return c?a[c]=Vv[t[o]]:a[o]=Vv[t[o]],a}),{});return gi(o)}(o.auths)),o}function formatRoleAuths(t){var a;return reduce(a=ui(t)).call(a,(function(a,o){var c=getEnumKeyByEnumValue(Kv,o);c?a[c]=Vv[t[o]]:a[_u(o)]=Vv[t[o]];return a}),{})}function formatRole(t){var a=format(Jv,t);return t.auths&&(a.auths=formatRoleAuths(JSON.parse(a.auths))),a.isMember&&delete a.isMember,a}function formatRoles(t){return xc(t)&&t.length>0?map(t).call(t,(function(t){return formatRole(t)})):[]}function formatChannelCategoryRole(t){return t.auths&&(t.auths=formatRoleAuths(JSON.parse(t.auths))),format(Yv,t)}function formatChannelCategoryMemberRole(t){return t.auths&&(t.auths=formatRoleAuths(JSON.parse(t.auths))),format(Xv,t)}collection("Set",(function(t){return function Set(){return t(this,arguments.length?arguments[0]:void 0)}}),Li);var Zv=H.Set;_export({target:"Set",stat:!0,forced:!0},{from:Di}),_export({target:"Set",stat:!0,forced:!0},{of:$i});_export({target:"Set",proto:!0,real:!0,forced:!0},{addAll:function addAll(){for(var t=anObject(this),a=aCallable(t.add),o=0,c=arguments.length;o<c;o++)E(a,t,arguments[o]);return t}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{deleteAll:Hi});var eb=getIterator;_export({target:"Set",proto:!0,real:!0,forced:!0},{every:function every(t){var a=anObject(this),o=eb(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return!iterate(o,(function(t,o){if(!c(t,t,a))return o()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{difference:function difference(t){var a=anObject(this),o=new(speciesConstructor(a,getBuiltIn("Set")))(a),c=aCallable(o.delete);return iterate(t,(function(t){E(c,o,t)})),o}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{filter:function filter(t){var a=anObject(this),o=eb(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0),m=new(speciesConstructor(a,getBuiltIn("Set"))),h=aCallable(m.add);return iterate(o,(function(t){c(t,t,a)&&E(h,m,t)}),{IS_ITERATOR:!0}),m}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{find:function find(t){var a=anObject(this),o=eb(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(o,(function(t,o){if(c(t,t,a))return o(t)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{intersection:function intersection(t){var a=anObject(this),o=new(speciesConstructor(a,getBuiltIn("Set"))),c=aCallable(a.has),m=aCallable(o.add);return iterate(t,(function(t){E(c,a,t)&&E(m,o,t)})),o}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{isDisjointFrom:function isDisjointFrom(t){var a=anObject(this),o=aCallable(a.has);return!iterate(t,(function(t,c){if(!0===E(o,a,t))return c()}),{INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{isSubsetOf:function isSubsetOf(t){var a=getIterator(this),o=anObject(t),c=o.has;return isCallable(c)||(o=new(getBuiltIn("Set"))(t),c=aCallable(o.has)),!iterate(a,(function(t,a){if(!1===E(c,o,t))return a()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{isSupersetOf:function isSupersetOf(t){var a=anObject(this),o=aCallable(a.has);return!iterate(t,(function(t,c){if(!1===E(o,a,t))return c()}),{INTERRUPTED:!0}).stopped}});var tb=k([].join),rb=[].push;_export({target:"Set",proto:!0,real:!0,forced:!0},{join:function join(t){var a=anObject(this),o=eb(a),c=void 0===t?",":toString$1(t),m=[];return iterate(o,rb,{that:m,IS_ITERATOR:!0}),tb(m,c)}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{map:function map(t){var a=anObject(this),o=eb(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0),m=new(speciesConstructor(a,getBuiltIn("Set"))),h=aCallable(m.add);return iterate(o,(function(t){E(h,m,c(t,t,a))}),{IS_ITERATOR:!0}),m}});var nb=TypeError;_export({target:"Set",proto:!0,real:!0,forced:!0},{reduce:function reduce(t){var a=anObject(this),o=eb(a),c=arguments.length<2,m=c?void 0:arguments[1];if(aCallable(t),iterate(o,(function(o){c?(c=!1,m=o):m=t(m,o,o,a)}),{IS_ITERATOR:!0}),c)throw nb("Reduce of empty set with no initial value");return m}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{some:function some(t){var a=anObject(this),o=eb(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(o,(function(t,o){if(c(t,t,a))return o()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{symmetricDifference:function symmetricDifference(t){var a=anObject(this),o=new(speciesConstructor(a,getBuiltIn("Set")))(a),c=aCallable(o.delete),m=aCallable(o.add);return iterate(t,(function(t){E(c,o,t)||E(m,o,t)})),o}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{union:function union(t){var a=anObject(this),o=new(speciesConstructor(a,getBuiltIn("Set")))(a);return iterate(t,aCallable(o.add),{that:o}),o}});var ab,ob,ib,sb,cb,lb,ub,db=Zv;!function(t){t[t.sendTime=1]="sendTime"}(ab||(ab={})),function(t){t[t.text=0]="text",t[t.image=1]="image",t[t.audio=2]="audio",t[t.video=3]="video",t[t.geo=4]="geo",t[t.notification=5]="notification",t[t.file=6]="file",t[t.tip=10]="tip",t[t.robot=11]="robot",t[t.g2=12]="g2",t[t.custom=100]="custom"}(ob||(ob={})),function(t){t[t.sending=1]="sending",t[t.success=2]="success",t[t.failed=3]="failed"}(ib||(ib={})),function(t){t[t.notifyAll=1]="notifyAll",t[t.notifySubscribe=2]="notifySubscribe"}(sb||(sb={})),function(t){t[t.unknown=0]="unknown",t[t.server=1]="server",t[t.channel=2]="channel",t[t.serverAccids=3]="serverAccids",t[t.channelAccids=4]="channelAccids",t[t.accids=5]="accids"}(cb||(cb={})),function(t){t[t.serverMemberInvite=1]="serverMemberInvite",t[t.serverMemberInviteReject=2]="serverMemberInviteReject",t[t.serverMemberApply=3]="serverMemberApply",t[t.serverMemberApplyReject=4]="serverMemberApplyReject",t[t.serverCreate=5]="serverCreate",t[t.serverRemove=6]="serverRemove",t[t.serverUpdate=7]="serverUpdate",t[t.serverMemberInviteDone=8]="serverMemberInviteDone",t[t.serverMemberInviteAccept=9]="serverMemberInviteAccept",t[t.serverMemberApplyDone=10]="serverMemberApplyDone",t[t.serverMemberApplyAccept=11]="serverMemberApplyAccept",t[t.serverMemberKick=12]="serverMemberKick",t[t.serverMemberLeave=13]="serverMemberLeave",t[t.serverMemberUpdate=14]="serverMemberUpdate",t[t.channelCreate=15]="channelCreate",t[t.channelRemove=16]="channelRemove",t[t.channelUpdate=17]="channelUpdate",t[t.channelUpdateWhiteBlackIdentify=18]="channelUpdateWhiteBlackIdentify",t[t.channelUpdateWhiteBlackIdentifyUser=19]="channelUpdateWhiteBlackIdentifyUser",t[t.updateQuickComment=20]="updateQuickComment",t[t.channelCategoryCreate=21]="channelCategoryCreate",t[t.channelCategoryRemove=22]="channelCategoryRemove",t[t.channelCategoryUpdate=23]="channelCategoryUpdate",t[t.channelCategoryUpdateWhiteBlackIdentify=24]="channelCategoryUpdateWhiteBlackIdentify",t[t.channelCategoryUpdateWhiteBlackIdentifyUser=25]="channelCategoryUpdateWhiteBlackIdentifyUser",t[t.serverIdentifyAdd=26]="serverIdentifyAdd",t[t.serverIdentifyRemove=27]="serverIdentifyRemove",t[t.serverIdentifyUpdate=28]="serverIdentifyUpdate",t[t.channelIdentifyUpdate=29]="channelIdentifyUpdate",t[t.userIdentifyUpdate=30]="userIdentifyUpdate",t[t.channelVisibilityUpdate=31]="channelVisibilityUpdate",t[t.serverEnterLeave=32]="serverEnterLeave",t[t.serverMemberJoinByInviteCode=33]="serverMemberJoinByInviteCode",t[t.channelVisibilityToVisitorUpdate=34]="channelVisibilityToVisitorUpdate",t[t.myMemberInfoUpdated=35]="myMemberInfoUpdated",t[t.custom=100]="custom",t[t.msgTyping=101]="msgTyping"}(lb||(lb={})),function(t){t[t.reply=1]="reply",t[t.thread=2]="thread",t[t.all=3]="all"}(ub||(ub={}));var now_1=function(){return hs.Date.now()},pb=Math.max,mb=Math.min;var hb=function debounce(t,a,o){var c,m,h,v,b,S,M=0,C=!1,T=!1,w=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function invokeFunc(a){var o=c,h=m;return c=m=void 0,M=a,v=t.apply(h,o)}function leadingEdge(t){return M=t,b=setTimeout(timerExpired,a),C?invokeFunc(t):v}function shouldInvoke(t){var o=t-S;return void 0===S||o>=a||o<0||T&&t-M>=h}function timerExpired(){var t=now_1();if(shouldInvoke(t))return trailingEdge(t);b=setTimeout(timerExpired,function remainingWait(t){var o=a-(t-S);return T?mb(o,h-(t-M)):o}(t))}function trailingEdge(t){return b=void 0,w&&c?invokeFunc(t):(c=m=void 0,v)}function debounced(){var t=now_1(),o=shouldInvoke(t);if(c=arguments,m=this,S=t,o){if(void 0===b)return leadingEdge(S);if(T)return clearTimeout(b),b=setTimeout(timerExpired,a),invokeFunc(S)}return void 0===b&&(b=setTimeout(timerExpired,a)),v}return a=df(a)||0,ws(o)&&(C=!!o.leading,h=(T="maxWait"in o)?pb(df(o.maxWait)||0,a):h,w="trailing"in o?!!o.trailing:w),debounced.cancel=function cancel(){void 0!==b&&clearTimeout(b),M=0,c=S=m=b=void 0},debounced.flush=function flush(){return void 0===b?v:trailingEdge(now_1())},debounced};var fb=function throttle(t,a,o){var c=!0,m=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return ws(o)&&(c="leading"in o?!!o.leading:c,m="trailing"in o?!!o.trailing:m),hb(t,a,{leading:c,maxWait:a,trailing:m})},gb=Math.min;var yb=function baseIntersection(t,a,o){for(var c=o?Ol:Pl,m=t[0].length,h=t.length,v=h,b=Array(h),S=1/0,M=[];v--;){var C=t[v];v&&a&&(C=Ul(C,Uc(a))),S=gb(C.length,S),b[v]=!o&&(a||m>=120&&C.length>=120)?new xl(v&&C):void 0}C=t[0];var T=-1,w=b[0];e:for(;++T<m&&M.length<S;){var I=C[T],k=a?a(I):I;if(I=o||0!==I?I:0,!(w?Bl(w,k):c(M,k,o))){for(v=h;--v;){var x=b[v];if(!(x?Bl(x,k):c(t[v],k,o)))continue e}w&&w.push(k),M.push(I)}}return M};var vb,bb=function castArrayLikeObject(t){return Jl(t)?t:[]},Sb=Vl((function(t){var a=Ul(t,bb);return a.length&&a[0]===t[0]?yb(a):[]}));!function(t){t[t.sub=1]="sub",t[t.unSub=2]="unSub"}(vb||(vb={}));var Mb,Cb=/*#__PURE__*/function(){function UnreadInfoModuleService(t){var a=this;this.unreadCount={},this.autoSubscribeUnreadMap={},this.autoSubscribeServerMap={},this.autoSubscribeTypingMap={},this.unreadServerCount={},this.serverRoleIdsMap={},this._serverUnreadInfo=fb((function(t){a.core.emit("serverUnreadInfo",a.getServerUnreadInfo(t))}),100),this.core=t}var t=UnreadInfoModuleService.prototype;return t.changeCacheServerRoleIds=function changeCacheServerRoleIds(t){var a,o=this,c=t.attach.serverIdentifyInfo,m=c.serverId,h=c.roleId,v=this.serverRoleIdsMap[m];if(v&&!(t.time<v.timeTag)){t.type===lb[lb.serverIdentifyAdd]?v.roleIds.add(h):v.roleIds.delete(h),this.core.logger.debug("QChatChannel::qchatChannel/serverIdentifyChange::now "+m+" roleIds is",concat(a=[]).call(a,v.roleIds));var b=this.unreadServerCount[m];if(b){var S=xf(ui(b),100);forEach$1(S).call(S,(function(t){o.core.qchatChannel.getChannelUnreadInfos({channels:map(t).call(t,(function(t){return{serverId:m,channelId:t}}))})}))}}},t.getRoleIdsByServerId=function getRoleIdsByServerId(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var a,o,c,m,h=this;return ci.wrap((function _callee$(v){for(;;)switch(v.prev=v.next){case 0:if((o=filter(t).call(t,(function(t){return!h.serverRoleIdsMap[t]}))).length){v.next=3;break}return v.abrupt("return");case 3:return c={serverIdTimeTags:o},this.core.logger.debug("QChatChannel:: getRoleIdsByServerId params is",c),v.next=7,this.core.sendCmd("qchatGetRoleIdsByServerId",{qchatGetRoleIdsByServerIdTag:c});case 7:m=v.sent,this.core.logger.debug("QChatChannel:: getRoleIdsByServerId result is",m),forEach$1(a=m.content.serverRoles).call(a,(function(t){try{t.roleIds=JSON.parse(t.roleIds)}catch(t){h.core.logger.error("QChatChannel:: getRoleIdsByServerId JSON parse roleIds error",t)}h.serverRoleIdsMap[t.serverId]={roleIds:new db(t.roleIds),timeTag:t.timeTag}}));case 10:case"end":return v.stop()}}),_callee,this)})))},t._unSubscribeChannel=function _unSubscribeChannel(t,a){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var o,c;return ci.wrap((function _callee2$(m){for(;;)switch(m.prev=m.next){case 0:if(o=t+"_"+a,c=this.autoSubscribeUnreadMap[o]){m.next=4;break}return m.abrupt("return");case 4:this.subscribe({opeType:vb.unSub,type:c,channels:[{serverId:t,channelId:a}]}),this.autoSubscribeUnreadMap[o]=void 0;case 6:case"end":return m.stop()}}),_callee2,this)})))},t.subscribe=function subscribe(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){var a,o,c,m,h=this;return ci.wrap((function _callee4$(v){for(;;)switch(v.prev=v.next){case 0:return validate({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},t),v.next=3,this.core.sendCmd("qchatSubscribe",{qchatSubReqTag:{type:t.type,opeType:t.opeType},channels:t.channels});case 3:return o=v.sent,c=new db,forEach$1(a=t.channels).call(a,(function(t){return __awaiter(h,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){return ci.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:this.serverRoleIdsMap[t.serverId]||c.add(t.serverId);case 1:case"end":return a.stop()}}),_callee3,this)})))})),m=xf(Fu(c),10),forEach$1(m).call(m,(function(t){h.getRoleIdsByServerId(t)})),v.abrupt("return",o.content);case 9:case"end":return v.stop()}}),_callee4,this)})))},t.resumeSubscribe=function resumeSubscribe(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee7(){var a,o,c,m,h,v,b,S=this;return ci.wrap((function _callee7$(M){for(;;)switch(M.prev=M.next){case 0:if(this.serverRoleIdsMap={},this.unreadServerCount={},this.unreadCount={},h=100,t.isAutoReconnect){M.next=6;break}return M.abrupt("return");case 6:return v={},forEach$1(a=ui(this.autoSubscribeUnreadMap)).call(a,(function(t){var a=S.autoSubscribeUnreadMap[t];if(a){var o=t.split("_"),c={serverId:o[0],channelId:o[1]};v[a]=v[a]||[],v[a].push(c)}})),v[5]=[],forEach$1(o=ui(this.autoSubscribeTypingMap)).call(o,(function(t){return __awaiter(S,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){var a,o,c,m;return ci.wrap((function _callee5$(h){for(;;)switch(h.prev=h.next){case 0:this.autoSubscribeTypingMap[t]&&(a=t.split("_"),o=a[0],c=a[1],m={serverId:o,channelId:c},v[5].push(m));case 2:case"end":return h.stop()}}),_callee5,this)})))})),v[4]=[],forEach$1(c=ui(this.autoSubscribeServerMap)).call(c,(function(t){return __awaiter(S,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){var a;return ci.wrap((function _callee6$(o){for(;;)switch(o.prev=o.next){case 0:this.autoSubscribeServerMap[t]&&(a={serverId:t},v[4].push(a));case 2:case"end":return o.stop()}}),_callee6,this)})))})),b=[],forEach$1(m=ui(v)).call(m,(function(t){var a=v[t];if(a&&0===a.length)return zo.resolve();if(a.length>h){var o=xf(a,100);return forEach$1(o).call(o,(function(a){b.push(S.createSubscribePromise(a,t))}))}b.push(S.createSubscribePromise(a,t))})),M.next=16,zo.all(b);case 16:case"end":return M.stop()}}),_callee7,this)})))},t.createSubscribePromise=function createSubscribePromise(t,a){var o=this,c={type:_u(a),opeType:1,channels:t};return this.core.logger.debug("qchatChannel:: autoSubscribeUnread params",c),this.subscribe(c).then((function(t){var a=t.unreadInfos;a&&a.length>0&&(a=formatUnreadInfos(a),o.cacheUnreadCount(a))})).catch((function(t){o.core.logger.error("qchatChannel:: autoSubscribeUnread error ",t)}))},t.cacheSubscribe=function cacheSubscribe(t){var a,o=this;forEach$1(a=t.channels).call(a,(function(a){var c=a.channelId?a.serverId+"_"+a.channelId:""+a.serverId,m=5===t.type?o.autoSubscribeTypingMap:4===t.type?o.autoSubscribeServerMap:o.autoSubscribeUnreadMap;t.opeType===vb.sub?m[c]=t.type:t.opeType===vb.unSub&&(m[c]=void 0)}))},t.cacheUnreadCount=function cacheUnreadCount(t){var a=this;forEach$1(t).call(t,(function(t){var o=t.serverId+"_"+t.channelId;a.unreadCount[o]=fi({},t),a.unreadServerCount[t.serverId]||(a.unreadServerCount[t.serverId]={}),a.unreadServerCount[t.serverId][t.channelId]=!0}))},t.getServerUnreadInfo=function getServerUnreadInfo(t){var a,o=this,c={serverId:t,unreadCount:0,mentionedCount:0,maxCount:0},m=this.unreadServerCount[t];m&&(forEach$1(a=ui(m)).call(a,(function(a){var m=t+"_"+a,h=o.unreadCount[m];c.unreadCount+=h.unreadCount,c.mentionedCount+=h.mentionedCount,void 0!==h.maxCount&&(c.maxCount=h.maxCount)})),c.unreadCount=c.unreadCount>c.maxCount?c.maxCount:c.unreadCount,c.mentionedCount=c.mentionedCount>c.maxCount?c.maxCount:c.mentionedCount);return c},t.getUnreadInfo=function getUnreadInfo(t){validate({serverId:{type:"string"},channelId:{type:"string"}},t);var a=t.serverId+"_"+t.channelId;return this.unreadCount[a]?this.unreadCount[a]:null},t.shouldChangeUnread=function shouldChangeUnread(t,a){if(!t.serverId||!t.channelId)return!1;if(this.core.qchatChannel.subscribeForVisitorService.isInSubscribeChannels(t.serverId,t.channelId))return!1;if(!1===t.historyEnable)return!1;if(!1===t.needBadge)return!1;if(t.fromAccount===this.core.account)return!1;if(a&&2!==(null==t?void 0:t.status))return!1;if(t.notifyReason&&t.notifyReason===getEnumKeyByEnumValue(sb,sb.notifySubscribe)){if(!t.serverId||!t.channelId)return!1;var o=this.getUnreadInfo({serverId:t.serverId,channelId:t.channelId}),c=a?"ackTimestamp":"lastMsgTime";if(!o)return!1;if(t.time&&o[c]&&o[c]>t.time)return!1}return!0},t.shouldChangeMentionedUnread=function shouldChangeMentionedUnread(t,a){return void 0===a&&(a=!1),__awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee8(){var o,c;return ci.wrap((function _callee8$(m){for(;;)switch(m.prev=m.next){case 0:if(!t.accidsOfMentionedRoles||!includes(o=t.accidsOfMentionedRoles).call(o,this.core.account)){m.next=2;break}return m.abrupt("return",!0);case 2:if(!t.mentionRoleIds||!t.serverId){m.next=16;break}if(this.serverRoleIdsMap[t.serverId]){m.next=9;break}if(a){m.next=7;break}return this.handledRoleMsg(t),m.abrupt("return",!1);case 7:return m.next=9,this.getRoleIdsByServerId([t.serverId]);case 9:c=0;case 10:if(!(c<t.mentionRoleIds.length)){m.next=16;break}if(!this.serverRoleIdsMap[t.serverId].roleIds.has(t.mentionRoleIds[c])){m.next=13;break}return m.abrupt("return",!0);case 13:c++,m.next=10;break;case 16:return m.abrupt("return",!1);case 17:case"end":return m.stop()}}),_callee8,this)})))},t.handledRoleMsg=function handledRoleMsg(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee9(){var a,o,c,m,h,v=this;return ci.wrap((function _callee9$(b){for(;;)switch(b.prev=b.next){case 0:if(t.mentionRoleIds){b.next=2;break}return b.abrupt("return");case 2:if(this.serverRoleIdsMap[t.serverId]){b.next=5;break}return b.next=5,this.getRoleIdsByServerId([t.serverId]);case 5:if(this.serverRoleIdsMap[t.serverId]){b.next=8;break}return this.core.logger.warn("QChatChannel::handledRoleMsg::can not get serverRoleIds,server id",t.serverId),b.abrupt("return");case 8:if(o=!1,forEach$1(a=t.mentionRoleIds).call(a,(function(a){v.serverRoleIdsMap[t.serverId].roleIds.has(a)&&(o=!0,v.core.logger.debug("QChatChannel::handledRoleMsg::will update message mentionedCount，message is ",t))})),o){b.next=12;break}return b.abrupt("return");case 12:if(c=this.unreadCount[t.serverId+"_"+t.channelId],m=2===(null==t?void 0:t.status),c.mentionedCount=m?c.mentionedCount?c.mentionedCount-1:0:c.mentionedCount?c.mentionedCount+1:1,"number"!=typeof c.maxCount){b.next=24;break}if(!((h=(h=c.mentionedCount)>c.maxCount?c.maxCount:h)>c.maxCount)){b.next=21;break}return this.core.logger.debug("QChatChannel::handledRoleMsg::tempUnreadCount more than maxCount"),b.abrupt("return");case 21:this.core.emit("unreadInfo",fi(fi({},c),{mentionedCount:h})),this.core.emit("unreadInfos",[fi(fi({},c),{mentionedCount:h})]),this._serverUnreadInfo(t.serverId);case 24:case"end":return b.stop()}}),_callee9,this)})))},t.getMentionedFlag=function getMentionedFlag(t,a){return void 0===a&&(a=!1),__awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee10(){var o;return ci.wrap((function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:if(!t.mentionAll){c.next=4;break}return c.abrupt("return",!0);case 4:if(!t.mentionRoleIds&&!t.accidsOfMentionedRoles){c.next=10;break}return c.next=7,this.shouldChangeMentionedUnread(t,a);case 7:return c.abrupt("return",c.sent);case 10:if(!t.mentionAccids||!includes(o=t.mentionAccids).call(o,this.core.account)){c.next=12;break}return c.abrupt("return",!0);case 12:return c.abrupt("return",!1);case 13:case"end":return c.stop()}}),_callee10,this)})))},t.changeUnread=function changeUnread(t,a){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee11(){var o,c,m,h,v,b,S,M,C;return ci.wrap((function _callee11$(T){for(;;)switch(T.prev=T.next){case 0:if(o=t.serverId,c=t.channelId,m=o+"_"+c,this.shouldChangeUnread(t,a)){T.next=6;break}return this.core.logger.debug("changeUnread: "+m+" does not need to update unreadInfo"),T.abrupt("return");case 6:if(this.unreadCount[m]){T.next=11;break}return T.next=9,this.core.qchatChannel.getChannelUnreadInfos({channels:[{serverId:o,channelId:c}]});case 9:return!this.serverRoleIdsMap[o]&&t.mentionRoleIds&&this.getRoleIdsByServerId([o]),T.abrupt("return");case 11:return h=this.unreadCount[m],v=2===(null==t?void 0:t.status),T.next=15,this.getMentionedFlag(t);case 15:if(b=T.sent,v?(h.unreadCount=h.unreadCount?h.unreadCount-1:0,b&&(h.mentionedCount=h.mentionedCount?h.mentionedCount-1:0),this.core.logger.debug("changeUnread: "+m+" unread reduce ",h)):(h.unreadCount=h.unreadCount?h.unreadCount+1:1,b&&(h.mentionedCount=h.mentionedCount?h.mentionedCount+1:1),this.core.logger.debug("changeUnread: "+m+" unread add ",h)),delete h.lastMsgTime,S=h.maxCount,M=h.mentionedCount,C=h.unreadCount,"number"!=typeof S){T.next=27;break}if(M=M>S?S:M,!((C=C>S?S:C)>S)){T.next=27;break}return this.core.logger.debug("QChatChannel::subscribe::tempUnreadCount more than maxCount"),T.abrupt("return");case 27:this.core.logger.warn("unreadInfo event will abandon,please use unreadInfos"),this.core.emit("unreadInfo",fi(fi({},h),{mentionedCount:M,unreadCount:C})),this.core.emit("unreadInfos",[fi(fi({},h),{mentionedCount:M,unreadCount:C})]),this._serverUnreadInfo(o);case 31:case"end":return T.stop()}}),_callee11,this)})))},t.updateUnread=function updateUnread(t){var a=t.serverId,o=t.channelId,c=a+"_"+o,m=this.unreadCount[c];m&&m.ackTimestamp&&t&&t.ackTimestamp&&m.ackTimestamp>t.ackTimestamp?this.core.logger.debug("qchat channel updateUnread exist: ",null==m?void 0:m.ackTimestamp,null==t?void 0:t.ackTimestamp):(this.core.logger.debug("qchat channel updateUnread: ",t),this.unreadCount[c]=t,this.unreadServerCount[a]||(this.unreadServerCount[a]={}),this.unreadServerCount[a][o]=!0,this.core.logger.warn("unreadInfo event will abandon,please use unreadInfos"),this.core.emit("unreadInfo",this.unreadCount[c]),this.core.emit("unreadInfos",[this.unreadCount[c]]),this._serverUnreadInfo(a))},t.clearUnreadCountByServers=function clearUnreadCountByServers(t,a){var o,c=this,m=[];forEach$1(t).call(t,(function(t){var a;c.unreadServerCount[t]&&forEach$1(a=ui(c.unreadServerCount[t])).call(a,(function(a){m.push(t+"_"+a)}))})),forEach$1(m).call(m,(function(t){c.unreadCount[t].unreadCount=c.unreadCount[t].mentionedCount=0,c.unreadCount[t].ackTimestamp=a})),this.core.emit("unreadInfos",map(m).call(m,(function(t){return c.unreadCount[t]}))),forEach$1(o=Sb(t,ui(this.unreadServerCount))).call(o,(function(t){c.core.emit("serverUnreadInfo",c.getServerUnreadInfo(t))}))},UnreadInfoModuleService}(),Tb=/*#__PURE__*/function(){function SubscribeForVisitorService(t){this.limitForBatchEnter=10,this.limitForBatchSubscribe=100,this.autoServers=new db,this.autoVisitorSubscribeServer=new db,this.autoVisitorSubscribeChannel=new db,this.core=t}var t=SubscribeForVisitorService.prototype;return t.subscribeChannelAsVisitor=function subscribeChannelAsVisitor(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var a,o,c,m,h=this;return ci.wrap((function _callee$(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:t.type||6,opeType:t.opeType},datas:t.channels});case 2:return o=v.sent,c=o.content.failedArr,m=filter(a=t.channels).call(a,(function(t){return!some(c).call(c,(function(a){return a.channelId===t.channelId&&a.serverId===t.serverId}))})),forEach$1(m).call(m,(function(a){1===t.opeType?h.autoVisitorSubscribeChannel.add(a.serverId+"&"+a.channelId):h.autoVisitorSubscribeChannel.delete(a.serverId+"&"+a.channelId)})),v.abrupt("return",{failedChannels:c});case 7:case"end":return v.stop()}}),_callee,this)})))},t.subscribeServerAsVisitor=function subscribeServerAsVisitor(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var a,o,c,m,h,v,b=this;return ci.wrap((function _callee2$(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:t.type||7,opeType:t.opeType},datas:map(a=t.serverIds).call(a,(function(t){return{serverId:t}}))});case 2:return m=S.sent,h=m.content.failedArr,v=filter(o=t.serverIds).call(o,(function(t){return!some(h).call(h,(function(a){return a.serverId===t}))})),forEach$1(v).call(v,(function(a){1===t.opeType?b.autoVisitorSubscribeServer.add(a):b.autoVisitorSubscribeServer.delete(a)})),S.abrupt("return",{failedServers:map(c=m.content.failedArr).call(c,(function(t){return t.serverId}))});case 7:case"end":return S.stop()}}),_callee2,this)})))},t.deleteServer=function deleteServer(t){var a;this.autoServers.delete(t),this.autoVisitorSubscribeServer.has(t)&&this.subscribeServerAsVisitor({opeType:2,serverIds:[t]});var o=[];forEach$1(a=this.autoVisitorSubscribeChannel).call(a,(function(a){if(0===indexOf(a).call(a,t)){var c=a.replace(t+"&","");o.push({serverId:t,channelId:c})}})),o.length>0&&this.subscribeChannelAsVisitor({opeType:2,channels:o})},t.deleteAutoSetInServerId=function deleteAutoSetInServerId(t){var a,o=this;this.autoServers.delete(t),this.autoVisitorSubscribeServer.delete(t),forEach$1(a=this.autoVisitorSubscribeChannel).call(a,(function(a){0===indexOf(a).call(a,t)&&o.autoVisitorSubscribeChannel.delete(a)}))},t.deleteAutoSetInChannel=function deleteAutoSetInChannel(t,a){this.autoVisitorSubscribeChannel.delete(t+"&"+a)},t.unSubscribeChannel=function unSubscribeChannel(t,a){this.subscribeChannelAsVisitor({opeType:2,channels:[{serverId:t,channelId:a}]})},t.isInSubscribeChannels=function isInSubscribeChannels(t,a){return this.autoVisitorSubscribeChannel.has(t+"&"+a)},t.isInAutoServers=function isInAutoServers(t){return this.autoServers.has(t)},t.doAutoSubscribe=function doAutoSubscribe(){var t=this,a=[],o=xf(Fu(this.autoVisitorSubscribeServer),this.limitForBatchSubscribe);forEach$1(o).call(o,(function(o){a.push(t.subscribeServerAsVisitor({opeType:1,serverIds:o}))}));var c=xf(Fu(this.autoVisitorSubscribeChannel),this.limitForBatchSubscribe);return forEach$1(c).call(c,(function(o){a.push(t.subscribeChannelAsVisitor({opeType:1,channels:map(o).call(o,(function(t){var a=indexOf(t).call(t,"&");return{serverId:slice(t).call(t,0,a),channelId:slice(t).call(t,a+1)}}))}))})),zo.all(a)},t.doAutoEnterServer=function doAutoEnterServer(){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var t,a,o,c=this;return ci.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:return t=xf(Fu(this.autoServers),this.limitForBatchEnter),a=[],forEach$1(t).call(t,(function(t){a.push(c.core.qchatServer.enterAsVisitor({serverIds:t}))})),m.next=5,zo.all(a);case 5:o=m.sent,forEach$1(o).call(o,(function(t){var a;forEach$1(a=t.failedServers).call(a,(function(t){c.deleteAutoSetInServerId(t)}))}));case 7:case"end":return m.stop()}}),_callee3,this)})))},t.resumeSubscribe=function resumeSubscribe(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){return ci.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:if(!t.isAutoReconnect){a.next=7;break}return a.next=3,this.doAutoEnterServer();case 3:return a.next=5,this.doAutoSubscribe();case 5:a.next=10;break;case 7:this.autoServers.clear(),this.autoVisitorSubscribeChannel.clear(),this.autoVisitorSubscribeServer.clear();case 10:case"end":return a.stop()}}),_callee4,this)})))},t.cacheServer=function cacheServer(t){var a=this;forEach$1(t).call(t,(function(t){return a.autoServers.add(t)}))},SubscribeForVisitorService}();!function(t){t[t.sub=1]="sub",t[t.unSub=2]="unSub"}(Mb||(Mb={}));var _b,wb,Ib=/*#__PURE__*/function(t){function QChatChannelService(a){var o,c,m,h,v,b,S;return(S=t.call(this,"qchatChannel",a)||this).core=a,registerParser({cmdMap:bv,cmdConfig:Tv}),S.subscribeModuleService=new Cb(a),S.subscribeForVisitorService=new Tb(a),S.core.eventBus.on("qchatChannel/changeUnread",bind$1(o=S.subscribeModuleService.changeUnread).call(o,S.subscribeModuleService)),S.core.eventBus.on("qchatChannel/updateUnread",bind$1(c=S.subscribeModuleService.updateUnread).call(c,S.subscribeModuleService)),S.core.eventBus.on("qchatChannel/cacheUnreadCount",bind$1(m=S.subscribeModuleService.cacheUnreadCount).call(m,S.subscribeModuleService)),S.core.eventBus.on("qchatChannel/cacheSubscribe",bind$1(h=S.subscribeModuleService.cacheSubscribe).call(h,S.subscribeModuleService)),S.core.eventBus.on("qchatChannel/clearUnreadCountByServers",bind$1(v=S.subscribeModuleService.clearUnreadCountByServers).call(v,S.subscribeModuleService)),S.core.eventBus.on("qchatChannel/getRoleIdsByServerId",bind$1(b=S.subscribeModuleService.getRoleIdsByServerId).call(b,S.subscribeModuleService)),S.core.eventBus.on("logined",(function(t){S.subscribeModuleService.resumeSubscribe(t),S.subscribeForVisitorService.resumeSubscribe(t)})),S.core.eventBus.on("qchatChannel/autoUnSubscribe",(function(t){if(S.logger.log("QChatChannel::enter autoUnSubscribe sysMsg is",t),t.type===lb[lb.channelVisibilityUpdate])S.logger.log("QChatChannel::begin autoUnSubscribe channel key is",t.serverId+"_"+t.channelId),S.subscribeModuleService._unSubscribeChannel(t.serverId,t.channelId),S.logger.log("QChatChannel::autoUnSubscribe channel done key is",t.serverId+"_"+t.channelId);else if(t.type===lb[lb.serverEnterLeave]){var a;S.subscribeModuleService.autoSubscribeServerMap[t.serverId]&&(S.logger.log("QChatChannel::begin autoUnSubscribe server key is",t.serverId),S.subscribeModuleService.subscribe({type:4,opeType:Mb.unSub,channels:[{serverId:t.serverId,channelId:""}]}),S.logger.log("QChatChannel::autoUnSubscribe server done key is",t.serverId));var o=S.subscribeModuleService.unreadServerCount[t.serverId];if(!o)return;S.logger.log("QChatChannel::begin autoUnSubscribe channels key is",ui(o)),forEach$1(a=ui(o)).call(a,(function(a){S.subscribeModuleService._unSubscribeChannel(t.serverId,a)})),S.logger.log("QChatChannel::autoUnSubscribe channels done key is",ui(o))}})),S.core.eventBus.on("qchatChannel/serverIdentifyChange",(function(t){S.subscribeModuleService.changeCacheServerRoleIds(t)})),S}Mt(QChatChannelService,t);var a=QChatChannelService.prototype;return a.createChannel=function createChannel(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var a;return ci.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Uv)},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},t),o.next=3,this.core.sendCmd("qchatCreateChannel",{channelInfo:fi(fi({},t),{type:Uv[t.type]}),antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatChannel(a.content.channelInfo));case 5:case"end":return o.stop()}}),_callee,this)})))},a.deleteChannel=function deleteChannel(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){return ci.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatDeleteChannel",t);case 3:case"end":return a.stop()}}),_callee2,this)})))},a.updateChannel=function updateChannel(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var a,o;return ci.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return validate({channelId:{type:"string",min:1},serverId:{type:"string",required:!1},type:{type:"enum",values:getEnumKeys(Uv),required:!1},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},t),a=t,t.type&&(a.type=Uv[t.type]),c.next=5,this.core.sendCmd("qchatUpdateChannel",{channelInfo:a,antispamTag:generateAntispamTag(t)});case 5:return o=c.sent,c.abrupt("return",formatChannel(o.content.channelInfo));case 7:case"end":return c.stop()}}),_callee3,this)})))},a.getChannels=function getChannels(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){var a;return ci.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return validate({channelIds:{type:"array",itemType:"string",min:1}},t),o.next=3,this.core.sendCmd("qchatGetChannels",t);case 3:return a=o.sent,o.abrupt("return",formatChannels(a.content.channelList));case 5:case"end":return o.stop()}}),_callee4,this)})))},a.getChannelsByPage=function getChannelsByPage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){var a,o,c,m;return ci.wrap((function _callee5$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),h.next=3,this.core.sendCmd("qchatGetChannelsByPage",{qchatGetChannelListPageTag:fi({limit:100},t)});case 3:return a=h.sent,o=a.content,c=o.datas,m=o.listQueryTag,h.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:_u(m.nextTimetag)},datas:formatChannels(c)});case 6:case"end":return h.stop()}}),_callee5,this)})))},a.getMembersByPage=function getMembersByPage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){var a,o,c,m;return ci.wrap((function _callee6$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),h.next=3,this.core.sendCmd("qchatGetMembersByPage",{qchatGetMembersByPageTag:t});case 3:return a=h.sent,o=a.content,c=o.datas,m=o.listQueryTag,h.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:_u(m.nextTimetag)},datas:formatMembers$1(c)});case 6:case"end":return h.stop()}}),_callee6,this)})))},a.updateWhiteBlackRole=function updateWhiteBlackRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee7(){return ci.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},roleId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Pv)},opeType:{type:"enum",values:getEnumKeys(Ov)}},t),a.next=3,this.core.sendCmd("qchatUpdateWhiteBlackRole",{qchatUpdateWhiteBlackRoleTag:fi(fi({},t),{type:Pv[t.type],opeType:Ov[t.opeType]})});case 3:case"end":return a.stop()}}),_callee7,this)})))},a.getWhiteBlackRolesPage=function getWhiteBlackRolesPage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee8(){var a,o,c,m;return ci.wrap((function _callee8$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Pv)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),h.next=3,this.core.sendCmd("qchatGetWhiteBlackRolesPage",{qchatGetWhiteBlackRolesPageTag:fi(fi({},t),{type:Pv[t.type]})});case 3:return a=h.sent,o=a.content,c=o.datas,m=o.listQueryTag,h.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:_u(m.nextTimetag)},datas:formatRoles(c)});case 6:case"end":return h.stop()}}),_callee8,this)})))},a.updateWhiteBlackMembers=function updateWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee9(){return ci.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Pv)},opeType:{type:"enum",values:getEnumKeys(Ov)},toAccids:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatUpdateWhiteBlackMembers",{qchatUpdateWhiteBlackMembersTag:fi(fi({},t),{type:Pv[t.type],opeType:Ov[t.opeType],toAccids:gi(t.toAccids)})});case 3:case"end":return a.stop()}}),_callee9,this)})))},a.getWhiteBlackMembersPage=function getWhiteBlackMembersPage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee10(){var a,o,c,m;return ci.wrap((function _callee10$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Pv)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),h.next=3,this.core.sendCmd("qchatGetWhiteBlackMembersPage",{qchatGetWhiteBlackMembersPageTag:fi(fi({limit:100},t),{type:Pv[t.type]})});case 3:return a=h.sent,o=a.content,c=o.datas,m=o.listQueryTag,h.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:_u(m.nextTimetag)},datas:formatMembers$1(c)});case 6:case"end":return h.stop()}}),_callee10,this)})))},a.getExistingWhiteBlackRoles=function getExistingWhiteBlackRoles(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee11(){var a,o;return ci.wrap((function _callee11$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Pv)},roleIds:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackRoles",{qchatGetExistingWhiteBlackRolesTag:fi(fi({},t),{type:Pv[t.type],roleIds:gi(t.roleIds)})});case 3:return a=c.sent,o=a.content.datas,c.abrupt("return",{datas:formatRoles(o)});case 6:case"end":return c.stop()}}),_callee11,this)})))},a.getExistingWhiteBlackMembers=function getExistingWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee12(){var a,o;return ci.wrap((function _callee12$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Pv)},accids:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackMembers",{qchatGetExistingWhiteBlackMembersTag:fi(fi({},t),{type:Pv[t.type],accids:gi(t.accids)})});case 3:return a=c.sent,o=a.content.datas,c.abrupt("return",{datas:formatMembers$1(o)});case 6:case"end":return c.stop()}}),_callee12,this)})))},a.updateCategoryInfoOfChannel=function updateCategoryInfoOfChannel(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee13(){var a;return ci.wrap((function _callee13$(o){for(;;)switch(o.prev=o.next){case 0:return validate({channelId:{type:"string",min:1},categoryId:{type:"string",allowEmpty:!1,required:!1},syncMode:{type:"number",min:0,max:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateCategoryInfoOfChannel",{qchatUpdateCategoryInfoOfChannelTag:t});case 3:return a=o.sent,o.abrupt("return",formatChannel(a.content.channelInfo));case 5:case"end":return o.stop()}}),_callee13,this)})))},a.createChannelCategory=function createChannelCategory(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee14(){var a;return ci.wrap((function _callee14$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatCreateChannelCategory",{qchatCreateChannelCategoryTag:t});case 3:return a=o.sent,o.abrupt("return",formatChannelCategory(a.content.QChatChannelCategoryInfo));case 5:case"end":return o.stop()}}),_callee14,this)})))},a.removeChannelCategory=function removeChannelCategory(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee15(){return ci.wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelCategory",t);case 3:case"end":return a.stop()}}),_callee15,this)})))},a.updateChannelCategory=function updateChannelCategory(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee16(){var a;return ci.wrap((function _callee16$(o){for(;;)switch(o.prev=o.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateChannelCategory",{qchatUpdateChannelCategoryTag:t});case 3:return a=o.sent,o.abrupt("return",formatChannelCategory(a.content.QChatChannelCategoryInfo));case 5:case"end":return o.stop()}}),_callee16,this)})))},a.getChannelCategoriesByID=function getChannelCategoriesByID(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee17(){var a;return ci.wrap((function _callee17$(o){for(;;)switch(o.prev=o.next){case 0:return validate({categoryIds:{type:"array",itemType:"string",min:1}},t),o.next=3,this.core.sendCmd("qchatGetChannelCategoriesByID",t);case 3:return a=o.sent,o.abrupt("return",formatChannelCategorys(a.content.channelCategoryList));case 5:case"end":return o.stop()}}),_callee17,this)})))},a.updateChannelCategoryWhiteBlackRole=function updateChannelCategoryWhiteBlackRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee18(){return ci.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Pv)},opeType:{type:"enum",values:getEnumKeys(Ov)},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackRole",{qchatUpdateChannelCategoryWhiteBlackRoleTag:fi(fi({},t),{type:Pv[t.type],opeType:Ov[t.opeType]})});case 3:case"end":return a.stop()}}),_callee18,this)})))},a.getChannelCategoryWhiteBlackRolesPage=function getChannelCategoryWhiteBlackRolesPage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee19(){var a,o,c,m;return ci.wrap((function _callee19$(h){for(;;)switch(h.prev=h.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Pv)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),h.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRolesPage",{qchatGetChannelCategoryWhiteBlackRolesPageTag:fi(fi({},t),{type:Pv[t.type]})});case 3:return a=h.sent,o=a.content,c=o.datas,m=o.listQueryTag,h.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:_u(m.nextTimetag)},datas:formatRoles(c)});case 6:case"end":return h.stop()}}),_callee19,this)})))},a.updateChannelCategoryWhiteBlackMembers=function updateChannelCategoryWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee20(){return ci.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Pv)},opeType:{type:"enum",values:getEnumKeys(Ov)},toAccids:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackMembers",{qchatUpdateChannelCategoryWhiteBlackMembersTag:fi(fi({},t),{type:Pv[t.type],opeType:Ov[t.opeType],toAccids:gi(t.toAccids)})});case 3:case"end":return a.stop()}}),_callee20,this)})))},a.getChannelCategoryWhiteBlackMembersPage=function getChannelCategoryWhiteBlackMembersPage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee21(){var a,o,c,m;return ci.wrap((function _callee21$(h){for(;;)switch(h.prev=h.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Pv)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),h.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembersPage",{qchatGetChannelCategoryWhiteBlackMembersPageTag:fi(fi({},t),{type:Pv[t.type]})});case 3:return a=h.sent,o=a.content,c=o.datas,m=o.listQueryTag,h.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:_u(m.nextTimetag)},datas:formatMembers$1(c)});case 6:case"end":return h.stop()}}),_callee21,this)})))},a.getChannelCategoryWhiteBlackRoles=function getChannelCategoryWhiteBlackRoles(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee22(){var a,o;return ci.wrap((function _callee22$(c){for(;;)switch(c.prev=c.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Pv)},roleIds:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRoles",{qchatGetChannelCategoryWhiteBlackRolesTag:fi(fi({},t),{type:Pv[t.type],roleIds:gi(t.roleIds)})});case 3:return a=c.sent,o=a.content.datas,c.abrupt("return",formatRoles(o));case 6:case"end":return c.stop()}}),_callee22,this)})))},a.getChannelCategoryWhiteBlackMembers=function getChannelCategoryWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee23(){var a,o;return ci.wrap((function _callee23$(c){for(;;)switch(c.prev=c.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Pv)},accids:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembers",{qchatGetChannelCategoryWhiteBlackMembersTag:fi(fi({},t),{type:Pv[t.type],accids:gi(t.accids)})});case 3:return a=c.sent,o=a.content.datas,c.abrupt("return",formatMembers$1(o));case 6:case"end":return c.stop()}}),_callee23,this)})))},a.getChannelCategoriesPage=function getChannelCategoriesPage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee24(){var a,o,c,m;return ci.wrap((function _callee24$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),h.next=3,this.core.sendCmd("qchatGetChannelCategoriesPage",{qchatGetChannelCategoriesPageTag:t});case 3:return a=h.sent,o=a.content,c=o.datas,m=o.listQueryTag,h.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:_u(m.nextTimetag)},datas:formatChannelCategorys(c)});case 6:case"end":return h.stop()}}),_callee24,this)})))},a.getChannelCategoryChannelsPage=function getChannelCategoryChannelsPage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee25(){var a,o,c,m;return ci.wrap((function _callee25$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),h.next=3,this.core.sendCmd("qchatGetChannelCategoryChannelsPage",{qchatGetChannelCategoryChannelsPageTag:t});case 3:return a=h.sent,o=a.content,c=o.datas,m=o.listQueryTag,h.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:_u(m.nextTimetag)},datas:formatChannels(c)});case 6:case"end":return h.stop()}}),_callee25,this)})))},a.subscribeChannel=function subscribeChannel(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee26(){var a,o;return ci.wrap((function _callee26$(c){for(;;)switch(c.prev=c.next){case 0:return validate({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},t),c.next=3,this.subscribeModuleService.subscribe(t);case 3:if((a=c.sent).unreadInfos=formatUnreadInfos(a.unreadInfos),1===t.opeType&&(t.channels=map(o=a.unreadInfos).call(o,(function(t){return{serverId:t.serverId,channelId:t.channelId}}))),this.logger.debug("QChatChannel::subscribeChannel:: cacheSubscribe ",t),this.subscribeModuleService.cacheSubscribe(t),5!==t.type){c.next=10;break}return c.abrupt("return");case 10:return this.subscribeModuleService.cacheUnreadCount(a.unreadInfos),c.abrupt("return",a);case 12:case"end":return c.stop()}}),_callee26,this)})))},a.getChannelUnreadInfos=function getChannelUnreadInfos(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee27(){var a,o,c=this;return ci.wrap((function _callee27$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("qchatGetUnreadInfo",t);case 2:return a=m.sent,o=formatUnreadInfos(a.content.unreadInfos),forEach$1(o).call(o,(function(t){return c.subscribeModuleService.updateUnread(t)})),m.abrupt("return",o);case 6:case"end":return m.stop()}}),_callee27,this)})))},a.getChannelSearchByPage=function getChannelSearchByPage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee28(){var a,o,c,m;return ci.wrap((function _callee28$(h){for(;;)switch(h.prev=h.next){case 0:if(validate({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:1,required:!1},order:{type:"enum",values:getEnumKeys(iv),required:!1},limit:{type:"number",min:1,required:!1},serverId:{type:"string",required:!1},sort:{type:"enum",values:getEnumKeys(qv),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),!(t.startTime&&t.endTime&&t.startTime>=t.endTime)){h.next=3;break}throw new rc("startTime more than endTime",t,"timeRule");case 3:return h.next=5,this.core.sendCmd("qchatGetChannelSearchByPage",{qchatGetChannelSearchByPageTag:fi(fi({},t),{order:t.order&&iv[t.order],sort:sort(t)&&qv[sort(t)]})});case 5:return a=h.sent,o=a.content,c=o.datas,m=o.listQueryTag,h.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:_u(m.nextTimetag),cursor:m.cursor},datas:formatChannels(c)});case 8:case"end":return h.stop()}}),_callee28,this)})))},a.channelMemberSearch=function channelMemberSearch(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee29(){var a;return ci.wrap((function _callee29$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatChannelMemberSearch",{qchatChannelMemberSearchTag:t});case 3:return a=o.sent,o.abrupt("return",formatChannelMembers(a.content.datas));case 5:case"end":return o.stop()}}),_callee29,this)})))},a.subscribeAsVisitor=function subscribeAsVisitor(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee30(){return ci.wrap((function _callee30$(a){for(;;)switch(a.prev=a.next){case 0:return validate({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},channels:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},min:1}},t),a.next=3,this.subscribeForVisitorService.subscribeChannelAsVisitor(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee30,this)})))},QChatChannelService}(vv),kb={"24_61":"qchatCreateServerRole","24_62":"qchatDeleteServerRole","24_63":"qchatUpdateServerRole","24_64":"qchatGetServerRoles","24_65":"qchatAddChannelRole","24_66":"qchatRemoveChannelRole","24_67":"qchatUpdateChannelRole","24_68":"qchatGetChannelRoles","24_69":"qchatAddMemberRole","24_70":"qchatRemoveMemberRole","24_71":"qchatUpdateMemberRole","24_72":"qchatGetMemberRoles","24_73":"qchatAddMembersToServerRole","24_74":"qchatRemoveMembersFromServerRole","24_75":"qchatGetMembersFromServerRole","24_76":"qchatGetServerRolesByAccid","24_77":"qchatGetExistingServerRolesByAccids","24_78":"qchatGetExistingChannelRolesByServerRoleIds","24_79":"qchatGetExistingAccidsOfMemberRoles","24_80":"qchatUpdateServerRolePriorities","24_81":"qchatGetExistingAccidsInServerRole","24_82":"qchatCheckPermission","24_83":"qchatAddChannelCategoryRole","24_84":"qchatRemoveChannelCategoryRole","24_85":"qchatUpdateChannelCategoryRole","24_86":"qchatGetChannelCategoryRole","24_87":"qchatAddChannelCategoryMemberRole","24_88":"qchatRemoveChannelCategoryMemberRole","24_89":"qchatUpdateChannelCategoryMemberRole","24_90":"qchatGetChannelCategoryMemberRole","24_126":"qchatCheckPermissions"},xb={channelRole:{serverId:1,roleId:2,parentRoleId:3,channelId:4,name:5,icon:6,ext:7,auths:8,type:9,createTime:10,updateTime:11},memberRole:{serverId:1,id:2,accid:3,channelId:4,auths:5,createTime:6,updateTime:7,nick:8,avatar:9,ext:10,memberType:11,joinTime:12,inviter:13},antispamTag:{antiSpamBusinessId:1},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11,isMember:12},getRoleByPagesTag:{serverId:1,channelId:2,time:3,limit:4},checkPermissionTag:{serverId:1,channelId:2,auth:3},member:{serverId:1,roleId:2,accid:3,createTime:4,updateTime:5,nick:6,avatar:7,ext:8,type:9,joinTime:10,inviter:11},qchatAddChannelCategoryRoleTag:{categoryId:3,serverId:4,parentRoleId:5},channelCategoryRole:{roleId:1,categoryId:3,serverId:4,parentRoleId:5,type:6,validFlag:7,createTime:8,updateTime:9,auths:10,name:11,icon:12,ext:13},qchatGetChannelCategoryRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},channelCategoryMemberRole:{id:1,accid:3,categoryId:4,serverId:5,validFlag:6,createTime:7,updateTime:8,auths:9,nick:10,avatar:11,ext:12,memberType:13,joinTime:14,inviter:15},qchatGetChannelCategoryMemberRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},checkPermissionsTag:{serverId:1,channelId:2,auths:3}},Rb=invertSerializeMap(xb),Eb={qchatCreateServerRole:{service:"qchatRole",sid:24,cid:61,params:[{type:"Property",name:"serverRole",reflectMapper:xb.serverRole},{type:"Property",name:"antispamTag",reflectMapper:xb.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:Rb.serverRole}]},qchatDeleteServerRole:{service:"qchatRole",sid:24,cid:62,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"}]},qchatUpdateServerRole:{service:"qchatRole",sid:24,cid:63,params:[{type:"Property",name:"updateServerRoleTag",reflectMapper:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,priority:7}},{type:"Property",name:"antispamTag",reflectMapper:xb.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:Rb.serverRole}]},qchatGetServerRoles:{service:"qchatRole",sid:24,cid:64,params:[{type:"Property",name:"getServerRolesTag",reflectMapper:{serverId:1,timetag:2,limit:3,priority:4,channelId:5,categoryId:6}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:Rb.serverRole}]},qchatAddChannelRole:{service:"qchatRole",sid:24,cid:65,params:[{type:"Property",name:"channelRole",reflectMapper:xb.channelRole}],response:[{type:"Property",name:"channelRole",reflectMapper:Rb.channelRole}]},qchatRemoveChannelRole:{service:"qchatRole",sid:24,cid:66,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelRole:{service:"qchatRole",sid:24,cid:67,params:[{type:"Property",name:"updateChannelRoleTag",reflectMapper:{serverId:1,roleId:2,channelId:3,auths:4}}],response:[{type:"Property",name:"channelRole",reflectMapper:Rb.channelRole}]},qchatGetChannelRoles:{service:"qchatRole",sid:24,cid:68,params:[{type:"Property",name:"getChannelRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:Rb.channelRole}]},qchatAddMemberRole:{service:"qchatRole",sid:24,cid:69,params:[{type:"Property",name:"memberRole",reflectMapper:xb.memberRole}],response:[{type:"Property",name:"memberRole",reflectMapper:Rb.memberRole}]},qchatRemoveMemberRole:{service:"qchatRole",sid:24,cid:70,params:[{type:"Property",name:"memberRole",reflectMapper:xb.memberRole}]},qchatUpdateMemberRole:{service:"qchatRole",sid:24,cid:71,params:[{type:"Property",name:"updateMemberRoleTag",reflectMapper:{serverId:1,accid:2,channelId:3,auths:4}}],response:[{type:"Property",name:"memberRole",reflectMapper:Rb.memberRole}]},qchatGetMemberRoles:{service:"qchatRole",sid:24,cid:72,params:[{type:"Property",name:"getMemberRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:Rb.memberRole}]},qchatAddMembersToServerRole:{service:"qchatRole",sid:24,cid:73,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatRemoveMembersFromServerRole:{service:"qchatRole",sid:24,cid:74,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatGetMembersFromServerRole:{service:"qchatRole",sid:24,cid:75,params:[{type:"Property",name:"getMembersFromServerRoleTag",reflectMapper:{serverId:1,roleId:2,timetag:3,accid:4,limit:5}}],response:[{type:"PropertyArray",name:"members",reflectMapper:Rb.member}]},qchatGetServerRolesByAccid:{service:"qchatRole",sid:24,cid:76,params:[{type:"Property",name:"getServerRolesByAccidTag",reflectMapper:{serverId:1,accid:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:Rb.serverRole}]},qchatGetExistingServerRolesByAccids:{service:"qchatRole",sid:24,cid:77,params:[{type:"Long",name:"serverId"},{type:"String",name:"accids"}],response:[{type:"String",name:"serverRoles"}]},qchatGetExistingChannelRolesByServerRoleIds:{service:"qchatRole",sid:24,cid:78,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"roleIds"}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:Rb.channelRole}]},qchatGetExistingAccidsOfMemberRoles:{service:"qchatRole",sid:24,cid:79,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:Rb.memberRole}]},qchatUpdateServerRolePriorities:{service:"qchatRole",sid:24,cid:80,params:[{type:"Long",name:"serverId"},{type:"PropertyArray",name:"serverRoles",reflectMapper:{serverId:1,roleId:2,priority:7}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:Rb.serverRole}]},qchatGetExistingAccidsInServerRole:{service:"qchatRole",sid:24,cid:81,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"members",reflectMapper:Rb.member}]},qchatCheckPermission:{service:"qchatRole",sid:24,cid:82,params:[{type:"Property",name:"checkPermissionTag",reflectMapper:xb.checkPermissionTag}],response:[{type:"Boolean",name:"checked"}]},qchatAddChannelCategoryRole:{service:"qchatRole",sid:24,cid:83,params:[{type:"Property",name:"qchatAddChannelCategoryRoleTag",reflectMapper:xb.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:Rb.channelCategoryRole}]},qchatRemoveChannelCategoryRole:{service:"qchatRole",sid:24,cid:84,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelCategoryRole:{service:"qchatRole",sid:24,cid:85,params:[{type:"Property",name:"qchatUpdateChannelCategoryRoleTag",reflectMapper:xb.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:Rb.channelCategoryRole}]},qchatGetChannelCategoryRole:{service:"qchatRole",sid:24,cid:86,params:[{type:"Property",name:"qchatGetChannelCategoryRoleTag",reflectMapper:xb.qchatGetChannelCategoryRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:Rb.channelCategoryRole}]},qchatAddChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:87,params:[{type:"Property",name:"qchatAddChannelCategoryMemberRoleTag",reflectMapper:xb.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:Rb.channelCategoryMemberRole}]},qchatRemoveChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:88,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"String",name:"accid"}]},qchatUpdateChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:89,params:[{type:"Property",name:"qchatUpdateChannelCategoryMemberRoleTag",reflectMapper:xb.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:Rb.channelCategoryMemberRole}]},qchatGetChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:90,params:[{type:"Property",name:"qchatGetChannelCategoryMemberRoleTag",reflectMapper:xb.qchatGetChannelCategoryMemberRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:Rb.channelCategoryMemberRole}]},qchatCheckPermissions:{service:"qchatRole",sid:24,cid:126,params:[{type:"Property",name:"checkPermissionsTag",reflectMapper:xb.checkPermissionsTag}],response:[{type:"PropertyArray",name:"checkPermissionsResult",reflectMapper:{1:"auth",2:"isAllow"}}]}},Ab=/*#__PURE__*/function(){function CategoryModuleService(t){this.core=t}var t=CategoryModuleService.prototype;return t.addChannelCategoryRole=function addChannelCategoryRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var a;return ci.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatAddChannelCategoryRole",{qchatAddChannelCategoryRoleTag:t});case 3:return a=o.sent,o.abrupt("return",formatChannelCategoryRole(a.content.channelCategoryRole));case 5:case"end":return o.stop()}}),_callee,this)})))},t.removeChannelCategoryRole=function removeChannelCategoryRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){return ci.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelCategoryRole",t);case 3:case"end":return a.stop()}}),_callee2,this)})))},t.updateChannelCategoryRole=function updateChannelCategoryRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var a;return ci.wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object"}},t),o.next=3,this.core.sendCmd("qchatUpdateChannelCategoryRole",{qchatUpdateChannelCategoryRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=o.sent).raw.code){o.next=6;break}throw new tc("No update required",{},406);case 6:return o.abrupt("return",formatChannelCategoryRole(a.content.channelCategoryRole));case 7:case"end":return o.stop()}}),_callee3,this)})))},t.getChannelCategoryRole=function getChannelCategoryRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){var a;return ci.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetChannelCategoryRole",{qchatGetChannelCategoryRoleTag:t});case 3:return a=o.sent,o.abrupt("return",(c=a.content.list,xc(c)&&c.length>0?map(c).call(c,(function(t){return formatChannelCategoryRole(t)})):[]));case 5:case"end":return o.stop()}var c}),_callee4,this)})))},t.addChannelCategoryMemberRole=function addChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){var a;return ci.wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatAddChannelCategoryMemberRole",{qchatAddChannelCategoryMemberRoleTag:t});case 3:return a=o.sent,o.abrupt("return",formatChannelCategoryMemberRole(a.content.channelCategoryMemberRole));case 5:case"end":return o.stop()}}),_callee5,this)})))},t.removeChannelCategoryMemberRole=function removeChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){return ci.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelCategoryMemberRole",t);case 3:case"end":return a.stop()}}),_callee6,this)})))},t.updateChannelCategoryMemberRole=function updateChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee7(){var a;return ci.wrap((function _callee7$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object"}},t),o.next=3,this.core.sendCmd("qchatUpdateChannelCategoryMemberRole",{qchatUpdateChannelCategoryMemberRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=o.sent).raw.code){o.next=6;break}throw new tc("No update required",{},406);case 6:return o.abrupt("return",formatChannelCategoryMemberRole(a.content.channelCategoryMemberRole));case 7:case"end":return o.stop()}}),_callee7,this)})))},t.getChannelCategoryMemberRole=function getChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee8(){var a;return ci.wrap((function _callee8$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetChannelCategoryMemberRole",{qchatGetChannelCategoryMemberRoleTag:t});case 3:return a=o.sent,o.abrupt("return",(c=a.content.list,xc(c)&&c.length>0?map(c).call(c,(function(t){return formatChannelCategoryMemberRole(t)})):[]));case 5:case"end":return o.stop()}var c}),_callee8,this)})))},CategoryModuleService}(),qb=/*#__PURE__*/function(t){function QChatRoleService(a){var o;return(o=t.call(this,"qchatRole",a)||this).core=a,registerParser({cmdMap:kb,cmdConfig:Eb}),o.category=new Ab(a),o}Mt(QChatRoleService,t);var a=QChatRoleService.prototype;return a.createServerRole=function createServerRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var a;return ci.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1},priority:{type:"number",min:1},icon:{type:"string",required:!1},ext:{type:"string",required:!1}},t),o.next=3,this.core.sendCmd("qchatCreateServerRole",{serverRole:fi(fi({},generatorRoleForCmd(t)),{type:Qv.custom}),antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatRole(a.content.serverRole));case 5:case"end":return o.stop()}}),_callee,this)})))},a.updateServerRole=function updateServerRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var a;return ci.wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},name:{type:"string",required:!1},icon:{type:"string",required:!1},ext:{type:"string",required:!1},priority:{type:"number",required:!1},auths:{type:"object",required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateServerRole",{updateServerRoleTag:generatorRoleForCmd(t),antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatRole(a.content.serverRole));case 5:case"end":return o.stop()}}),_callee2,this)})))},a.deleteServerRole=function deleteServerRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){return ci.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatDeleteServerRole",t);case 3:case"end":return a.stop()}}),_callee3,this)})))},a.getServerRoles=function getServerRoles(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){var a,o,c;return ci.wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},categoryId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},priority:{type:"number",required:!1}},t),m.next=3,this.core.sendCmd("qchatGetServerRoles",{getServerRolesTag:generatorRoleForCmd(t)});case 3:return o=m.sent,c=filter(a=o.content.serverRoles).call(a,(function(t){return 1===_u(t.isMember)})),c=map(c).call(c,(function(t){return t.roleId})),m.abrupt("return",{roles:formatRoles(o.content.serverRoles),isMemberRoles:c});case 7:case"end":return m.stop()}}),_callee4,this)})))},a.addChannelRole=function addChannelRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){var a;return ci.wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatAddChannelRole",{channelRole:generatorRoleForCmd(t)});case 3:return a=o.sent,o.abrupt("return",formatRole(a.content.channelRole));case 5:case"end":return o.stop()}}),_callee5,this)})))},a.getChannelRoles=function getChannelRoles(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){var a;return ci.wrap((function _callee6$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetChannelRoles",{getChannelRolesTag:t});case 3:return a=o.sent,o.abrupt("return",formatRoles(a.content.channelRoles));case 5:case"end":return o.stop()}}),_callee6,this)})))},a.removeChannelRole=function removeChannelRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee7(){return ci.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelRole",t);case 3:case"end":return a.stop()}}),_callee7,this)})))},a.updateChannelRole=function updateChannelRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee8(){var a;return ci.wrap((function _callee8$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateChannelRole",{updateChannelRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=o.sent).raw.code){o.next=6;break}throw new tc("No update required",{},406);case 6:return o.abrupt("return",formatRole(a.content.channelRole));case 7:case"end":return o.stop()}}),_callee8,this)})))},a.addMemberRole=function addMemberRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee9(){var a;return ci.wrap((function _callee9$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatAddMemberRole",{memberRole:t});case 3:return a=o.sent,o.abrupt("return",formatRole(a.content.memberRole));case 5:case"end":return o.stop()}}),_callee9,this)})))},a.getMemberRoles=function getMemberRoles(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee10(){var a;return ci.wrap((function _callee10$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetMemberRoles",{getMemberRolesTag:t});case 3:return a=o.sent,o.abrupt("return",formatRoles(a.content.memberRoles));case 5:case"end":return o.stop()}}),_callee10,this)})))},a.removeMemberRole=function removeMemberRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee11(){return ci.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveMemberRole",{memberRole:t});case 3:case"end":return a.stop()}}),_callee11,this)})))},a.updateMemberRole=function updateMemberRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee12(){var a;return ci.wrap((function _callee12$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateMemberRole",{updateMemberRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=o.sent).raw.code){o.next=6;break}throw new tc("No update required",{},406);case 6:return o.abrupt("return",formatRole(a.content.memberRole));case 7:case"end":return o.stop()}}),_callee12,this)})))},a.addMembersToServerRole=function addMembersToServerRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee13(){var a,o,c;return ci.wrap((function _callee13$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},t),m.next=3,this.core.sendCmd("qchatAddMembersToServerRole",fi(fi({},t),{accids:gi(t.accids)}));case 3:return a=m.sent,o=dd(a,"content.accids.successAccids"),c=dd(a,"content.accids.failedAccids"),m.abrupt("return",{successAccids:o?JSON.parse(o):[],failedAccids:c?JSON.parse(c):[]});case 7:case"end":return m.stop()}}),_callee13,this)})))},a.removeMembersFromServerRole=function removeMembersFromServerRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee14(){var a,o,c;return ci.wrap((function _callee14$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},t),m.next=3,this.core.sendCmd("qchatRemoveMembersFromServerRole",fi(fi({},t),{accids:gi(t.accids)}));case 3:return a=m.sent,o=dd(a,"content.accids.successAccids"),c=dd(a,"content.accids.failedAccids"),m.abrupt("return",{successAccids:o?JSON.parse(o):[],failedAccids:c?JSON.parse(c):[]});case 7:case"end":return m.stop()}}),_callee14,this)})))},a.getMembersFromServerRole=function getMembersFromServerRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee15(){var a;return ci.wrap((function _callee15$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},accid:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetMembersFromServerRole",{getMembersFromServerRoleTag:t});case 3:return a=o.sent,o.abrupt("return",formatRoles(a.content.members));case 5:case"end":return o.stop()}}),_callee15,this)})))},a.getServerRolesByAccid=function getServerRolesByAccid(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee16(){var a;return ci.wrap((function _callee16$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetServerRolesByAccid",{getServerRolesByAccidTag:t});case 3:return a=o.sent,o.abrupt("return",formatRoles(a.content.serverRoles));case 5:case"end":return o.stop()}}),_callee16,this)})))},a.getExistingServerRolesByAccids=function getExistingServerRolesByAccids(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee17(){var a,o,c;return ci.wrap((function _callee17$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},t),m.next=3,this.core.sendCmd("qchatGetExistingServerRolesByAccids",{serverId:t.serverId,accids:gi(t.accids)});case 3:return a=m.sent,m.prev=4,c=JSON.parse(a.content.serverRoles),forEach$1(o=ui(c)).call(o,(function(t){var a;forEach$1(a=c[t]).call(a,(function(a,o){c[t][o]=deserialize(a,Rb.serverRole)})),c[t]=formatRoles(c[t])})),m.abrupt("return",c);case 10:throw m.prev=10,m.t0=m.catch(4),this.logger.error("can not parse serverRolesGroupByAccid from "+t.serverId+" and "+t.accids,a.content.serverRoles),m.t0;case 14:case"end":return m.stop()}}),_callee17,this,[[4,10]])})))},a.getExistingChannelRolesByServerRoleIds=function getExistingChannelRolesByServerRoleIds(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee18(){var a;return ci.wrap((function _callee18$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleIds:{type:"array",itemType:"string"}},t),o.next=3,this.core.sendCmd("qchatGetExistingChannelRolesByServerRoleIds",{serverId:t.serverId,channelId:t.channelId,roleIds:gi(t.roleIds)});case 3:return a=o.sent,o.abrupt("return",formatRoles(a.content.channelRoles));case 5:case"end":return o.stop()}}),_callee18,this)})))},a.getExistingAccidsOfMemberRoles=function getExistingAccidsOfMemberRoles(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee19(){var a,o;return ci.wrap((function _callee19$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},t),c.next=3,this.core.sendCmd("qchatGetExistingAccidsOfMemberRoles",{serverId:t.serverId,channelId:t.channelId,accids:gi(t.accids)});case 3:return a=c.sent,o=a.content.memberRoles,c.abrupt("return",o&&o.length>0?map(o).call(o,(function(t){return t.accid})):[]);case 6:case"end":return c.stop()}}),_callee19,this)})))},a.getExistingAccidsInServerRole=function getExistingAccidsInServerRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee20(){var a,o;return ci.wrap((function _callee20$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},t),c.next=3,this.core.sendCmd("qchatGetExistingAccidsInServerRole",{serverId:t.serverId,roleId:t.roleId,accids:gi(t.accids)});case 3:return a=c.sent,o=a.content.members,c.abrupt("return",o&&o.length>0?map(o).call(o,(function(t){return t.accid})):[]);case 6:case"end":return c.stop()}}),_callee20,this)})))},a.updateServerRolePriorities=function updateServerRolePriorities(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee21(){var a,o;return ci.wrap((function _callee21$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},serverRoles:{type:"array"}},t),c.next=3,this.core.sendCmd("qchatUpdateServerRolePriorities",{serverId:t.serverId,serverRoles:map(a=t.serverRoles).call(a,(function(t){return{serverId:t.serverId,roleId:t.roleId,priority:t.priority}}))});case 3:return o=c.sent,c.abrupt("return",formatRoles(o.content.serverRoles));case 5:case"end":return c.stop()}}),_callee21,this)})))},a.checkPermission=function checkPermission(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee22(){var a;return ci.wrap((function _callee22$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auth:{type:"string"}},t),o.next=3,this.core.sendCmd("qchatCheckPermission",{checkPermissionTag:fi(fi({},t),{auth:Kv[t.auth]||t.auth})});case 3:return a=o.sent,o.abrupt("return",a.content.checked);case 5:case"end":return o.stop()}}),_callee22,this)})))},a.addChannelCategoryRole=function addChannelCategoryRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee23(){return ci.wrap((function _callee23$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.addChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee23,this)})))},a.removeChannelCategoryRole=function removeChannelCategoryRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee24(){return ci.wrap((function _callee24$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.removeChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee24,this)})))},a.updateChannelCategoryRole=function updateChannelCategoryRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee25(){return ci.wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.updateChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee25,this)})))},a.getChannelCategoryRole=function getChannelCategoryRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee26(){return ci.wrap((function _callee26$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.getChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee26,this)})))},a.addChannelCategoryMemberRole=function addChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee27(){return ci.wrap((function _callee27$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.addChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee27,this)})))},a.removeChannelCategoryMemberRole=function removeChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee28(){return ci.wrap((function _callee28$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.removeChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee28,this)})))},a.updateChannelCategoryMemberRole=function updateChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee29(){return ci.wrap((function _callee29$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.updateChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee29,this)})))},a.getChannelCategoryMemberRole=function getChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee30(){return ci.wrap((function _callee30$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.getChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee30,this)})))},a.checkPermissions=function checkPermissions(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee31(){var a,o,c,m;return ci.wrap((function _callee31$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auths:{type:"array",itemType:"string"}},t),this.core.logger.log("qchatRole::checkPermission options is",t),h.next=4,this.core.sendCmd("qchatCheckPermissions",{checkPermissionsTag:fi(fi({},t),{auths:gi(map(a=t.auths).call(a,(function(t){return Kv[t]||t})))})});case 4:return c=h.sent,this.core.logger.log("qchatRole::checkPermission result is",c.content),m={},forEach$1(o=c.content.checkPermissionsResult).call(o,(function(t){m[t.auth]=t.isAllow})),this.core.logger.log("qchatRole::checkPermission auths is",m),h.abrupt("return",formatRoleAuths(m));case 10:case"end":return h.stop()}}),_callee31,this)})))},QChatRoleService}(vv),Pb={"24_10":"qchatSendMsg","24_11":"qchatOnMsg","24_12":"qchatOnRecvUnreadInfo","24_13":"qchatSendCustomSysMsg","24_14":"qchatOnSysMsg","24_16":"qchatGetHistoryMsg","24_17":"qchatMarkMessageRead","24_18":"qchatMultiSyncMessageRead","24_22":"qchatUpdateSystemNotification","24_23":"qchatMultiSyncSystemNotificationUpdate","24_24":"qchatSyncSystemNotification","24_25":"qchatUpdateMessage","24_26":"qchatRecvMessageUpdate","24_28":"qchatMarkSysMsgRead","24_94":"qchatMessageSearchByPage","24_100":"qchatGetMessageHistoryByIds","24_101":"qchatGetThreadMessages","24_102":"qchatUpdateQuickComment","24_103":"qchatGetQuickComments","24_108":"qchatGetThreadRootMessagesMeta","24_121":"qchatGetLastMessageOfChannels","24_127":"qchatGetMentionedMeMessages","25_6":"qchatMultiSyncServersMessageRead"},Ob={getHistoryMsgTag:{serverId:1,channelId:2,beginTime:3,endTime:4,excludeMsgId:5,limit:6,reverse:7},getThreadHistoryMsgTag:{beginTime:1,endTime:2,excludeMsgId:3,limit:4,reverse:5},qchatMsgTag:{serverId:1,channelId:2,fromAccount:3,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,updateTime:8,type:9,body:10,attach:11,ext:12,msgIdClient:13,msgIdServer:14,resendFlag:15,status:16,pushPayload:17,pushContent:18,mentionAccids:19,mentionAll:20,env:21,callbackExt:22,replyMsgFromAccount:23,replyMsgTime:24,replyMsgIdServer:25,replyMsgIdClient:26,threadMsgFromAccount:27,threadMsgTime:28,threadMsgIdServer:29,threadMsgIdClient:30,useCustomContent:31,antiSpamContent:32,antiSpamBusinessId:33,antiSpamUsingYidun:34,yidunCallback:35,yidunAntiCheating:36,yidunAntiSpamExt:37,yidunAntiSpamRes:38,mentionRoleIds:41,accidsOfMentionedRoles:42,updateContent:39,updateOperatorInfo:40,subType:61,historyEnable:100,pushEnable:101,needBadge:102,needPushNick:103,notifyReason:104,routeEnable:105,isAntispam:106},sysMsg:{toType:1,serverId:2,channelId:3,toAccids:4,fromAccount:5,fromClientType:6,fromDeviceId:7,fromNick:8,time:9,updateTime:10,type:11,msgIdClient:12,msgIdServer:13,body:14,attach:15,ext:16,resendFlag:17,status:18,pushPayload:19,pushContent:20,env:21,callbackExt:22,persistEnable:100,pushEnable:101,needBadge:102,needPushNick:103,routeEnable:104},qchatMsgUpdateTag:{operatorAccount:1,operatorClientType:2,ps:3,ext:4,pushContent:5,pushPayload:6,env:7,routeEnable:100},markMsgReadTag:{serverId:1,channelId:2,time:3},qchatQuickCommentRequestTag:{serverId:1,channelId:2,fromAccount:3,msgIdServer:4,time:5,type:6,opeType:7,opeAccid:8},qchatQuickCommentQueryTag:{serverId:1,channelId:2,msgIdServerList:3},qchatGetLastMessageOfChannelsTag:{serverId:1,channelIdList:2},qchatMultiSyncServersMessageReadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},qchatMessageSearchByPageTag:{keyword:1,serverId:2,channelId:3,fromAccid:4,fromTime:5,toTime:6,msgTypes:7,subTypes:8,includeSelf:9,order:10,limit:11,sort:12,cursor:13},qchatPageQueryTag:{hasMore:1,nextTimetag:2,cursor:3},unreadInfo:Sv},Ub=invertSerializeMap(Ob),Bb={qchatSendMsg:{service:"qchatMsg",sid:24,cid:10,params:[{type:"Property",name:"qchatMsg",reflectMapper:Ob.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:Ub.qchatMsgTag}]},qchatOnMsg:{service:"qchatMsg",sid:24,cid:11,response:[{type:"Property",name:"qchatMsg",reflectMapper:Ub.qchatMsgTag}]},qchatOnRecvUnreadInfo:{service:"qchatMsg",sid:24,cid:12,response:[{type:"Property",name:"qchatMsg",reflectMapper:Ub.qchatMsgTag}]},qchatSendCustomSysMsg:{service:"qchatMsg",sid:24,cid:13,params:[{type:"Property",name:"sysMsg",reflectMapper:Ob.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:Ub.sysMsg}]},qchatOnSysMsg:{service:"qchatMsg",sid:24,cid:14,response:[{type:"Property",name:"sysMsg",reflectMapper:Ub.sysMsg}]},qchatGetHistoryMsg:{service:"qchatMsg",sid:24,cid:16,params:[{type:"Property",name:"getHistoryMsgTag",reflectMapper:Ob.getHistoryMsgTag}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:Ub.qchatMsgTag}]},qchatUpdateMessage:{service:"qchatMsg",sid:24,cid:25,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:Ob.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:Ob.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:Ub.qchatMsgTag}]},qchatRecvMessageUpdate:{service:"qchatMsg",sid:24,cid:26,response:[{type:"Property",name:"qchatMsgUpdateInfo",reflectMapper:Ub.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:Ub.qchatMsgTag}]},qchatMarkMessageRead:{sid:24,cid:17,service:"qchatMsg",params:[{type:"Property",name:"markMsgReadTag",reflectMapper:Ob.markMsgReadTag}],response:[{type:"Property",name:"unreadInfo",reflectMapper:Ub.unreadInfo}]},qchatMultiSyncMessageRead:{sid:24,cid:18,service:"qchatMsg",response:[{type:"Property",name:"unreadInfo",reflectMapper:Ub.unreadInfo}]},qchatUpdateSystemNotification:{service:"qchatMsg",sid:24,cid:22,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:Ob.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:Ob.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:Ub.sysMsg}]},qchatMultiSyncSystemNotificationUpdate:{service:"qchatMsg",sid:24,cid:23,response:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:Ub.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:Ub.sysMsg}]},qchatSyncSystemNotification:{service:"qchatMsg",sid:24,cid:24,response:[{type:"PropertyArray",name:"systemNotifications",reflectMapper:Ub.sysMsg}]},qchatMarkSysMsgRead:{service:"qchatMsg",sid:24,cid:28,params:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:Ob.sysMsg}]},qchatMessageSearchByPage:{service:"qchatMsg",sid:24,cid:94,params:[{type:"Property",name:"qchatMessageSearchByPageTag",reflectMapper:Ob.qchatMessageSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:Ub.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:Ub.qchatMsgTag}]},qchatGetMessageHistoryByIds:{service:"qchatMsg",sid:24,cid:100,params:[{type:"Property",name:"channelInfo",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"messageReferList",reflectMapper:{msgIdServer:1,time:2}}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:Ub.qchatMsgTag}]},qchatGetThreadMessages:{service:"qchatMsg",sid:24,cid:101,params:[{type:"Property",name:"qchatMsg",reflectMapper:Ob.qchatMsgTag},{type:"Property",name:"getThreadHistoryMsgTag",reflectMapper:Ob.getThreadHistoryMsgTag}],response:[{type:"Property",name:"thread",reflectMapper:Ub.qchatMsgTag},{type:"Property",name:"threadInfo",reflectMapper:{1:"messageCount",2:"lastMessageTimestamp"}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:Ub.qchatMsgTag}]},qchatUpdateQuickComment:{service:"qchatMsg",sid:24,cid:102,params:[{type:"Property",name:"tag",reflectMapper:Ob.qchatQuickCommentRequestTag}]},qchatGetQuickComments:{service:"qchatMsg",sid:24,cid:103,params:[{type:"Property",name:"tag",reflectMapper:Ob.qchatQuickCommentQueryTag}],response:[{type:"PropertyArray",name:"quickCommentResponse",reflectMapper:{1:"serverId",2:"channelId",3:"msgIdServer",4:"totalCount",5:"lastUpdateTime",6:"details"}}]},qchatGetThreadRootMessagesMeta:{service:"qchatMsg",sid:24,cid:108,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:{time:7,msgIdServer:14}}],response:[{type:"PropertyArray",name:"metas",reflectMapper:{1:"total",2:"timestamp",3:"msgIdServer",4:"msgTime"}}]},qchatGetLastMessageOfChannels:{service:"qchatMsg",sid:24,cid:121,params:[{type:"Property",name:"tag",reflectMapper:Ob.qchatGetLastMessageOfChannelsTag}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Ub.qchatMsgTag}]},qchatMultiSyncServersMessageRead:{service:"qchatMsg",sid:25,cid:6,response:[{type:"Property",name:"qchatMultiSyncServersMessageReadTag",reflectMapper:Ub.qchatMultiSyncServersMessageReadTag}]},qchatGetMentionedMeMessages:{service:"qchatMsg",sid:24,cid:127,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2,timestamp:3,limit:4}}],response:[{type:"Property",name:"page",reflectMapper:Ub.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:Ub.qchatMsgTag}]}};!function(t){t[t.Android=1]="Android",t[t.iOS=2]="iOS",t[t.PC=4]="PC",t[t.WindowsPhone=8]="WindowsPhone",t[t.Web=16]="Web",t[t.Server=32]="Server",t[t.Mac=64]="Mac"}(_b||(_b={}));var Fb=["image","audio","video","file"],Lb={time:{type:"number"},updateTime:{type:"number"},resendFlag:{type:"boolean"},persistEnable:{type:"boolean"},routeEnable:{type:"boolean"},pushEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},type:{type:"enum",values:lb},fromClientType:{type:"enum",values:_b},status:{type:"number"},toAccids:{type:"object"},toType:{type:"number"},attach:{type:"object"},pushPayload:{type:"object"}};function generatorSysMsgForCmd(t,a){var o=fi({},t),c=fi({type:a||lb.custom},formatReverse(Lb,o));return c.serverId&&c.channelId&&c.toAccids?c.toType=cb.channelAccids:c.serverId&&c.toAccids?c.toType=cb.serverAccids:c.serverId&&c.channelId?c.toType=cb.channel:c.serverId?c.toType=cb.server:c.toAccids?c.toType=cb.accids:c.toType=cb.unknown,c}function generatorSysMsgMarkersForCmd(t){var a=Rm(t,["msgIdServer","type"]);return formatReverse(Lb,a)}var jb=((wb={})[lb.channelUpdateWhiteBlackIdentify]=function(t){return t.notify=formatUpdateWhiteBlackRole(deserialize(t.notify,Cv.qchatUpdateWhiteBlackRoleTag)),t},wb[lb.channelUpdateWhiteBlackIdentifyUser]=function(t){return t.notify=function formatUpdateWhiteBlackMembers(t){return format(jv,t)}(deserialize(t.notify,Cv.qchatUpdateWhiteBlackMembersTag)),t},wb[lb.updateQuickComment]=function(t){return t.notify=function formatQuickCommentRequest(t){return format($b,t)}(deserialize(t.notify,Ub.qchatQuickCommentRequestTag)),t},wb[lb.channelCategoryCreate]=function(t){return t.categoryInfo=formatChannelCategory(deserialize(t.categoryInfo,Cv.QChatChannelCategoryInfo)),t},wb[lb.channelCategoryUpdate]=function(t){return t.categoryInfo=formatChannelCategory(deserialize(t.categoryInfo,Cv.QChatChannelCategoryInfo)),t},wb[lb.channelCategoryUpdateWhiteBlackIdentify]=function(t){return t.notify=formatUpdateWhiteBlackRole(deserialize(t.notify,Cv.qchatUpdateChannelCategoryWhiteBlackRoleTag)),t},wb[lb.channelCategoryUpdateWhiteBlackIdentifyUser]=function(t){return t.notify=formatUpdateWhiteBlackRole(deserialize(t.notify,Cv.qchatUpdateChannelCategoryWhiteBlackMembersTag)),t},wb[lb.serverIdentifyAdd]=function(t){return t.serverIdentifyInfo=formatRole(deserialize(t.serverIdentifyInfo,Rb.serverRole)),t},wb[lb.serverIdentifyRemove]=function(t){return t.serverIdentifyInfo=formatRole(deserialize(t.serverIdentifyInfo,Rb.serverRole)),t},wb[lb.serverIdentifyUpdate]=function(t){return t.serverIdentifyInfo=formatRole(deserialize(t.serverIdentifyInfo,Rb.serverRole)),t},wb[lb.channelIdentifyUpdate]=function(t){return t.channelIdentifyInfo=formatRole(deserialize(t.channelIdentifyInfo,Rb.channelRole)),t},wb[lb.userIdentifyUpdate]=function(t){return t.userIdentifyInfo=formatRole(deserialize(t.userIdentifyInfo,Rb.memberRole)),t},wb[lb.myMemberInfoUpdated]=function(t){var a,o=dd(t,"userInfo.name"),c=dd(t,"userInfo.icon");return t.updatedInfos=map(a=t.reuseServers).call(a,(function(t){var a={serverId:t.serverId};return 1==(1&t.bits)&&"string"==typeof o&&fi(a,{nickChanged:!0,nick:o}),2==(2&t.bits)&&"string"==typeof c&&fi(a,{avatarChanged:!0,avatar:c}),a})),delete t.userInfo,delete t.reuseServers,t},wb);function formatSystemNotification(t,a){var o=format(Lb,t);if(!o.attach)return o;if(o.attach.serverInfo&&(o.attach.serverInfo=formatServer(deserialize(o.attach.serverInfo,Iv.serverInfo))),o.attach.channelInfo&&(o.attach.channelInfo=formatChannel(deserialize(o.attach.channelInfo,Cv.channelInfo))),o.attach.serverMember&&(o.attach.serverMember=formatMember$1(deserialize(o.attach.serverMember,Iv.memberInfo))),jb[o.attach.type]&&(o.attach=jb[o.attach.type](o.attach)),o.attach.updateAuths)try{o.attach.updateAuths=formatRoleAuths(JSON.parse(o.attach.updateAuths))}catch(t){a.error("formatSystemNotification:JSON parse updateAuths error: ",t)}return o.attach.type&&(o.attach.rawType=o.attach.type,o.attach.type=lb[o.attach.type]),o}var Nb={type:{type:"enum",values:ob},fromClientType:{type:"enum",values:_b},status:{type:"number"},resendFlag:{type:"boolean"},mentionAll:{type:"boolean"},notifyReason:{type:"enum",values:sb},pushEnable:{type:"boolean"},historyEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},routeEnable:{type:"boolean"},time:{type:"number"},updateTime:{type:"number"},mentionAccids:{type:"object"},mentionRoleIds:{type:"object"},accidsOfMentionedRoles:{type:"object"},attach:{type:"object"},pushPayload:{type:"object"},isAntispam:{type:"boolean"},antiSpamInfo:{useCustomContent:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBusinessId:{type:"string"},antiSpamUsingYidun:{type:"boolean"},yidunCallback:{type:"string"},yidunAntiCheating:{type:"object"},yidunAntiSpamExt:{type:"object"},yidunAntiSpamRes:{type:"string"}},replyRefer:{fromAccount:{type:"string",rawKey:"replyMsgFromAccount"},time:{type:"number",rawKey:"replyMsgTime"},msgIdServer:{type:"string",rawKey:"replyMsgIdServer"},msgIdClient:{type:"string",rawKey:"replyMsgIdClient"}},threadRefer:{fromAccount:{type:"string",rawKey:"threadMsgFromAccount"},time:{type:"number",rawKey:"threadMsgTime"},msgIdServer:{type:"string",rawKey:"threadMsgIdServer"},msgIdClient:{type:"string",rawKey:"threadMsgIdClient"}}};function generatorMsgForCmd(t){t.onSendBefore,t.onUploadStart,t.onUploadDone,t.onUploadProgress;var a=__rest(t,["onSendBefore","onUploadStart","onUploadDone","onUploadProgress"]),o=formatReverse(Nb,a);if(o.msgIdClient=t.resendFlag?t.msgIdClient:wu(),!o.msgIdClient)throw new oc("msgIdClient is required for resend a message","msgIdClient","required");return t.replyMessage&&t.replyMessage.msgIdServer&&(o.replyMsgFromAccount=t.replyMessage.fromAccount,o.replyMsgTime=+t.replyMessage.time,o.replyMsgIdServer=t.replyMessage.msgIdServer,o.replyMsgIdClient=t.replyMessage.msgIdClient,t.replyMessage.threadRefer&&t.replyMessage.threadRefer.msgIdServer?(o.threadMsgFromAccount=t.replyMessage.threadRefer.fromAccount,o.threadMsgTime=+t.replyMessage.threadRefer.time,o.threadMsgIdServer=t.replyMessage.threadRefer.msgIdServer,o.threadMsgIdClient=t.replyMessage.threadRefer.msgIdClient):(o.threadMsgFromAccount=t.replyMessage.fromAccount,o.threadMsgTime=+t.replyMessage.time,o.threadMsgIdServer=t.replyMessage.msgIdServer,o.threadMsgIdClient=t.replyMessage.msgIdClient),delete o.replyMessage),o}function formatMsgOperatorInfo(t){return format({operatorClientType:{type:"enum",values:_b},pushPayload:{type:"object"}},t)}function formatMsg(t,a,o){var c,m;return void 0===a&&(a={}),__awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var h,v,b;return ci.wrap((function _callee$(S){for(;;)switch(S.prev=S.next){case 0:return(h=format(Nb,t)).deliveryStatus=a.deliveryStatus?ib[a.deliveryStatus]:ib[ib.success],a.time&&(h.time=a.time),h.updateContent&&(v=format({status:{type:"number"}},v=deserialize(v=JSON.parse(h.updateContent),Ub.qchatMsgTag)),h.updateContent=v),h.updateOperatorInfo&&(b=formatMsgOperatorInfo(deserialize(b=JSON.parse(h.updateOperatorInfo),Ub.qchatMsgUpdateTag)),h.updateOperatorInfo=b),""===(null===(c=null==h?void 0:h.threadRefer)||void 0===c?void 0:c.fromAccount)&&delete h.threadRefer,""===(null===(m=null==h?void 0:h.replyRefer)||void 0===m?void 0:m.fromAccount)&&delete h.replyRefer,h.attach&&a.attachUrl&&(h.attach.url=a.attachUrl),S.next=10,formatMsgAttach(h,o);case 10:return S.abrupt("return",S.sent);case 11:case"end":return S.stop()}}),_callee)})))}function formatMsgAttach(t,a){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var o;return ci.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:if(includes(Fb).call(Fb,t.type)&&t.attach&&t.attach.url){c.next=2;break}return c.abrupt("return",t);case 2:if(a&&a.cloudStorage&&"function"==typeof a.cloudStorage.getPrivateUrl&&"function"==typeof a.cloudStorage.getOriginUrl){c.next=4;break}return c.abrupt("return",t);case 4:if(!(indexOf(o=t.attach.url).call(o,"_im_url=1")<0)){c.next=7;break}return t.attach.url=a.cloudStorage.getPrivateUrl(t.attach.url),c.abrupt("return",t);case 7:return c.prev=7,c.next=10,a.cloudStorage.getOriginUrl(t.attach.url);case 10:t.attach.url=c.sent,c.next=16;break;case 13:throw c.prev=13,c.t0=c.catch(7),new oc('url "'+t.attach.url+'" parse error',"message.attach.url","parse error");case 16:return c.abrupt("return",t);case 17:case"end":return c.stop()}}),_callee2,null,[[7,13]])})))}function formatMsgs(t,a,o){return void 0===a&&(a={}),__awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var c;return ci.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:if(xc(t)&&t.length>0){m.next=2;break}return m.abrupt("return",[]);case 2:return c=map(t).call(t,(function(t){return formatMsg(t,a,o)})),m.next=5,zo.all(c);case 5:return m.abrupt("return",m.sent);case 6:case"end":return m.stop()}}),_callee3)})))}var Db={totalCount:{type:"number"},lastUpdateTime:{type:"number"},details:{type:"object"}};function formatQuickComments(t){var a=map(t).call(t,(function(t){var a,o=format(Db,t);return o.details=map(a=o.details).call(a,(function(t){return{count:t.count,hasSelf:t.self,severalAccids:t.topN,type:t.type}})),o})),o={};return forEach$1(a).call(a,(function(t){return o[t.msgIdServer]=t})),o}var $b={type:{type:"number"},time:{type:"number"},opeType:{type:"number"}};var Hb={includeSelf:{type:"number"},order:{type:"enum",values:iv},sort:{type:"enum",values:ab},msgTypes:{type:"object"},subTypes:{type:"object"}};var Gb={hasMore:{type:"boolean"},nextTimetag:{type:"number"},cursor:{type:"string"}};var Qb={6:function _(t){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInServerId(t.serverId),!0},16:function _(t){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInChannel(t.serverId,t.channelId),!0},26:function _(t){var a=dd(t,"attach.addAccids");return a&&includes(a).call(a,this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",t),!0},27:function _(t){var a=dd(t,"attach.deleteAccids");return a&&includes(a).call(a,this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",t),!0},31:function _(t){return 2===t.attach.event&&(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",t),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",t)),!0},32:function _(t){return 2===t.attach.event?(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",t),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",t)):1===t.attach.event&&this.core.qchatChannel.subscribeForVisitorService.deleteServer(t.serverId),!0},34:function _(t){return 2===t.attach.event&&this.core.qchatChannel.subscribeForVisitorService.unSubscribeChannel(t.serverId,t.channelId),!0},101:function _(t){var a=Rm(t,["serverId","channelId","ext","fromAccount","fromNick","time"]);return this.logger.log("qchat on recvTypingEvent: ",a),this.core.emit("recvTypingEvent",a),!1}},Wb=/*#__PURE__*/function(){function NotificationModuleService(t){this.core=t,this.logger=t.logger}var t=NotificationModuleService.prototype;return t.sendSystemNotification=function sendSystemNotification(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var a,o;return ci.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:generatorSysMsgForCmd(t)});case 2:return a=c.sent,o=formatSystemNotification(a.content.sysMsg,this.logger),"debug"===this.core.options.debugLevel?this.logger.debug("sendCustomSysMsg success",o):this.logger.log("sendCustomSysMsg success",o.serverId,o.channelId,o.msgIdServer),c.abrupt("return",o);case 6:case"end":return c.stop()}}),_callee,this)})))},t.updateSystemNotification=function updateSystemNotification(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var a,o,c,m,h;return ci.wrap((function _callee2$(v){for(;;)switch(v.prev=v.next){case 0:return a=t.systemNotification,o=__rest(t,["systemNotification"]),c=Rm(a,["msgIdServer","type","body","ext","status"]),m=generatorSysMsgForCmd(c),v.next=5,this.core.sendCmd("qchatUpdateSystemNotification",{sysMsg:m,qchatMsgUpdateTag:fi(fi({},o),{operatorAccount:this.core.account,operatorClientType:_b.Web,pushPayload:gi(t.pushPayload),routeEnable:Ad.boolean(t,"routeEnable")})});case 5:return h=v.sent,v.abrupt("return",formatSystemNotification(h.content.sysMsg,this.logger));case 7:case"end":return v.stop()}}),_callee2,this)})))},t.markSystemNotificationsRead=function markSystemNotificationsRead(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var a;return ci.wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.sendCmd("qchatMarkSysMsgRead",{sysMsgs:map(a=t.systemNotifications).call(a,(function(t){return generatorSysMsgMarkersForCmd(t)}))});case 2:case"end":return o.stop()}}),_callee3,this)})))},t.onSysMsg=function onSysMsg(t){var a=t.content.sysMsg;if(a){var o=formatSystemNotification(a,this.core.logger),c=Qb[lb[o.type]];if(c)if(!1===c.call(this,o))return;var m={feature:"default",systemNotifications:[o]};this.logger.log("qchat on systemNotification: ",m),this.core.emit("systemNotification",m)}else this.core.logger.warn("No sysMsg in onSysMsg packet")},t.onMultiSysMsg=function onMultiSysMsg(t){var a=t.content.sysMsg;if(a){var o=formatSystemNotification(a,this.logger);this.core.emit("systemNotificationUpdate",o)}},t.onSyncSysMsg=function onSyncSysMsg(t){var a=this,o=t.content.systemNotifications;if(o&&o.length>0){var c=map(o).call(o,(function(t){return formatSystemNotification(t,a.logger)}));this.core.emit("systemNotification",{feature:"sync",systemNotifications:c})}else this.logger.warn("sync system notification not exist")},NotificationModuleService}(),Vb=["image","audio","video","file"],Kb=/*#__PURE__*/function(){function MessageModuleService(t){var a=this;this.markMessageRead=fb((function(t){return __awaiter(a,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var a,o;return ci.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("qchatMarkMessageRead",{markMsgReadTag:t});case 2:a=c.sent,o=formatUnreadInfo(a.content.unreadInfo),this.core.eventBus.emit("qchatChannel/updateUnread",o);case 5:case"end":return c.stop()}}),_callee,this)})))}),200),this.core=t,this.logger=t.logger}var t=MessageModuleService.prototype;return t.sendMessage=function sendMessage(t){var a,o,c,m;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var h,v,b,S,M,C;return ci.wrap((function _callee2$(T){for(;;)switch(T.prev=T.next){case 0:if(!(indexOf(Vb).call(Vb,t.type)>-1)){T.next=4;break}return T.next=3,this.doSendFile(t);case 3:t.attach=T.sent;case 4:return h=generatorMsgForCmd(fi({fromAccount:this.core.account},t)),T.next=7,formatMsg(h,{time:(new Date).getTime(),deliveryStatus:ib.sending},this.core);case 7:v=T.sent;try{t.onSendBefore&&t.onSendBefore(v)}catch(t){this.logger.error("sendMsg: options.onSendBefore error",t)}return T.prev=9,T.next=12,this.core.sendCmd("qchatSendMsg",{qchatMsg:h});case 12:b=T.sent,T.next=22;break;case 15:return T.prev=15,T.t0=T.catch(9),T.next=19,formatMsg(h,{time:(new Date).getTime(),deliveryStatus:ib.failed,attachUrl:null===(a=v.attach)||void 0===a?void 0:a.url},this.core);case 19:throw S=T.sent,T.t0.msg=S,T.t0;case 22:return M=b.content,T.next=25,formatMsg(fi({},M.qchatMsg),{deliveryStatus:ib.success,attachUrl:null===(o=v.attach)||void 0===o?void 0:o.url},this.core);case 25:if(!(C=T.sent).isAntispam){T.next=29;break}throw{code:10403,msg:C,message:(null===(c=null==C?void 0:C.antiSpamInfo)||void 0===c?void 0:c.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(m=null==C?void 0:C.antiSpamInfo)||void 0===m?void 0:m.yidunAntiSpamRes)||""};case 29:return T.abrupt("return",C);case 30:case"end":return T.stop()}}),_callee2,this,[[9,15]])})))},t.doSendFile=function doSendFile(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var a;return ci.wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:if(validate({type:{type:"enum",values:["image","audio","video","file"]},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},t),a=t.attach){o.next=23;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){o.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return o.prev=5,o.next=8,this.core.cloudStorage.uploadFile(t);case 8:a=o.sent,o.next=15;break;case 11:throw o.prev=11,o.t0=o.catch(5),this.logger.error("sendFile:: upload File error or abort",o.t0),o.t0;case 15:o.prev=15,t.onUploadDone&&t.onUploadDone(a),o.next=23;break;case 19:throw o.prev=19,o.t1=o.catch(15),this.logger.error("sendFile options.onUploadDone err",o.t1),o.t1;case 23:return o.abrupt("return",a);case 24:case"end":return o.stop()}}),_callee3,this,[[5,11],[15,19]])})))},t.resendMessage=function resendMessage(t){var a,o;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){var c,m,h,v,b;return ci.wrap((function _callee4$(S){for(;;)switch(S.prev=S.next){case 0:return(c=generatorMsgForCmd(fi(fi({},t),{resendFlag:!0}))).deliveryStatus=ib.sending,S.prev=2,S.next=5,this.core.sendCmd("qchatSendMsg",{qchatMsg:c});case 5:m=S.sent,S.next=15;break;case 8:return S.prev=8,S.t0=S.catch(2),S.next=12,formatMsg(c,{time:(new Date).getTime(),deliveryStatus:ib.failed},this.core);case 12:throw h=S.sent,S.t0.msg=h,S.t0;case 15:return v=m.content,S.next=18,formatMsg(fi({},v.qchatMsg),{deliveryStatus:ib.success},this.core);case 18:if(!(b=S.sent).isAntispam){S.next=22;break}throw{code:10403,msg:b,message:(null===(a=null==b?void 0:b.antiSpamInfo)||void 0===a?void 0:a.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(o=null==b?void 0:b.antiSpamInfo)||void 0===o?void 0:o.yidunAntiSpamRes)||""};case 22:return S.abrupt("return",b);case 23:case"end":return S.stop()}}),_callee4,this,[[2,8]])})))},t.doUpdateMessage=function doUpdateMessage(t){var a,o;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){var c,m,h,v,b;return ci.wrap((function _callee5$(S){for(;;)switch(S.prev=S.next){case 0:return c=t.message,m=__rest(t,["message"]),(h=generatorMsgForCmd(c)).msgIdClient=void 0,h.time=c.time,S.next=6,this.core.sendCmd("qchatUpdateMessage",{qchatMsg:h,qchatMsgUpdateTag:fi(fi({},m),{operatorAccount:this.core.account,operatorClientType:_b.Web,pushPayload:gi(t.pushPayload),routeEnable:Ad.boolean(t,"routeEnable")})});case 6:return v=S.sent,S.next=9,formatMsg(v.content.qchatMsg,{},this.core);case 9:if(b=S.sent,this.core.eventBus.emit("qchatChannel/changeUnread",b,!0),!v.content.qchatMsg.isAntispam){S.next=14;break}throw{code:10403,msg:h,message:(null===(a=v.content.qchatMsg)||void 0===a?void 0:a.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(o=v.content.qchatMsg)||void 0===o?void 0:o.yidunAntiSpamRes)||""};case 14:return S.abrupt("return",b);case 15:case"end":return S.stop()}}),_callee5,this)})))},t.getHistoryMessage=function getHistoryMessage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){var a,o,c,m=this;return ci.wrap((function _callee6$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("qchatGetHistoryMsg",{getHistoryMsgTag:fi(fi({},t),{reverse:reverse$1(t)?1:0})});case 2:return o=h.sent,c=o.content,h.next=6,zo.all(map(a=c.qchatMsgs).call(a,(function(t){return formatMsg(t,{},m.core)})));case 6:return h.abrupt("return",h.sent);case 7:case"end":return h.stop()}}),_callee6,this)})))},t.getMentionedMeMessages=function getMentionedMeMessages(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee7(){var a,o,c,m,h,v=this;return ci.wrap((function _callee7$(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this.core.sendCmd("qchatGetMentionedMeMessages",{tag:t});case 2:return o=b.sent,c=o.content,S=c.page,m=format(Gb,S),b.next=7,zo.all(map(a=c.datas).call(a,(function(t){return formatMsg(t,{},v.core)})));case 7:return h=b.sent,b.abrupt("return",{pageInfo:m,messages:h});case 9:case"end":return b.stop()}var S}),_callee7,this)})))},t.areMentionedMeMessages=function areMentionedMeMessages(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee8(){var a,o,c;return ci.wrap((function _callee8$(m){for(;;)switch(m.prev=m.next){case 0:a={},o=0;case 2:if(!(o<t.length)){m.next=13;break}if((c=t[o]).fromAccount!==this.core.account){m.next=7;break}return a[c.msgIdClient]=!1,m.abrupt("continue",10);case 7:return m.next=9,this.core.qchatChannel.subscribeModuleService.getMentionedFlag(c,!0);case 9:a[c.msgIdClient]=m.sent;case 10:o++,m.next=2;break;case 13:return m.abrupt("return",a);case 14:case"end":return m.stop()}}),_callee8,this)})))},t.getLastMessageOfChannels=function getLastMessageOfChannels(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee9(){var a,o,c;return ci.wrap((function _callee9$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("qchatGetLastMessageOfChannels",{tag:t});case 2:return a=m.sent,o=a.content.msgs,m.next=6,formatMsgs(o,{},this.core);case 6:return c=m.sent,m.abrupt("return",reduce(c).call(c,(function(t,a){return t[a.channelId]=a,t}),{}));case 8:case"end":return m.stop()}}),_callee9,this)})))},t.messageSearchByPage=function messageSearchByPage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee10(){var a,o,c,m,h;return ci.wrap((function _callee10$(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.core.sendCmd("qchatMessageSearchByPage",{qchatMessageSearchByPageTag:fi(fi({},(b=t,formatReverse(Hb,b))),{includeSelf:t.includeSelf?1:""})});case 2:return a=v.sent,o=a.content,c=o.datas,m=o.listQueryTag,v.next=6,formatMsgs(c,{},this.core);case 6:return h=v.sent,v.abrupt("return",{listQueryTag:{hasMore:1==+m.hasMore,nextTimetag:m.nextTimetag?_u(m.nextTimetag):0,cursor:m.cursor},datas:h});case 8:case"end":return v.stop()}var b}),_callee10,this)})))},t.onMsg=function onMsg(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee11(){var a,o;return ci.wrap((function _callee11$(c){for(;;)switch(c.prev=c.next){case 0:if(a=t.content.qchatMsg){c.next=4;break}return this.logger.warn("No qchatMsg in qchatMsg packet"),c.abrupt("return");case 4:return c.next=6,formatMsg(a,{},this.core);case 6:o=c.sent,this.core.eventBus.emit("qchatChannel/changeUnread",o,!1),this.core.emit("message",o);case 9:case"end":return c.stop()}}),_callee11,this)})))},t.onRecvUnreadInfo=function onRecvUnreadInfo(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee12(){var a,o;return ci.wrap((function _callee12$(c){for(;;)switch(c.prev=c.next){case 0:if(a=t.content.qchatMsg){c.next=3;break}return c.abrupt("return");case 3:return c.next=5,formatMsg(a);case 5:o=c.sent,this.core.eventBus.emit("qchatChannel/changeUnread",o,!1);case 7:case"end":return c.stop()}}),_callee12,this)})))},t.onMultiSyncRead=function onMultiSyncRead(t){var a=t.content.unreadInfo;if(a){var o=formatUnreadInfo(a);this.core.eventBus.emit("qchatChannel/updateUnread",o)}},t.onMultiSyncServersRead=function onMultiSyncServersRead(t){var a=t.content.qchatMultiSyncServersMessageReadTag;if(a){var o=formatClearServersUnread(a),c=o.successServerIds,m=o.ackTimestamp;this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",c,m)}},t.onRecvMsgUpdate=function onRecvMsgUpdate(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee13(){var a,o,c,m;return ci.wrap((function _callee13$(h){for(;;)switch(h.prev=h.next){case 0:if(a=t.content.qchatMsg,o=t.content.qchatMsgUpdateInfo,a){h.next=4;break}return h.abrupt("return");case 4:return h.next=6,formatMsg(a,{},this.core);case 6:c=h.sent,m=formatMsgOperatorInfo(o),this.core.eventBus.emit("qchatChannel/changeUnread",c,!0),this.core.emit("messageUpdate",c,m);case 10:case"end":return h.stop()}}),_callee13,this)})))},MessageModuleService}(),zb=/*#__PURE__*/function(){function ExtendModuleService(t){var a=this;this._sendTypingEvent=fb((function(t){return __awaiter(a,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){return ci.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:generatorSysMsgForCmd(fi(fi({},t),{resendFlag:!1,persistEnable:!1,routeEnable:!1,pushEnable:!1,needBadge:!1,needPushNick:!1}),lb.msgTyping)});case 2:case"end":return a.stop()}}),_callee,this)})))}),3e3),this.core=t,this.logger=t.logger,this.lastChannelIdInTyping=""}var t=ExtendModuleService.prototype;return t.getMessageHistoryByIds=function getMessageHistoryByIds(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var a,o;return ci.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("qchatGetMessageHistoryByIds",{channelInfo:{serverId:t.serverId,channelId:t.channelId},messageReferList:t.messageReferList});case 2:return o=c.sent,c.abrupt("return",zo.all(map(a=o.content.qchatMsgs).call(a,(function(t){return formatMsg(t)}))));case 4:case"end":return c.stop()}}),_callee2,this)})))},t.getReferMessages=function getReferMessages(t){var a,o;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){var c;return ci.wrap((function _callee3$(m){for(;;)switch(m.prev=m.next){case 0:if((null===(a=t.message.replyRefer)||void 0===a?void 0:a.msgIdServer)&&(null===(o=t.message.threadRefer)||void 0===o?void 0:o.msgIdServer)){m.next=2;break}throw new Error("Message has no reply");case 2:return m.next=4,this.getMessageHistoryByIds({serverId:t.message.serverId,channelId:t.message.channelId,messageReferList:[t.message.replyRefer,t.message.threadRefer]});case 4:if(c=m.sent,t.referType!==ub[ub.all]){m.next=9;break}return m.abrupt("return",{replyMessage:c[0],threadMessage:c[1]});case 9:if(t.referType!==ub[ub.reply]){m.next=13;break}return m.abrupt("return",{replyMessage:c[0]});case 13:if(t.referType!==ub[ub.thread]){m.next=15;break}return m.abrupt("return",{threadMessage:c[1]});case 15:return m.abrupt("return",{replyMessage:c[0],threadMessage:c[1]});case 16:case"end":return m.stop()}}),_callee3,this)})))},t.getThreadMessages=function getThreadMessages(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){var o,c,m,h,v;return ci.wrap((function _callee4$(b){for(;;)switch(b.prev=b.next){case 0:return c=(null===(a=t.message.threadRefer)||void 0===a?void 0:a.msgIdServer)?fi({serverId:t.message.serverId,channelId:t.message.channelId},t.message.threadRefer):t.message,b.next=3,this.core.sendCmd("qchatGetThreadMessages",{qchatMsg:c,getThreadHistoryMsgTag:fi(fi({},t.messageQueryOption),{reverse:Ad.boolean(t.messageQueryOption,"reverse")})});case 3:return m=b.sent,b.next=6,formatMsg(m.content.thread);case 6:return h=b.sent,b.next=9,zo.all(map(o=m.content.qchatMsgs).call(o,(function(t){return formatMsg(t)})));case 9:return v=b.sent,b.abrupt("return",{thread:h,threadInfo:{messageCount:+m.content.threadInfo.messageCount,lastMessageTimestamp:+m.content.threadInfo.lastMessageTimestamp},messages:v});case 11:case"end":return b.stop()}}),_callee4,this)})))},t.getThreadRootMessagesMeta=function getThreadRootMessagesMeta(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){var a,o,c,m;return ci.wrap((function _callee5$(h){for(;;)switch(h.prev=h.next){case 0:return a=t.threadRootMessages,o=__rest(t,["threadRootMessages"]),h.next=3,this.core.sendCmd("qchatGetThreadRootMessagesMeta",{qchatMsgs:a,tag:o});case 3:if(c=h.sent,!((m=c.content.metas)&&m.length>0)){h.next=7;break}return h.abrupt("return",map(m).call(m,(function(t){return fi(fi({},t),{total:_u(t.total),timestamp:_u(t.timestamp),msgTime:_u(t.msgTime)})})));case 7:return h.abrupt("return",[]);case 8:case"end":return h.stop()}}),_callee5,this)})))},t.getQuickComments=function getQuickComments(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){var a,o,c;return ci.wrap((function _callee6$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("qchatGetQuickComments",{tag:{serverId:t.serverId,channelId:t.channelId,msgIdServerList:gi(map(a=t.msgList).call(a,(function(t){return t.msgIdServer})))}});case 2:return o=m.sent,c=o.content.quickCommentResponse,m.abrupt("return",formatQuickComments(c));case 5:case"end":return m.stop()}}),_callee6,this)})))},t.updateQuickComment=function updateQuickComment(t,a){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee7(){var o,c,m,h,v,b;return ci.wrap((function _callee7$(S){for(;;)switch(S.prev=S.next){case 0:return validate({type:{type:"number"},commentMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},t),o=t.commentMessage,c=o.serverId,m=o.channelId,h=o.fromAccount,v=o.msgIdServer,b=o.time,S.next=4,this.core.sendCmd("qchatUpdateQuickComment",{tag:{serverId:c,channelId:m,fromAccount:h,msgIdServer:v,time:b,type:t.type,opeType:a,opeAccid:this.core.account}});case 4:case"end":return S.stop()}}),_callee7,this)})))},t.sendTypingEvent=function sendTypingEvent(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee8(){return ci.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:if(t.channelId!==this.lastChannelIdInTyping){a.next=4;break}return this.logger.log("qchatMsg sendTypingEvent throttle"),this._sendTypingEvent(t),a.abrupt("return");case 4:this.lastChannelIdInTyping=t.channelId,this._sendTypingEvent.flush(),this._sendTypingEvent(t);case 7:case"end":return a.stop()}}),_callee8,this)})))},ExtendModuleService}(),Jb=/*#__PURE__*/function(t){function QChatMsgService(a){var o;return(o=t.call(this,"qchatMsg",a)||this).core=a,o.lastChannelIdInMark="",registerParser({cmdMap:Pb,cmdConfig:Bb}),o.notificationModuleService=new Wb(a),o.messageModuleService=new Kb(a),o.extendModuleService=new zb(a),o}Mt(QChatMsgService,t);var a=QChatMsgService.prototype;return a.sendMessage=function sendMessage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){return ci.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(ob)},ext:{type:"string",required:!1},mentionAll:{type:"boolean",required:!1},mentionAccids:{type:"array",itemType:"string",required:!1},mentionRoleIds:{type:"array",itemType:"string",required:!1,min:1},historyEnable:{type:"boolean",required:!1},pushEnable:{type:"boolean",required:!1}},t),a.next=3,this.messageModuleService.sendMessage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee,this)})))},a.updateMessage=function updateMessage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){return ci.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(validate({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0},body:{type:"string",required:!1},ext:{type:"string",required:!1}}}},t),!("number"==typeof t.message.status&&t.message.status<1e4)){a.next=3;break}throw new tc("Status should be greater than or equal to 10000");case 3:return a.next=5,this.messageModuleService.doUpdateMessage(t);case 5:return a.abrupt("return",a.sent);case 6:case"end":return a.stop()}}),_callee2,this)})))},a.resendMessage=function resendMessage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){return ci.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdClient:{type:"string",allowEmpty:!1}},t),a.next=3,this.messageModuleService.resendMessage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee3,this)})))},a.deleteMessage=function deleteMessage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){var a;return ci.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return validate({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},t),(a=JSON.parse(gi(t))).message.status=2,o.next=5,this.messageModuleService.doUpdateMessage(a);case 5:return o.abrupt("return",o.sent);case 6:case"end":return o.stop()}}),_callee4,this)})))},a.revokeMessage=function revokeMessage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){var a;return ci.wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return validate({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},t),(a=JSON.parse(gi(t))).message=Rm(a.message,["serverId","channelId","msgIdServer","time"]),a.message.status=1,o.next=6,this.messageModuleService.doUpdateMessage(a);case 6:return o.abrupt("return",o.sent);case 7:case"end":return o.stop()}}),_callee5,this)})))},a.markMessageRead=function markMessageRead(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){return ci.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:validate({serverId:{type:"string"},channelId:{type:"string"},time:{type:"number",min:0}},t),t.channelId!==this.lastChannelIdInMark&&this.messageModuleService.markMessageRead.flush(),this.lastChannelIdInMark=t.channelId,this.messageModuleService.markMessageRead(t);case 4:case"end":return a.stop()}}),_callee6,this)})))},a.replyMessage=function replyMessage(t){validate({replyMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},t);var replyMessage=t.replyMessage;if(t.serverId!==replyMessage.serverId||t.channelId!==replyMessage.channelId)throw new tc("Forbid replying to message from other server, channel");return this.sendMessage(t)},a.getMessageHistoryByIds=function getMessageHistoryByIds(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee7(){return ci.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},messageReferList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},t),a.next=3,this.extendModuleService.getMessageHistoryByIds(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee7,this)})))},a.getReferMessages=function getReferMessages(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee8(){return ci.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return validate({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},referType:{type:"enum",values:getEnumKeys(ub),required:!1}},t),a.next=3,this.extendModuleService.getReferMessages(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee8,this)})))},a.getThreadMessages=function getThreadMessages(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee9(){return ci.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},messageQueryOption:{type:"object",rules:{beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},excludeMsgId:{type:"string",required:!1},limit:{type:"number",required:!1},reverse:{type:"boolean",required:!1}}}},t),a.next=3,this.extendModuleService.getThreadMessages(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee9,this)})))},a.getThreadRootMessagesMeta=function getThreadRootMessagesMeta(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee10(){return ci.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},threadRootMessages:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},t),a.next=3,this.extendModuleService.getThreadRootMessagesMeta(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee10,this)})))},a.sendSystemNotification=function sendSystemNotification(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee11(){return ci.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},attach:{type:"object",required:!1}},t),a.next=3,this.notificationModuleService.sendSystemNotification(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee11,this)})))},a.updateSystemNotification=function updateSystemNotification(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee12(){return ci.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return validate({systemNotification:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(lb)},body:{type:"string",required:!1},ext:{type:"string",required:!1},status:{type:"number",required:!1}}}},t),a.next=3,this.notificationModuleService.updateSystemNotification(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee12,this)})))},a.markSystemNotificationsRead=function markSystemNotificationsRead(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee13(){return ci.wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:return validate({systemNotifications:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1}},min:1}},t),a.next=3,this.notificationModuleService.markSystemNotificationsRead(t);case 3:case"end":return a.stop()}}),_callee13,this)})))},a.getHistoryMessage=function getHistoryMessage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee14(){return ci.wrap((function _callee14$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},beginTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},excludeMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},t),a.next=3,this.messageModuleService.getHistoryMessage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee14,this)})))},a.getMentionedMeMessages=function getMentionedMeMessages(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee15(){return ci.wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timestamp:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),a.next=3,this.messageModuleService.getMentionedMeMessages(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee15,this)})))},a.areMentionedMeMessages=function areMentionedMeMessages(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee16(){var a;return ci.wrap((function _callee16$(o){for(;;)switch(o.prev=o.next){case 0:if(validate({messages:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1}},min:1}},t),every(a=t.messages).call(a,(function(a){return t.messages[0].serverId===a.serverId}))){o.next=4;break}throw new tc("Different serverId",t,10414);case 4:if(!this.core.qchatChannel.subscribeForVisitorService.isInAutoServers(t.messages[0].serverId)){o.next=7;break}throw new tc("Not allowed for visitor",t,10403);case 7:return o.next=9,this.messageModuleService.areMentionedMeMessages(t.messages);case 9:return o.abrupt("return",o.sent);case 10:case"end":return o.stop()}}),_callee16,this)})))},a.addQuickComment=function addQuickComment(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee17(){return ci.wrap((function _callee17$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.extendModuleService.updateQuickComment(t,1);case 2:case"end":return a.stop()}}),_callee17,this)})))},a.removeQuickComment=function removeQuickComment(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee18(){return ci.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.extendModuleService.updateQuickComment(t,2);case 2:case"end":return a.stop()}}),_callee18,this)})))},a.getQuickComments=function getQuickComments(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee19(){return ci.wrap((function _callee19$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1}},min:1}},t),a.next=3,this.extendModuleService.getQuickComments(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee19,this)})))},a.sendTypingEvent=function sendTypingEvent(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee20(){return ci.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.extendModuleService.sendTypingEvent(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee20,this)})))},a.getLastMessageOfChannels=function getLastMessageOfChannels(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee21(){return ci.wrap((function _callee21$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelIdList:{type:"array",itemType:"string"}},t),a.next=3,this.messageModuleService.getLastMessageOfChannels(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee21,this)})))},a.qchatOnMsgHandler=function qchatOnMsgHandler(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee22(){return ci.wrap((function _callee22$(a){for(;;)switch(a.prev=a.next){case 0:this.messageModuleService.onMsg(t);case 1:case"end":return a.stop()}}),_callee22,this)})))},a.qchatOnRecvUnreadInfoHandler=function qchatOnRecvUnreadInfoHandler(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee23(){return ci.wrap((function _callee23$(a){for(;;)switch(a.prev=a.next){case 0:this.messageModuleService.onRecvUnreadInfo(t);case 1:case"end":return a.stop()}}),_callee23,this)})))},a.qchatOnSysMsgHandler=function qchatOnSysMsgHandler(t){this.notificationModuleService.onSysMsg(t)},a.qchatMultiSyncMessageReadHandler=function qchatMultiSyncMessageReadHandler(t){this.messageModuleService.onMultiSyncRead(t)},a.qchatMultiSyncSystemNotificationUpdateHandler=function qchatMultiSyncSystemNotificationUpdateHandler(t){this.notificationModuleService.onMultiSysMsg(t)},a.qchatSyncSystemNotificationHandler=function qchatSyncSystemNotificationHandler(t){this.notificationModuleService.onSyncSysMsg(t)},a.qchatRecvMessageUpdateHandler=function qchatRecvMessageUpdateHandler(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee24(){return ci.wrap((function _callee24$(a){for(;;)switch(a.prev=a.next){case 0:this.messageModuleService.onRecvMsgUpdate(t);case 1:case"end":return a.stop()}}),_callee24,this)})))},a.searchMsgByPage=function searchMsgByPage(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee25(){return ci.wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:return validate({keyword:{type:"string",allowEmpty:!1,required:!1},serverId:{type:"string",allowEmpty:!1,required:!0},channelId:{type:"string",allowEmpty:!1,required:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},fromTime:{type:"number",allowEmpty:!1,required:!1},toTime:{type:"number",allowEmpty:!1,required:!1},msgTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!0},subTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!1},includeSelf:{type:"boolean",allowEmpty:!1,required:!1},order:{type:"enum",values:getEnumKeys(iv),required:!1},limit:{type:"number",min:0,required:!1},sort:{type:"enum",values:getEnumKeys(ab),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),a.next=3,this.messageModuleService.messageSearchByPage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee25,this)})))},a.qchatMultiSyncServersMessageReadHandler=function qchatMultiSyncServersMessageReadHandler(t){this.messageModuleService.onMultiSyncServersRead(t)},QChatMsgService}(vv);function formatLoginInfo(t,a){void 0===a&&(a=1);var o=format({clientPort:{type:"number"},clientType:{type:"enum",values:_b},customClientType:{type:"number"},loginTime:{type:"number"},hasTokenPreviously:{type:"boolean"},pushType:{type:"number"}},t);return fi(fi({},o),{account:o.account,connectionId:o.connectionId,deviceId:o.deviceId,ip:o.ip,mac:o.ip,os:o.os,clientType:o.clientType,time:o.time,online:2!==a})}var Yb={1:{reason:"samePlatformKick",message:"The same account is not allowed to multiple login at the same time"},2:{reason:"serverKick",message:"Kicked out by IM server"},3:{reason:"otherPlatformKick",message:"Kicked out by other client of your account"},4:{reason:"silentlyKick",message:"Quietly kicked"}};var Xb,Zb,eS={BROWSER:0,RN:2,UNIAPP:3,WECHAT:6},tS=/*#__PURE__*/function(t){function QChatAuthService(a){var o;return(o=t.call(this,"qchatAuth",a)||this).syncTimeTag=0,o}Mt(QChatAuthService,t);var a=QChatAuthService.prototype;return a.doLogin=function doLogin(t){var a;return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var o,c,m,h,v,b,S;return ci.wrap((function _callee$(M){for(;;)switch(M.prev=M.next){case 0:return o=this.core.options,c=pc.getSystemInfo(),m=fi(fi({},o),{appLogin:t?0:1,clientType:16,clientSession:null===(a=this.core.socket)||void 0===a?void 0:a.sessionId,deviceId:this.core.config.deviceId,sdkVersion:90903,sdkType:eS[pc.platform]||0,userAgent:"Native/0.12.3",sdkHumanVersion:"0.12.3",os:c.os,browser:c.browser}),M.next=5,this.core.sendCmd("qchatLogin",{qchatLoginReqTag:m});case 5:if(!(h=M.sent).error){M.next=8;break}throw h.error;case 8:return v=h.content,b=v.qchatLoginResTag,S=v.qchatMultiLoginResult,b.isAutoReconnect=t,M.abrupt("return",{loginResult:formatLoginInfo(b),multiLoginResults:map(S).call(S,(function(t){return formatLoginInfo(t)}))});case 11:case"end":return M.stop()}}),_callee,this)})))},a.kick=function kick(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){var o;return ci.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("qchatKick",t);case 2:return o=c.sent,c.abrupt("return",null===(a=o.content)||void 0===a?void 0:a.deviceIds);case 4:case"end":return c.stop()}}),_callee2,this)})))},a.sync=function sync(){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){return ci.wrap((function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatSync",{qchatSyncTag:{systemNotification:this.syncTimeTag||0}});case 2:case"end":return t.stop()}}),_callee3,this)})))},a.qchatSyncHandler=function qchatSyncHandler(t){var a,o;this.logger.log("sync: emit syncdone",null===(a=t.content)||void 0===a?void 0:a.timetag),this.core.emit("syncdone"),this.syncTimeTag=(null===(o=t.content)||void 0===o?void 0:o.timetag)||0},a.qchatMultiSpotLoginHandler=function qchatMultiSpotLoginHandler(t){if(t.error)this.logger.error("qchatMultiPortLoginHandler:: error, ",t.error);else{var a=t.content,o=formatLoginInfo(a.qchatLoginResTag,a.state);this.core.emit("multiSpotLogin",[o])}},a.qchatBeKickedHandler=function qchatBeKickedHandler(t){if(t.error)this.logger.error("qchatBeKickedHandler error, ",t.error);else{var a=function formatBeKickedTag(t){var a=format({clientType:{type:"enum",values:_b},customClientType:{type:"number"}},t),o=Yb[a.reason];return fi(a,o=o||{reason:"unknow",message:"Unknown reason"})}(t.content.beKickedTag);this.logger.warn("bekicked::",a),this.core.doDisconnect(ju.KICKED,a)}},QChatAuthService}(vv);!function(t){t.UNKNOWN="UNKNOWN",t.LOGIN_STATE_ERROR="LOGIN_STATE_ERROR",t.CLOSE_BY_BACKEND="CLOSE_BY_BACKEND",t.ALL_MEMBERS_OUT="ALL_MEMBERS_OUT",t.END_OF_LIFE="END_OF_LIFE",t.CLOSE_BY_MEMBER="CLOSE_BY_MEMBER",t.KICK_OUT="KICK_OUT",t.SYNC_DATA_ERROR="SYNC_DATA_ERROR",t.LEAVE_BY_SELF="LEAVE_BY_SELF",t.kICK_BY_SELF="kICK_BY_SELF"}(Xb||(Xb={})),function(t){t.offNotAllowSelfOn="offNotAllowSelfOn",t.offAllowSelfOn="offAllowSelfOn",t.disable="disable"}(Zb||(Zb={}));var rS={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},nS={limit:{type:"number"}};function formatMembers(t){return xc(t)&&t.length>0?map(t).call(t,(function(t){return function formatMember(t){return format(rS,t)}(t)})):[]}function formatRTCChannelConfig(t){try{t.audio&&(t.audio=JSON.parse(t.audio))}catch(t){throw new rc('result "audio" JSON parse error',{key:"audio"},"JSON parse error")}try{t.video&&(t.video=JSON.parse(t.video))}catch(t){throw new rc('result "video" JSON parse error',{key:"video"},"JSON parse error")}return format(nS,t)}var aS={"25_1":"qchatGetNeroomToken","25_2":"qchatUpdateRTCChannelConfig","25_3":"qchatGetRTCChannelConfig","25_4":"qchatGetRTCChannelMembers"},oS={QChatRTCChannelConfigTag:{serverId:1,channelId:2,limit:3,audio:4,video:5},QChatRTCChannelConfigResultTag:{limit:1,audio:2,video:3},QChatGetRTCParams:{serverId:1,channelId:2},qchatGetRTCChannelMembersTag:{serverId:1,channelId:2},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},QChatGetNeroomTokenResultTag:{token:1,expire:2},QChatGetNeroomTokenParams:{neroomDeviceId:1}},iS=invertSerializeMap(oS),sS={qchatGetNeroomToken:{sid:25,cid:1,service:"qchatMedia",params:[{type:"Property",name:"qchatGetNeroomTokenTag",reflectMapper:oS.QChatGetNeroomTokenParams}],response:[{type:"Property",name:"neroomToken",reflectMapper:iS.QChatGetNeroomTokenResultTag}]},qchatUpdateRTCChannelConfig:{sid:25,cid:2,service:"qchatMedia",params:[{type:"Property",name:"RTCChannelConfig",reflectMapper:oS.QChatRTCChannelConfigTag}]},qchatGetRTCChannelConfig:{sid:25,cid:3,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelConfigTag",reflectMapper:oS.QChatGetRTCParams}],response:[{type:"Property",name:"RTCChannelConfig",reflectMapper:iS.QChatRTCChannelConfigResultTag}]},qchatGetRTCChannelMembers:{sid:25,cid:4,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelMembersTag",reflectMapper:oS.QChatGetRTCParams}],response:[{type:"PropertyArray",name:"memberList",reflectMapper:iS.memberInfo}]}},cS=/*#__PURE__*/function(t){function QChatMediaService(a){var o;return(o=t.call(this,"qchatMedia",a)||this).tokenExpireTime=24e4,o.getTokenState=!1,o.core=a,registerParser({cmdMap:aS,cmdConfig:sS}),o.core.on("disconnect",(function(){return __awaiter(c(o),void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){return ci.wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:if(!this.roomContext){t.next=3;break}return t.next=3,this.disconnectChannel();case 3:this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0);case 4:case"end":return t.stop()}}),_callee,this)})))})),o.core.on("kicked",(function(){return __awaiter(c(o),void 0,void 0,/*#__PURE__*/ci.mark((function _callee2(){return ci.wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(!this.roomContext){t.next=3;break}return t.next=3,this.disconnectChannel();case 3:this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0);case 4:case"end":return t.stop()}}),_callee2,this)})))})),o.core.eventBus.on("qchatMedia/serverOrChannelLeave",(function(t){return __awaiter(c(o),void 0,void 0,/*#__PURE__*/ci.mark((function _callee3(){return ci.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:if(!(t.type===lb[lb.channelVisibilityUpdate]&&t.channelId===this.channelId||t.type===lb[lb.serverEnterLeave]&&t.serverId===this.serverId)){a.next=4;break}if(!this.roomContext||!this.roomContext.roomUuid){a.next=4;break}return a.next=4,this.disconnectChannel();case 4:case"end":return a.stop()}}),_callee3,this)})))})),o.tokenExpireTime=24e4,o.channelId="",o.serverId="",o}Mt(QChatMediaService,t);var a=QChatMediaService.prototype;return a.setNeroom=function setNeroom(t){this.neroom=new t},a._checkPermission=function _checkPermission(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee4(){var a;return ci.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.qchatRole.checkPermission(t);case 2:return a=o.sent,o.abrupt("return",a);case 4:case"end":return o.stop()}}),_callee4,this)})))},a._checkConnectState=function _checkConnectState(){if("connect"!==this.state)throw new tc("QChatMedia::you should connect first")},a.kickMemberOut=function kickMemberOut(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee5(){return ci.wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),o.prev=2,o.next=5,null===(a=this.roomContext)||void 0===a?void 0:a.kickMemberOut(t.accid);case 5:o.next=11;break;case 7:throw o.prev=7,o.t0=o.catch(2),this.logger.error("QChatMedia::kickMemberOut error params is "+gi(t),o.t0),new tc("QChatMedia::kickMemberOut error",o.t0);case 11:case"end":return o.stop()}}),_callee5,this,[[2,7]])})))},a.disconnectChannel=function disconnectChannel(){var t;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee6(){return ci.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),this.logger.debug("QChatMedia::disconnect begin disconnect"),a.prev=2,a.next=5,null===(t=this.roomContext)||void 0===t?void 0:t.leaveRoom();case 5:a.next=10;break;case 7:a.prev=7,a.t0=a.catch(2),this.logger.error("QChatMedia::disconnect error",a.t0);case 10:if(!this.authService){a.next=13;break}return a.next=13,this.authService.logout();case 13:this._setStateInit(),this.core.emit("qchatMediaDisconnect");case 15:case"end":return a.stop()}}),_callee6,this,[[2,7]])})))},a._setStateInit=function _setStateInit(){this.logger.debug("QChatMedia::disconnect end"),this.roomContext=void 0,this.rtcController=void 0,this.state="init",this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0),this.channelId="",this.serverId=""},a.muteAudio=function muteAudio(t){var a,o,c,m,h;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee7(){var v;return ci.wrap((function _callee7$(b){for(;;)switch(b.prev=b.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),(null===(a=this.roomContext)||void 0===a?void 0:a.localMember.uuid)!==t.accid){b.next=14;break}return b.prev=3,b.next=6,null===(o=this.rtcController)||void 0===o?void 0:o.muteMyAudio();case 6:b.next=12;break;case 8:throw b.prev=8,b.t0=b.catch(3),this.logger.error("QChatMedia::muteAudio error",b.t0),new tc("QChatMedia::muteAudio error",b.t0);case 12:case 25:b.next=31;break;case 14:if(b.prev=14,!(v=null===(c=this.roomContext)||void 0===c?void 0:c.roomProperties.audioOff)||(null===(m=v.value)||void 0===m?void 0:m.split("_")[0])!==Zb.offNotAllowSelfOn){b.next=23;break}return b.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 19:if(b.sent){b.next=23;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),b.abrupt("return");case 23:return b.next=25,null===(h=this.rtcController)||void 0===h?void 0:h.muteMemberAudio(t.accid);case 27:throw b.prev=27,b.t1=b.catch(14),this.logger.error("QChatMedia::muteAudio error params is "+gi(t),b.t1),new tc("QChatMedia::muteAudio error",b.t1);case 31:case"end":return b.stop()}}),_callee7,this,[[3,8],[14,27]])})))},a.unMuteAudio=function unMuteAudio(t){var a,o,c,m,h;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee8(){var v;return ci.wrap((function _callee8$(b){for(;;)switch(b.prev=b.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),!(v=null===(a=this.roomContext)||void 0===a?void 0:a.roomProperties.audioOff)||(null===(o=v.value)||void 0===o?void 0:o.split("_")[0])!==Zb.offNotAllowSelfOn){b.next=10;break}return b.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 6:if(b.sent){b.next=10;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),b.abrupt("return");case 10:if((null===(c=this.roomContext)||void 0===c?void 0:c.localMember.uuid)!==t.accid){b.next=22;break}return b.prev=11,b.next=14,null===(m=this.rtcController)||void 0===m?void 0:m.unmuteMyAudio();case 14:b.next=20;break;case 16:throw b.prev=16,b.t0=b.catch(11),this.logger.error("QChatMedia::unMuteAudio error",b.t0),new tc("QChatMedia::unMuteAudio error",b.t0);case 20:case 25:b.next=31;break;case 22:return b.prev=22,b.next=25,null===(h=this.rtcController)||void 0===h?void 0:h.unmuteMemberAudio(t.accid);case 27:throw b.prev=27,b.t1=b.catch(22),this.logger.error("QChatMedia::unMuteAudio error params is "+gi(t),b.t1),new tc("QChatMedia::unMuteAudio error",b.t1);case 31:case"end":return b.stop()}}),_callee8,this,[[11,16],[22,27]])})))},a.muteVideo=function muteVideo(t){var a,o,c,m,h;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee9(){var v;return ci.wrap((function _callee9$(b){for(;;)switch(b.prev=b.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),(null===(a=this.roomContext)||void 0===a?void 0:a.localMember.uuid)!==t.accid){b.next=14;break}return b.prev=3,b.next=6,null===(o=this.rtcController)||void 0===o?void 0:o.muteMyVideo();case 6:b.next=12;break;case 8:throw b.prev=8,b.t0=b.catch(3),this.logger.error("QChatMedia::muteVideo error",b.t0),new tc("QChatMedia::muteVideo error",b.t0);case 12:case 25:b.next=31;break;case 14:if(b.prev=14,!(v=null===(c=this.roomContext)||void 0===c?void 0:c.roomProperties.videoOff)||(null===(m=v.value)||void 0===m?void 0:m.split("_")[0])!==Zb.offNotAllowSelfOn){b.next=23;break}return b.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 19:if(b.sent){b.next=23;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),b.abrupt("return");case 23:return b.next=25,null===(h=this.rtcController)||void 0===h?void 0:h.muteMemberVideo(t.accid);case 27:throw b.prev=27,b.t1=b.catch(14),this.logger.error("QChatMedia::muteVideo error params is "+gi(t),b.t1),new tc("QChatMedia::muteVideo error",b.t1);case 31:case"end":return b.stop()}}),_callee9,this,[[3,8],[14,27]])})))},a.unMuteVideo=function unMuteVideo(t){var a,o,c,m,h;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee10(){var v;return ci.wrap((function _callee10$(b){for(;;)switch(b.prev=b.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),!(v=null===(a=this.roomContext)||void 0===a?void 0:a.roomProperties.videoOff)||(null===(o=v.value)||void 0===o?void 0:o.split("_")[0])!==Zb.offNotAllowSelfOn){b.next=10;break}return b.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 6:if(b.sent){b.next=10;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),b.abrupt("return");case 10:if((null===(c=this.roomContext)||void 0===c?void 0:c.localMember.uuid)!==t.accid){b.next=22;break}return b.prev=11,b.next=14,null===(m=this.rtcController)||void 0===m?void 0:m.unmuteMyVideo();case 14:b.next=20;break;case 16:throw b.prev=16,b.t0=b.catch(11),this.logger.error("QChatMedia::unMuteVideo error",b.t0),new tc("QChatMedia::unMuteVideo error",b.t0);case 20:b.next=30;break;case 22:b.prev=22,null===(h=this.rtcController)||void 0===h||h.unmuteMemberVideo(t.accid),b.next=30;break;case 26:throw b.prev=26,b.t1=b.catch(22),this.logger.error("QChatMedia::unMuteVideo error",b.t1),new tc("QChatMedia::unMuteVideo error",b.t1);case 30:case"end":return b.stop()}}),_callee10,this,[[11,16],[22,26]])})))},a.startScreenShare=function startScreenShare(){var t;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee11(){return ci.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:this._checkConnectState(),a.prev=1,null===(t=this.rtcController)||void 0===t||t.startScreenShare(),a.next=9;break;case 5:throw a.prev=5,a.t0=a.catch(1),this.logger.error("QChatMedia::startScreenShare error",a.t0),new tc("QChatMedia::startScreenShare error",a.t0);case 9:case"end":return a.stop()}}),_callee11,this,[[1,5]])})))},a.stopScreenShare=function stopScreenShare(){var t;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee12(){return ci.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:this._checkConnectState(),a.prev=1,null===(t=this.rtcController)||void 0===t||t.stopScreenShare(),a.next=9;break;case 5:throw a.prev=5,a.t0=a.catch(1),this.logger.error("QChatMedia::stopScreenShare error",a.t0),new tc("QChatMedia::stopScreenShare error",a.t0);case 9:case"end":return a.stop()}}),_callee12,this,[[1,5]])})))},a.stopMemberScreenShare=function stopMemberScreenShare(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee13(){return ci.wrap((function _callee13$(o){for(;;)switch(o.prev=o.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),o.prev=2,null===(a=this.rtcController)||void 0===a||a.stopMemberScreenShare(t.accid),o.next=10;break;case 6:throw o.prev=6,o.t0=o.catch(2),this.logger.error("QChatMedia::stopMemberScreenShare error",o.t0),new tc("QChatMedia::stopMemberScreenShare error",o.t0);case 10:case"end":return o.stop()}}),_callee13,this,[[2,6]])})))},a.subscribeRemoteVideoStream=function subscribeRemoteVideoStream(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee14(){return ci.wrap((function _callee14$(o){for(;;)switch(o.prev=o.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},t),o.prev=2,null===(a=this.rtcController)||void 0===a||a.subscribeRemoteVideoStream(t.accid,t.streamType),o.next=10;break;case 6:throw o.prev=6,o.t0=o.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoStream error",o.t0),new tc("QChatMedia::subscribeRemoteVideoStream error",o.t0);case 10:case"end":return o.stop()}}),_callee14,this,[[2,6]])})))},a.unSubscribeRemoteVideoStream=function unSubscribeRemoteVideoStream(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee15(){return ci.wrap((function _callee15$(o){for(;;)switch(o.prev=o.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},t),o.prev=2,null===(a=this.rtcController)||void 0===a||a.unsubscribeRemoteVideoStream(t.accid,t.streamType),o.next=10;break;case 6:throw o.prev=6,o.t0=o.catch(2),this.logger.error("QChatMedia::unSubscribeRemoteVideoStream error",o.t0),new tc("QChatMedia::unSubscribeRemoteVideoStream error",o.t0);case 10:case"end":return o.stop()}}),_callee15,this,[[2,6]])})))},a.setupVideoCanvas=function setupVideoCanvas(t){var a;if(this._checkConnectState(),(null===(a=this.roomContext)||void 0===a?void 0:a.localMember.uuid)===t.accid)try{return this.rtcController.setupLocalVideoCanvas(t.videoView)}catch(t){throw this.logger.error("QChatMedia::setupVideoCanvas error",t),new tc("QChatMedia::setupVideoCanvas error",t)}else try{return this.rtcController.setupRemoteVideoCanvas(t.videoView,t.accid)}catch(t){throw this.logger.error("QChatMedia::setupVideoCanvas error",t),new tc("QChatMedia::setupVideoCanvas error",t)}},a.setupRemoteVideoSubStreamCanvas=function setupRemoteVideoSubStreamCanvas(t){this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t);try{return this.rtcController.setupRemoteVideoSubStreamCanvas(t.videoView,t.accid)}catch(t){throw this.logger.error("QChatMedia::setupRemoteVideoSubStreamCanvas error",t),new tc("QChatMedia::setupRemoteVideoSubStreamCanvas error",t)}},a.getScreenSharingUserUuid=function getScreenSharingUserUuid(){this._checkConnectState();try{return this.rtcController.getScreenSharingUserUuid()}catch(t){throw this.logger.error("QChatMedia::getScreenSharingUserUuid error",t),new tc("QChatMedia::getScreenSharingUserUuid error",t)}},a.initQChatMedia=function initQChatMedia(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee16(){return ci.wrap((function _callee16$(a){for(;;)switch(a.prev=a.next){case 0:if(this.neroom){a.next=3;break}return this.logger.warn("QChatMedia::init::you should import neroom SDK"),a.abrupt("return");case 3:if(void 0===this.state){a.next=6;break}return this.logger.error("QChatMedia::init::you already init QChatMedia"),a.abrupt("return");case 6:a.prev=6,this.neroom.initialize({appKey:this.core.options.appkey,serverConfig:t.serverConfig}),a.next=14;break;case 10:throw a.prev=10,a.t0=a.catch(6),this.logger.error("QChatMedia::initQChatMedia error",a.t0),new tc("QChatMedia::initQChatMedia error",a.t0);case 14:this.authService=this.neroom.authService,this.roomService=this.neroom.roomService,this.messageChannelService=this.neroom.messageChannelService,this.state="init";case 18:case"end":return a.stop()}}),_callee16,this,[[6,10]])})))},a.loginByIM=function loginByIM(){var t;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee17(){var a,o;return ci.wrap((function _callee17$(c){for(;;)switch(c.prev=c.next){case 0:if("init"===this.state){c.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),c.abrupt("return");case 3:return a=this.core.options,c.next=6,this._getToken();case 6:return o=c.sent,c.prev=7,c.next=10,null===(t=this.authService)||void 0===t?void 0:t.loginByIM(a.account,o,a.token);case 10:c.next=16;break;case 12:throw c.prev=12,c.t0=c.catch(7),this.logger.error("QChatMedia::loginByIM error",c.t0),new tc("QChatMedia::loginByIM error",c.t0);case 16:this.state="login";case 17:case"end":return c.stop()}}),_callee17,this,[[7,12]])})))},a._getToken=function _getToken(){var t;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee19(){var a,o,c,m,h=this;return ci.wrap((function _callee19$(v){for(;;)switch(v.prev=v.next){case 0:return this.logger.log("QChatMedia::getToken begin getToken"),v.next=3,this.core.sendCmd("qchatGetNeroomToken",{qchatGetNeroomTokenTag:{neroomDeviceId:null===(t=this.neroom)||void 0===t?void 0:t.deviceId}});case 3:return a=v.sent,o=a.content.neroomToken,c=o.token,m=o.expire,this.logger.log("QChatMedia::getToken success token is "+c+",expire is "+m+" "),this.tokenTimer||(this.logger.debug("QChatMedia::getToken set token timer,expire is "+(1e3*m-this.tokenExpireTime)+" "),this.tokenTimer=this.core.timerManager.addTimer((function(){return __awaiter(h,void 0,void 0,/*#__PURE__*/ci.mark((function _callee18(){var t;return ci.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return this.tokenTimer&&this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0,a.next=4,this._getToken();case 4:t=a.sent,this.authService&&this.authService.renewToken(t);case 6:case"end":return a.stop()}}),_callee18,this)})))}),1e3*m-this.tokenExpireTime)),v.abrupt("return",c);case 8:case"end":return v.stop()}}),_callee19,this)})))},a.connectChannel=function connectChannel(t){var a,o;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee20(){var c;return ci.wrap((function _callee20$(m){for(;;)switch(m.prev=m.next){case 0:if(void 0!==this.state){m.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),m.abrupt("return");case 3:if("init"!==this.state){m.next=6;break}return m.next=6,this.loginByIM();case 6:return this.serverId=t.serverId,this.channelId=t.channelId,m.prev=8,m.next=11,null===(a=this.roomService)||void 0===a?void 0:a.joinRoom({roomUuid:t.channelId,role:"qchatAudience",userName:this.core.options.account,initialProperties:{}},{});case 11:m.next=17;break;case 13:throw m.prev=13,m.t0=m.catch(8),this.logger.error("QChatMedia::connectChannel error",m.t0),new tc("QChatMedia::connectChannel error",m.t0);case 17:if(!(c=null===(o=this.roomService)||void 0===o?void 0:o.getRoomContext(t.channelId))){m.next=27;break}return this.roomContext=c,this.rtcController=this.roomContext.rtcController,this.state="connect",m.next=24,this.rtcController.joinRtcChannel();case 24:this.core.emit("connectChannel"),m.next=28;break;case 27:this.logger.error("QChatMedia::connect room not exited");case 28:case"end":return m.stop()}}),_callee20,this,[[8,13]])})))},a.updateRTCChannelInfo=function updateRTCChannelInfo(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee21(){return ci.wrap((function _callee21$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},limit:{type:"number",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateRTCChannelConfig",{RTCChannelConfig:fi(fi({},t),{audio:gi(t.audio),video:gi(t.video)})});case 3:case"end":return a.stop()}}),_callee21,this)})))},a.getRTCChannelInfo=function getRTCChannelInfo(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee22(){var a;return ci.wrap((function _callee22$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatGetRTCChannelConfig",{qchatGetRTCChannelConfigTag:t});case 3:return a=o.sent,o.abrupt("return",formatRTCChannelConfig(a.content.RTCChannelConfig));case 5:case"end":return o.stop()}}),_callee22,this)})))},a.getRTCChannelOnlineMembers=function getRTCChannelOnlineMembers(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee23(){var a;return ci.wrap((function _callee23$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatGetRTCChannelMembers",{qchatGetRTCChannelMembersTag:t});case 3:return a=o.sent,o.abrupt("return",formatMembers(a.content.memberList));case 5:case"end":return o.stop()}}),_callee23,this)})))},a.addRTCChannelListener=function addRTCChannelListener(){var t,a,o=this;this._checkConnectState();try{null===(t=this.authService)||void 0===t||t.addAuthListener({onAuthEvent:function onAuthEvent(t){return __awaiter(o,void 0,void 0,/*#__PURE__*/ci.mark((function _callee24(){var a;return ci.wrap((function _callee24$(o){for(;;)switch(o.prev=o.next){case 0:if(1026!==t||this.getTokenState){o.next=10;break}return this.logger.log("QChatMedia::loginByIM token expire,begin get new token "),this.getTokenState=!0,o.next=5,this._getToken();case 5:if(a=o.sent,!this.authService){o.next=9;break}return o.next=9,this.authService.renewToken(a);case 9:this.getTokenState=!1;case 10:case"end":return o.stop()}}),_callee24,this)})))}})}catch(t){throw this.getTokenState=!1,this.logger.error("QChatMedia::loginByIM addAuthListener error",t),new tc("QChatMedia::loginByIM addAuthListener error",t)}null===(a=this.roomContext)||void 0===a||a.addRoomListener({onRoomPropertiesChanged:function onRoomPropertiesChanged(t){var a,c,m,h,v,b;if(o.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesChanged",t),t.audioOff){var S=null===(a=t.audioOff.value)||void 0===a?void 0:a.split("_")[0];S!==Zb.offNotAllowSelfOn&&S!==Zb.offAllowSelfOn||(null===(c=o.roomContext)||void 0===c?void 0:c.localMember.isAudioOn)&&(null===(m=o.rtcController)||void 0===m||m.muteMyAudio())}else if(t.videoOff){var M=null===(h=t.videoOff.value)||void 0===h?void 0:h.split("_")[0];M!==Zb.offNotAllowSelfOn&&M!==Zb.offAllowSelfOn||(null===(v=o.roomContext)||void 0===v?void 0:v.localMember.isVideoOn)&&(null===(b=o.rtcController)||void 0===b||b.muteMyVideo())}},onRoomPropertiesDeleted:function onRoomPropertiesDeleted(t){o.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesDeleted",t)},onMemberJoinRtcChannel:function onMemberJoinRtcChannel(t){o.logger.log("QChatMedia::addRTCChannelListener::onMemberJoinRTCChannel",t);var a=map(t).call(t,(function(t){return t.uuid}));o.core.emit("memberJoinRTCChannel",a)},onMemberLeaveRoom:function onMemberLeaveRoom(t){o.logger.log("QChatMedia::addRTCChannelListener::onMemberLeaveRoom",t);var a=map(t).call(t,(function(t){return t.uuid}));o.core.emit("memberLeaveRTCChannel",a)},onRoomEnded:function onRoomEnded(t){o.authService&&o.authService.logout(),o._setStateInit(),o.logger.log("QChatMedia::addRTCChannelListener::onRoomEnded",t),o.core.emit("RTCChannelEnded",t)},onRtcChannelError:function onRtcChannelError(t){o.logger.log("QChatMedia::addRTCChannelListener::onRtcChannelError",t),"SOCKET_ERROR"===t&&o.disconnectChannel(),o.core.emit("RTCChannelError",t)},onRtcAudioVolumeIndication:function onRtcAudioVolumeIndication(t){o.logger.log("QChatMedia::addRTCChannelListener::onRtcAudioVolumeIndication",t),o.core.emit("onRtcAudioVolumeIndication",t)},onMemberAudioMuteChanged:function onMemberAudioMuteChanged(t,a,c){o.logger.log("QChatMedia::addRTCChannelListener::onMemberAudioMuteChanged",t,a),o.core.emit("memberAudioMuteChanged",{memberAccId:t.uuid,mute:a,operateByAccId:c.uuid})},onMemberScreenShareStateChanged:function onMemberScreenShareStateChanged(t,a,c){o.logger.log("QChatMedia::addRTCChannelListener::onMemberScreenShareStateChanged",t,a),o.core.emit("memberScreenShareStateChanged",{memberAccId:t.uuid,isSharing:a,operateByAccId:c.uuid})},onMemberVideoMuteChanged:function onMemberVideoMuteChanged(t,a,c){o.logger.log("QChatMedia::addRTCChannelListener::onMemberVideoMuteChanged",t,a),o.core.emit("memberVideoMuteChanged",{memberAccId:t.uuid,mute:a,operateByAccId:c.uuid})}})},a.enumCameraDevices=function enumCameraDevices(){var t=this;return this._checkConnectState(),this.rtcController.enumCameraDevices().then((function(t){return t.data}),(function(a){throw t.logger.error("QChatMedia::enumCameraDevices error",a),new tc("QChatMedia::enumCameraDevices error",a)}))},a.enumPlayoutDevices=function enumPlayoutDevices(){var t=this;return this._checkConnectState(),this.rtcController.enumPlayoutDevices().then((function(t){return t.data}),(function(a){throw t.logger.error("QChatMedia::enumPlayoutDevices error",a),new tc("QChatMedia::enumPlayoutDevices error",a)}))},a.enumRecordDevices=function enumRecordDevices(){var t=this;return this._checkConnectState(),this.rtcController.enumRecordDevices().then((function(t){return t.data}),(function(a){throw t.logger.error("QChatMedia::enumRecordDevices error",a),new tc("QChatMedia::enumRecordDevices error",a)}))},a.removeRTCChannelListener=function removeRTCChannelListener(){var t,a;this._checkConnectState(),null===(t=this.roomContext)||void 0===t||t.removeRoomListener({}),null===(a=this.authService)||void 0===a||a.removeAuthListener({})},a.setSelectedCameraDevice=function setSelectedCameraDevice(t){var a=this;return this._checkConnectState(),validate({deviceId:{type:"string",allowEmpty:!1}},t),this.rtcController.setSelectedCameraDevice(t.deviceId).then((function(t){return t.data}),(function(t){throw a.logger.error("QChatMedia::setSelectedCameraDevice error",t),new tc("QChatMedia::setSelectedCameraDevice error",t)}))},a.setSelectedPlayoutDevice=function setSelectedPlayoutDevice(t){var a=this;return this._checkConnectState(),validate({deviceId:{type:"string",allowEmpty:!1}},t),this.rtcController.setSelectedPlayoutDevice(t.deviceId).then((function(t){return t.data}),(function(t){throw a.logger.error("QChatMedia::setSelectedPlayoutDevice error",t),new tc("QChatMedia::setSelectedPlayoutDevice error",t)}))},a.setSelectedRecordDevice=function setSelectedRecordDevice(t){var a=this;return this._checkConnectState(),validate({deviceId:{type:"string",allowEmpty:!1}},t),this.rtcController.setSelectedRecordDevice(t.deviceId).then((function(t){return t.data}),(function(t){throw a.logger.error("QChatMedia::setSelectedRecordDevice error",t),new tc("QChatMedia::setSelectedRecordDevice error",t)}))},a.getRTCMembers=function getRTCMembers(){var t,a;return this._checkConnectState(),map(t=filter(a=this.roomContext.remoteMembers).call(a,(function(t){return t.isInRtcChannel}))).call(t,(function(t){return{accid:t.uuid,isAudioOn:!!t.isAudioOn,isVideoOn:!!t.isVideoOn,isSharingScreen:!!t.isSharingScreen,properties:t.properties}}))},a.subscribeRemoteVideoSubStream=function subscribeRemoteVideoSubStream(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee25(){return ci.wrap((function _callee25$(o){for(;;)switch(o.prev=o.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),o.prev=2,null===(a=this.rtcController)||void 0===a||a.subscribeRemoteVideoSubStream(t.accid),o.next=10;break;case 6:throw o.prev=6,o.t0=o.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoSubStream error",o.t0),new tc("QChatMedia::subscribeRemoteVideoSubStream error",o.t0);case 10:case"end":return o.stop()}}),_callee25,this,[[2,6]])})))},a.unsubscribeRemoteVideoSubStream=function unsubscribeRemoteVideoSubStream(t){var a;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee26(){return ci.wrap((function _callee26$(o){for(;;)switch(o.prev=o.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),o.prev=2,null===(a=this.rtcController)||void 0===a||a.unsubscribeRemoteVideoSubStream(t.accid),o.next=10;break;case 6:throw o.prev=6,o.t0=o.catch(2),this.logger.error("QChatMedia::unsubscribeRemoteVideoSubStream error",o.t0),new tc("QChatMedia::unsubscribeRemoteVideoSubStream error",o.t0);case 10:case"end":return o.stop()}}),_callee26,this,[[2,6]])})))},a.muteAllAudio=function muteAllAudio(){var t;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee27(){return ci.wrap((function _callee27$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("audioOff",gi({value:Zb.offNotAllowSelfOn+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::muteAllAudio error",a.t0),new tc("QChatMedia::muteAllAudio error",a.t0);case 15:case"end":return a.stop()}}),_callee27,this,[[7,11]])})))},a.muteAllVideo=function muteAllVideo(){var t;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee28(){return ci.wrap((function _callee28$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("videoOff",gi({value:Zb.offNotAllowSelfOn+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::muteAllVideo error",a.t0),new tc("QChatMedia::muteAllVideo error",a.t0);case 15:case"end":return a.stop()}}),_callee28,this,[[7,11]])})))},a.unMuteAllAudio=function unMuteAllAudio(){var t;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee29(){return ci.wrap((function _callee29$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("audioOff",gi({value:Zb.disable+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::unMuteAllAudio error",a.t0),new tc("QChatMedia::unMuteAllAudio error",a.t0);case 15:case"end":return a.stop()}}),_callee29,this,[[7,11]])})))},a.unMuteAllVideo=function unMuteAllVideo(){var t;return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee30(){return ci.wrap((function _callee30$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("videoOff",gi({value:Zb.disable+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::unMuteAllVideo error",a.t0),new tc("QChatMedia::unMuteAllVideo error",a.t0);case 15:case"end":return a.stop()}}),_callee30,this,[[7,11]])})))},QChatMediaService}(vv),lS={"1_2":"heartbeat","24_2":"qchatLogin","24_4":"qchatExit","24_5":"qchatBeKicked","24_8":"qchatMultiSpotLogin","24_9":"qchatKick","24_19":"qchatSync"},uS={qchatLoginTag:{appkey:1,account:2,authType:3,token:4,loginExt:5,clientType:6,clientSession:7,deviceId:8,sdkVersion:9,sdkType:10,userAgent:11,customTag:12,customClientType:13,sdkHumanVersion:14,pushTokenName:20,pushToken:21,pushkitTokenName:22,pushkitToken:23,deviceInfo:24,customPushContentType:25,os:30,mac:31,bundleId:32,simCarrierCode:33,simCountryCode:34,networkCode:35,browser:36,deviceModel:37,androidid:38,imei:39,idfv:40,openuuid:41,pushType:100,hasTokenPreviously:101,consid:102,clientIP:103,clientPort:104,loginTime:105}},dS=invertSerializeMap(uS),pS={heartbeat:{sid:1,cid:2,service:"qchatAuth"},qchatLogin:{sid:24,cid:2,service:"qchatAuth",params:[{type:"Property",name:"qchatLoginReqTag",reflectMapper:uS.qchatLoginTag}],response:[{type:"Property",name:"qchatLoginResTag",reflectMapper:dS.qchatLoginTag},{type:"PropertyArray",name:"qchatMultiLoginResult",reflectMapper:dS.qchatLoginTag}]},qchatExit:{sid:24,cid:4,service:"qchatAuth"},qchatBeKicked:{sid:24,cid:5,service:"qchatAuth",response:[{type:"Property",name:"beKickedTag",reflectMapper:{1:"clientType",2:"reason",3:"ext",4:"customClientType"}}]},qchatMultiSpotLogin:{sid:24,cid:8,service:"qchatAuth",response:[{type:"Number",name:"state"},{type:"Property",name:"qchatLoginResTag",reflectMapper:dS.qchatLoginTag}]},qchatKick:{sid:24,cid:9,service:"qchatAuth",params:[{type:"StrArray",name:"deviceIds"}],response:[{type:"StrArray",name:"deviceIds"}]},qchatSync:{sid:24,cid:19,service:"qchatAuth",isNoResponse:!0,params:[{type:"Property",name:"qchatSyncTag",reflectMapper:{systemNotification:1,pushConfig:2}}],response:[{type:"Number",name:"timetag"}]}},mS={debugLevel:"off",needReconnect:!0,reconnectionAttempts:9007199254740991,isAbtestEnable:!0,abtestUrl:"https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo",abtestProjectKey:"imElite_sdk_abtest_web"},hS=/*#__PURE__*/function(t){function QChat(a,o){var m;return void 0===o&&(o={cloudStorageConfig:{}}),(m=t.call(this,a)||this).instanceName="QChat",m.account="",m.options={},m.qchatAuth={},m.qchatServer={},m.qchatChannel={},m.qchatMsg={},m.qchatRole={},m.qchatMedia={},m.cloudStorage={},m.setOptions(a),registerParser({cmdMap:lS,cmdConfig:pS}),registerParser({cmdMap:ey,cmdConfig:ny}),m.qchatAuth=new tS(c(m)),m.qchatServer=new zv(c(m)),m.qchatChannel=new Ib(c(m)),m.qchatMsg=new Jb(c(m)),m.qchatRole=new qb(c(m)),m.qchatMedia=new cS(c(m)),m.cloudStorage=new py(c(m),fi({storageKeyPrefix:m.instanceName},o.cloudStorageConfig)),o&&m.setOtherOptions(o),QChat.instance=c(m),m}Mt(QChat,t),QChat.getInstance=function getInstance(t,a){if(!QChat.instance){if(t)return new QChat(t,a);throw new Error("Instance not exist, please input options")}if(t){if(QChat.instance.options.account===t.account&&QChat.instance.options.appkey===t.appkey)return QChat.instance.setOptions(t),a&&QChat.instance.setOtherOptions(a),QChat.instance;throw new Error("Unexpected login")}return QChat.instance};var a=QChat.prototype;return a.connect=function connect(a){void 0===a&&(a={});var o=st(null,{connect:{get:function get(){return t.prototype.connect}}});return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var t,c,m;return ci.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:if(/^(unconnected|waitReconnect)$/.test(this.status)){h.next=4;break}return t="QChat status is "+this.status+", and would not connect",this.logger.warn(t),h.abrupt("return",zo.reject(t));case 4:return c=a.isAutoReconnect||!1,h.next=7,o.connect.call(this,{linkUrls:this.options.linkAddresses,isAutoReconnect:c});case 7:return h.prev=7,h.next=10,this.qchatAuth.doLogin(c);case 10:m=h.sent,h.next=21;break;case 13:if(h.prev=13,h.t0=h.catch(7),this.logger.warn("qchat connect:: login failed",h.t0),0!==this.retryCount){h.next=19;break}throw this.doDisconnect(ju.ACTIVE,"FailedToInitializeLogin"),h.t0;case 19:return this.doDisconnect(ju.OFFLINE,"ReconnectLoginFailed"),h.abrupt("return");case 21:return this.status="logined",m.loginResult.appkey=this.options.appkey,this.eventBus.emit("logined",m.loginResult),this.emit("logined",m.loginResult),m.multiLoginResults&&m.multiLoginResults.length>0&&this.emit("multiSpotLogin",m.multiLoginResults),this.resetConnectStatus(),this.ping(),h.prev=28,h.next=31,this.cloudStorage.init();case 31:h.next=36;break;case 33:h.prev=33,h.t1=h.catch(28),this.logger.error("NIM:login cloudStorage init failed ",h.t1);case 36:return h.next=38,this.qchatAuth.sync();case 38:case"end":return h.stop()}}),_callee,this,[[7,13],[28,33]])})))},a.login=function login(t){return void 0===t&&(t={}),this.connect(t)},a.setOptions=function setOptions(t){validate({account:{type:"string"},appkey:{type:"string"},token:{type:"string"},linkAddresses:{type:"array",itemType:"string",min:1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},debugLevel:{type:"enum",values:lc,required:!1}},t),this.logger.log("QChat::setOptions options is",t),this.account=t.account,this.options=fi(fi({},mS),t)},a.setOtherOptions=function setOtherOptions(t){var a;(null===(a=null==t?void 0:t.QChatMedia)||void 0===a?void 0:a.neroom)&&this.qchatMedia.setNeroom(t.QChatMedia.neroom)},a.onMessage=function onMessage(a){var o,c,m=t.prototype.onMessage.call(this,a);if(m){var h=m.raw.ser,v=this.sendingCmdMap.get(h);if(v&&v.cmd===m.cmd){var b=v.callback,S=v.timer,M=v.params;if(clearTimeout(S),m.params=M,this.sendingCmdMap.delete(h),"heartbeat"===m.cmd)return void b[0]();var C=null===(o=this[m.service])||void 0===o?void 0:o.process(m);C&&"function"==typeof C.then?C.then((function(t){b[0](t)})).catch((function(t){b[1](t)})):(this.logger.log("imsocket:: handlerFn without promise",m.service,m.cmd),b[0]())}else null===(c=this[m.service])||void 0===c||c.process(m)}},a.disconnect=function disconnect(){var a=this;switch(this.status){case"connected":case"logined":return this.sendCmd("qchatExit").then((function(){t.prototype.doDisconnect.call(a,ju.ACTIVE,"UserActiveDisconnect")}));case"connecting":case"waitReconnect":return t.prototype.doDisconnect.call(this,ju.ACTIVE,"UserActiveDisconnect"),zo.resolve();case"unconnected":case"destroyed":return zo.resolve()}},a.logout=function logout(){return this.disconnect()},a.destroy=function destroy(){return QChat.instance=null,t.prototype.destroy.call(this)},a.kickOtherClients=function kickOtherClients(t){return validate({deviceIds:{type:"array",itemType:"string"}},t),this.qchatAuth.kick(t)},QChat}(Hu);hS.instance=null;var fS=Math.min,gS=[].lastIndexOf,yS=!!gS&&1/[1].lastIndexOf(1,-0)<0,vS=arrayMethodIsStrict("lastIndexOf"),bS=yS||!vS?function lastIndexOf(t){if(yS)return M(gS,this,arguments)||0;var a=toIndexedObject(this),o=lengthOfArrayLike(a),c=o-1;for(arguments.length>1&&(c=fS(c,toIntegerOrInfinity(arguments[1]))),c<0&&(c=o+c);c>=0;c--)if(c in a&&a[c]===t)return c||0;return-1}:gS;_export({target:"Array",proto:!0,forced:bS!==[].lastIndexOf},{lastIndexOf:bS});var SS=entryVirtual("Array").lastIndexOf,MS=Array.prototype,lastIndexOf=function(t){var a=t.lastIndexOf;return t===MS||G(MS,t)&&a===MS.lastIndexOf?SS:a},CS=console,TS={clear:function clear(){try{uni.clearStorageSync()}catch(t){CS.error("uni-app::ws: clearStorage ",t)}},getItem:function getItem(t){return uni.getStorageSync(t)},setItem:function setItem(t,a){return uni.setStorageSync(t,a)},removeItem:function removeItem(t){return uni.removeStorageSync(t)}},_S=/*#__PURE__*/function(){function WebSocket(t,a){var o=this;if(void 0===a&&(a=""),this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.onclose=function(t){CS.log("Adapter uniapp: sockets on close ",t)},this.onerror=function(t){CS.error("Adapter uniapp: sockets error ",t)},this.onmessage=function(t){},this.onopen=function(t){},!t)throw new Error("Failed to construct 'socket': url required");this.url=t.replace(/:443(\/|$)/,"$1"),this.protocol=a,this.readyState=this.CONNECTING;var c=this.protocol?{protocols:this.protocol}:{};if("function"==typeof getApp){var m=getApp();if(m&&m.globalData&&m.globalData.__NIM_SDK_SOCKET_INTANCE_STATE)throw CS.warn("warning: uniapp create socket:: Multiple websockets are created in uniapp, may lead to unexpected results"),new Error("Create websocket failed cause multiple websockets are not supported in uniapp")}uni.connectSocket(fi(fi({url:this.url},c),{fail:function fail(t){o.errorHandler(t)},success:function success(){if("function"==typeof getApp){var t=getApp();t&&t.globalData&&(t.globalData.__NIM_SDK_SOCKET_INTANCE_STATE="CREATED")}}})),uni.onSocketOpen((function(t){o.readyState=o.OPEN,o.onmessage&&o.onmessage({type:"open",header:t})})),uni.onSocketError((function(t){if("function"==typeof getApp){var a=getApp();a&&a.globalData&&delete a.globalData.__NIM_SDK_SOCKET_INTANCE_STATE}o.errorHandler(t)})),uni.onSocketClose((function(t){CS.log("uniapp socket closed"),o.readyState=o.CLOSED;var a=t.code,c=t.reason,m=t.wasClean;if("function"==typeof o.onclose&&o.onclose&&o.onclose({code:a,reason:c,wasClean:m,type:"close"}),"function"==typeof getApp){var h=getApp();h&&h.globalData&&delete h.globalData.__NIM_SDK_SOCKET_INTANCE_STATE}})),uni.onSocketMessage((function(t){var a=t.data,c=t.origin,m=t.ports,h=t.source;o.onmessage&&o.onmessage({data:a,origin:c,ports:m,source:h,type:"message"})}))}var t=WebSocket.prototype;return t.close=function close(){uni.closeSocket({code:1e3,reason:"user force close websocket",complete:function complete(){}})},t.send=function send(t){if(this.readyState!==this.OPEN)throw new Error("Adapter uniapp: socket sendMsg when readyState="+this.readyState);if(!("string"==typeof t||t instanceof ArrayBuffer))throw new TypeError("Adapter uniapp: socket sendMsg only String/ArrayBuffer supported");uni.sendSocketMessage({data:t})},t.errorHandler=function errorHandler(t){var a,o;this.readyState=this.CLOSED,this.onerror&&this.onerror({type:"error",message:t&&t.errMsg}),t.errMsg&&"[object Array]"===Object.prototype.toString.call(t.errMsg)&&(indexOf(a=t.errMsg).call(a,"断裂管道")>0||indexOf(o=t.errMsg).call(o,"broken pipe")>0)&&this.onclose&&this.onclose({code:1006,reason:t&&t.errMsg,type:"close"})},WebSocket}();var wS={setLogger:function setLogger(t){CS=t},platform:"UNIAPP",localStorage:TS,request:function request$4(t,a){return new zo((function(o,c){uni.request(fi(fi({method:"GET",url:t},a),{success:function success(t){t={data:t.data,status:t.statusCode,errMsg:t.errMsg,header:t.header},o(t)},fail:function fail(t){c(t)}}))}))},WebSocket:_S,uploadFile:function uploadFile$5(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){return ci.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,new zo((function(a,o){var c=uni.uploadFile({url:t.commonUploadHost?t.commonUploadHost+"/"+t.nosToken.bucket:"https://nos.netease.com/nim",formData:{Object:decodeURIComponent(t.nosToken.objectName),"x-nos-token":t.nosToken.token,"x-nos-entity-type":"json"},name:"file",fileType:t.type,filePath:t.filePath,success:function success(c){if(200==c.statusCode)try{var m,h,v,b=JSON.parse(c.data);b.name=t.filePath,b.ext=lastIndexOf(m=b.name).call(m,".")>-1?slice(h=b.name).call(h,lastIndexOf(v=b.name).call(v,".")+1).toLowerCase():"",a(b)}catch(t){o(new Error("Upload Error parse result error: "+c.data))}else o(new Error("Upload error "+c.statusCode+": "+c.errMsg))},fail:function fail(t){o(t)}});try{t.onUploadStart&&t.onUploadStart(c)}catch(t){CS.error("Adapter uploadFile: options.onUploadStart error",t&&t.message),c.abort(),o(t)}t.onUploadProgress&&c.onProgressUpdate((function(a){t.onUploadProgress&&t.onUploadProgress({total:a.totalBytesExpectedToSend,loaded:a.totalBytesSent,percentage:a.progress,percentageText:a.progress+"%"})}))}));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee)})))},getSystemInfo:function getSystemInfo$5(){var t=uni.getSystemInfoSync()||{};return{os:t.osName||"UNIAPP_UNKNOW",osVer:t.osVersion,browser:t.browserName||"",browserVer:t.browserVersion||"",hostEnv:t.hostName,hostEnvVer:t.hostVersion,hostInfo:t.uniPlatform,pushDeviceInfo:{PRODUCT:t.model,DEVICE:t.model,MANUFACTURER:t.brand}}}},IS=createCommonjsModule((function(a,o){(function(){var c={function:!0,object:!0}[typeof window]&&window||this,m=o,h=a&&!a.nodeType&&a,v=m&&h&&"object"==typeof t&&t;!v||v.global!==v&&v.window!==v&&v.self!==v||(c=v);var b=Math.pow(2,53)-1,S=/\bOpera/,M=Object.prototype,C=M.hasOwnProperty,T=M.toString;function capitalize(t){return(t=String(t)).charAt(0).toUpperCase()+t.slice(1)}function format(t){return t=trim(t),/^(?:webOS|i(?:OS|P))/.test(t)?t:capitalize(t)}function forOwn(t,a){for(var o in t)C.call(t,o)&&a(t[o],o,t)}function getClassOf(t){return null==t?capitalize(t):T.call(t).slice(8,-1)}function qualify(t){return String(t).replace(/([ -])(?!$)/g,"$1?")}function reduce(t,a){var o=null;return function each(t,a){var o=-1,c=t?t.length:0;if("number"==typeof c&&c>-1&&c<=b)for(;++o<c;)a(t[o],o,t);else forOwn(t,a)}(t,(function(c,m){o=a(o,c,m,t)})),o}function trim(t){return String(t).replace(/^ +| +$/g,"")}var w=function parse(t){var a=c,o=t&&"object"==typeof t&&"String"!=getClassOf(t);o&&(a=t,t=null);var m=a.navigator||{},h=m.userAgent||"";t||(t=h);var v,b,M=o?!!m.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(T.toString()),C="Object",w=o?C:"ScriptBridgingProxyObject",I=o?C:"Environment",k=o&&a.java?"JavaPackage":getClassOf(a.java),x=o?C:"RuntimeObject",R=/\bJava/.test(k)&&a.java,E=R&&getClassOf(a.environment)==I,A=R?"a":"α",q=R?"b":"β",P=a.document||{},O=a.operamini||a.opera,U=S.test(U=o&&O?O["[[Class]]"]:getClassOf(O))?U:O=null,B=t,L=[],j=null,N=t==h,D=N&&O&&"function"==typeof O.version&&O.version(),$=function getLayout(a){return reduce(a,(function(a,o){return a||RegExp("\\b"+(o.pattern||qualify(o))+"\\b","i").exec(t)&&(o.label||o)}))}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),H=function getName(a){return reduce(a,(function(a,o){return a||RegExp("\\b"+(o.pattern||qualify(o))+"\\b","i").exec(t)&&(o.label||o)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),G=getProduct([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),Q=function getManufacturer(a){return reduce(a,(function(a,o,c){return a||(o[G]||o[/^[a-z]+(?: +[a-z]+\b)*/i.exec(G)]||RegExp("\\b"+qualify(c)+"(?:\\b|\\w*\\d)","i").exec(t))&&c}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),W=function getOS(a){return reduce(a,(function(a,o){var c=o.pattern||qualify(o);return!a&&(a=RegExp("\\b"+c+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(a=function cleanupOS(t,a,o){var c={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return a&&o&&/^Win/i.test(t)&&!/^Windows Phone /i.test(t)&&(c=c[/[\d.]+$/.exec(t)])&&(t="Windows "+c),t=String(t),a&&o&&(t=t.replace(RegExp(a,"i"),o)),format(t.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(a,c,o.label||o)),a}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function getProduct(a){return reduce(a,(function(a,o){var c=o.pattern||qualify(o);return!a&&(a=RegExp("\\b"+c+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+c+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+c+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((a=String(o.label&&!RegExp(c,"i").test(o.label)?o.label:a).split("/"))[1]&&!/[\d.]+/.test(a[0])&&(a[0]+=" "+a[1]),o=o.label||o,a=format(a[0].replace(RegExp(c,"i"),o).replace(RegExp("; *(?:"+o+"[_-])?","i")," ").replace(RegExp("("+o+")[-_.]?(\\w)","i"),"$1 $2"))),a}))}function getVersion(a){return reduce(a,(function(a,o){return a||(RegExp(o+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if($&&($=[$]),/\bAndroid\b/.test(W)&&!G&&(v=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(G=trim(v[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),Q&&!G?G=getProduct([Q]):Q&&G&&(G=G.replace(RegExp("^("+qualify(Q)+")[-_.\\s]","i"),Q+" ").replace(RegExp("^("+qualify(Q)+")[-_.]?(\\w)","i"),Q+" $2")),(v=/\bGoogle TV\b/.exec(G))&&(G=v[0]),/\bSimulator\b/i.test(t)&&(G=(G?G+" ":"")+"Simulator"),"Opera Mini"==H&&/\bOPiOS\b/.test(t)&&L.push("running in Turbo/Uncompressed mode"),"IE"==H&&/\blike iPhone OS\b/.test(t)?(Q=(v=parse(t.replace(/like iPhone OS/,""))).manufacturer,G=v.product):/^iP/.test(G)?(H||(H="Safari"),W="iOS"+((v=/ OS ([\d_]+)/i.exec(t))?" "+v[1].replace(/_/g,"."):"")):"Konqueror"==H&&/^Linux\b/i.test(W)?W="Kubuntu":Q&&"Google"!=Q&&(/Chrome/.test(H)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(G))||/\bAndroid\b/.test(W)&&/^Chrome/.test(H)&&/\bVersion\//i.test(t)?(H="Android Browser",W=/\bAndroid\b/.test(W)?W:"Android"):"Silk"==H?(/\bMobi/i.test(t)||(W="Android",L.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&L.unshift("accelerated")):"UC Browser"==H&&/\bUCWEB\b/.test(t)?L.push("speed mode"):"PaleMoon"==H&&(v=/\bFirefox\/([\d.]+)\b/.exec(t))?L.push("identifying as Firefox "+v[1]):"Firefox"==H&&(v=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(W||(W="Firefox OS"),G||(G=v[1])):!H||(v=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(H))?(H&&!G&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(v+"/")+8))&&(H=null),(v=G||Q||W)&&(G||Q||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(W))&&(H=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(W)?W:v)+" Browser")):"Electron"==H&&(v=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&L.push("Chromium "+v),D||(D=getVersion(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",qualify(H),"(?:Firefox|Minefield|NetFront)"])),(v=("iCab"==$&&parseFloat(D)>3?"WebKit":/\bOpera\b/.test(H)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test($)&&"WebKit"||!$&&/\bMSIE\b/i.test(t)&&("Mac OS"==W?"Tasman":"Trident")||"WebKit"==$&&/\bPlayStation\b(?! Vita\b)/i.test(H)&&"NetFront")&&($=[v]),"IE"==H&&(v=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(H+=" Mobile",W="Windows Phone "+(/\+$/.test(v)?v:v+".x"),L.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(H="IE Mobile",W="Windows Phone 8.x",L.unshift("desktop mode"),D||(D=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=H&&"Trident"==$&&(v=/\brv:([\d.]+)/.exec(t))&&(H&&L.push("identifying as "+H+(D?" "+D:"")),H="IE",D=v[1]),N){if(function isHostType(t,a){var o=null!=t?typeof t[a]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(o)||"object"==o&&!t[a])}(a,"global"))if(R&&(B=(v=R.lang.System).getProperty("os.arch"),W=W||v.getProperty("os.name")+" "+v.getProperty("os.version")),E){try{D=a.require("ringo/engine").version.join("."),H="RingoJS"}catch(t){(v=a.system)&&v.global.system==a.system&&(H="Narwhal",W||(W=v[0].os||null))}H||(H="Rhino")}else"object"==typeof a.process&&!a.process.browser&&(v=a.process)&&("object"==typeof v.versions&&("string"==typeof v.versions.electron?(L.push("Node "+v.versions.node),H="Electron",D=v.versions.electron):"string"==typeof v.versions.nw&&(L.push("Chromium "+D,"Node "+v.versions.node),H="NW.js",D=v.versions.nw)),H||(H="Node.js",B=v.arch,W=v.platform,D=(D=/[\d.]+/.exec(v.version))?D[0]:null));else getClassOf(v=a.runtime)==w?(H="Adobe AIR",W=v.flash.system.Capabilities.os):getClassOf(v=a.phantom)==x?(H="PhantomJS",D=(v=v.version||null)&&v.major+"."+v.minor+"."+v.patch):"number"==typeof P.documentMode&&(v=/\bTrident\/(\d+)/i.exec(t))?(D=[D,P.documentMode],(v=+v[1]+4)!=D[1]&&(L.push("IE "+D[1]+" mode"),$&&($[1]=""),D[1]=v),D="IE"==H?String(D[1].toFixed(1)):D[0]):"number"==typeof P.documentMode&&/^(?:Chrome|Firefox)\b/.test(H)&&(L.push("masking as "+H+" "+D),H="IE",D="11.0",$=["Trident"],W="Windows");W=W&&format(W)}if(D&&(v=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(D)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(N&&m.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(j=/b/i.test(v)?"beta":"alpha",D=D.replace(RegExp(v+"\\+?$"),"")+("beta"==j?q:A)+(/\d+\+?/.exec(v)||"")),"Fennec"==H||"Firefox"==H&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(W))H="Firefox Mobile";else if("Maxthon"==H&&D)D=D.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(G))"Xbox 360"==G&&(W=null),"Xbox 360"==G&&/\bIEMobile\b/.test(t)&&L.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(H)&&(!H||G||/Browser|Mobi/.test(H))||"Windows CE"!=W&&!/Mobi/i.test(t))if("IE"==H&&N)try{null===a.external&&L.unshift("platform preview")}catch(t){L.unshift("embedded")}else(/\bBlackBerry\b/.test(G)||/\bBB10\b/.test(t))&&(v=(RegExp(G.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||D)?(W=((v=[v,/BB10/.test(t)])[1]?(G=null,Q="BlackBerry"):"Device Software")+" "+v[0],D=null):this!=forOwn&&"Wii"!=G&&(N&&O||/Opera/.test(H)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==H&&/\bOS X (?:\d+\.){2,}/.test(W)||"IE"==H&&(W&&!/^Win/.test(W)&&D>5.5||/\bWindows XP\b/.test(W)&&D>8||8==D&&!/\bTrident\b/.test(t)))&&!S.test(v=parse.call(forOwn,t.replace(S,"")+";"))&&v.name&&(v="ing as "+v.name+((v=v.version)?" "+v:""),S.test(H)?(/\bIE\b/.test(v)&&"Mac OS"==W&&(W=null),v="identify"+v):(v="mask"+v,H=U?format(U.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(v)&&(W=null),N||(D=null)),$=["Presto"],L.push(v));else H+=" Mobile";(v=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(v=[parseFloat(v.replace(/\.(\d)$/,".0$1")),v],"Safari"==H&&"+"==v[1].slice(-1)?(H="WebKit Nightly",j="alpha",D=v[1].slice(0,-1)):D!=v[1]&&D!=(v[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(D=null),v[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==v[0]&&537.36==v[2]&&parseFloat(v[1])>=28&&"WebKit"==$&&($=["Blink"]),N&&(M||v[1])?($&&($[1]="like Chrome"),v=v[1]||((v=v[0])<530?1:v<532?2:v<532.05?3:v<533?4:v<534.03?5:v<534.07?6:v<534.1?7:v<534.13?8:v<534.16?9:v<534.24?10:v<534.3?11:v<535.01?12:v<535.02?"13+":v<535.07?15:v<535.11?16:v<535.19?17:v<536.05?18:v<536.1?19:v<537.01?20:v<537.11?"21+":v<537.13?23:v<537.18?24:v<537.24?25:v<537.36?26:"Blink"!=$?"27":"28")):($&&($[1]="like Safari"),v=(v=v[0])<400?1:v<500?2:v<526?3:v<533?4:v<534?"4+":v<535?5:v<537?6:v<538?7:v<601?8:v<602?9:v<604?10:v<606?11:v<608?12:"12"),$&&($[1]+=" "+(v+="number"==typeof v?".x":/[.+]/.test(v)?"":"+")),"Safari"==H&&(!D||parseInt(D)>45)?D=v:"Chrome"==H&&/\bHeadlessChrome/i.test(t)&&L.unshift("headless")),"Opera"==H&&(v=/\bzbov|zvav$/.exec(W))?(H+=" ",L.unshift("desktop mode"),"zvav"==v?(H+="Mini",D=null):H+="Mobile",W=W.replace(RegExp(" *"+v+"$"),"")):"Safari"==H&&/\bChrome\b/.exec($&&$[1])?(L.unshift("desktop mode"),H="Chrome Mobile",D=null,/\bOS X\b/.test(W)?(Q="Apple",W="iOS 4.3+"):W=null):/\bSRWare Iron\b/.test(H)&&!D&&(D=getVersion("Chrome")),D&&0==D.indexOf(v=/[\d.]+$/.exec(W))&&t.indexOf("/"+v+"-")>-1&&(W=trim(W.replace(v,""))),W&&-1!=W.indexOf(H)&&!RegExp(H+" OS").test(W)&&(W=W.replace(RegExp(" *"+qualify(H)+" *"),"")),$&&!/\b(?:Avant|Nook)\b/.test(H)&&(/Browser|Lunascape|Maxthon/.test(H)||"Safari"!=H&&/^iOS/.test(W)&&/\bSafari\b/.test($[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(H)&&$[1])&&(v=$[$.length-1])&&L.push(v),L.length&&(L=["("+L.join("; ")+")"]),Q&&G&&G.indexOf(Q)<0&&L.push("on "+Q),G&&L.push((/^on /.test(L[L.length-1])?"":"on ")+G),W&&(v=/ ([\d.+]+)$/.exec(W),b=v&&"/"==W.charAt(W.length-v[0].length-1),W={architecture:32,family:v&&!b?W.replace(v[0],""):W,version:v?v[1]:null,toString:function(){var t=this.version;return this.family+(t&&!b?" "+t:"")+(64==this.architecture?" 64-bit":"")}}),(v=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(B))&&!/\bi686\b/i.test(B)?(W&&(W.architecture=64,W.family=W.family.replace(RegExp(" *"+v),"")),H&&(/\bWOW64\b/i.test(t)||N&&/\w(?:86|32)$/.test(m.cpuClass||m.platform)&&!/\bWin64; x64\b/i.test(t))&&L.unshift("32-bit")):W&&/^OS X/.test(W.family)&&"Chrome"==H&&parseFloat(D)>=39&&(W.architecture=64),t||(t=null);var V={};return V.description=t,V.layout=$&&$[0],V.manufacturer=Q,V.name=H,V.prerelease=j,V.product=G,V.ua=t,V.version=H&&D,V.os=W||{architecture:null,family:null,version:null,toString:function(){return"null"}},V.parse=parse,V.toString=function toStringPlatform(){return this.description||""},V.version&&L.unshift(D),V.name&&L.unshift(H),W&&H&&(W!=String(W).split(" ")[0]||W!=H.split(" ")[0]&&!G)&&L.push(G?"("+W+")":"on "+W),L.length&&(V.description=L.join(" ")),V}();m&&h?forOwn(w,(function(t,a){m[a]=t})):c.platform=w}).call(t)})),kS=createCommonjsModule((function(t,a){self,t.exports=function(){var t={d:function(a,o){for(var c in o)t.o(o,c)&&!t.o(a,c)&&Object.defineProperty(a,c,{enumerable:!0,get:o[c]})},o:function(t,a){return Object.prototype.hasOwnProperty.call(t,a)}},a={};t.d(a,{default:function(){return T}});var o=function e(t){for(var a in function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=2,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.onError=function(t){},this.onProgress=function(t){},this.onComplete=function(t){},t)this[a]=t[a]};function n(t,a){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,a){if(t){if("string"==typeof t)return r(t,a);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?r(t,a):void 0}}(t))||a&&t&&"number"==typeof t.length){o&&(t=o);var c=0,i=function(){};return{s:i,n:function(){return c>=t.length?{done:!0}:{done:!1,value:t[c++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var m,h=!0,v=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return h=t.done,t},e:function(t){v=!0,m=t},f:function(){try{h||null==o.return||o.return()}finally{if(v)throw m}}}}function r(t,a){(null==a||a>t.length)&&(a=t.length);for(var o=0,c=new Array(a);o<a;o++)c[o]=t[o];return c}var c=window.localStorage;window.localStorage&&"function"==typeof window.localStorage.getItem&&"function"==typeof window.localStorage.setItem&&"function"==typeof window.localStorage.removeItem||(c={privateObj:{},setItem:function(t,a){c.privateObj[t]=a},getItem:function(t){return c.privateObj[t]},removeItem:function(t){delete c.privateObj[t]},getKeys:function(){return Object.keys(c.privateObj)}});var m={getFileKey:function(t){var a=t.size.toString(),o=t.lastModified.toString();return t.name+a.slice(a.length-5)+o.slice(o.length-5)},getFileInfo:function(t){var a=c.getItem(t);if(!a)return null;try{return JSON.parse(a)}catch(t){return null}},initFile:function(t,a){m.clearExpiredInfo();var o=this.getFileKey(a),h={ctx:void 0!==t.ctx?t.ctx:"",bucket:t.bucketName,obj:t.objectName,token:t.token,modifyAt:Date.now(),end:!1};return t.payload&&(h.payload=t.payload),c.setItem(o,JSON.stringify(h)),o},setUploadContext:function(t,a){var o=this.getFileInfo(t);o&&(o.ctx=a,c.setItem(t,JSON.stringify(o)))},setComplete:function(t){var a=this.getFileInfo(t);a&&(a.modifyAt=Date.now(),a.end=!0,c.setItem(t,JSON.stringify(a)))},getUploadContext:function(t){var a=this.getFileInfo(t);return a?a.ctx:""},removeFileInfo:function(t){c.removeItem(t)},clearExpiredInfo:function(){var t,a="function"==typeof c.getKeys?c.getKeys():Object.keys(c),o=Date.now(),h=[],v=n(a);try{for(v.s();!(t=v.n()).done;){var b=t.value,S=m.getFileInfo(b);null===S||o-S.modifyAt>T.expireTime?c.removeItem(b):h.push({fileInfo:S,key:b})}}catch(t){v.e(t)}finally{v.f()}if(h.length>T.maxFileCache){var M,C=n(h.sort((function(t,a){return a.fileInfo.modifyAt-t.fileInfo.modifyAt})).slice(T.maxFileCache));try{for(C.s();!(M=C.n()).done;){var w=M.value;c.removeItem(w.key)}}catch(t){C.e(t)}finally{C.f()}}}},h=m;function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t,a){return!a||"object"!==u(a)&&"function"!=typeof a?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):a}function l(t){var a="function"==typeof Map?new Map:void 0;return(l=function(t){if(null===t||(o=t,-1===Function.toString.call(o).indexOf("[native code]")))return t;var o;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==a){if(a.has(t))return a.get(t);a.set(t,n)}function n(){return s(t,arguments,y(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),d(n,t)})(t)}function s(t,a,o){return(s=p()?Reflect.construct:function(t,a,o){var c=[null];c.push.apply(c,a);var m=new(Function.bind.apply(t,c));return o&&d(m,o.prototype),m}).apply(null,arguments)}function p(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function d(t,a){return(d=Object.setPrototypeOf||function(t,a){return t.__proto__=a,t})(t,a)}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var v=function(t){!function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(a&&a.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),a&&d(t,a)}(r,t);var a,o,c=(a=r,o=p(),function(){var t,c=y(a);if(o){var m=y(this).constructor;t=Reflect.construct(c,arguments,m)}else t=c.apply(this,arguments);return f(this,t)});function r(t,a){var o;return function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,r),(o=c.call(this,"NosUploadError:"+t)).errCode=a,o.errMsg=t,o}return r}(l(Error)),b=function e(t,a,o){if("uploading"===t.uploadState){var c=t.config,m=t.param,b=h.getUploadContext(t.fileKey);if(!b)return o(0);var S=new XMLHttpRequest,M=c.directUploadAddr+"/".concat(m.bucketName)+"/".concat(encodeURIComponent(m.objectName))+"?uploadContext"+"&context=".concat(b)+"&version=".concat(c.version);S.onreadystatechange=function(){if("abort"!==t.uploadState&&4===S.readyState){var m;try{m=JSON.parse(S.responseText)}catch(t){m={errMsg:"JsonParseError in getOffset",errCode:500}}200===S.status?m.errCode?t.config.onError(new v(m.errMsg,m.errCode)):o(m.offset):S.status.toString().match(/^5/)?e(t,a-1,o):(h.removeFileInfo(t.fileKey),S.status?c.onError(new v("getOffset(".concat(M,") error: ").concat(S.status," ").concat(S.statusText))):c.onError(new v("getOffset(".concat(M,") error. no Error Code"))))}},S.open("get",M),S.setRequestHeader("x-nos-token",m.token),S.timeout=c.getOffsetTimeout,S.send()}},S=function e(t,a,o,c){if("uploading"===t.uploadState){var m=t.param,b=t.config,S=File.prototype.slice,M=void 0!==m.ctx?m.ctx:"",C=a+b.trunkSize>t.file.size,T=C?t.file.size:a+b.trunkSize,w=new XMLHttpRequest,I=b.directUploadAddr+"/".concat(m.bucketName)+"/".concat(encodeURIComponent(m.objectName));if(w.upload.onprogress=function(o){var c=0;o.lengthComputable?(c=(a+o.loaded)/t.file.size,b.onProgress(c)):b.onError(new v("browser does not support query upload progress"))},w.onreadystatechange=function(){if("abort"!==t.uploadState&&4===w.readyState){var m;try{m=JSON.parse(w.responseText)}catch(t){console.error("JsonParseError in uploadTrunk",t),m={errMsg:"JsonParseError in uploadTrunk"}}200===w.status?(t.setContext(m.context),C?(c(),t.setComplete()):e(t,m.offset,b.retryCount,c)):w.status.toString().match(/^5/)?o>0?e(t,a,o-1,c):(h.removeFileInfo(t.fileKey),b.onError(new v(m.errMsg,m.errCode))):w.status?(h.removeFileInfo(t.fileKey),b.onError(new v("uploadTrunk(".concat(I,") error: ").concat(w.status," ").concat(w.statusText)))):(console.log("upload is paused",w),b.onError(new v("uploadTrunk(".concat(I,") error. no Error Code"))))}},w.open("post",I+"?offset=".concat(a)+"&complete=".concat(C)+"&context=".concat(M)+"&version=".concat(b.version)),w.setRequestHeader("x-nos-token",m.token),t.file.type&&w.setRequestHeader("content-type",t.file.type),w.timeout=b.trunkUploadTimeout,"undefined"!=typeof FileReader){var k=new FileReader;k.addEventListener("load",(function(t){var a;(null===(a=null==t?void 0:t.target)||void 0===a?void 0:a.result)?w.send(t.target.result):b.onError(new v("Read ArrayBuffer failed"))})),k.addEventListener("error",(function(t){var a=t.target.error;b.onError(new v("Read ArrayBuffer error. ".concat(a.toString()),a.code))})),k.readAsArrayBuffer(S.call(t.file,a,T))}else w.send(S.call(t.file,a,T))}};function g(t,a){for(var o=0;o<a.length;o++){var c=a[o];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}var M=function(){function e(t,a,o){!function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this.uploadState="paused",this.config=o,this.file=t,this.param=a,this.fileKey=h.initFile(a,t),this.resume()}var t;return(t=[{key:"resume",value:function(){var t=this;if("uploading"!==this.uploadState){this.setUploadState("uploading");var a=this.config;b(this,a.retryCount,(function(o){S(t,o,a.retryCount,(function(){t.setUploadState("ended"),"function"==typeof a.onComplete&&a.onComplete(t.param)}))}))}}},{key:"pause",value:function(){this.setUploadState("paused")}},{key:"abort",value:function(){this.setUploadState("abort"),h.removeFileInfo(this.fileKey)}},{key:"setUploadState",value:function(t){t!==this.uploadState&&(this.uploadState=t)}},{key:"setContext",value:function(t){h.setUploadContext(this.fileKey,t),this.param.ctx=t}},{key:"setComplete",value:function(){h.setComplete(this.fileKey),this.setUploadState("ended")}}])&&g(e.prototype,t),e}(),C={maxFileCache:6,expireTime:864e5,getFileUploadInformation:function(t){var a=h.getFileKey(t),o=h.getFileInfo(a);return null===o?null:Date.now()-o.modifyAt>C.expireTime?(h.removeFileInfo(a),null):{uploadInfo:Object.assign({bucketName:o.bucket,objectName:o.obj,token:o.token,ctx:o.ctx},o.payload?{payload:o.payload}:{}),complete:o.end}},setMaxFileCache:function(t){C.maxFileCache=t},setExpireTime:function(t){C.expireTime=t},printCaches:function(){for(var t=0,a=Object.keys(localStorage);t<a.length;t++){var o=a[t],c=h.getFileInfo(o);c&&console.log(c,"modifiedAt",new Date(c.modifyAt).toTimeString())}},createConfig:function(t){return new o(t)},createTask:function(t,a,o){return new M(t,a,o)}},T=C;return a.default}()})),xS=createCommonjsModule((function(t,a){t.exports=function(){const t=5e3;function object2String(t){if(t){let a="";return Object.entries(t).forEach((([t,o],c)=>{a+=0===c?"?":"&",a+=`${t}=${o}`})),a}return""}function timeoutPromise(a,o){return new Promise(((c,m)=>{setTimeout((()=>{m({message:"request timeout",params:o})}),a||t)}))}function request(a,o={dataType:"json",method:"GET",timeout:t}){const c="text"===o.dataType?"text/plain; charset=UTF-8":"application/json; charset=UTF-8";let m="GET"===o.method?object2String(o.params):"";return Promise.race([timeoutPromise(o.timeout,{url:a,params:o}),new Promise((function(t,h){if(window.fetch&&"function"==typeof window.fetch)try{let v={method:o.method,headers:Object.assign({"Content-Type":c},o.headers)};"POST"===o.method&&(v.body=JSON.stringify(o.params)),fetch(`${a}${m}`,v).then((a=>{"text"!==o.dataType?a.json().then((o=>{a.data=o,t(a)}),h):a.text().then((o=>{a.data=o,t(a)}),h)}),h)}catch(t){h(t)}else if(window.XMLHttpRequest){const v=new XMLHttpRequest;let b;if(v.onreadystatechange=function(){if(4===v.readyState)if(200===v.status){try{b=JSON.parse(v.response||"{}")}catch(t){b=v.response}t({status:v.status,data:b})}else h(v.status)},v.open(o.method,`${a}${m}`),v.setRequestHeader("Content-Type",c),o.headers)for(let t in o.headers)v.setRequestHeader(t,o.headers[t]);v.send(JSON.stringify(o.params))}else h("request no suppout")}))])}return request}()})),RS=console;var ES={setLogger:function setLogger(t){RS=t},platform:"BROWSER",localStorage:window.localStorage,request:xS,WebSocket:window.WebSocket,uploadFile:function uploadFile$4(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){var a,o,c,m,h,v;return ci.wrap((function _callee$(b){for(;;)switch(b.prev=b.next){case 0:if(t.fileInput||t.file){b.next=2;break}throw new Error("File not exist");case 2:if(!t.file){b.next=6;break}m=t.file,b.next=20;break;case 6:if("string"!=typeof t.fileInput){b.next=15;break}if(!((h=document.getElementById(t.fileInput))&&h.files&&h.files[0])){b.next=12;break}m=h.files[0],b.next=13;break;case 12:throw new Error("Can not get file from fileInput");case 13:b.next=20;break;case 15:if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0])){b.next=19;break}m=t.fileInput.files[0],b.next=20;break;case 19:throw new Error("Can not get file from fileInput "+t.fileInput);case 20:if(!(t.maxSize&&m.size>t.maxSize)){b.next=22;break}throw new Error("The file exceeds maxSize limit. maxSize: "+t.maxSize+", get "+m.size);case 22:return b.next=24,new zo((function(a,o){var c=kS.createConfig({directUploadAddr:t.chunkUploadHost,onError:function onError(t){o(t)},onProgress:t.onUploadProgress||function(){},onComplete:function onComplete(t){a(t)}}),h=kS.createTask(m,{bucketName:t.nosToken.bucket,objectName:decodeURIComponent(t.nosToken.objectName),token:t.nosToken.token},c);try{t.onUploadStart&&t.onUploadStart(h)}catch(t){RS.error("Adapter uploadFile: options.onUploadStart error",t&&t.message),h.abort(),o(t)}}));case 24:return(v=b.sent).name=m.name,v.size=m.size,v.type=m.type,v.ext=lastIndexOf(a=v.name).call(a,".")>-1?slice(o=v.name).call(o,lastIndexOf(c=v.name).call(c,".")+1).toLowerCase():"",b.abrupt("return",v);case 30:case"end":return b.stop()}}),_callee)})))},getSystemInfo:function getSystemInfo$4(){var t,a;return{os:(null===(t=IS.os)||void 0===t?void 0:t.family)||"",osVer:(null===(a=IS.os)||void 0===a?void 0:a.version)||"",browser:IS.name||"",browserVer:IS.version||"",hostEnv:"BROWSER",hostEnvVer:IS.version||"",hostInfo:IS.ua||""}}},AS=console,qS={clear:function clear(){try{my.clearStorageSync()}catch(t){AS.error("ali-app::ws: clearStorage ",t)}},getItem:function getItem(t){return my.getStorageSync({key:t}).data},setItem:function setItem(t,a){return my.setStorageSync({key:t,data:a})},removeItem:function removeItem(t){return my.removeStorageSync({key:t})}},PS=/*#__PURE__*/function(){function WebSocket(t,a){var o=this;if(void 0===a&&(a=""),this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.onclose=function(t){AS.log("my-app: sockets on close ",t)},this.onerror=function(t){AS.error("my-app: sockets error ",t)},this.onmessage=function(t){},this.onopen=function(t){},!t)throw new Error("Failed to construct 'socket': url required");this.url=t.replace(/:443(\/|$)/,"$1"),this.protocol=a,this.readyState=this.CONNECTING,this.socketTask=my.connectSocket({url:this.url,multiple:!0,fail:function fail(t){o.errorHandler(t)},success:function success(){o.readyState=o.OPEN}}),this.socketTask.onOpen((function(t){o.readyState=o.OPEN,o.onmessage&&o.onmessage({type:"open",header:t})})),this.socketTask.onError((function(t){o.errorHandler(t)})),this.socketTask.onClose((function(t){o.readyState=o.CLOSED;var a=t.code,c=t.reason,m=t.wasClean;"function"==typeof o.onclose&&o.onclose&&o.onclose({code:a,reason:c,wasClean:m,type:"close"}),o.socketTask=null})),this.socketTask.onMessage((function(t){var a="object"==typeof t.data&&null!==t.data?t.data.data:t.data;o.onmessage&&o.onmessage({data:a})}))}var t=WebSocket.prototype;return t.close=function close(){var t=this;this.socketTask&&this.socketTask.close({code:1e3,reason:"user force close websocket",complete:function complete(){t.socketTask=null}})},t.send=function send(t){if(this.readyState!==this.OPEN)throw new Error("my-app: socket sendMsg when readyState="+this.readyState);if(!("string"==typeof t||t instanceof ArrayBuffer))throw new TypeError("my-app: socket sendMsg only String/ArrayBuffer supported");this.socketTask&&this.socketTask.send({data:t,isBuffer:t instanceof ArrayBuffer})},t.errorHandler=function errorHandler(t){AS.error("my-app::ws: onerror ",t),this.readyState=this.CLOSED,this.onerror&&this.onerror({type:"error",message:t&&t.errMsg})},WebSocket}();var OS={setLogger:function setLogger(t){AS=t},platform:"ALIAPP",localStorage:qS,request:function request$3(t,a){return new zo((function(o,c){my.request(fi(fi({url:t},a),{success:function success(t){t={data:t.data,status:t.status,errMsg:t.errMsg,header:t.header},o(t)},fail:function fail(t){c(t)}}))}))},WebSocket:PS,uploadFile:function uploadFile$3(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){return ci.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,new zo((function(a,o){var c=my.uploadFile({url:t.commonUploadHost?t.commonUploadHost+"/"+t.nosToken.bucket:"https://nos.netease.com/nim",formData:{Object:decodeURIComponent(t.nosToken.objectName),"x-nos-token":t.nosToken.token,"x-nos-entity-type":"json"},fileType:t.type,fileName:"file",filePath:t.filePath,success:function success(c){if(200==c.statusCode)try{var m,h,v,b=JSON.parse(c.data);b.name=t.filePath,b.ext=lastIndexOf(m=b.name).call(m,".")>-1?slice(h=b.name).call(h,lastIndexOf(v=b.name).call(v,".")+1).toLowerCase():"",a(b)}catch(t){o(new Error("Upload Error parse result error: "+c.data))}else o(new Error("Upload error "+c.statusCode+": "+c.errMsg))},fail:function fail(t){o(t)}});try{t.onUploadStart&&t.onUploadStart(c)}catch(t){AS.error("uploadFile: options.onUploadStart error",t),c.abort(),o(t)}t.onUploadProgress&&c.onProgressUpdate((function(a){t.onUploadProgress&&t.onUploadProgress({total:a.totalBytesExpectedToWrite,loaded:a.totalBytesWritten,percentage:a.progress,percentageText:a.progress+"%"})}))}));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee)})))},getSystemInfo:function getSystemInfo$3(){var t=my.getSystemInfoSync()||{};return{os:t.platform||"",osVer:t.system||"",browser:"",browserVer:"",hostEnv:"ALIAPP",hostEnvVer:t.version,hostInfo:"",pushDeviceInfo:{PRODUCT:t.model,DEVICE:t.model,MANUFACTURER:t.brand}}}},US=console,BS={clear:function clear(){try{wx.clearStorageSync()}catch(t){US.error("wx-app::ws: clearStorage ",t)}},getItem:function getItem(t){return wx.getStorageSync(t)},setItem:function setItem(t,a){return wx.setStorageSync(t,a)},removeItem:function removeItem(t){return wx.removeStorageSync(t)}},FS=/*#__PURE__*/function(){function WebSocket(t,a){var o=this;if(void 0===a&&(a=""),this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.onclose=function(t){US.log("wx-app: sockets on close ",t)},this.onerror=function(t){US.error("wx-app: sockets error ",t)},this.onmessage=function(t){},this.onopen=function(t){},!t)throw new Error("Failed to construct 'socket': url required");this.url=t.replace(/:443(\/|$)/,"$1"),this.protocol=a,this.readyState=this.CONNECTING;var c=this.protocol?{protocols:[this.protocol]}:{};this.socketTask=wx.connectSocket(fi(fi({url:this.url},c),{fail:function fail(t){o.errorHandler(t)},success:function success(){}})),this.socketTask.onOpen((function(t){o.readyState=o.OPEN,o.onmessage&&o.onmessage({type:"open",header:t})})),this.socketTask.onError((function(t){o.errorHandler(t)})),this.socketTask.onClose((function(t){o.readyState=o.CLOSED;var a=t.code,c=t.reason,m=t.wasClean;"function"==typeof o.onclose&&o.onclose&&o.onclose({code:a,reason:c,wasClean:m,type:"close"})})),this.socketTask.onMessage((function(t){o.onmessage&&o.onmessage(t)}))}var t=WebSocket.prototype;return t.close=function close(){var t=this;this.socketTask.close({code:1e3,reason:"user force close websocket",complete:function complete(){t.socketTask=null}})},t.send=function send(t){if(this.readyState!==this.OPEN)throw new Error("wx-app: socket sendMsg when readyState="+this.readyState);if(!("string"==typeof t||t instanceof ArrayBuffer))throw new TypeError("wx-app: socket sendMsg only String/ArrayBuffer supported");this.socketTask.send({data:t})},t.errorHandler=function errorHandler(t){US.error("wx-app::ws: onerror ",t),this.readyState=this.CLOSED,this.onerror&&this.onerror({type:"error",message:t&&t.errMsg})},WebSocket}();var LS={setLogger:function setLogger(t){US=t},platform:"WXAPP",localStorage:BS,request:function request$2(t,a){return a&&(a.header=a.headers),new zo((function(o,c){wx.request(fi(fi({url:t},a),{success:function success(t){t={data:t.data,status:t.statusCode,errMsg:t.errMsg,header:t.header},o(t)},fail:function fail(t){c(t)}}))}))},WebSocket:FS,uploadFile:function uploadFile$2(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){return ci.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,new zo((function(a,o){var c=wx.uploadFile({url:t.commonUploadHost?t.commonUploadHost+"/"+t.nosToken.bucket:"https://nos.netease.com/nim",formData:{Object:decodeURIComponent(t.nosToken.objectName),"x-nos-token":t.nosToken.token,"x-nos-entity-type":"json"},name:"file",filePath:t.filePath,success:function success(c){if(200==c.statusCode)try{var m,h,v,b=JSON.parse(c.data);b.name=t.filePath,b.ext=lastIndexOf(m=b.name).call(m,".")>-1?slice(h=b.name).call(h,lastIndexOf(v=b.name).call(v,".")+1).toLowerCase():"",a(b)}catch(t){o(new Error("Upload Error parse result error: "+c.data))}else o(new Error("Upload error "+c.statusCode+": "+c.errMsg))},fail:function fail(t){o(t)}});try{t.onUploadStart&&t.onUploadStart(c)}catch(t){US.error("uploadFile: options.onUploadStart error",t),c.abort(),o(t)}t.onUploadProgress&&c.onProgressUpdate((function(a){t.onUploadProgress&&t.onUploadProgress({total:a.totalBytesExpectedToSend,loaded:a.totalBytesSent,percentage:a.progress,percentageText:a.progress+"%"})}))}));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee)})))},getSystemInfo:function getSystemInfo$2(){var t=wx.getSystemInfoSync()||{};return{os:t.platform||"",osVer:t.system||"",browser:"",browserVer:"",hostEnv:"WXAPP",hostEnvVer:t.version,hostInfo:t.SDKVersion,pushDeviceInfo:{PRODUCT:t.model,DEVICE:t.model,MANUFACTURER:t.brand}}}},jS=console,NS={clear:function clear(){try{swan.clearStorageSync()}catch(t){jS.error("baidu-app::ws: clearStorage ",t)}},getItem:function getItem(t){return swan.getStorageSync(t)},setItem:function setItem(t,a){return swan.setStorageSync(t,a)},removeItem:function removeItem(t){return swan.removeStorageSync(t)}},DS=/*#__PURE__*/function(){function WebSocket(t,a){var o=this;if(void 0===a&&(a=""),this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.onclose=function(t){jS.log("baidu-app: sockets on close ",t)},this.onerror=function(t){jS.error("baidu-app: sockets error ",t)},this.onmessage=function(t){},this.onopen=function(t){},!t)throw new Error("Failed to construct 'socket': url required");this.url=t.replace(/:443(\/|$)/,"$1"),this.protocol=a,this.readyState=this.CONNECTING;var c=this.protocol?{protocols:[this.protocol]}:{};this.socketTask=swan.connectSocket(fi(fi({url:this.url},c),{fail:function fail(t){o.errorHandler(t)},success:function success(){}})),this.socketTask.onOpen((function(t){o.readyState=o.OPEN,o.onmessage&&o.onmessage({type:"open",header:t})})),this.socketTask.onError((function(t){o.errorHandler(t)})),this.socketTask.onClose((function(t){o.readyState=o.CLOSED;var a=t.code,c=t.reason,m=t.wasClean;"function"==typeof o.onclose&&o.onclose&&o.onclose({code:a,reason:c,wasClean:m,type:"close"})})),this.socketTask.onMessage((function(t){o.onmessage&&o.onmessage({data:t.data})}))}var t=WebSocket.prototype;return t.close=function close(){var t=this;this.socketTask.close({code:1e3,reason:"user force close websocket",complete:function complete(){t.socketTask=null}})},t.send=function send(t){if(this.readyState!==this.OPEN)throw new Error("wx-app: socket sendMsg when readyState="+this.readyState);if(!("string"==typeof t||t instanceof ArrayBuffer))throw new TypeError("wx-app: socket sendMsg only String/ArrayBuffer supported");this.socketTask.send({data:t})},t.errorHandler=function errorHandler(t){this.readyState=this.CLOSED,this.onerror&&this.onerror({type:"error",message:t&&t.errMsg})},WebSocket}();var $S={setLogger:function setLogger(t){jS=t},platform:"BAIDUAPP",localStorage:NS,request:function request$1(t,a){return a&&(a.header=a.headers),new zo((function(o,c){swan.request(fi(fi({url:t},a),{success:function success(t){t={data:t.data,status:t.statusCode,errMsg:t.errMsg,header:t.header},o(t)},fail:function fail(t){c(t)}}))}))},WebSocket:DS,uploadFile:function uploadFile$1(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){return ci.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,new zo((function(a,o){var c=swan.uploadFile({url:t.commonUploadHost?t.commonUploadHost+"/"+t.nosToken.bucket:"https://nos.netease.com/nim",formData:{Object:decodeURIComponent(t.nosToken.objectName),"x-nos-token":t.nosToken.token,"x-nos-entity-type":"json"},name:"file",filePath:t.filePath,success:function success(c){if(200==c.statusCode)try{var m,h,v,b=JSON.parse(c.data);b.name=t.filePath,b.ext=lastIndexOf(m=b.name).call(m,".")>-1?slice(h=b.name).call(h,lastIndexOf(v=b.name).call(v,".")+1).toLowerCase():"",a(b)}catch(t){o(new Error("Upload Error parse result error: "+c.data))}else o(new Error("Upload error "+c.statusCode+": "+c.errMsg))},fail:function fail(t){o(t)}});try{t.onUploadStart&&t.onUploadStart(c)}catch(t){jS.error("uploadFile: options.onUploadStart error",t),c.abort(),o(t)}t.onUploadProgress&&c.onProgressUpdate((function(a){t.onUploadProgress&&t.onUploadProgress({total:a.totalBytesExpectedToSend,loaded:a.totalBytesSent,percentage:a.progress,percentageText:a.progress+"%"})}))}));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee)})))},getSystemInfo:function getSystemInfo$1(){var t=swan.getSystemInfoSync()||{};return{os:t.platform||"",osVer:t.system||"",browser:"",browserVer:"",hostEnv:"BAIDUAPP",hostEnvVer:t.version,hostInfo:t.SDKVersion,pushDeviceInfo:{PRODUCT:t.model,DEVICE:t.model,MANUFACTURER:t.brand}}}},HS=console,GS={clear:function clear(){try{tt.clearStorageSync()}catch(t){HS.error("tt-app::ws: clearStorage ",t)}},getItem:function getItem(t){return tt.getStorageSync(t)},setItem:function setItem(t,a){return tt.setStorageSync(t,a)},removeItem:function removeItem(t){return tt.removeStorageSync(t)}},QS=/*#__PURE__*/function(){function WebSocket(t,a){var o=this;if(void 0===a&&(a=""),this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.onclose=function(t){HS.log("wx-app: sockets on close ",t)},this.onerror=function(t){HS.error("wx-app: sockets error ",t)},this.onmessage=function(t){},this.onopen=function(t){},!t)throw new Error("Failed to construct 'socket': url required");this.url=t.replace(/:443(\/|$)/,"$1"),this.protocol=a,this.readyState=this.CONNECTING;var c=this.protocol?{protocols:[this.protocol]}:{};this.socketTask=tt.connectSocket(fi(fi({url:this.url},c),{fail:function fail(t){o.errorHandler(t)},success:function success(){}})),this.socketTask.onOpen((function(t){o.readyState=o.OPEN,o.onmessage&&o.onmessage({type:"open",header:t.header})})),this.socketTask.onError((function(t){o.errorHandler(t)})),this.socketTask.onClose((function(t){o.readyState=o.CLOSED;var a=t.code,c=t.reason,m=t.wasClean;"function"==typeof o.onclose&&o.onclose&&o.onclose({code:a,reason:c,wasClean:m,type:"close"})})),this.socketTask.onMessage((function(t){o.onmessage&&o.onmessage({data:t.data})}))}var t=WebSocket.prototype;return t.close=function close(){this.socketTask&&this.socketTask.close({code:1e3,reason:"user force close websocket",complete:function complete(){}})},t.send=function send(t){if(this.readyState!==this.OPEN)throw new Error("tt-app: socket sendMsg when readyState="+this.readyState);if(!("string"==typeof t||t instanceof ArrayBuffer))throw new TypeError("tt-app: socket sendMsg only String/ArrayBuffer supported");this.socketTask&&this.socketTask.send({data:t})},t.errorHandler=function errorHandler(t){HS.error("tt-app::ws: onerror ",t),this.readyState=this.CLOSED,this.onerror&&this.onerror({type:"error",message:t&&t.errMsg})},WebSocket}();var WS={WX:LS,ALI:OS,BAIDU:$S,TT:{setLogger:function setLogger(t){HS=t},platform:"TTAPP",localStorage:GS,request:function request(t,a){return a&&(a.header=a.headers),new zo((function(o,c){tt.request(fi(fi({url:t},a),{success:function success(t){t={data:t.data,status:t.statusCode,errMsg:t.errMsg,header:t.header},o(t)},fail:function fail(t){c(t)}}))}))},WebSocket:QS,uploadFile:function uploadFile(t){return __awaiter(this,void 0,void 0,/*#__PURE__*/ci.mark((function _callee(){return ci.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,new zo((function(a,o){var c=tt.uploadFile({url:t.commonUploadHost?t.commonUploadHost+"/"+t.nosToken.bucket:"https://nos.netease.com/nim",formData:{Object:decodeURIComponent(t.nosToken.objectName),"x-nos-token":t.nosToken.token,"x-nos-entity-type":"json"},name:"file",filePath:t.filePath,success:function success(c){if(200==c.statusCode)try{var m,h,v,b=JSON.parse(c.data);b.name=t.filePath,b.ext=lastIndexOf(m=b.name).call(m,".")>-1?slice(h=b.name).call(h,lastIndexOf(v=b.name).call(v,".")+1).toLowerCase():"",a(b)}catch(t){o(new Error("Upload Error parse result error: "+c.data))}else o(new Error("Upload error "+c.statusCode+": "+c.errMsg))},fail:function fail(t){o(t)}});try{t.onUploadStart&&t.onUploadStart(c)}catch(t){HS.error("uploadFile: options.onUploadStart error",t),c.abort(),o(t)}t.onUploadProgress&&c.onProgressUpdate((function(a){t.onUploadProgress&&t.onUploadProgress({total:a.totalBytesExpectedToSend,loaded:a.totalBytesSent,percentage:a.progress,percentageText:a.progress+"%"})}))}));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee)})))},getSystemInfo:function getSystemInfo(){var t=tt.getSystemInfoSync()||{};return{os:t.platform||"",osVer:t.system||"",browser:"",browserVer:"",hostEnv:"TTAPP",hostEnvVer:t.version,hostInfo:t.SDKVersion,pushDeviceInfo:{PRODUCT:t.model,DEVICE:t.model,MANUFACTURER:t.brand}}}}}[getMiniappEnv()];hd.registerService(dp,"auth"),hd.registerService(hp,"sync"),hd.registerService(yp,"misc");var VS=hd;export{yv as Chatroom,Zf as EventService,Vf as FriendService,og as MsgExtendService,mg as MsgLogService,hm as MsgService,VS as NIM,vg as PassThroughService,Ng as PluginService,hS as QChat,Af as SessionService,Xy as SignalingService,Fg as SuperTeamService,Df as SystemMessageService,Pf as TeamService,ch as UserService,ES as browserAdapters,py as cloudStorageService,WS as miniAppAdapters,wS as uniAppAdapters};
