/**
 * 
 *   Version: 0.12.3
 * 
 *   Git Hash: 1e29863397d62295db762f58beb5f2b3b9fe846b
 * 
 *   Created At: 2023/3/9 下午6:30:10
 * 
 *   Target: QCHAT_BROWSER_SDK.js
 *   
 */

!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):(t="undefined"!=typeof globalThis?globalThis:t||self).QChat=a()}(this,(function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t){var a={exports:{}};return t(a,a.exports),a.exports}var a,o,c=getDefaultExportFromCjs(createCommonjsModule((function(t){t.exports=function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.__esModule=!0,t.exports.default=t.exports}))),check=function(t){return t&&t.Math==Math&&t},h=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof t&&t)||function(){return this}()||Function("return this")(),fails=function(t){try{return!!t()}catch(t){return!0}},m=!fails((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),v=Function.prototype,b=v.apply,C=v.call,S="object"==typeof Reflect&&Reflect.apply||(m?C.bind(b):function(){return C.apply(b,arguments)}),M=Function.prototype,w=M.bind,I=M.call,x=m&&w.bind(I,I),T=m?function(t){return t&&x(t)}:function(t){return t&&function(){return I.apply(t,arguments)}},isCallable=function(t){return"function"==typeof t},k=!fails((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),R=Function.prototype.call,q=m?R.bind(R):function(){return R.apply(R,arguments)},E={}.propertyIsEnumerable,P=Object.getOwnPropertyDescriptor,A={f:P&&!E.call({1:2},1)?function propertyIsEnumerable(t){var a=P(this,t);return!!a&&a.enumerable}:E},createPropertyDescriptor=function(t,a){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:a}},O=T({}.toString),U=T("".slice),classofRaw=function(t){return U(O(t),8,-1)},B=Object,j=T("".split),L=fails((function(){return!B("z").propertyIsEnumerable(0)}))?function(t){return"String"==classofRaw(t)?j(t,""):B(t)}:B,isNullOrUndefined=function(t){return null==t},N=TypeError,requireObjectCoercible=function(t){if(isNullOrUndefined(t))throw N("Can't call method on "+t);return t},toIndexedObject=function(t){return L(requireObjectCoercible(t))},G="object"==typeof document&&document.all,$=void 0===G&&void 0!==G?function(t){return"object"==typeof t?null!==t:isCallable(t)||t===G}:function(t){return"object"==typeof t?null!==t:isCallable(t)},D={},aFunction=function(t){return isCallable(t)?t:void 0},getBuiltIn=function(t,a){return arguments.length<2?aFunction(D[t])||aFunction(h[t]):D[t]&&D[t][a]||h[t]&&h[t][a]},Q=T({}.isPrototypeOf),W=getBuiltIn("navigator","userAgent")||"",V=h.process,K=h.Deno,z=V&&V.versions||K&&K.version,H=z&&z.v8;H&&(o=(a=H.split("."))[0]>0&&a[0]<4?1:+(a[0]+a[1])),!o&&W&&(!(a=W.match(/Edge\/(\d+)/))||a[1]>=74)&&(a=W.match(/Chrome\/(\d+)/))&&(o=+a[1]);var J,Y=o,X=!!Object.getOwnPropertySymbols&&!fails((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Y&&Y<41})),Z=X&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ee=Object,te=Z?function(t){return"symbol"==typeof t}:function(t){var a=getBuiltIn("Symbol");return isCallable(a)&&Q(a.prototype,ee(t))},re=String,tryToString=function(t){try{return re(t)}catch(t){return"Object"}},ne=TypeError,aCallable=function(t){if(isCallable(t))return t;throw ne(tryToString(t)+" is not a function")},getMethod=function(t,a){var o=t[a];return isNullOrUndefined(o)?void 0:aCallable(o)},ae=TypeError,oe=Object.defineProperty,ie="__core-js_shared__",se=h[ie]||function(t,a){try{oe(h,t,{value:a,configurable:!0,writable:!0})}catch(o){h[t]=a}return a}(ie,{}),ce=createCommonjsModule((function(t){(t.exports=function(t,a){return se[t]||(se[t]=void 0!==a?a:{})})("versions",[]).push({version:"3.25.0",mode:"pure",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),le=Object,toObject=function(t){return le(requireObjectCoercible(t))},ue=T({}.hasOwnProperty),de=Object.hasOwn||function hasOwn(t,a){return ue(toObject(t),a)},pe=0,he=Math.random(),fe=T(1..toString),uid=function(t){return"Symbol("+(void 0===t?"":t)+")_"+fe(++pe+he,36)},me=ce("wks"),ve=h.Symbol,ge=ve&&ve.for,ye=Z?ve:ve&&ve.withoutSetter||uid,wellKnownSymbol=function(t){if(!de(me,t)||!X&&"string"!=typeof me[t]){var a="Symbol."+t;X&&de(ve,t)?me[t]=ve[t]:me[t]=Z&&ge?ge(a):ye(a)}return me[t]},be=TypeError,Ce=wellKnownSymbol("toPrimitive"),toPrimitive=function(t,a){if(!$(t)||te(t))return t;var o,c=getMethod(t,Ce);if(c){if(void 0===a&&(a="default"),o=q(c,t,a),!$(o)||te(o))return o;throw be("Can't convert object to primitive value")}return void 0===a&&(a="number"),function(t,a){var o,c;if("string"===a&&isCallable(o=t.toString)&&!$(c=q(o,t)))return c;if(isCallable(o=t.valueOf)&&!$(c=q(o,t)))return c;if("string"!==a&&isCallable(o=t.toString)&&!$(c=q(o,t)))return c;throw ae("Can't convert object to primitive value")}(t,a)},toPropertyKey=function(t){var a=toPrimitive(t,"string");return te(a)?a:a+""},Se=h.document,Me=$(Se)&&$(Se.createElement),documentCreateElement=function(t){return Me?Se.createElement(t):{}},_e=!k&&!fails((function(){return 7!=Object.defineProperty(documentCreateElement("div"),"a",{get:function(){return 7}}).a})),we=Object.getOwnPropertyDescriptor,Ie={f:k?we:function getOwnPropertyDescriptor(t,a){if(t=toIndexedObject(t),a=toPropertyKey(a),_e)try{return we(t,a)}catch(t){}if(de(t,a))return createPropertyDescriptor(!q(A.f,t,a),t[a])}},xe=/#|\.prototype\./,isForced=function(t,a){var o=ke[Te(t)];return o==qe||o!=Re&&(isCallable(a)?fails(a):!!a)},Te=isForced.normalize=function(t){return String(t).replace(xe,".").toLowerCase()},ke=isForced.data={},Re=isForced.NATIVE="N",qe=isForced.POLYFILL="P",Ee=isForced,Pe=T(T.bind),functionBindContext=function(t,a){return aCallable(t),void 0===a?t:m?Pe(t,a):function(){return t.apply(a,arguments)}},Ae=k&&fails((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Oe=String,Ue=TypeError,anObject=function(t){if($(t))return t;throw Ue(Oe(t)+" is not an object")},Be=TypeError,je=Object.defineProperty,Le=Object.getOwnPropertyDescriptor,Ne="enumerable",Fe="configurable",Ge="writable",$e={f:k?Ae?function defineProperty(t,a,o){if(anObject(t),a=toPropertyKey(a),anObject(o),"function"==typeof t&&"prototype"===a&&"value"in o&&Ge in o&&!o.writable){var c=Le(t,a);c&&c.writable&&(t[a]=o.value,o={configurable:Fe in o?o.configurable:c.configurable,enumerable:Ne in o?o.enumerable:c.enumerable,writable:!1})}return je(t,a,o)}:je:function defineProperty(t,a,o){if(anObject(t),a=toPropertyKey(a),anObject(o),_e)try{return je(t,a,o)}catch(t){}if("get"in o||"set"in o)throw Be("Accessors not supported");return"value"in o&&(t[a]=o.value),t}},De=k?function(t,a,o){return $e.f(t,a,createPropertyDescriptor(1,o))}:function(t,a,o){return t[a]=o,t},Qe=Ie.f,wrapConstructor=function(t){var Wrapper=function(a,o,c){if(this instanceof Wrapper){switch(arguments.length){case 0:return new t;case 1:return new t(a);case 2:return new t(a,o)}return new t(a,o,c)}return S(t,this,arguments)};return Wrapper.prototype=t.prototype,Wrapper},_export=function(t,a){var o,c,m,v,b,C,S,M,w=t.target,I=t.global,x=t.stat,k=t.proto,R=I?h:x?h[w]:(h[w]||{}).prototype,q=I?D:D[w]||De(D,w,{})[w],E=q.prototype;for(m in a)o=!Ee(I?m:w+(x?".":"#")+m,t.forced)&&R&&de(R,m),b=q[m],o&&(C=t.dontCallGetSet?(M=Qe(R,m))&&M.value:R[m]),v=o&&C?C:a[m],o&&typeof b==typeof v||(S=t.bind&&o?functionBindContext(v,h):t.wrap&&o?wrapConstructor(v):k&&isCallable(v)?T(v):v,(t.sham||v&&v.sham||b&&b.sham)&&De(S,"sham",!0),De(q,m,S),k&&(de(D,c=w+"Prototype")||De(D,c,{}),De(D[c],m,v),t.real&&E&&!E[m]&&De(E,m,v)))},We=Math.ceil,Ve=Math.floor,Ke=Math.trunc||function trunc(t){var a=+t;return(a>0?Ve:We)(a)},toIntegerOrInfinity=function(t){var a=+t;return a!=a||0===a?0:Ke(a)},ze=Math.max,He=Math.min,toAbsoluteIndex=function(t,a){var o=toIntegerOrInfinity(t);return o<0?ze(o+a,0):He(o,a)},Je=Math.min,lengthOfArrayLike=function(t){return(a=t.length)>0?Je(toIntegerOrInfinity(a),9007199254740991):0;var a},createMethod$4=function(t){return function(a,o,c){var h,m=toIndexedObject(a),v=lengthOfArrayLike(m),b=toAbsoluteIndex(c,v);if(t&&o!=o){for(;v>b;)if((h=m[b++])!=h)return!0}else for(;v>b;b++)if((t||b in m)&&m[b]===o)return t||b||0;return!t&&-1}},Ye={includes:createMethod$4(!0),indexOf:createMethod$4(!1)},Xe={},Ze=Ye.indexOf,et=T([].push),objectKeysInternal=function(t,a){var o,c=toIndexedObject(t),h=0,m=[];for(o in c)!de(Xe,o)&&de(c,o)&&et(m,o);for(;a.length>h;)de(c,o=a[h++])&&(~Ze(m,o)||et(m,o));return m},tt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],rt=Object.keys||function keys(t){return objectKeysInternal(t,tt)},nt=k&&!Ae?Object.defineProperties:function defineProperties(t,a){anObject(t);for(var o,c=toIndexedObject(a),h=rt(a),m=h.length,v=0;m>v;)$e.f(t,o=h[v++],c[o]);return t},at={f:nt},ot=getBuiltIn("document","documentElement"),it=ce("keys"),sharedKey=function(t){return it[t]||(it[t]=uid(t))},st=sharedKey("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(t){return"<script>"+t+"</"+"script>"},NullProtoObjectViaActiveX=function(t){t.write(scriptTag("")),t.close();var a=t.parentWindow.Object;return t=null,a},NullProtoObject=function(){try{J=new ActiveXObject("htmlfile")}catch(t){}var t,a;NullProtoObject="undefined"!=typeof document?document.domain&&J?NullProtoObjectViaActiveX(J):((a=documentCreateElement("iframe")).style.display="none",ot.appendChild(a),a.src=String("javascript:"),(t=a.contentWindow.document).open(),t.write(scriptTag("document.F=Object")),t.close(),t.F):NullProtoObjectViaActiveX(J);for(var o=tt.length;o--;)delete NullProtoObject.prototype[tt[o]];return NullProtoObject()};Xe[st]=!0;var ct=Object.create||function create(t,a){var o;return null!==t?(EmptyConstructor.prototype=anObject(t),o=new EmptyConstructor,EmptyConstructor.prototype=null,o[st]=t):o=NullProtoObject(),void 0===a?o:at.f(o,a)};_export({target:"Object",stat:!0,sham:!k},{create:ct});var lt=D.Object,ut=function create(t,a){return lt.create(t,a)},dt=String,pt=TypeError,ht=Object.setPrototypeOf||("__proto__"in{}?function(){var t,a=!1,o={};try{(t=T(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(o,[]),a=o instanceof Array}catch(t){}return function setPrototypeOf(o,c){return anObject(o),function(t){if("object"==typeof t||isCallable(t))return t;throw pt("Can't set "+dt(t)+" as a prototype")}(c),a?t(o,c):o.__proto__=c,o}}():void 0);_export({target:"Object",stat:!0},{setPrototypeOf:ht});var ft=D.Object.setPrototypeOf,mt=T([].slice),vt=Function,gt=T([].concat),yt=T([].join),bt={},construct$8=function(t,a,o){if(!de(bt,a)){for(var c=[],h=0;h<a;h++)c[h]="a["+h+"]";bt[a]=vt("C,a","return new C("+yt(c,",")+")")}return bt[a](t,o)},Ct=m?vt.bind:function bind(t){var a=aCallable(this),o=a.prototype,c=mt(arguments,1),h=function bound(){var o=gt(c,mt(arguments));return this instanceof h?construct$8(a,o.length,o):a.apply(t,o)};return $(o)&&(h.prototype=o),h};_export({target:"Function",proto:!0,forced:Function.bind!==Ct},{bind:Ct});var entryVirtual=function(t){return D[t+"Prototype"]},St=entryVirtual("Function").bind,Mt=Function.prototype,bind$1=function(t){var a=t.bind;return t===Mt||Q(Mt,t)&&a===Mt.bind?St:a},_t=createCommonjsModule((function(t){function _setPrototypeOf(a,o){var c;return t.exports=_setPrototypeOf=ft?bind$1(c=ft).call(c):function _setPrototypeOf(t,a){return t.__proto__=a,t},t.exports.__esModule=!0,t.exports.default=t.exports,_setPrototypeOf(a,o)}t.exports=_setPrototypeOf,t.exports.__esModule=!0,t.exports.default=t.exports})),wt=getDefaultExportFromCjs(createCommonjsModule((function(t){t.exports=function _inheritsLoose(t,a){t.prototype=ut(a.prototype),t.prototype.constructor=t,_t(t,a)},t.exports.__esModule=!0,t.exports.default=t.exports}))),It=Array.isArray||function isArray(t){return"Array"==classofRaw(t)},xt=TypeError,doesNotExceedSafeInteger=function(t){if(t>9007199254740991)throw xt("Maximum allowed index exceeded");return t},createProperty=function(t,a,o){var c=toPropertyKey(a);c in t?$e.f(t,c,createPropertyDescriptor(0,o)):t[c]=o},Tt={};Tt[wellKnownSymbol("toStringTag")]="z";var kt="[object z]"===String(Tt),Rt=wellKnownSymbol("toStringTag"),qt=Object,Et="Arguments"==classofRaw(function(){return arguments}()),Pt=kt?classofRaw:function(t){var a,o,c;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(o=function(t,a){try{return t[a]}catch(t){}}(a=qt(t),Rt))?o:Et?classofRaw(a):"Object"==(c=classofRaw(a))&&isCallable(a.callee)?"Arguments":c},At=T(Function.toString);isCallable(se.inspectSource)||(se.inspectSource=function(t){return At(t)});var Ot=se.inspectSource,noop$1=function(){},Ut=[],Bt=getBuiltIn("Reflect","construct"),jt=/^\s*(?:class|function)\b/,Lt=T(jt.exec),Nt=!jt.exec(noop$1),Ft=function isConstructor(t){if(!isCallable(t))return!1;try{return Bt(noop$1,Ut,t),!0}catch(t){return!1}},Gt=function isConstructor(t){if(!isCallable(t))return!1;switch(Pt(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Nt||!!Lt(jt,Ot(t))}catch(t){return!0}};Gt.sham=!0;var $t=!Bt||fails((function(){var t;return Ft(Ft.call)||!Ft(Object)||!Ft((function(){t=!0}))||t}))?Gt:Ft,Dt=wellKnownSymbol("species"),Qt=Array,arraySpeciesCreate=function(t,a){return new(function(t){var a;return It(t)&&(a=t.constructor,($t(a)&&(a===Qt||It(a.prototype))||$(a)&&null===(a=a[Dt]))&&(a=void 0)),void 0===a?Qt:a}(t))(0===a?0:a)},Wt=wellKnownSymbol("species"),arrayMethodHasSpeciesSupport=function(t){return Y>=51||!fails((function(){var a=[];return(a.constructor={})[Wt]=function(){return{foo:1}},1!==a[t](Boolean).foo}))},Vt=wellKnownSymbol("isConcatSpreadable"),Kt=Y>=51||!fails((function(){var t=[];return t[Vt]=!1,t.concat()[0]!==t})),zt=arrayMethodHasSpeciesSupport("concat"),isConcatSpreadable=function(t){if(!$(t))return!1;var a=t[Vt];return void 0!==a?!!a:It(t)};_export({target:"Array",proto:!0,arity:1,forced:!Kt||!zt},{concat:function concat(t){var a,o,c,h,m,v=toObject(this),b=arraySpeciesCreate(v,0),C=0;for(a=-1,c=arguments.length;a<c;a++)if(isConcatSpreadable(m=-1===a?v:arguments[a]))for(h=lengthOfArrayLike(m),doesNotExceedSafeInteger(C+h),o=0;o<h;o++,C++)o in m&&createProperty(b,C,m[o]);else doesNotExceedSafeInteger(C+1),createProperty(b,C++,m);return b.length=C,b}});var Ht,Jt,Yt,Xt=String,toString$1=function(t){if("Symbol"===Pt(t))throw TypeError("Cannot convert a Symbol value to a string");return Xt(t)},Zt=tt.concat("length","prototype"),er={f:Object.getOwnPropertyNames||function getOwnPropertyNames(t){return objectKeysInternal(t,Zt)}},tr=Array,rr=Math.max,arraySliceSimple=function(t,a,o){for(var c=lengthOfArrayLike(t),h=toAbsoluteIndex(a,c),m=toAbsoluteIndex(void 0===o?c:o,c),v=tr(rr(m-h,0)),b=0;h<m;h++,b++)createProperty(v,b,t[h]);return v.length=b,v},nr=er.f,ar="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],or={f:function getOwnPropertyNames(t){return ar&&"Window"==classofRaw(t)?function(t){try{return nr(t)}catch(t){return arraySliceSimple(ar)}}(t):nr(toIndexedObject(t))}},ir={f:Object.getOwnPropertySymbols},defineBuiltIn=function(t,a,o,c){return c&&c.enumerable?t[a]=o:De(t,a,o),t},sr={f:wellKnownSymbol},cr=$e.f,wellKnownSymbolDefine=function(t){var a=D.Symbol||(D.Symbol={});de(a,t)||cr(a,t,{value:sr.f(t)})},symbolDefineToPrimitive=function(){var t=getBuiltIn("Symbol"),a=t&&t.prototype,o=a&&a.valueOf,c=wellKnownSymbol("toPrimitive");a&&!a[c]&&defineBuiltIn(a,c,(function(t){return q(o,this)}),{arity:1})},lr=kt?{}.toString:function toString(){return"[object "+Pt(this)+"]"},ur=$e.f,dr=wellKnownSymbol("toStringTag"),setToStringTag=function(t,a,o,c){if(t){var h=o?t:t.prototype;de(h,dr)||ur(h,dr,{configurable:!0,value:a}),c&&!kt&&De(h,"toString",lr)}},pr=h.WeakMap,hr=isCallable(pr)&&/native code/.test(String(pr)),fr="Object already initialized",mr=h.TypeError,vr=h.WeakMap;if(hr||se.state){var gr=se.state||(se.state=new vr),yr=T(gr.get),br=T(gr.has),Cr=T(gr.set);Ht=function(t,a){if(br(gr,t))throw mr(fr);return a.facade=t,Cr(gr,t,a),a},Jt=function(t){return yr(gr,t)||{}},Yt=function(t){return br(gr,t)}}else{var Sr=sharedKey("state");Xe[Sr]=!0,Ht=function(t,a){if(de(t,Sr))throw mr(fr);return a.facade=t,De(t,Sr,a),a},Jt=function(t){return de(t,Sr)?t[Sr]:{}},Yt=function(t){return de(t,Sr)}}var Mr={set:Ht,get:Jt,has:Yt,enforce:function(t){return Yt(t)?Jt(t):Ht(t,{})},getterFor:function(t){return function(a){var o;if(!$(a)||(o=Jt(a)).type!==t)throw mr("Incompatible receiver, "+t+" required");return o}}},_r=T([].push),createMethod$3=function(t){var a=1==t,o=2==t,c=3==t,h=4==t,m=6==t,v=7==t,b=5==t||m;return function(C,S,M,w){for(var I,x,T=toObject(C),k=L(T),R=functionBindContext(S,M),q=lengthOfArrayLike(k),E=0,P=w||arraySpeciesCreate,A=a?P(C,q):o||v?P(C,0):void 0;q>E;E++)if((b||E in k)&&(x=R(I=k[E],E,T),t))if(a)A[E]=x;else if(x)switch(t){case 3:return!0;case 5:return I;case 6:return E;case 2:_r(A,I)}else switch(t){case 4:return!1;case 7:_r(A,I)}return m?-1:c||h?h:A}},wr={forEach:createMethod$3(0),map:createMethod$3(1),filter:createMethod$3(2),some:createMethod$3(3),every:createMethod$3(4),find:createMethod$3(5),findIndex:createMethod$3(6),filterReject:createMethod$3(7)},Ir=wr.forEach,xr=sharedKey("hidden"),Tr="Symbol",kr=Mr.set,Rr=Mr.getterFor(Tr),qr=Object.prototype,Er=h.Symbol,Pr=Er&&Er.prototype,Ar=h.TypeError,Or=h.QObject,Ur=Ie.f,Br=$e.f,jr=or.f,Lr=A.f,Nr=T([].push),Fr=ce("symbols"),Gr=ce("op-symbols"),$r=ce("wks"),Dr=!Or||!Or.prototype||!Or.prototype.findChild,Qr=k&&fails((function(){return 7!=ct(Br({},"a",{get:function(){return Br(this,"a",{value:7}).a}})).a}))?function(t,a,o){var c=Ur(qr,a);c&&delete qr[a],Br(t,a,o),c&&t!==qr&&Br(qr,a,c)}:Br,wrap$1=function(t,a){var o=Fr[t]=ct(Pr);return kr(o,{type:Tr,tag:t,description:a}),k||(o.description=a),o},Wr=function defineProperty(t,a,o){t===qr&&Wr(Gr,a,o),anObject(t);var c=toPropertyKey(a);return anObject(o),de(Fr,c)?(o.enumerable?(de(t,xr)&&t[xr][c]&&(t[xr][c]=!1),o=ct(o,{enumerable:createPropertyDescriptor(0,!1)})):(de(t,xr)||Br(t,xr,createPropertyDescriptor(1,{})),t[xr][c]=!0),Qr(t,c,o)):Br(t,c,o)},Vr=function defineProperties(t,a){anObject(t);var o=toIndexedObject(a),c=rt(o).concat($getOwnPropertySymbols(o));return Ir(c,(function(a){k&&!q(Kr,o,a)||Wr(t,a,o[a])})),t},Kr=function propertyIsEnumerable(t){var a=toPropertyKey(t),o=q(Lr,this,a);return!(this===qr&&de(Fr,a)&&!de(Gr,a))&&(!(o||!de(this,a)||!de(Fr,a)||de(this,xr)&&this[xr][a])||o)},zr=function getOwnPropertyDescriptor(t,a){var o=toIndexedObject(t),c=toPropertyKey(a);if(o!==qr||!de(Fr,c)||de(Gr,c)){var h=Ur(o,c);return!h||!de(Fr,c)||de(o,xr)&&o[xr][c]||(h.enumerable=!0),h}},Hr=function getOwnPropertyNames(t){var a=jr(toIndexedObject(t)),o=[];return Ir(a,(function(t){de(Fr,t)||de(Xe,t)||Nr(o,t)})),o},$getOwnPropertySymbols=function(t){var a=t===qr,o=jr(a?Gr:toIndexedObject(t)),c=[];return Ir(o,(function(t){!de(Fr,t)||a&&!de(qr,t)||Nr(c,Fr[t])})),c};X||(Er=function Symbol(){if(Q(Pr,this))throw Ar("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?toString$1(arguments[0]):void 0,a=uid(t),setter=function(t){this===qr&&q(setter,Gr,t),de(this,xr)&&de(this[xr],a)&&(this[xr][a]=!1),Qr(this,a,createPropertyDescriptor(1,t))};return k&&Dr&&Qr(qr,a,{configurable:!0,set:setter}),wrap$1(a,t)},Pr=Er.prototype,defineBuiltIn(Pr,"toString",(function toString(){return Rr(this).tag})),defineBuiltIn(Er,"withoutSetter",(function(t){return wrap$1(uid(t),t)})),A.f=Kr,$e.f=Wr,at.f=Vr,Ie.f=zr,er.f=or.f=Hr,ir.f=$getOwnPropertySymbols,sr.f=function(t){return wrap$1(wellKnownSymbol(t),t)},k&&Br(Pr,"description",{configurable:!0,get:function description(){return Rr(this).description}})),_export({global:!0,constructor:!0,wrap:!0,forced:!X,sham:!X},{Symbol:Er}),Ir(rt($r),(function(t){wellKnownSymbolDefine(t)})),_export({target:Tr,stat:!0,forced:!X},{useSetter:function(){Dr=!0},useSimple:function(){Dr=!1}}),_export({target:"Object",stat:!0,forced:!X,sham:!k},{create:function create(t,a){return void 0===a?ct(t):Vr(ct(t),a)},defineProperty:Wr,defineProperties:Vr,getOwnPropertyDescriptor:zr}),_export({target:"Object",stat:!0,forced:!X},{getOwnPropertyNames:Hr}),symbolDefineToPrimitive(),setToStringTag(Er,Tr),Xe[xr]=!0;var Jr=X&&!!Symbol.for&&!!Symbol.keyFor,Yr=ce("string-to-symbol-registry"),Xr=ce("symbol-to-string-registry");_export({target:"Symbol",stat:!0,forced:!Jr},{for:function(t){var a=toString$1(t);if(de(Yr,a))return Yr[a];var o=getBuiltIn("Symbol")(a);return Yr[a]=o,Xr[o]=a,o}});var Zr=ce("symbol-to-string-registry");_export({target:"Symbol",stat:!0,forced:!Jr},{keyFor:function keyFor(t){if(!te(t))throw TypeError(tryToString(t)+" is not a symbol");if(de(Zr,t))return Zr[t]}});var en=getBuiltIn("JSON","stringify"),tn=T(/./.exec),rn=T("".charAt),nn=T("".charCodeAt),an=T("".replace),sn=T(1..toString),cn=/[\uD800-\uDFFF]/g,ln=/^[\uD800-\uDBFF]$/,un=/^[\uDC00-\uDFFF]$/,dn=!X||fails((function(){var t=getBuiltIn("Symbol")();return"[null]"!=en([t])||"{}"!=en({a:t})||"{}"!=en(Object(t))})),pn=fails((function(){return'"\\udf06\\ud834"'!==en("\udf06\ud834")||'"\\udead"'!==en("\udead")})),stringifyWithSymbolsFix=function(t,a){var o=mt(arguments),c=a;if(($(a)||void 0!==t)&&!te(t))return It(a)||(a=function(t,a){if(isCallable(c)&&(a=q(c,this,t,a)),!te(a))return a}),o[1]=a,S(en,null,o)},fixIllFormed=function(t,a,o){var c=rn(o,a-1),h=rn(o,a+1);return tn(ln,t)&&!tn(un,h)||tn(un,t)&&!tn(ln,c)?"\\u"+sn(nn(t,0),16):t};en&&_export({target:"JSON",stat:!0,arity:3,forced:dn||pn},{stringify:function stringify(t,a,o){var c=mt(arguments),h=S(dn?stringifyWithSymbolsFix:en,null,c);return pn&&"string"==typeof h?an(h,cn,fixIllFormed):h}});var hn=!X||fails((function(){ir.f(1)}));_export({target:"Object",stat:!0,forced:hn},{getOwnPropertySymbols:function getOwnPropertySymbols(t){var a=ir.f;return a?a(toObject(t)):[]}}),wellKnownSymbolDefine("asyncIterator"),wellKnownSymbolDefine("hasInstance"),wellKnownSymbolDefine("isConcatSpreadable"),wellKnownSymbolDefine("iterator"),wellKnownSymbolDefine("match"),wellKnownSymbolDefine("matchAll"),wellKnownSymbolDefine("replace"),wellKnownSymbolDefine("search"),wellKnownSymbolDefine("species"),wellKnownSymbolDefine("split"),wellKnownSymbolDefine("toPrimitive"),symbolDefineToPrimitive(),wellKnownSymbolDefine("toStringTag"),setToStringTag(getBuiltIn("Symbol"),"Symbol"),wellKnownSymbolDefine("unscopables"),setToStringTag(h.JSON,"JSON",!0);var fn,mn,vn,gn=D.Symbol,yn={},bn=Function.prototype,Cn=k&&Object.getOwnPropertyDescriptor,Sn=de(bn,"name"),Mn={EXISTS:Sn,PROPER:Sn&&"something"===function something(){}.name,CONFIGURABLE:Sn&&(!k||k&&Cn(bn,"name").configurable)},_n=!fails((function(){function F(){}return F.prototype.constructor=null,Object.getPrototypeOf(new F)!==F.prototype})),wn=sharedKey("IE_PROTO"),In=Object,xn=In.prototype,Tn=_n?In.getPrototypeOf:function(t){var a=toObject(t);if(de(a,wn))return a[wn];var o=a.constructor;return isCallable(o)&&a instanceof o?o.prototype:a instanceof In?xn:null},kn=wellKnownSymbol("iterator"),Rn=!1;[].keys&&("next"in(vn=[].keys())?(mn=Tn(Tn(vn)))!==Object.prototype&&(fn=mn):Rn=!0);var qn=!$(fn)||fails((function(){var t={};return fn[kn].call(t)!==t}));fn=qn?{}:ct(fn),isCallable(fn[kn])||defineBuiltIn(fn,kn,(function(){return this}));var En={IteratorPrototype:fn,BUGGY_SAFARI_ITERATORS:Rn},Pn=En.IteratorPrototype,returnThis$1=function(){return this},An=Mn.PROPER,On=En.BUGGY_SAFARI_ITERATORS,Un=wellKnownSymbol("iterator"),Bn="keys",jn="values",Ln="entries",returnThis=function(){return this},iteratorDefine=function(t,a,o,c,h,m,v){!function(t,a,o,c){var h=a+" Iterator";t.prototype=ct(Pn,{next:createPropertyDescriptor(+!c,o)}),setToStringTag(t,h,!1,!0),yn[h]=returnThis$1}(o,a,c);var b,C,S,getIterationMethod=function(t){if(t===h&&T)return T;if(!On&&t in I)return I[t];switch(t){case Bn:return function keys(){return new o(this,t)};case jn:return function values(){return new o(this,t)};case Ln:return function entries(){return new o(this,t)}}return function(){return new o(this)}},M=a+" Iterator",w=!1,I=t.prototype,x=I[Un]||I["@@iterator"]||h&&I[h],T=!On&&x||getIterationMethod(h),k="Array"==a&&I.entries||x;if(k&&(b=Tn(k.call(new t)))!==Object.prototype&&b.next&&(setToStringTag(b,M,!0,!0),yn[M]=returnThis),An&&h==jn&&x&&x.name!==jn&&(w=!0,T=function values(){return q(x,this)}),h)if(C={values:getIterationMethod(jn),keys:m?T:getIterationMethod(Bn),entries:getIterationMethod(Ln)},v)for(S in C)(On||w||!(S in I))&&defineBuiltIn(I,S,C[S]);else _export({target:a,proto:!0,forced:On||w},C);return v&&I[Un]!==T&&defineBuiltIn(I,Un,T,{name:h}),yn[a]=T,C};$e.f;var Nn="Array Iterator",Fn=Mr.set,Gn=Mr.getterFor(Nn);iteratorDefine(Array,"Array",(function(t,a){Fn(this,{type:Nn,target:toIndexedObject(t),index:0,kind:a})}),(function(){var t=Gn(this),a=t.target,o=t.kind,c=t.index++;return!a||c>=a.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==o?{value:c,done:!1}:"values"==o?{value:a[c],done:!1}:{value:[c,a[c]],done:!1}}),"values"),yn.Arguments=yn.Array;var $n=wellKnownSymbol("toStringTag");for(var Dn in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var Qn=h[Dn],Wn=Qn&&Qn.prototype;Wn&&Pt(Wn)!==$n&&De(Wn,$n,Dn),yn[Dn]=yn.Array}var Vn=gn;wellKnownSymbolDefine("asyncDispose"),wellKnownSymbolDefine("dispose"),wellKnownSymbolDefine("matcher"),wellKnownSymbolDefine("metadataKey"),wellKnownSymbolDefine("observable"),wellKnownSymbolDefine("metadata"),wellKnownSymbolDefine("patternMatch"),wellKnownSymbolDefine("replaceAll");var Kn=Vn,zn=T("".charAt),Hn=T("".charCodeAt),Jn=T("".slice),createMethod$2=function(t){return function(a,o){var c,h,m=toString$1(requireObjectCoercible(a)),v=toIntegerOrInfinity(o),b=m.length;return v<0||v>=b?t?"":void 0:(c=Hn(m,v))<55296||c>56319||v+1===b||(h=Hn(m,v+1))<56320||h>57343?t?zn(m,v):c:t?Jn(m,v,v+2):h-56320+(c-55296<<10)+65536}},Yn={codeAt:createMethod$2(!1),charAt:createMethod$2(!0)}.charAt,Xn="String Iterator",Zn=Mr.set,ea=Mr.getterFor(Xn);iteratorDefine(String,"String",(function(t){Zn(this,{type:Xn,string:toString$1(t),index:0})}),(function next(){var t,a=ea(this),o=a.string,c=a.index;return c>=o.length?{value:void 0,done:!0}:(t=Yn(o,c),a.index+=t.length,{value:t,done:!1})}));var ta=sr.f("iterator"),ra=createCommonjsModule((function(t){function _typeof(a){return t.exports=_typeof="function"==typeof Kn&&"symbol"==typeof ta?function(t){return typeof t}:function(t){return t&&"function"==typeof Kn&&t.constructor===Kn&&t!==Kn.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,_typeof(a)}t.exports=_typeof,t.exports.__esModule=!0,t.exports.default=t.exports})),na=$e.f;_export({target:"Object",stat:!0,forced:Object.defineProperty!==na,sham:!k},{defineProperty:na});var aa=createCommonjsModule((function(t){var a=D.Object,o=t.exports=function defineProperty(t,o,c){return a.defineProperty(t,o,c)};a.defineProperty.sham&&(o.sham=!0)})),oa=aa,ia=fails((function(){Tn(1)}));_export({target:"Object",stat:!0,forced:ia,sham:!_n},{getPrototypeOf:function getPrototypeOf(t){return Tn(toObject(t))}});var sa=D.Object.getPrototypeOf,arrayMethodIsStrict=function(t,a){var o=[][t];return!!o&&fails((function(){o.call(null,a||function(){return 1},1)}))},ca=wr.forEach,la=arrayMethodIsStrict("forEach")?[].forEach:function forEach(t){return ca(this,t,arguments.length>1?arguments[1]:void 0)};_export({target:"Array",proto:!0,forced:[].forEach!=la},{forEach:la});var ua=entryVirtual("Array").forEach,da=Array.prototype,pa={DOMTokenList:!0,NodeList:!0},forEach$1=function(t){var a=t.forEach;return t===da||Q(da,t)&&a===da.forEach||de(pa,Pt(t))?ua:a},ha=T([].concat),fa=getBuiltIn("Reflect","ownKeys")||function ownKeys(t){var a=er.f(anObject(t)),o=ir.f;return o?ha(a,o(t)):a},ma=Error,va=T("".replace),ga=String(ma("zxcasd").stack),ya=/\n\s*at [^:]*:[^\n]*/,ba=ya.test(ga),errorStackClear=function(t,a){if(ba&&"string"==typeof t&&!ma.prepareStackTrace)for(;a--;)t=va(t,ya,"");return t},installErrorCause=function(t,a){$(a)&&"cause"in a&&De(t,"cause",a.cause)},Ca=wellKnownSymbol("iterator"),Sa=Array.prototype,isArrayIteratorMethod=function(t){return void 0!==t&&(yn.Array===t||Sa[Ca]===t)},Ma=wellKnownSymbol("iterator"),getIteratorMethod$5=function(t){if(!isNullOrUndefined(t))return getMethod(t,Ma)||getMethod(t,"@@iterator")||yn[Pt(t)]},_a=TypeError,getIterator=function(t,a){var o=arguments.length<2?getIteratorMethod$5(t):a;if(aCallable(o))return anObject(q(o,t));throw _a(tryToString(t)+" is not iterable")},iteratorClose=function(t,a,o){var c,h;anObject(t);try{if(!(c=getMethod(t,"return"))){if("throw"===a)throw o;return o}c=q(c,t)}catch(t){h=!0,c=t}if("throw"===a)throw o;if(h)throw c;return anObject(c),o},wa=TypeError,Result=function(t,a){this.stopped=t,this.result=a},Ia=Result.prototype,iterate=function(t,a,o){var c,h,m,v,b,C,S,M=o&&o.that,w=!(!o||!o.AS_ENTRIES),I=!(!o||!o.IS_RECORD),x=!(!o||!o.IS_ITERATOR),T=!(!o||!o.INTERRUPTED),k=functionBindContext(a,M),stop=function(t){return c&&iteratorClose(c,"normal",t),new Result(!0,t)},callFn=function(t){return w?(anObject(t),T?k(t[0],t[1],stop):k(t[0],t[1])):T?k(t,stop):k(t)};if(I)c=t.iterator;else if(x)c=t;else{if(!(h=getIteratorMethod$5(t)))throw wa(tryToString(t)+" is not iterable");if(isArrayIteratorMethod(h)){for(m=0,v=lengthOfArrayLike(t);v>m;m++)if((b=callFn(t[m]))&&Q(Ia,b))return b;return new Result(!1)}c=getIterator(t,h)}for(C=I?t.next:c.next;!(S=q(C,c)).done;){try{b=callFn(S.value)}catch(t){iteratorClose(c,"throw",t)}if("object"==typeof b&&b&&Q(Ia,b))return b}return new Result(!1)},normalizeStringArgument=function(t,a){return void 0===t?arguments.length<2?"":a:toString$1(t)},xa=!fails((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",createPropertyDescriptor(1,7)),7!==t.stack)})),Ta=wellKnownSymbol("toStringTag"),ka=Error,Ra=[].push,qa=function AggregateError(t,a){var o,c=arguments.length>2?arguments[2]:void 0,h=Q(Ea,this);ht?o=ht(ka(),h?Tn(this):Ea):(o=h?this:ct(Ea),De(o,Ta,"Error")),void 0!==a&&De(o,"message",normalizeStringArgument(a)),xa&&De(o,"stack",errorStackClear(o.stack,1)),installErrorCause(o,c);var m=[];return iterate(t,Ra,{that:m}),De(o,"errors",m),o};ht?ht(qa,ka):function(t,a,o){for(var c=fa(a),h=$e.f,m=Ie.f,v=0;v<c.length;v++){var b=c[v];de(t,b)||o&&de(o,b)||h(t,b,m(a,b))}}(qa,ka,{name:!0});var Ea=qa.prototype=ct(ka.prototype,{constructor:createPropertyDescriptor(1,qa),message:createPropertyDescriptor(1,""),name:createPropertyDescriptor(1,"AggregateError")});_export({global:!0,constructor:!0,arity:2},{AggregateError:qa});var Pa,Aa,Oa,Ua,Ba="process"==classofRaw(h.process),ja=wellKnownSymbol("species"),setSpecies=function(t){var a=getBuiltIn(t),o=$e.f;k&&a&&!a[ja]&&o(a,ja,{configurable:!0,get:function(){return this}})},La=TypeError,anInstance=function(t,a){if(Q(a,t))return t;throw La("Incorrect invocation")},Na=TypeError,aConstructor=function(t){if($t(t))return t;throw Na(tryToString(t)+" is not a constructor")},Fa=wellKnownSymbol("species"),speciesConstructor=function(t,a){var o,c=anObject(t).constructor;return void 0===c||isNullOrUndefined(o=anObject(c)[Fa])?a:aConstructor(o)},Ga=TypeError,validateArgumentsLength=function(t,a){if(t<a)throw Ga("Not enough arguments");return t},$a=/(?:ipad|iphone|ipod).*applewebkit/i.test(W),Da=h.setImmediate,Qa=h.clearImmediate,Wa=h.process,Va=h.Dispatch,Ka=h.Function,za=h.MessageChannel,Ha=h.String,Ja=0,Ya={},Xa="onreadystatechange";try{Pa=h.location}catch(t){}var run=function(t){if(de(Ya,t)){var a=Ya[t];delete Ya[t],a()}},runner=function(t){return function(){run(t)}},listener=function(t){run(t.data)},post=function(t){h.postMessage(Ha(t),Pa.protocol+"//"+Pa.host)};Da&&Qa||(Da=function setImmediate(t){validateArgumentsLength(arguments.length,1);var a=isCallable(t)?t:Ka(t),o=mt(arguments,1);return Ya[++Ja]=function(){S(a,void 0,o)},Aa(Ja),Ja},Qa=function clearImmediate(t){delete Ya[t]},Ba?Aa=function(t){Wa.nextTick(runner(t))}:Va&&Va.now?Aa=function(t){Va.now(runner(t))}:za&&!$a?(Ua=(Oa=new za).port2,Oa.port1.onmessage=listener,Aa=functionBindContext(Ua.postMessage,Ua)):h.addEventListener&&isCallable(h.postMessage)&&!h.importScripts&&Pa&&"file:"!==Pa.protocol&&!fails(post)?(Aa=post,h.addEventListener("message",listener,!1)):Aa=Xa in documentCreateElement("script")?function(t){ot.appendChild(documentCreateElement("script")).onreadystatechange=function(){ot.removeChild(this),run(t)}}:function(t){setTimeout(runner(t),0)});var Za,eo,to,ro,no,ao,oo,io,so={set:Da,clear:Qa},co=/ipad|iphone|ipod/i.test(W)&&void 0!==h.Pebble,lo=/web0s(?!.*chrome)/i.test(W),uo=Ie.f,po=so.set,ho=h.MutationObserver||h.WebKitMutationObserver,fo=h.document,mo=h.process,vo=h.Promise,go=uo(h,"queueMicrotask"),yo=go&&go.value;yo||(Za=function(){var t,a;for(Ba&&(t=mo.domain)&&t.exit();eo;){a=eo.fn,eo=eo.next;try{a()}catch(t){throw eo?ro():to=void 0,t}}to=void 0,t&&t.enter()},$a||Ba||lo||!ho||!fo?!co&&vo&&vo.resolve?((oo=vo.resolve(void 0)).constructor=vo,io=functionBindContext(oo.then,oo),ro=function(){io(Za)}):Ba?ro=function(){mo.nextTick(Za)}:(po=functionBindContext(po,h),ro=function(){po(Za)}):(no=!0,ao=fo.createTextNode(""),new ho(Za).observe(ao,{characterData:!0}),ro=function(){ao.data=no=!no}));var bo=yo||function(t){var a={fn:t,next:void 0};to&&(to.next=a),eo||(eo=a,ro()),to=a},perform=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Queue=function(){this.head=null,this.tail=null};Queue.prototype={add:function(t){var a={item:t,next:null};this.head?this.tail.next=a:this.head=a,this.tail=a},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var Co,So,Mo=Queue,_o=h.Promise,wo="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Io=!wo&&!Ba&&"object"==typeof window&&"object"==typeof document,xo=_o&&_o.prototype,To=wellKnownSymbol("species"),ko=!1,Ro=isCallable(h.PromiseRejectionEvent),qo=Ee("Promise",(function(){var t=Ot(_o),a=t!==String(_o);if(!a&&66===Y)return!0;if(!xo.catch||!xo.finally)return!0;if(!Y||Y<51||!/native code/.test(t)){var o=new _o((function(t){t(1)})),FakePromise=function(t){t((function(){}),(function(){}))};if((o.constructor={})[To]=FakePromise,!(ko=o.then((function(){}))instanceof FakePromise))return!0}return!a&&(Io||wo)&&!Ro})),Eo={CONSTRUCTOR:qo,REJECTION_EVENT:Ro,SUBCLASSING:ko},Po=TypeError,PromiseCapability=function(t){var a,o;this.promise=new t((function(t,c){if(void 0!==a||void 0!==o)throw Po("Bad Promise constructor");a=t,o=c})),this.resolve=aCallable(a),this.reject=aCallable(o)},Ao={f:function(t){return new PromiseCapability(t)}},Oo=so.set,Uo="Promise",Bo=Eo.CONSTRUCTOR,jo=Eo.REJECTION_EVENT,Lo=Mr.getterFor(Uo),No=Mr.set,Fo=_o&&_o.prototype,Go=_o,$o=Fo,Do=h.TypeError,Qo=h.document,Wo=h.process,Vo=Ao.f,Ko=Vo,zo=!!(Qo&&Qo.createEvent&&h.dispatchEvent),Ho="unhandledrejection",isThenable=function(t){var a;return!(!$(t)||!isCallable(a=t.then))&&a},callReaction=function(t,a){var o,c,h,m=a.value,v=1==a.state,b=v?t.ok:t.fail,C=t.resolve,S=t.reject,M=t.domain;try{b?(v||(2===a.rejection&&onHandleUnhandled(a),a.rejection=1),!0===b?o=m:(M&&M.enter(),o=b(m),M&&(M.exit(),h=!0)),o===t.promise?S(Do("Promise-chain cycle")):(c=isThenable(o))?q(c,o,C,S):C(o)):S(m)}catch(t){M&&!h&&M.exit(),S(t)}},notify=function(t,a){t.notified||(t.notified=!0,bo((function(){for(var o,c=t.reactions;o=c.get();)callReaction(o,t);t.notified=!1,a&&!t.rejection&&onUnhandled(t)})))},dispatchEvent=function(t,a,o){var c,m;zo?((c=Qo.createEvent("Event")).promise=a,c.reason=o,c.initEvent(t,!1,!0),h.dispatchEvent(c)):c={promise:a,reason:o},!jo&&(m=h["on"+t])?m(c):t===Ho&&function(t,a){var o=h.console;o&&o.error&&(1==arguments.length?o.error(t):o.error(t,a))}("Unhandled promise rejection",o)},onUnhandled=function(t){q(Oo,h,(function(){var a,o=t.facade,c=t.value;if(isUnhandled(t)&&(a=perform((function(){Ba?Wo.emit("unhandledRejection",c,o):dispatchEvent(Ho,o,c)})),t.rejection=Ba||isUnhandled(t)?2:1,a.error))throw a.value}))},isUnhandled=function(t){return 1!==t.rejection&&!t.parent},onHandleUnhandled=function(t){q(Oo,h,(function(){var a=t.facade;Ba?Wo.emit("rejectionHandled",a):dispatchEvent("rejectionhandled",a,t.value)}))},bind=function(t,a,o){return function(c){t(a,c,o)}},internalReject=function(t,a,o){t.done||(t.done=!0,o&&(t=o),t.value=a,t.state=2,notify(t,!0))},internalResolve=function(t,a,o){if(!t.done){t.done=!0,o&&(t=o);try{if(t.facade===a)throw Do("Promise can't be resolved itself");var c=isThenable(a);c?bo((function(){var o={done:!1};try{q(c,a,bind(internalResolve,o,t),bind(internalReject,o,t))}catch(a){internalReject(o,a,t)}})):(t.value=a,t.state=1,notify(t,!1))}catch(a){internalReject({done:!1},a,t)}}};Bo&&($o=(Go=function Promise(t){anInstance(this,$o),aCallable(t),q(Co,this);var a=Lo(this);try{t(bind(internalResolve,a),bind(internalReject,a))}catch(t){internalReject(a,t)}}).prototype,(Co=function Promise(t){No(this,{type:Uo,done:!1,notified:!1,parent:!1,reactions:new Mo,rejection:!1,state:0,value:void 0})}).prototype=defineBuiltIn($o,"then",(function then(t,a){var o=Lo(this),c=Vo(speciesConstructor(this,Go));return o.parent=!0,c.ok=!isCallable(t)||t,c.fail=isCallable(a)&&a,c.domain=Ba?Wo.domain:void 0,0==o.state?o.reactions.add(c):bo((function(){callReaction(c,o)})),c.promise})),So=function(){var t=new Co,a=Lo(t);this.promise=t,this.resolve=bind(internalResolve,a),this.reject=bind(internalReject,a)},Ao.f=Vo=function(t){return t===Go||undefined===t?new So(t):Ko(t)}),_export({global:!0,constructor:!0,wrap:!0,forced:Bo},{Promise:Go}),setToStringTag(Go,Uo,!1,!0),setSpecies(Uo);var Jo=wellKnownSymbol("iterator"),Yo=!1;try{var Xo=0,Zo={next:function(){return{done:!!Xo++}},return:function(){Yo=!0}};Zo[Jo]=function(){return this},Array.from(Zo,(function(){throw 2}))}catch(t){}var checkCorrectnessOfIteration=function(t,a){if(!a&&!Yo)return!1;var o=!1;try{var c={};c[Jo]=function(){return{next:function(){return{done:o=!0}}}},t(c)}catch(t){}return o},ei=Eo.CONSTRUCTOR||!checkCorrectnessOfIteration((function(t){_o.all(t).then(void 0,(function(){}))}));_export({target:"Promise",stat:!0,forced:ei},{all:function all(t){var a=this,o=Ao.f(a),c=o.resolve,h=o.reject,m=perform((function(){var o=aCallable(a.resolve),m=[],v=0,b=1;iterate(t,(function(t){var C=v++,S=!1;b++,q(o,a,t).then((function(t){S||(S=!0,m[C]=t,--b||c(m))}),h)})),--b||c(m)}));return m.error&&h(m.value),o.promise}});var ti=Eo.CONSTRUCTOR;_o&&_o.prototype,_export({target:"Promise",proto:!0,forced:ti,real:!0},{catch:function(t){return this.then(void 0,t)}}),_export({target:"Promise",stat:!0,forced:ei},{race:function race(t){var a=this,o=Ao.f(a),c=o.reject,h=perform((function(){var h=aCallable(a.resolve);iterate(t,(function(t){q(h,a,t).then(o.resolve,c)}))}));return h.error&&c(h.value),o.promise}}),_export({target:"Promise",stat:!0,forced:Eo.CONSTRUCTOR},{reject:function reject(t){var a=Ao.f(this);return q(a.reject,void 0,t),a.promise}});var promiseResolve=function(t,a){if(anObject(t),$(a)&&a.constructor===t)return a;var o=Ao.f(t);return(0,o.resolve)(a),o.promise},ri=Eo.CONSTRUCTOR,ni=getBuiltIn("Promise"),ai=!ri;_export({target:"Promise",stat:!0,forced:!0},{resolve:function resolve(t){return promiseResolve(ai&&this===ni?_o:this,t)}}),_export({target:"Promise",stat:!0},{allSettled:function allSettled(t){var a=this,o=Ao.f(a),c=o.resolve,h=o.reject,m=perform((function(){var o=aCallable(a.resolve),h=[],m=0,v=1;iterate(t,(function(t){var b=m++,C=!1;v++,q(o,a,t).then((function(t){C||(C=!0,h[b]={status:"fulfilled",value:t},--v||c(h))}),(function(t){C||(C=!0,h[b]={status:"rejected",reason:t},--v||c(h))}))})),--v||c(h)}));return m.error&&h(m.value),o.promise}});var oi="No one promise resolved";_export({target:"Promise",stat:!0},{any:function any(t){var a=this,o=getBuiltIn("AggregateError"),c=Ao.f(a),h=c.resolve,m=c.reject,v=perform((function(){var c=aCallable(a.resolve),v=[],b=0,C=1,S=!1;iterate(t,(function(t){var M=b++,w=!1;C++,q(c,a,t).then((function(t){w||S||(S=!0,h(t))}),(function(t){w||S||(w=!0,v[M]=t,--C||m(new o(v,oi)))}))})),--C||m(new o(v,oi))}));return v.error&&m(v.value),c.promise}});var ii=_o&&_o.prototype,si=!!_o&&fails((function(){ii.finally.call({then:function(){}},(function(){}))}));_export({target:"Promise",proto:!0,real:!0,forced:si},{finally:function(t){var a=speciesConstructor(this,getBuiltIn("Promise")),o=isCallable(t);return this.then(o?function(o){return promiseResolve(a,t()).then((function(){return o}))}:t,o?function(o){return promiseResolve(a,t()).then((function(){throw o}))}:t)}});var ci=D.Promise;_export({target:"Promise",stat:!0,forced:!0},{try:function(t){var a=Ao.f(this),o=perform(t);return(o.error?a.reject:a.resolve)(o.value),a.promise}});var li=ci,ui=T([].reverse),di=[1,2];_export({target:"Array",proto:!0,forced:String(di)===String(di.reverse())},{reverse:function reverse(){return It(this)&&(this.length=this.length),ui(this)}});var pi=entryVirtual("Array").reverse,hi=Array.prototype,reverse=function(t){var a=t.reverse;return t===hi||Q(hi,t)&&a===hi.reverse?pi:a},fi=arrayMethodHasSpeciesSupport("slice"),mi=wellKnownSymbol("species"),vi=Array,gi=Math.max;_export({target:"Array",proto:!0,forced:!fi},{slice:function slice(t,a){var o,c,h,m=toIndexedObject(this),v=lengthOfArrayLike(m),b=toAbsoluteIndex(t,v),C=toAbsoluteIndex(void 0===a?v:a,v);if(It(m)&&(o=m.constructor,($t(o)&&(o===vi||It(o.prototype))||$(o)&&null===(o=o[mi]))&&(o=void 0),o===vi||void 0===o))return mt(m,b,C);for(c=new(void 0===o?vi:o)(gi(C-b,0)),h=0;b<C;b++,h++)b in m&&createProperty(c,h,m[b]);return c.length=h,c}});var yi=entryVirtual("Array").slice,bi=Array.prototype,slice=function(t){var a=t.slice;return t===bi||Q(bi,t)&&a===bi.slice?yi:a},Ci=createCommonjsModule((function(t){var a=ra.default;function _regeneratorRuntime(){t.exports=_regeneratorRuntime=function _regeneratorRuntime(){return o},t.exports.__esModule=!0,t.exports.default=t.exports;var o={},c=Object.prototype,h=c.hasOwnProperty,m="function"==typeof Kn?Kn:{},v=m.iterator||"@@iterator",b=m.asyncIterator||"@@asyncIterator",C=m.toStringTag||"@@toStringTag";function define(t,a,o){return oa(t,a,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[a]}try{define({},"")}catch(t){define=function define(t,a,o){return t[a]=o}}function wrap(t,a,o,c){var h=a&&a.prototype instanceof Generator?a:Generator,m=ut(h.prototype),v=new Context(c||[]);return m._invoke=function(t,a,o){var c="suspendedStart";return function(h,m){if("executing"===c)throw new Error("Generator is already running");if("completed"===c){if("throw"===h)throw m;return doneResult()}for(o.method=h,o.arg=m;;){var v=o.delegate;if(v){var b=maybeInvokeDelegate(v,o);if(b){if(b===S)continue;return b}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===c)throw c="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);c="executing";var C=tryCatch(t,a,o);if("normal"===C.type){if(c=o.done?"completed":"suspendedYield",C.arg===S)continue;return{value:C.arg,done:o.done}}"throw"===C.type&&(c="completed",o.method="throw",o.arg=C.arg)}}}(t,o,v),m}function tryCatch(t,a,o){try{return{type:"normal",arg:t.call(a,o)}}catch(t){return{type:"throw",arg:t}}}o.wrap=wrap;var S={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var M={};define(M,v,(function(){return this}));var w=sa&&sa(sa(values([])));w&&w!==c&&h.call(w,v)&&(M=w);var I=GeneratorFunctionPrototype.prototype=Generator.prototype=ut(M);function defineIteratorMethods(t){var a;forEach$1(a=["next","throw","return"]).call(a,(function(a){define(t,a,(function(t){return this._invoke(a,t)}))}))}function AsyncIterator(t,o){function invoke(c,m,v,b){var C=tryCatch(t[c],t,m);if("throw"!==C.type){var S=C.arg,M=S.value;return M&&"object"==a(M)&&h.call(M,"__await")?o.resolve(M.__await).then((function(t){invoke("next",t,v,b)}),(function(t){invoke("throw",t,v,b)})):o.resolve(M).then((function(t){S.value=t,v(S)}),(function(t){return invoke("throw",t,v,b)}))}b(C.arg)}var c;this._invoke=function(t,a){function callInvokeWithMethodAndArg(){return new o((function(o,c){invoke(t,a,o,c)}))}return c=c?c.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(t,a){var o=t.iterator[a.method];if(void 0===o){if(a.delegate=null,"throw"===a.method){if(t.iterator.return&&(a.method="return",a.arg=void 0,maybeInvokeDelegate(t,a),"throw"===a.method))return S;a.method="throw",a.arg=new TypeError("The iterator does not provide a 'throw' method")}return S}var c=tryCatch(o,t.iterator,a.arg);if("throw"===c.type)return a.method="throw",a.arg=c.arg,a.delegate=null,S;var h=c.arg;return h?h.done?(a[t.resultName]=h.value,a.next=t.nextLoc,"return"!==a.method&&(a.method="next",a.arg=void 0),a.delegate=null,S):h:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,S)}function pushTryEntry(t){var a={tryLoc:t[0]};1 in t&&(a.catchLoc=t[1]),2 in t&&(a.finallyLoc=t[2],a.afterLoc=t[3]),this.tryEntries.push(a)}function resetTryEntry(t){var a=t.completion||{};a.type="normal",delete a.arg,t.completion=a}function Context(t){this.tryEntries=[{tryLoc:"root"}],forEach$1(t).call(t,pushTryEntry,this),this.reset(!0)}function values(t){if(t){var a=t[v];if(a)return a.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,c=function next(){for(;++o<t.length;)if(h.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return c.next=c}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(I,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,C,"GeneratorFunction"),o.isGeneratorFunction=function(t){var a="function"==typeof t&&t.constructor;return!!a&&(a===GeneratorFunction||"GeneratorFunction"===(a.displayName||a.name))},o.mark=function(t){return ft?ft(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,C,"GeneratorFunction")),t.prototype=ut(I),t},o.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,b,(function(){return this})),o.AsyncIterator=AsyncIterator,o.async=function(t,a,c,h,m){void 0===m&&(m=li);var v=new AsyncIterator(wrap(t,a,c,h),m);return o.isGeneratorFunction(a)?v:v.next().then((function(t){return t.done?t.value:v.next()}))},defineIteratorMethods(I),define(I,C,"Generator"),define(I,v,(function(){return this})),define(I,"toString",(function(){return"[object Generator]"})),o.keys=function(t){var a=[];for(var o in t)a.push(o);return reverse(a).call(a),function next(){for(;a.length;){var o=a.pop();if(o in t)return next.value=o,next.done=!1,next}return next.done=!0,next}},o.values=values,Context.prototype={constructor:Context,reset:function reset(t){var a;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,forEach$1(a=this.tryEntries).call(a,resetTryEntry),!t)for(var o in this)"t"===o.charAt(0)&&h.call(this,o)&&!isNaN(+slice(o).call(o,1))&&(this[o]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var a=this;function handle(o,c){return m.type="throw",m.arg=t,a.next=o,c&&(a.method="next",a.arg=void 0),!!c}for(var o=this.tryEntries.length-1;o>=0;--o){var c=this.tryEntries[o],m=c.completion;if("root"===c.tryLoc)return handle("end");if(c.tryLoc<=this.prev){var v=h.call(c,"catchLoc"),b=h.call(c,"finallyLoc");if(v&&b){if(this.prev<c.catchLoc)return handle(c.catchLoc,!0);if(this.prev<c.finallyLoc)return handle(c.finallyLoc)}else if(v){if(this.prev<c.catchLoc)return handle(c.catchLoc,!0)}else{if(!b)throw new Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return handle(c.finallyLoc)}}}},abrupt:function abrupt(t,a){for(var o=this.tryEntries.length-1;o>=0;--o){var c=this.tryEntries[o];if(c.tryLoc<=this.prev&&h.call(c,"finallyLoc")&&this.prev<c.finallyLoc){var m=c;break}}m&&("break"===t||"continue"===t)&&m.tryLoc<=a&&a<=m.finallyLoc&&(m=null);var v=m?m.completion:{};return v.type=t,v.arg=a,m?(this.method="next",this.next=m.finallyLoc,S):this.complete(v)},complete:function complete(t,a){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&a&&(this.next=a),S},finish:function finish(t){for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),S}},catch:function _catch(t){for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a];if(o.tryLoc===t){var c=o.completion;if("throw"===c.type){var h=c.arg;resetTryEntry(o)}return h}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,a,o){return this.delegate={iterator:values(t),resultName:a,nextLoc:o},"next"===this.method&&(this.arg=void 0),S}},o}t.exports=_regeneratorRuntime,t.exports.__esModule=!0,t.exports.default=t.exports})),Si=Ci(),Mi=Si;try{regeneratorRuntime=Si}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=Si:Function("r","regeneratorRuntime = r")(Si)}_export({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991});var _i=9007199254740991,wi=Object.assign,Ii=Object.defineProperty,xi=T([].concat),Ti=!wi||fails((function(){if(k&&1!==wi({b:1},wi(Ii({},"a",{enumerable:!0,get:function(){Ii(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},a={},o=Symbol(),c="abcdefghijklmnopqrst";return t[o]=7,c.split("").forEach((function(t){a[t]=t})),7!=wi({},t)[o]||rt(wi({},a)).join("")!=c}))?function assign(t,a){for(var o=toObject(t),c=arguments.length,h=1,m=ir.f,v=A.f;c>h;)for(var b,C=L(arguments[h++]),S=m?xi(rt(C),m(C)):rt(C),M=S.length,w=0;M>w;)b=S[w++],k&&!q(v,C,b)||(o[b]=C[b]);return o}:wi;_export({target:"Object",stat:!0,arity:2,forced:Object.assign!==Ti},{assign:Ti});var ki=D.Object.assign;function __rest(t,a){var o={};for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&a.indexOf(c)<0&&(o[c]=t[c]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var h=0;for(c=Object.getOwnPropertySymbols(t);h<c.length;h++)a.indexOf(c[h])<0&&Object.prototype.propertyIsEnumerable.call(t,c[h])&&(o[c[h]]=t[c[h]])}return o}function __awaiter(t,a,o,c){return new(o||(o=Promise))((function(h,m){function fulfilled(t){try{step(c.next(t))}catch(t){m(t)}}function rejected(t){try{step(c.throw(t))}catch(t){m(t)}}function step(t){t.done?h(t.value):function adopt(t){return t instanceof o?t:new o((function(a){a(t)}))}(t.value).then(fulfilled,rejected)}step((c=c.apply(t,a||[])).next())}))}var Ri=fails((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),qi=Object.isExtensible,Ei=fails((function(){qi(1)}))||Ri?function isExtensible(t){return!!$(t)&&((!Ri||"ArrayBuffer"!=classofRaw(t))&&(!qi||qi(t)))}:qi,Pi=!fails((function(){return Object.isExtensible(Object.preventExtensions({}))})),Ai=createCommonjsModule((function(t){var a=$e.f,o=!1,c=uid("meta"),h=0,setMetadata=function(t){a(t,c,{value:{objectID:"O"+h++,weakData:{}}})},m=t.exports={enable:function(){m.enable=function(){},o=!0;var t=er.f,a=T([].splice),h={};h[c]=1,t(h).length&&(er.f=function(o){for(var h=t(o),m=0,v=h.length;m<v;m++)if(h[m]===c){a(h,m,1);break}return h},_export({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:or.f}))},fastKey:function(t,a){if(!$(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!de(t,c)){if(!Ei(t))return"F";if(!a)return"E";setMetadata(t)}return t[c].objectID},getWeakData:function(t,a){if(!de(t,c)){if(!Ei(t))return!0;if(!a)return!1;setMetadata(t)}return t[c].weakData},onFreeze:function(t){return Pi&&o&&Ei(t)&&!de(t,c)&&setMetadata(t),t}};Xe[c]=!0})),Oi=$e.f,Ui=wr.forEach,Bi=Mr.set,ji=Mr.getterFor,collection=function(t,a,o){var c,m=-1!==t.indexOf("Map"),v=-1!==t.indexOf("Weak"),b=m?"set":"add",C=h[t],S=C&&C.prototype,M={};if(k&&isCallable(C)&&(v||S.forEach&&!fails((function(){(new C).entries().next()})))){var w=(c=a((function(a,o){Bi(anInstance(a,w),{type:t,collection:new C}),null!=o&&iterate(o,a[b],{that:a,AS_ENTRIES:m})}))).prototype,I=ji(t);Ui(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(t){var a="add"==t||"set"==t;!(t in S)||v&&"clear"==t||De(w,t,(function(o,c){var h=I(this).collection;if(!a&&v&&!$(o))return"get"==t&&void 0;var m=h[t](0===o?0:o,c);return a?this:m}))})),v||Oi(w,"size",{configurable:!0,get:function(){return I(this).collection.size}})}else c=o.getConstructor(a,t,m,b),Ai.enable();return setToStringTag(c,t,!1,!0),M[t]=c,_export({global:!0,forced:!0},M),v||o.setStrong(c,t,m),c},defineBuiltIns=function(t,a,o){for(var c in a)o&&o.unsafe&&t[c]?t[c]=a[c]:defineBuiltIn(t,c,a[c],o);return t},Li=$e.f,Ni=Ai.fastKey,Fi=Mr.set,Gi=Mr.getterFor,$i={getConstructor:function(t,a,o,c){var h=t((function(t,h){anInstance(t,m),Fi(t,{type:a,index:ct(null),first:void 0,last:void 0,size:0}),k||(t.size=0),isNullOrUndefined(h)||iterate(h,t[c],{that:t,AS_ENTRIES:o})})),m=h.prototype,v=Gi(a),define=function(t,a,o){var c,h,m=v(t),b=getEntry(t,a);return b?b.value=o:(m.last=b={index:h=Ni(a,!0),key:a,value:o,previous:c=m.last,next:void 0,removed:!1},m.first||(m.first=b),c&&(c.next=b),k?m.size++:t.size++,"F"!==h&&(m.index[h]=b)),t},getEntry=function(t,a){var o,c=v(t),h=Ni(a);if("F"!==h)return c.index[h];for(o=c.first;o;o=o.next)if(o.key==a)return o};return defineBuiltIns(m,{clear:function clear(){for(var t=v(this),a=t.index,o=t.first;o;)o.removed=!0,o.previous&&(o.previous=o.previous.next=void 0),delete a[o.index],o=o.next;t.first=t.last=void 0,k?t.size=0:this.size=0},delete:function(t){var a=this,o=v(a),c=getEntry(a,t);if(c){var h=c.next,m=c.previous;delete o.index[c.index],c.removed=!0,m&&(m.next=h),h&&(h.previous=m),o.first==c&&(o.first=h),o.last==c&&(o.last=m),k?o.size--:a.size--}return!!c},forEach:function forEach(t){for(var a,o=v(this),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0);a=a?a.next:o.first;)for(c(a.value,a.key,this);a&&a.removed;)a=a.previous},has:function has(t){return!!getEntry(this,t)}}),defineBuiltIns(m,o?{get:function get(t){var a=getEntry(this,t);return a&&a.value},set:function set(t,a){return define(this,0===t?0:t,a)}}:{add:function add(t){return define(this,t=0===t?0:t,t)}}),k&&Li(m,"size",{get:function(){return v(this).size}}),h},setStrong:function(t,a,o){var c=a+" Iterator",h=Gi(a),m=Gi(c);iteratorDefine(t,a,(function(t,a){Fi(this,{type:c,target:t,state:h(t),kind:a,last:void 0})}),(function(){for(var t=m(this),a=t.kind,o=t.last;o&&o.removed;)o=o.previous;return t.target&&(t.last=o=o?o.next:t.state.first)?"keys"==a?{value:o.key,done:!1}:"values"==a?{value:o.value,done:!1}:{value:[o.key,o.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),o?"entries":"values",!o,!0),setSpecies(a)}};collection("Map",(function(t){return function Map(){return t(this,arguments.length?arguments[0]:void 0)}}),$i);var Di=D.Map,Qi=[].push,Wi=function from(t){var a,o,c,h,m=arguments.length,v=m>1?arguments[1]:void 0;return aConstructor(this),(a=void 0!==v)&&aCallable(v),isNullOrUndefined(t)?new this:(o=[],a?(c=0,h=functionBindContext(v,m>2?arguments[2]:void 0),iterate(t,(function(t){q(Qi,o,h(t,c++))}))):iterate(t,Qi,{that:o}),new this(o))};_export({target:"Map",stat:!0,forced:!0},{from:Wi});var Vi=function of(){return new this(mt(arguments))};_export({target:"Map",stat:!0,forced:!0},{of:Vi});var Ki=function deleteAll(){for(var t,a=anObject(this),o=aCallable(a.delete),c=!0,h=0,m=arguments.length;h<m;h++)t=q(o,a,arguments[h]),c=c&&t;return!!c};_export({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:Ki});_export({target:"Map",proto:!0,real:!0,forced:!0},{emplace:function emplace(t,a){var o,c,h=anObject(this),m=aCallable(h.get),v=aCallable(h.has),b=aCallable(h.set);return q(v,h,t)?(o=q(m,h,t),"update"in a&&(o=a.update(o,t,h),q(b,h,t,o)),o):(c=a.insert(t,h),q(b,h,t,c),c)}});var zi=getIterator;_export({target:"Map",proto:!0,real:!0,forced:!0},{every:function every(t){var a=anObject(this),o=zi(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return!iterate(o,(function(t,o,h){if(!c(o,t,a))return h()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{filter:function filter(t){var a=anObject(this),o=zi(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0),h=new(speciesConstructor(a,getBuiltIn("Map"))),m=aCallable(h.set);return iterate(o,(function(t,o){c(o,t,a)&&q(m,h,t,o)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),h}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{find:function find(t){var a=anObject(this),o=zi(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(o,(function(t,o,h){if(c(o,t,a))return h(o)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function findKey(t){var a=anObject(this),o=zi(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(o,(function(t,o,h){if(c(o,t,a))return h(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Hi=T([].push);_export({target:"Map",stat:!0,forced:!0},{groupBy:function groupBy(t,a){aCallable(a);var o=getIterator(t),c=new this,h=aCallable(c.has),m=aCallable(c.get),v=aCallable(c.set);return iterate(o,(function(t){var o=a(t);q(h,c,o)?Hi(q(m,c,o),t):q(v,c,o,[t])}),{IS_ITERATOR:!0}),c}});_export({target:"Map",proto:!0,real:!0,forced:!0},{includes:function includes(t){return iterate(zi(anObject(this)),(function(a,o,c){if((h=o)===(m=t)||h!=h&&m!=m)return c();var h,m}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",stat:!0,forced:!0},{keyBy:function keyBy(t,a){var o=new this;aCallable(a);var c=aCallable(o.set);return iterate(t,(function(t){q(c,o,a(t),t)})),o}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function keyOf(t){return iterate(zi(anObject(this)),(function(a,o,c){if(o===t)return c(a)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function mapKeys(t){var a=anObject(this),o=zi(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0),h=new(speciesConstructor(a,getBuiltIn("Map"))),m=aCallable(h.set);return iterate(o,(function(t,o){q(m,h,c(o,t,a),o)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),h}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function mapValues(t){var a=anObject(this),o=zi(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0),h=new(speciesConstructor(a,getBuiltIn("Map"))),m=aCallable(h.set);return iterate(o,(function(t,o){q(m,h,t,c(o,t,a))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),h}}),_export({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function merge(t){for(var a=anObject(this),o=aCallable(a.set),c=arguments.length,h=0;h<c;)iterate(arguments[h++],o,{that:a,AS_ENTRIES:!0});return a}});var Ji=TypeError;_export({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function reduce(t){var a=anObject(this),o=zi(a),c=arguments.length<2,h=c?void 0:arguments[1];if(aCallable(t),iterate(o,(function(o,m){c?(c=!1,h=m):h=t(h,m,o,a)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),c)throw Ji("Reduce of empty map with no initial value");return h}}),_export({target:"Map",proto:!0,real:!0,forced:!0},{some:function some(t){var a=anObject(this),o=zi(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(o,(function(t,o,h){if(c(o,t,a))return h()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Yi=TypeError;_export({target:"Map",proto:!0,real:!0,forced:!0},{update:function update(t,a){var o=anObject(this),c=aCallable(o.get),h=aCallable(o.has),m=aCallable(o.set),v=arguments.length;aCallable(a);var b=q(h,o,t);if(!b&&v<3)throw Yi("Updating absent value");var C=b?q(c,o,t):aCallable(v>2?arguments[2]:void 0)(t,o);return q(m,o,t,a(C,t,o)),o}});var Xi=TypeError,Zi=function upsert(t,a){var o,c=anObject(this),h=aCallable(c.get),m=aCallable(c.has),v=aCallable(c.set),b=arguments.length>2?arguments[2]:void 0;if(!isCallable(a)&&!isCallable(b))throw Xi("At least one callback required");return q(m,c,t)?(o=q(h,c,t),isCallable(a)&&(o=a(o),q(v,c,t,o))):isCallable(b)&&(o=b(),q(v,c,t,o)),o};_export({target:"Map",proto:!0,real:!0,forced:!0},{upsert:Zi}),_export({target:"Map",proto:!0,real:!0,name:"upsert",forced:!0},{updateOrInsert:Zi});var es=Di,ts=entryVirtual("Array").concat,rs=Array.prototype,concat=function(t){var a=t.concat;return t===rs||Q(rs,t)&&a===rs.concat?ts:a},ns=/MSIE .\./.test(W),as=h.Function,wrap=function(t){return ns?function(a,o){var c=validateArgumentsLength(arguments.length,1)>2,h=isCallable(a)?a:as(a),m=c?mt(arguments,2):void 0;return t(c?function(){S(h,this,m)}:h,o)}:t},os={setTimeout:wrap(h.setTimeout),setInterval:wrap(h.setInterval)},is=os.setInterval;_export({global:!0,bind:!0,forced:h.setInterval!==is},{setInterval:is});var ss=os.setTimeout;_export({global:!0,bind:!0,forced:h.setTimeout!==ss},{setTimeout:ss});var cs=D.setTimeout;D.JSON||(D.JSON={stringify:JSON.stringify});var ls=function stringify(t,a,o){return S(D.JSON.stringify,null,arguments)},us=ls,ds=Date,ps=T(ds.prototype.getTime);_export({target:"Date",stat:!0},{now:function now(){return ps(new ds)}});var hs=D.Date.now,fs=wr.map,ms=arrayMethodHasSpeciesSupport("map");_export({target:"Array",proto:!0,forced:!ms},{map:function map(t){return fs(this,t,arguments.length>1?arguments[1]:void 0)}});var vs=entryVirtual("Array").map,gs=Array.prototype,map=function(t){var a=t.map;return t===gs||Q(gs,t)&&a===gs.map?vs:a},ys=createCommonjsModule((function(t){var a=Object.prototype.hasOwnProperty,o="~";function Events(){}function EE(t,a,o){this.fn=t,this.context=a,this.once=o||!1}function addListener(t,a,c,h,m){if("function"!=typeof c)throw new TypeError("The listener must be a function");var v=new EE(c,h||t,m),b=o?o+a:a;return t._events[b]?t._events[b].fn?t._events[b]=[t._events[b],v]:t._events[b].push(v):(t._events[b]=v,t._eventsCount++),t}function clearEvent(t,a){0==--t._eventsCount?t._events=new Events:delete t._events[a]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(o=!1)),EventEmitter.prototype.eventNames=function eventNames(){var t,c,h=[];if(0===this._eventsCount)return h;for(c in t=this._events)a.call(t,c)&&h.push(o?c.slice(1):c);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(t)):h},EventEmitter.prototype.listeners=function listeners(t){var a=o?o+t:t,c=this._events[a];if(!c)return[];if(c.fn)return[c.fn];for(var h=0,m=c.length,v=new Array(m);h<m;h++)v[h]=c[h].fn;return v},EventEmitter.prototype.listenerCount=function listenerCount(t){var a=o?o+t:t,c=this._events[a];return c?c.fn?1:c.length:0},EventEmitter.prototype.emit=function emit(t,a,c,h,m,v){var b=o?o+t:t;if(!this._events[b])return!1;var C,S,M=this._events[b],w=arguments.length;if(M.fn){switch(M.once&&this.removeListener(t,M.fn,void 0,!0),w){case 1:return M.fn.call(M.context),!0;case 2:return M.fn.call(M.context,a),!0;case 3:return M.fn.call(M.context,a,c),!0;case 4:return M.fn.call(M.context,a,c,h),!0;case 5:return M.fn.call(M.context,a,c,h,m),!0;case 6:return M.fn.call(M.context,a,c,h,m,v),!0}for(S=1,C=new Array(w-1);S<w;S++)C[S-1]=arguments[S];M.fn.apply(M.context,C)}else{var I,x=M.length;for(S=0;S<x;S++)switch(M[S].once&&this.removeListener(t,M[S].fn,void 0,!0),w){case 1:M[S].fn.call(M[S].context);break;case 2:M[S].fn.call(M[S].context,a);break;case 3:M[S].fn.call(M[S].context,a,c);break;case 4:M[S].fn.call(M[S].context,a,c,h);break;default:if(!C)for(I=1,C=new Array(w-1);I<w;I++)C[I-1]=arguments[I];M[S].fn.apply(M[S].context,C)}}return!0},EventEmitter.prototype.on=function on(t,a,o){return addListener(this,t,a,o,!1)},EventEmitter.prototype.once=function once(t,a,o){return addListener(this,t,a,o,!0)},EventEmitter.prototype.removeListener=function removeListener(t,a,c,h){var m=o?o+t:t;if(!this._events[m])return this;if(!a)return clearEvent(this,m),this;var v=this._events[m];if(v.fn)v.fn!==a||h&&!v.once||c&&v.context!==c||clearEvent(this,m);else{for(var b=0,C=[],S=v.length;b<S;b++)(v[b].fn!==a||h&&!v[b].once||c&&v[b].context!==c)&&C.push(v[b]);C.length?this._events[m]=1===C.length?C[0]:C:clearEvent(this,m)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(t){var a;return t?(a=o?o+t:t,this._events[a]&&clearEvent(this,a)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=o,EventEmitter.EventEmitter=EventEmitter,t.exports=EventEmitter})),bs=Backoff;function Backoff(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var a=Math.random(),o=Math.floor(a*this.jitter*t);t=0==(1&Math.floor(10*a))?t-o:t+o}return 0|Math.min(t,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(t){this.ms=t},Backoff.prototype.setMax=function(t){this.max=t},Backoff.prototype.setJitter=function(t){this.jitter=t};var Cs="object"==typeof t&&t&&t.Object===Object&&t,Ss="object"==typeof self&&self&&self.Object===Object&&self,Ms=Cs||Ss||Function("return this")(),_s=Ms.Symbol,ws=Object.prototype,Is=ws.hasOwnProperty,xs=ws.toString,Ts=_s?_s.toStringTag:void 0;var ks=function getRawTag(t){var a=Is.call(t,Ts),o=t[Ts];try{t[Ts]=void 0;var c=!0}catch(t){}var h=xs.call(t);return c&&(a?t[Ts]=o:delete t[Ts]),h},Rs=Object.prototype.toString;var qs=function objectToString(t){return Rs.call(t)},Es=_s?_s.toStringTag:void 0;var Ps=function baseGetTag(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Es&&Es in Object(t)?ks(t):qs(t)};var As=function isObject(t){var a=typeof t;return null!=t&&("object"==a||"function"==a)};var Os=function isFunction(t){if(!As(t))return!1;var a=Ps(t);return"[object Function]"==a||"[object GeneratorFunction]"==a||"[object AsyncFunction]"==a||"[object Proxy]"==a},Us={deviceId:"",timeout:8e3},Bs={account:"",appkey:"",token:"",debugLevel:"off",needReconnect:!0,reconnectionAttempts:_i,isAbtestEnable:!0,abtestUrl:"https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo",abtestProjectKey:"imElite_sdk_abtest_web"},js=Ye.includes,Ls=fails((function(){return!Array(1).includes()}));_export({target:"Array",proto:!0,forced:Ls},{includes:function includes(t){return js(this,t,arguments.length>1?arguments[1]:void 0)}});var Ns=entryVirtual("Array").includes,Fs=wellKnownSymbol("match"),Gs=TypeError,notARegexp=function(t){if(function(t){var a;return $(t)&&(void 0!==(a=t[Fs])?!!a:"RegExp"==classofRaw(t))}(t))throw Gs("The method doesn't accept regular expressions");return t},$s=wellKnownSymbol("match"),Ds=T("".indexOf);_export({target:"String",proto:!0,forced:!function(t){var a=/./;try{"/./"[t](a)}catch(o){try{return a[$s]=!1,"/./"[t](a)}catch(t){}}return!1}("includes")},{includes:function includes(t){return!!~Ds(toString$1(requireObjectCoercible(this)),toString$1(notARegexp(t)),arguments.length>1?arguments[1]:void 0)}});var Qs=entryVirtual("String").includes,Ws=Array.prototype,Vs=String.prototype,includes=function(t){var a=t.includes;return t===Ws||Q(Ws,t)&&a===Ws.includes?Ns:"string"==typeof t||t===Vs||Q(Vs,t)&&a===Vs.includes?Qs:a},Ks=wr.findIndex,zs="findIndex",Hs=!0;zs in[]&&Array(1).findIndex((function(){Hs=!1})),_export({target:"Array",proto:!0,forced:Hs},{findIndex:function findIndex(t){return Ks(this,t,arguments.length>1?arguments[1]:void 0)}});var Js=entryVirtual("Array").findIndex,Ys=Array.prototype,findIndex=function(t){var a=t.findIndex;return t===Ys||Q(Ys,t)&&a===Ys.findIndex?Js:a},Xs=createCommonjsModule((function(t){function _getPrototypeOf(a){var o;return t.exports=_getPrototypeOf=ft?bind$1(o=sa).call(o):function _getPrototypeOf(t){return t.__proto__||sa(t)},t.exports.__esModule=!0,t.exports.default=t.exports,_getPrototypeOf(a)}t.exports=_getPrototypeOf,t.exports.__esModule=!0,t.exports.default=t.exports})),Zs=Ye.indexOf,ec=T([].indexOf),tc=!!ec&&1/ec([1],1,-0)<0,rc=arrayMethodIsStrict("indexOf");_export({target:"Array",proto:!0,forced:tc||!rc},{indexOf:function indexOf(t){var a=arguments.length>1?arguments[1]:void 0;return tc?ec(this,t,a)||0:Zs(this,t,a)}});var nc=entryVirtual("Array").indexOf,ac=Array.prototype,indexOf=function(t){var a=t.indexOf;return t===ac||Q(ac,t)&&a===ac.indexOf?nc:a},oc=createCommonjsModule((function(t){t.exports=function _isNativeFunction(t){var a;return-1!==indexOf(a=Function.toString.call(t)).call(a,"[native code]")},t.exports.__esModule=!0,t.exports.default=t.exports})),ic=getBuiltIn("Reflect","construct"),sc=Object.prototype,cc=[].push,lc=fails((function(){function F(){}return!(ic((function(){}),[],F)instanceof F)})),uc=!fails((function(){ic((function(){}))})),dc=lc||uc;_export({target:"Reflect",stat:!0,forced:dc,sham:dc},{construct:function construct(t,a){aConstructor(t),anObject(a);var o=arguments.length<3?t:aConstructor(arguments[2]);if(uc&&!lc)return ic(t,a,o);if(t==o){switch(a.length){case 0:return new t;case 1:return new t(a[0]);case 2:return new t(a[0],a[1]);case 3:return new t(a[0],a[1],a[2]);case 4:return new t(a[0],a[1],a[2],a[3])}var c=[null];return S(cc,c,a),new(S(Ct,t,c))}var h=o.prototype,m=ct($(h)?h:sc),v=S(t,m,a);return $(v)?v:m}});var pc=D.Reflect.construct,hc=createCommonjsModule((function(t){t.exports=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!pc)return!1;if(pc.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(pc(Boolean,[],(function(){}))),!0}catch(t){return!1}},t.exports.__esModule=!0,t.exports.default=t.exports})),fc=createCommonjsModule((function(t){function _construct(a,o,c){var h;hc()?(t.exports=_construct=bind$1(h=pc).call(h),t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=_construct=function _construct(t,a,o){var c=[null];c.push.apply(c,a);var h=new(bind$1(Function).apply(t,c));return o&&_t(h,o.prototype),h},t.exports.__esModule=!0,t.exports.default=t.exports);return _construct.apply(null,arguments)}t.exports=_construct,t.exports.__esModule=!0,t.exports.default=t.exports})),mc=createCommonjsModule((function(t){function _wrapNativeSuper(a){var o="function"==typeof es?new es:void 0;return t.exports=_wrapNativeSuper=function _wrapNativeSuper(t){if(null===t||!oc(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==o){if(o.has(t))return o.get(t);o.set(t,Wrapper)}function Wrapper(){return fc(t,arguments,Xs(this).constructor)}return Wrapper.prototype=ut(t.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_t(Wrapper,t)},t.exports.__esModule=!0,t.exports.default=t.exports,_wrapNativeSuper(a)}t.exports=_wrapNativeSuper,t.exports.__esModule=!0,t.exports.default=t.exports})),vc=function(t){function CustomError(a,o,c){var h;return void 0===o&&(o={}),void 0===c&&(c=400),(h=t.call(this,a)||this).data=o,h.code=c,h.name="customError",h}return wt(CustomError,t),CustomError}(getDefaultExportFromCjs(mc)(Error)),gc=function(t){function ValidateError(a,o,c){var h;return void 0===o&&(o={}),(h=t.call(this,a,o,414)||this).code=414,h.name="validateError",h.rules=c,h}return wt(ValidateError,t),ValidateError}(vc),yc={200:null,406:null,808:null,810:null,201:"The client version is incorrect. You need to upgrade the SDK",302:"The user name or password is incorrect. Please check whether the appkey and token are valid and whether the account and token match",403:"Illegal operation or no permission",404:"Target object does not exist",405:"Parameter length too long",408:"Client request timed out",414:"Request parameter error",415:"Service unavailable",416:"Frequency control",417:"Repeat operation",422:"Account disabled",500:"Server internal error",503:"Server busy",508:"Expiration date",509:"Invalid",7101:"Be pulled black",700:"Partial failure of batch operation",801:"The number of people in the team has reached the upper limit",802:"No permission",803:"The team does not exist or has not changed",804:"The user is not in the team",805:"Team type mismatch",806:"The number of teams created has reached the limit",807:"Team member not valid",809:"Already in the team",811:"The number of accounts in the forced push list exceeds the limit",812:"The team is muted",813:"Due to the limited number of team, some pull people successfully",814:"Disable team message read service",815:"Maximum number of team administrators",816:"Batch operation partial failure",997:"The packet has expired",998:"Deserialize packet error",999:"Serialize packet error",9102:"Channel failure",9103:"This call has been answered / rejected at another end",10201:"Signaling: target NIM client is offline",10202:"Signaling: push is unreachable",10404:"Signaling: channel not exists",10405:"Signaling: channel already exists",10406:"Signaling: member of channel not exists",10407:"Signaling: member of channel already exists",10408:"Signaling: the invitation request does not exist or has expired",10409:"Signaling: the invitation request has been rejected",10410:"Signaling: the invitation request has been accepted",10414:"Signaling: request parameter error",10417:"Signaling: uid conflict",10419:"Signaling: the number of members of channel exceed the limit",10420:"Signaling: member is already in the channel on other client",10700:"Signaling: phased success",13002:"Abnormal chatroom status",13003:"In the blacklist",13004:"In the mute list",13006:"All members are muted, and only the administrator can speak"},bc=function(t){function CmdError(a,o,c,h,m){var v;return void 0===c&&(c=""),void 0===h&&(h=(new Date).getTime()),void 0===m&&(m={}),c=c||yc[a],(v=t.call(this,c,m,a)||this).name="cmdError",v.cmd=o,v.timetag=h,v}return wt(CmdError,t),CmdError}(vc);var Cc=function(t){function FormatError(a,o,c){var h;return(h=t.call(this,a,{},412)||this).code=412,h.name="formatError",h.key=o,h.reason=c,h}return wt(FormatError,t),FormatError}(vc),Sc=function(t){function UploadError(a,o,c,h,m){var v;return(v=t.call(this,a,{file:m},400)||this).name="uploadError",v.rawError=o,v.curProvider=c||1,v.mixStorePolicy=h,v}return wt(UploadError,t),UploadError}(vc),Mc=["error","warn","log","debug"],_c=function emptyFunc(){},wc=["off","error","warn","log","debug"],Ic=function(){function Logger(t,a){this.name=a,this.strategies={debug:console.log,log:console.log,warn:console.warn,error:console.error},this.debug=_c,this.log=_c,this.warn=_c,this.error=_c,this.name=a,Logger.instancesName.push(a),includes(wc).call(wc,t)||(t="off"),this.setLogFunc(t)}var t=Logger.prototype;return t.setLogFunc=function setLogFunc(t){var a=this,o=findIndex(Mc).call(Mc,(function(a){return a===t}));forEach$1(Mc).call(Mc,(function(t,c){c<=o&&(a[t]=function(){var a=slice(Array.prototype).call(arguments),o=this.formatArgs(a,t);this.strategies[t](o)})}))},t.formatArgs=function formatArgs(t,a){var o=new Date,c=o.getMonth()+1+"-"+o.getDate()+" "+o.getHours()+":"+o.getMinutes()+":"+o.getSeconds()+":"+o.getMilliseconds();return"[NIM "+a+" "+this.name+" "+c+"] "+map(t).call(t,(function(t){return t instanceof vc?t.name+", "+t.code+", "+t.message:t instanceof Error?t&&t.message?t.message:t:"object"==typeof t?us(t):t})).join(" ")},Logger}();Ic.instancesName=[];var xc=createCommonjsModule((function(t,a){t.exports=function(){function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,a){for(var o=0;o<a.length;o++){var c=a[o];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}function _createClass(t,a,o){return a&&_defineProperties(t.prototype,a),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function __rest(t,a){var o={};for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&a.indexOf(c)<0&&(o[c]=t[c]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var h=0;for(c=Object.getOwnPropertySymbols(t);h<c.length;h++)a.indexOf(c[h])<0&&Object.prototype.propertyIsEnumerable.call(t,c[h])&&(o[c[h]]=t[c[h]])}return o}var t={reportUrl:"https://statistic.live.126.net/statics/report/common/form",maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,maxInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0},a="https://statistic.live.126.net/dispatcher/req",o=function emptyFn(){},c=function(){function Reporter(a){_classCallCheck(this,Reporter),this.enable=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=t,this.msgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=Date.now(),this.timer=null,this.setConfig(a),this.reportConfig.autoStart&&this.initUploadConfig()}return _createClass(Reporter,[{key:"setConfig",value:function setConfig(t){this.reportConfig=Object.assign({},this.reportConfig,t)}},{key:"reportImmediately",value:function reportImmediately(t,a){var o=this;this.reportConfig.request(t,Object.assign({dataType:"json",method:"POST",timeout:this.reportConfig.timeout},a)).catch((function(t){var a,c;null===(c=null===(a=o.reportConfig)||void 0===a?void 0:a.logger)||void 0===c||c.warn("Reporter immediately upload failed",t)}))}},{key:"report",value:function report(t,a){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t){var c=Date.now();o?this.lowPriorityMsgList.push({module:t,msg:a,createTime:c}):this.msgList.push({module:t,msg:a,createTime:c}),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function reportTraceStart(t,a){if(t&&!this.traceMsgCache[t]){var o=Object.assign(Object.assign({start_time:Date.now()},a),{extension:[]});this.traceMsgCache[t]=o}}},{key:"reportTraceUpdate",value:function reportTraceUpdate(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.traceMsgCache[t]){var c,h=a.operation_type,m=a.code,v=a.target,b=a.error,C=__rest(a,["operation_type","code","target","error"]),S=Date.now(),M=this.traceMsgCache[t].extension.length;c=0===M?this.traceMsgCache[t].start_time:this.traceMsgCache[t].extension[M-1].end_time,b&&b.code&&(m=b.code),this.traceMsgCache[t].extension.push({operation_type:h,code:m,succeed:o,target:v,duration:S-c,description:JSON.stringify(C),end_time:S})}}},{key:"reportTraceUpdateV2",value:function reportTraceUpdateV2(t,a){if(this.traceMsgCache[t]){var o=this.traceMsgCache[t].extension.length;a.end_time=0===o?this.traceMsgCache[t].start_time+(a.duration?a.duration:0):this.traceMsgCache[t].extension[o-1].end_time+(a.duration?a.duration:0),this.traceMsgCache[t].extension.push(a)}}},{key:"reportTraceEnd",value:function reportTraceEnd(t){var a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.traceMsgCache[t]&&("nos"!==t||!1===a?("boolean"==typeof a?this.traceMsgCache[t].succeed=!!a:this.traceMsgCache[t].state=a,this.traceMsgCache[t].duration=Date.now()-this.traceMsgCache[t].start_time,this.traceMsgCache[t].extension.forEach((function(t){delete t.end_time})),this.report(t,this.traceMsgCache[t]),this.traceMsgCache[t]=null):this.traceMsgCache[t]=null)}},{key:"pause",value:function pause(){this.enable=!1}},{key:"restore",value:function restore(){this.enable=!0,this.initConfigLoaded||this.initUploadConfig()}},{key:"destroy",value:function destroy(){var t=this;Object.keys(this.traceMsgCache).forEach((function(a){t.reportTraceEnd(a,1)})),null!==this.timer&&clearTimeout(this.timer),this.setConfig=o,this.report=o,this.reportTraceStart=o,this.reportTraceUpdate=o,this.reportTraceEnd=o,this.pause=o,this.restore=o,this.destroy=o,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.reportConfig={},this.isDestroyed=!0}},{key:"initUploadConfig",value:function initUploadConfig(){var t,o,c=this;if(!this.loading){this.loading=!0;var h=this.reportConfig.common||{};try{this.reportConfig.request(a,{method:"GET",dataType:"json",params:{deviceId:h.dev_id,sdkVer:h.sdk_ver,platform:h.platform,appkey:h.app_key},timeout:this.reportConfig.timeout}).then((function(t){var a,o;if(!c.isDestroyed){if(200===t.status&&t.data&&200===t.data.code){var h=t.data.data||{};c.reportConfig.maxSize=h.maxSize>1e3?1e3:h.maxSize,c.reportConfig.maxInterval=h.maxInterval>1e4?1e4:h.maxInterval,c.reportConfig.maxInterval=h.maxInterval<10?10:h.maxInterval,c.reportConfig.minInterval=h.minInterval<2?2:h.minInterval,c.reportConfig.maxDelay=h.maxDelay||300,c.reportConfig.maxInterval=1e3*c.reportConfig.maxInterval,c.reportConfig.minInterval=1e3*c.reportConfig.minInterval,c.reportConfig.maxDelay=1e3*c.reportConfig.maxDelay,c.enable=!0,c.initConfigLoaded=!0,c.loading=!1,c.reportHeartBeat()}null===(o=null===(a=c.reportConfig)||void 0===a?void 0:a.logger)||void 0===o||o.log("Get reporter upload config success")}})).catch((function(t){var a,o;c.loading=!1,null===(o=null===(a=c.reportConfig)||void 0===a?void 0:a.logger)||void 0===o||o.error("Get reporter upload config failed",t)}))}catch(a){this.loading=!1,null===(o=null===(t=this.reportConfig)||void 0===t?void 0:t.logger)||void 0===o||o.error("Exec reporter request failed",a)}}}},{key:"reportHeartBeat",value:function reportHeartBeat(){var t=this;this.isDestroyed||(this.timer=setTimeout((function(){t.reportHeartBeat()}),this.reportConfig.minInterval),this.doReport())}},{key:"doReport",value:function doReport(){if(!this.isDestroyed){var t=this.msgList.length+this.lowPriorityMsgList.length+this.cacheMsgList.length>2*this.reportConfig.maxSize?this.reportConfig.minInterval:this.reportConfig.maxInterval;Date.now()-this.lastReportTime>=t&&this.upload()}}},{key:"getUploadMsg",value:function getUploadMsg(){var t=this,a={},o=Date.now();this.msgList=this.msgList.filter((function(a){return o-a.createTime<t.reportConfig.maxDelay})),this.lowPriorityMsgList=this.lowPriorityMsgList.filter((function(a){return o-a.createTime<t.reportConfig.maxDelay})),this.cacheMsgList=this.cacheMsgList.filter((function(a){return o-a.createTime<t.reportConfig.maxDelay}));var c=this.msgList.slice(0,this.reportConfig.maxSize);if(this.msgList=this.msgList.slice(c.length),c.length<this.reportConfig.maxSize){var h=this.reportConfig.maxSize-c.length;c=c.concat(this.lowPriorityMsgList.slice(0,h)),this.lowPriorityMsgList=this.lowPriorityMsgList.slice(h)}if(c.length<this.reportConfig.maxSize){var m=this.reportConfig.maxSize-c.length;c=c.concat(this.cacheMsgList.slice(0,m)),this.cacheMsgList=this.cacheMsgList.slice(m)}return c.forEach((function(t){a[t.module]?a[t.module].push(t.msg):a[t.module]=[t.msg]})),{uploadMsgArr:c,uploadMsg:a}}},{key:"upload",value:function upload(){var t,a,o=this;if(this.enable&&!(this.lastReportTime&&Date.now()-this.lastReportTime<this.reportConfig.minInterval)){var c=this.getUploadMsg(),h=c.uploadMsgArr,m=c.uploadMsg;if(h.length){this.lastReportTime=Date.now();try{this.reportConfig.request(this.reportConfig.reportUrl,{dataType:"json",method:"POST",params:{common:this.reportConfig.common,event:m},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch((function(t){var a,c;o.cacheMsgList=o.cacheMsgList.concat(h).slice(0,o.reportConfig.cacheMaxSize),null===(c=null===(a=o.reportConfig)||void 0===a?void 0:a.logger)||void 0===c||c.warn("Reporter upload failed",t)}))}catch(o){null===(a=null===(t=this.reportConfig)||void 0===t?void 0:t.logger)||void 0===a||a.warn("Exec reporter request failed",o)}clearTimeout(this.timer),this.reportHeartBeat()}}}}]),Reporter}();return c}()})),Tc={setLogger:function setLogger(t){throw new Error("Function not implemented.")},platform:"",WebSocket:function(){function AdapterSocket(t,a){throw this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,new Error("Method not implemented.")}var t=AdapterSocket.prototype;return t.close=function close(t,a){throw new Error("Method not implemented.")},t.send=function send(t){throw new Error("Method not implemented.")},t.onclose=function onclose(t){throw new Error("Method not implemented.")},t.onerror=function onerror(t){throw new Error("Method not implemented.")},t.onmessage=function onmessage(t){throw new Error("Method not implemented.")},t.onopen=function onopen(t){throw new Error("Method not implemented.")},AdapterSocket}(),localStorage:{},request:function request(t,a){throw new Error("Function not implemented.")},uploadFile:function uploadFile(t){throw new Error("Function not implemented.")},getSystemInfo:function getSystemInfo(){throw new Error("Function not implemented.")}};var kc=TypeError,createMethod$1=function(t){return function(a,o,c,h){aCallable(o);var m=toObject(a),v=L(m),b=lengthOfArrayLike(m),C=t?b-1:0,S=t?-1:1;if(c<2)for(;;){if(C in v){h=v[C],C+=S;break}if(C+=S,t?C<0:b<=C)throw kc("Reduce of empty array with no initial value")}for(;t?C>=0:b>C;C+=S)C in v&&(h=o(h,v[C],C,m));return h}},Rc={left:createMethod$1(!1),right:createMethod$1(!0)}.left,qc=arrayMethodIsStrict("reduce");_export({target:"Array",proto:!0,forced:!qc||!Ba&&Y>79&&Y<83},{reduce:function reduce(t){var a=arguments.length;return Rc(this,t,a,a>1?arguments[1]:void 0)}});var Ec=entryVirtual("Array").reduce,Pc=Array.prototype,reduce=function(t){var a=t.reduce;return t===Pc||Q(Pc,t)&&a===Pc.reduce?Ec:a},Ac=fails((function(){rt(1)}));_export({target:"Object",stat:!0,forced:Ac},{keys:function keys(t){return rt(toObject(t))}});var Oc=D.Object.keys;var Uc=function isUndefined(t){return void 0===t},Bc={},jc={};function parseCmd(t,a){var o,c,h;try{h=JSON.parse(t)}catch(o){throw a.error("Parse command error: ",t),o}var m=h.sid+"_"+h.cid,v=h.r;if(includes(o=["4_1","4_2","4_10","4_11"]).call(o,m)){var b=h.r[1].headerPacket;m=b.sid+"_"+b.cid,v=h.r[1].body}var C,S=jc[m],M=Bc[S],w=function genCmdError(t,a){var o=yc[t];return null===o?null:new bc(t,a,o,(new Date).getTime())}(h.code,S),I={cmd:S,raw:h,error:w,service:null==M?void 0:M.service,content:{}};if(I.error){if(I.error.cmd=S,I.error.callFunc="parseCmd",!(null===(c=null==M?void 0:M.ignoreErrCodes)||void 0===c?void 0:includes(c).call(c,h.code)))return I;a.warn("parseCmd:: ignore error ",I.error),I.error.ignore=!0}if(!S||!M)return I.notFound=!0,I;M.response&&forEach$1(C=M.response).call(C,(function(t,a){var o=v[a],c=t.type,h=t.name,m=t.reflectMapper;if(!Uc(o))switch(c){case"Property":I.content[h]=m?deserialize(o,m):o;break;case"PropertyArray":I.content[h]=map(o).call(o,(function(t){return m?deserialize(t,m):t}));break;case"long":case"Long":case"byte":case"Byte":case"Number":I.content[h]=+o;break;default:I.content[h]=o}}));return I}function serialize(t,a){var o={};for(var c in t)void 0!==a[c]&&(o[a[c]]=t[c]);return o}function deserialize(t,a){var o={};for(var c in t)void 0!==a[c]&&(o[a[c]]=t[c]);return o}function registerParser(t){Bc=ki(Bc,t.cmdConfig),jc=ki(jc,t.cmdMap)}function invertSerializeMap(t){var a;return reduce(a=Oc(t)).call(a,(function(a,o){var c,h=t[o];return a[o]=reduce(c=Oc(h)).call(c,(function(t,a){return t[h[a]]=a,t}),{}),a}),{})}var Lc=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],Nc=["transport not supported","client not handshaken","unauthorized"],Fc=["reconnect"],Gc=function(t){function NIMWebsocket(a,o,c){var h;return(h=t.call(this)||this).url=o,h.logger=c,h.websocket=null,h.core=a,h.url=o,h.status="disconnected",h.logger=c,h.connect(),h}wt(NIMWebsocket,t);var a=NIMWebsocket.prototype;return a.connect=function connect(){var t=this;"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this.core.adapters.request("https://"+this.url+"/socket.io/1/?t="+hs(),{method:"GET",dataType:"text",timeout:8e3}).then((function(a){var o=a.data.split(":"),c=o[0],h=o[1];return t.sessionId=c,t.closeTimeout=1e3*h,t._createWebsocket("wss://"+t.url+"/socket.io/1/websocket/"+c)})).catch((function(a){t.logger.error("imsocket::handshake fail. ",a&&a.message),t.status="disconnected",t.emit("handshakeFailed")}))):this.logger.warn("imsocket::socket is connecting or connected",this.status)},a.close=function close(){var t;if(this.websocket){this.status="disconnected",this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null;try{null===(t=this.websocket)||void 0===t||t.send(this.encodePacket({type:"disconnect"})),this.websocket.close()}catch(t){this.logger.warn("attempt to close websocket error",t)}this.websocket.onclose=null,this.websocket=null,this.emit("disconnect")}},a.onConnect=function onConnect(){this.status="connected",this.resetCloseTimer(),this.emit("connect")},a._createWebsocket=function _createWebsocket(t){var a,o=this;this.websocket=new Tc.WebSocket(t),this.websocket.onmessage=bind$1(a=this.onMessage).call(a,this),this.websocket.onclose=function(){o.logger.log("imsocket:: websocket onclose done"),"disconnected"!==o.status&&(o.logger.log("imsocket:: close()",o.status),o.close())},this.websocket.onerror=function(t){o.logger.error("imsocket:: onerror",t)}},a.onMessage=function onMessage(t){var a;this.resetCloseTimer();var o=this.decodePacket(t.data);if(o)switch(o.type){case"connect":this.onConnect();break;case"disconnect":this.close();break;case"message":case"json":this.emit("message",o.data);break;case"event":o.name&&this.emit(o.name,o.args);break;case"error":"unauthorized"===o.reason?this.emit("connect_failed",o.reason):this.emit("error",o.reason);break;case"heartbeat":null===(a=this.websocket)||void 0===a||a.send(this.encodePacket({type:"heartbeat"}));break;default:this.logger.warn("imsocket::no handler type",o.type)}},a.encodePacket=function encodePacket(t){var a,o,c=t.type,h=t.id,m=void 0===h?"":h,v=t.endpoint,b=void 0===v?"":v,C=t.ack,S=null;if(!c)return"";switch(c){case"error":a=t.reason?indexOf(Nc).call(Nc,t.reason):"",o=t.advice?indexOf(Fc).call(Fc,t.advice):"",""===a&&""===o||(S=a+(""!==o?"+"+o:""));break;case"message":""!==t.data&&(S=t.data);break;case"event":a={name:t.name},a=t.args&&t.args.length?{name:t.name,args:t.args}:{name:t.name},S=us(a);break;case"json":S=us(t.data);break;case"connect":t.qs&&(S=t.qs);break;case"ack":S=t.ackId+(t.args&&t.args.length?"+"+us(t.args):"")}var M=[indexOf(Lc).call(Lc,c),m+("data"===C?"+":""),b];return null!=S&&M.push(S),M.join(":")},a.decodePacket=function decodePacket(t){if(t)if("�"!=t.charAt(0)){var a=t.match(/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);if(a){var o,c=a[1],h=a[2],m=a[3],v=a[4],b=a[5],C={type:Lc[+c],endpoint:v};switch(h&&(C.id=h,C.ack=!m||"data"),C.type){case"error":o=b.split("+"),C.reason=Nc[+o[0]]||"";break;case"message":C.data=b||"";break;case"connect":C.qs=b||"";break;case"event":try{var S=JSON.parse(b);C.name=S.name,C.args=S.args}catch(t){this.logger.error("imsocket::parseData::type::event error",t)}C.args=C.args||[];break;case"json":try{C.data=JSON.parse(b)}catch(t){this.logger.error("imsocket::parseData::type::json error",t)}break;case"ack":if((o=b.match(/^([0-9]+)(\+)?(.*)/))&&(C.ackId=o[1],C.args=[],o[3]))try{C.args=o[3]?JSON.parse(o[3]):[]}catch(t){this.logger.error("imsocket::parseData::type::ack error",t)}}return C}}else this.logger.error("imsocket::unrecognize dataStr",slice(t).call(t,0,20))},a.send=function send(t){var a,o={data:t,type:"message",endpoint:""};null===(a=this.websocket)||void 0===a||a.send(this.encodePacket(o))},a.resetCloseTimer=function resetCloseTimer(){var t=this;this.closeTimeout&&(clearTimeout(this.closeTimer),this.closeTimer=cs((function(){t.close()}),this.closeTimeout))},NIMWebsocket}(ys),$c=entryVirtual("Array").values,Dc=Array.prototype,Qc={DOMTokenList:!0,NodeList:!0},values=function(t){var a=t.values;return t===Dc||Q(Dc,t)&&a===Dc.values||de(Qc,Pt(t))?$c:a};_export({target:"Array",stat:!0},{isArray:It});var Wc=D.Array.isArray,Vc=wr.every,Kc=arrayMethodIsStrict("every");_export({target:"Array",proto:!0,forced:!Kc},{every:function every(t){return Vc(this,t,arguments.length>1?arguments[1]:void 0)}});var zc=entryVirtual("Array").every,Hc=Array.prototype,every=function(t){var a=t.every;return t===Hc||Q(Hc,t)&&a===Hc.every?zc:a};var Jc=function isObjectLike(t){return null!=t&&"object"==typeof t};var Yc=function baseIsRegExp(t){return Jc(t)&&"[object RegExp]"==Ps(t)};var Xc=function baseUnary(t){return function(a){return t(a)}},Zc=createCommonjsModule((function(t,a){var o=a&&!a.nodeType&&a,c=o&&t&&!t.nodeType&&t,h=c&&c.exports===o&&Cs.process,m=function(){try{var t=c&&c.require&&c.require("util").types;return t||h&&h.binding&&h.binding("util")}catch(t){}}();t.exports=m})),el=Zc&&Zc.isRegExp,tl=el?Xc(el):Yc,rl=Ms["__core-js_shared__"],nl=function(){var t=/[^.]+$/.exec(rl&&rl.keys&&rl.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();var al=function isMasked(t){return!!nl&&nl in t},ol=Function.prototype.toString;var il=function toSource(t){if(null!=t){try{return ol.call(t)}catch(t){}try{return t+""}catch(t){}}return""},sl=/^\[object .+?Constructor\]$/,cl=Function.prototype,ll=Object.prototype,ul=cl.toString,dl=ll.hasOwnProperty,pl=RegExp("^"+ul.call(dl).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var hl=function baseIsNative(t){return!(!As(t)||al(t))&&(Os(t)?pl:sl).test(il(t))};var fl=function getValue(t,a){return null==t?void 0:t[a]};var ml=function getNative(t,a){var o=fl(t,a);return hl(o)?o:void 0},vl=ml(Object,"create");var gl=function hashClear(){this.__data__=vl?vl(null):{},this.size=0};var yl=function hashDelete(t){var a=this.has(t)&&delete this.__data__[t];return this.size-=a?1:0,a},bl=Object.prototype.hasOwnProperty;var Cl=function hashGet(t){var a=this.__data__;if(vl){var o=a[t];return"__lodash_hash_undefined__"===o?void 0:o}return bl.call(a,t)?a[t]:void 0},Sl=Object.prototype.hasOwnProperty;var Ml=function hashHas(t){var a=this.__data__;return vl?void 0!==a[t]:Sl.call(a,t)};var _l=function hashSet(t,a){var o=this.__data__;return this.size+=this.has(t)?0:1,o[t]=vl&&void 0===a?"__lodash_hash_undefined__":a,this};function Hash(t){var a=-1,o=null==t?0:t.length;for(this.clear();++a<o;){var c=t[a];this.set(c[0],c[1])}}Hash.prototype.clear=gl,Hash.prototype.delete=yl,Hash.prototype.get=Cl,Hash.prototype.has=Ml,Hash.prototype.set=_l;var wl=Hash;var Il=function listCacheClear(){this.__data__=[],this.size=0};var xl=function eq(t,a){return t===a||t!=t&&a!=a};var Tl=function assocIndexOf(t,a){for(var o=t.length;o--;)if(xl(t[o][0],a))return o;return-1},kl=Array.prototype.splice;var Rl=function listCacheDelete(t){var a=this.__data__,o=Tl(a,t);return!(o<0)&&(o==a.length-1?a.pop():kl.call(a,o,1),--this.size,!0)};var ql=function listCacheGet(t){var a=this.__data__,o=Tl(a,t);return o<0?void 0:a[o][1]};var El=function listCacheHas(t){return Tl(this.__data__,t)>-1};var Pl=function listCacheSet(t,a){var o=this.__data__,c=Tl(o,t);return c<0?(++this.size,o.push([t,a])):o[c][1]=a,this};function ListCache(t){var a=-1,o=null==t?0:t.length;for(this.clear();++a<o;){var c=t[a];this.set(c[0],c[1])}}ListCache.prototype.clear=Il,ListCache.prototype.delete=Rl,ListCache.prototype.get=ql,ListCache.prototype.has=El,ListCache.prototype.set=Pl;var Al=ListCache,Ol=ml(Ms,"Map");var Ul=function mapCacheClear(){this.size=0,this.__data__={hash:new wl,map:new(Ol||Al),string:new wl}};var Bl=function isKeyable(t){var a=typeof t;return"string"==a||"number"==a||"symbol"==a||"boolean"==a?"__proto__"!==t:null===t};var jl=function getMapData(t,a){var o=t.__data__;return Bl(a)?o["string"==typeof a?"string":"hash"]:o.map};var Ll=function mapCacheDelete(t){var a=jl(this,t).delete(t);return this.size-=a?1:0,a};var Nl=function mapCacheGet(t){return jl(this,t).get(t)};var Fl=function mapCacheHas(t){return jl(this,t).has(t)};var Gl=function mapCacheSet(t,a){var o=jl(this,t),c=o.size;return o.set(t,a),this.size+=o.size==c?0:1,this};function MapCache(t){var a=-1,o=null==t?0:t.length;for(this.clear();++a<o;){var c=t[a];this.set(c[0],c[1])}}MapCache.prototype.clear=Ul,MapCache.prototype.delete=Ll,MapCache.prototype.get=Nl,MapCache.prototype.has=Fl,MapCache.prototype.set=Gl;var $l=MapCache;var Dl=function setCacheAdd(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var Ql=function setCacheHas(t){return this.__data__.has(t)};function SetCache(t){var a=-1,o=null==t?0:t.length;for(this.__data__=new $l;++a<o;)this.add(t[a])}SetCache.prototype.add=SetCache.prototype.push=Dl,SetCache.prototype.has=Ql;var Wl=SetCache;var Vl=function baseFindIndex(t,a,o,c){for(var h=t.length,m=o+(c?1:-1);c?m--:++m<h;)if(a(t[m],m,t))return m;return-1};var Kl=function baseIsNaN(t){return t!=t};var zl=function strictIndexOf(t,a,o){for(var c=o-1,h=t.length;++c<h;)if(t[c]===a)return c;return-1};var Hl=function baseIndexOf(t,a,o){return a==a?zl(t,a,o):Vl(t,Kl,o)};var Jl=function arrayIncludes(t,a){return!!(null==t?0:t.length)&&Hl(t,a,0)>-1};var Yl=function arrayIncludesWith(t,a,o){for(var c=-1,h=null==t?0:t.length;++c<h;)if(o(a,t[c]))return!0;return!1};var Xl=function arrayMap(t,a){for(var o=-1,c=null==t?0:t.length,h=Array(c);++o<c;)h[o]=a(t[o],o,t);return h};var Zl=function cacheHas(t,a){return t.has(a)};var eu=function baseDifference(t,a,o,c){var h=-1,m=Jl,v=!0,b=t.length,C=[],S=a.length;if(!b)return C;o&&(a=Xl(a,Xc(o))),c?(m=Yl,v=!1):a.length>=200&&(m=Zl,v=!1,a=new Wl(a));e:for(;++h<b;){var M=t[h],w=null==o?M:o(M);if(M=c||0!==M?M:0,v&&w==w){for(var I=S;I--;)if(a[I]===w)continue e;C.push(M)}else m(a,w,c)||C.push(M)}return C};var tu=function identity(t){return t};var ru=function apply(t,a,o){switch(o.length){case 0:return t.call(a);case 1:return t.call(a,o[0]);case 2:return t.call(a,o[0],o[1]);case 3:return t.call(a,o[0],o[1],o[2])}return t.apply(a,o)},nu=Math.max;var au=function overRest(t,a,o){return a=nu(void 0===a?t.length-1:a,0),function(){for(var c=arguments,h=-1,m=nu(c.length-a,0),v=Array(m);++h<m;)v[h]=c[a+h];h=-1;for(var b=Array(a+1);++h<a;)b[h]=c[h];return b[a]=o(v),ru(t,this,b)}};var ou=function constant(t){return function(){return t}},iu=function(){try{var t=ml(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),su=iu?function(t,a){return iu(t,"toString",{configurable:!0,enumerable:!1,value:ou(a),writable:!0})}:tu,cu=Date.now;var lu=function shortOut(t){var a=0,o=0;return function(){var c=cu(),h=16-(c-o);if(o=c,h>0){if(++a>=800)return arguments[0]}else a=0;return t.apply(void 0,arguments)}},uu=lu(su);var du=function baseRest(t,a){return uu(au(t,a,tu),t+"")};var pu=function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991};var hu=function isArrayLike(t){return null!=t&&pu(t.length)&&!Os(t)};var fu=function isArrayLikeObject(t){return Jc(t)&&hu(t)},mu=du((function(t,a){return fu(t)?eu(t,a):[]})),vu=mu;function replacer(t,a){return a instanceof RegExp?"__REGEXP "+a.toString():a}function validate(t,a,o){var c;void 0===a&&(a={});var h={};return forEach$1(c=Oc(t)).call(c,(function(c){var m=t[c].type,v=o?"In "+o+", ":"";if(void 0===a[c]){if(!1===t[c].required)return void(h[c]=a[c]);throw new gc(v+'param "'+c+'" is required',{key:c},"required")}var b=gu[m];if(b&&!b(a,c,t[c]))throw new gc(v+'param "'+c+'" expects '+us(t[c],replacer),{key:c,value:a[c]},us(t[c]));h[c]=a[c]})),h}var gu={string:function string(t,a,o){var c=o.allowEmpty,h=o.max,m=o.min,v=o.regExp,b=t[a];return"string"==typeof b&&((!1!==c||""!==b)&&(!("number"==typeof h&&b.length>h)&&(!("number"==typeof m&&b.length<m)&&!(tl(v)&&!v.test(b)))))},number:function number(t,a,o){var c=o.min,h=o.max,m=t[a];return"number"==typeof m&&(!("number"==typeof c&&m<c)&&!("number"==typeof h&&m>h))},boolean:function boolean(t,a){return"boolean"==typeof t[a]},enum:function _enum(t,a,o){var c=values(o),h=t[a];return!c||indexOf(c).call(c,h)>-1},array:function array(t,a,o){var c,h=o.itemType,m=o.rules,v=o.min,b=o.max,C=values(o),S=t[a];return!!Wc(S)&&(!("number"==typeof b&&S.length>b)&&(!("number"==typeof v&&S.length<v)&&(!(h&&"enum"!==h&&!every(S).call(S,(function(t){return typeof t===h})))&&(("enum"!==h||!C||!vu.apply(void 0,concat(c=[S]).call(c,C)).length)&&(m&&forEach$1(S).call(S,(function(t,o){return validate(m,t,a+"["+o+"]")})),!0)))))},object:function object(t,a,o){var c=o.rules,h=t[a];return c&&validate(c,h,a),!0}},yu=ml(Ms,"Set");var bu=function noop(){};var Cu=function setToArray(t){var a=-1,o=Array(t.size);return t.forEach((function(t){o[++a]=t})),o},Su=yu&&1/Cu(new yu([,-0]))[1]==1/0?function(t){return new yu(t)}:bu,Mu=Su;var _u=function baseUniq(t,a,o){var c=-1,h=Jl,m=t.length,v=!0,b=[],C=b;if(o)v=!1,h=Yl;else if(m>=200){var S=a?null:Mu(t);if(S)return Cu(S);v=!1,h=Zl,C=new Wl}else C=a?[]:b;e:for(;++c<m;){var M=t[c],w=a?a(M):M;if(M=o||0!==M?M:0,v&&w==w){for(var I=C.length;I--;)if(C[I]===w)continue e;a&&C.push(w),b.push(M)}else h(C,w,o)||(C!==b&&C.push(w),b.push(M))}return b};var wu=function uniq(t){return t&&t.length?_u(t):[]},Iu=wr.filter,xu=arrayMethodHasSpeciesSupport("filter");_export({target:"Array",proto:!0,forced:!xu},{filter:function filter(t){return Iu(this,t,arguments.length>1?arguments[1]:void 0)}});var Tu=entryVirtual("Array").filter,ku=Array.prototype,filter=function(t){var a=t.filter;return t===ku||Q(ku,t)&&a===ku.filter?Tu:a},Ru="\t\n\v\f\r                　\u2028\u2029\ufeff",qu=T("".replace),Eu="["+Ru+"]",Pu=RegExp("^"+Eu+Eu+"*"),Au=RegExp(Eu+Eu+"*$"),createMethod=function(t){return function(a){var o=toString$1(requireObjectCoercible(a));return 1&t&&(o=qu(o,Pu,"")),2&t&&(o=qu(o,Au,"")),o}},Ou={start:createMethod(1),end:createMethod(2),trim:createMethod(3)}.trim,Uu=h.parseInt,Bu=h.Symbol,ju=Bu&&Bu.iterator,Lu=/^[+-]?0x/i,Nu=T(Lu.exec),Fu=8!==Uu(Ru+"08")||22!==Uu(Ru+"0x16")||ju&&!fails((function(){Uu(Object(ju))}))?function parseInt(t,a){var o=Ou(toString$1(t));return Uu(o,a>>>0||(Nu(Lu,o)?16:10))}:Uu;_export({global:!0,forced:parseInt!=Fu},{parseInt:Fu});var Gu,$u=D.parseInt,Du=(Gu=function _s4(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return Gu()+Gu()+Gu()+Gu()+Gu()+Gu()+Gu()+Gu()});function getEnumKeys(t){var a;return filter(a=Oc(t)).call(a,(function(t){return!(+t>=0)}))}function getEnumKeyByEnumValue(t,a){var o,c=filter(o=Oc(t)).call(o,(function(o){return t[o]==a}));return c.length>0?c[0]:void 0}var Qu=TypeError,Wu=Object.getOwnPropertyDescriptor,Vu=k&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,a){if(It(t)&&!Wu(t,"length").writable)throw Qu("Cannot set read only .length");return t.length=a}:function(t,a){return t.length=a},Ku=TypeError,deletePropertyOrThrow=function(t,a){if(!delete t[a])throw Ku("Cannot delete property "+tryToString(a)+" of "+tryToString(t))},zu=arrayMethodHasSpeciesSupport("splice"),Hu=Math.max,Ju=Math.min;_export({target:"Array",proto:!0,forced:!zu},{splice:function splice(t,a){var o,c,h,m,v,b,C=toObject(this),S=lengthOfArrayLike(C),M=toAbsoluteIndex(t,S),w=arguments.length;for(0===w?o=c=0:1===w?(o=0,c=S-M):(o=w-2,c=Ju(Hu(toIntegerOrInfinity(a),0),S-M)),doesNotExceedSafeInteger(S+o-c),h=arraySpeciesCreate(C,c),m=0;m<c;m++)(v=M+m)in C&&createProperty(h,m,C[v]);if(h.length=c,o<c){for(m=M;m<S-c;m++)b=m+o,(v=m+c)in C?C[b]=C[v]:deletePropertyOrThrow(C,b);for(m=S;m>S-c+o;m--)deletePropertyOrThrow(C,m-1)}else if(o>c)for(m=S-c;m>M;m--)b=m+o-1,(v=m+c-1)in C?C[b]=C[v]:deletePropertyOrThrow(C,b);for(m=0;m<o;m++)C[m+M]=arguments[m+2];return Vu(C,S-c+o),h}});var Yu=entryVirtual("Array").splice,Xu=Array.prototype,splice=function(t){var a=t.splice;return t===Xu||Q(Xu,t)&&a===Xu.splice?Yu:a},callWithSafeIterationClosing=function(t,a,o,c){try{return c?a(anObject(o)[0],o[1]):a(o)}catch(a){iteratorClose(t,"throw",a)}},Zu=Array,ed=!checkCorrectnessOfIteration((function(t){Array.from(t)}));_export({target:"Array",stat:!0,forced:ed},{from:function from(t){var a=toObject(t),o=$t(this),c=arguments.length,h=c>1?arguments[1]:void 0,m=void 0!==h;m&&(h=functionBindContext(h,c>2?arguments[2]:void 0));var v,b,C,S,M,w,I=getIteratorMethod$5(a),x=0;if(!I||this===Zu&&isArrayIteratorMethod(I))for(v=lengthOfArrayLike(a),b=o?new this(v):Zu(v);v>x;x++)w=m?h(a[x],x):a[x],createProperty(b,x,w);else for(M=(S=getIterator(a,I)).next,b=o?new this:[];!(C=q(M,S)).done;x++)w=m?callWithSafeIterationClosing(S,h,[C.value,x],!0):C.value,createProperty(b,x,w);return b.length=x,b}});var td=D.Array.from,rd=getIteratorMethod$5;function _createForOfIteratorHelperLoose$1(t,a){var o,c=void 0!==Kn&&rd(t)||t["@@iterator"];if(c)return bind$1(o=(c=c.call(t)).next).call(o,c);if(Wc(t)||(c=function _unsupportedIterableToArray$1(t,a){var o;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$1(t,a);var c=slice(o=Object.prototype.toString.call(t)).call(o,8,-1);"Object"===c&&t.constructor&&(c=t.constructor.name);if("Map"===c||"Set"===c)return td(t);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray$1(t,a)}(t))||a&&t&&"number"==typeof t.length){c&&(t=c);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray$1(t,a){(null==a||a>t.length)&&(a=t.length);for(var o=0,c=new Array(a);o<a;o++)c[o]=t[o];return c}var nd,ad=function(){function TimerManager(){this.timerList=[],this.id=0,this.timer=null,this.timeout=0}var t=TimerManager.prototype;return t.addTimer=function addTimer(t,a,o){void 0===a&&(a=0),void 0===o&&(o=1);var c=(new Date).getTime(),h=this.id;return this.timerList.push({id:h,loop:o,count:0,timeout:c+a,interval:a,callback:t}),this.id++,this.checkTimer(c),h},t.checkTimer=function checkTimer(t){if(void 0===t&&(t=(new Date).getTime()),this.removeFinished(),0!==this.timerList.length||null==this.timer){for(var a,o,c=0,h=_createForOfIteratorHelperLoose$1(this.timerList);!(a=h()).done;){var m=a.value;(0===c||c>m.timeout)&&(c=m.timeout)}if(0!==this.timerList.length)if(null===this.timer||c<this.timeout||this.timeout<t)this.timer=cs(bind$1(o=this.nowTime).call(o,this),c-t),this.timeout=c}},t.nowTime=function nowTime(){for(var t,nowTime=(new Date).getTime(),a=_createForOfIteratorHelperLoose$1(this.timerList);!(t=a()).done;){var o=t.value;nowTime>=o.timeout&&(o.callback(),o.count++,o.timeout=nowTime+o.interval)}this.clerTime(),this.checkTimer(nowTime)},t.clerTime=function clerTime(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.deleteTimer=function deleteTimer(t){for(var a=this.timerList.length-1;a>=0;a--){var o;if(this.timerList[a].id===t)splice(o=this.timerList).call(o,a,1)}},t.removeFinished=function removeFinished(){for(var t=this.timerList.length-1;t>=0;t--){var a,o=this.timerList[t];if(o.loop>=0&&o.count>=o.loop)splice(a=this.timerList).call(a,t,1)}},t.destroy=function destroy(){this.clerTime(),this.timerList=[],this.id=0,this.timer=null},TimerManager}(),od=function(){function CoreAdapters(t){this.core=t}var t=CoreAdapters.prototype;return t.request=function request(t,a){var o=this,c=(new Date).getTime();return Tc.request(t,a).catch((function(h){var m,v,b=h;throw o.core.reporter.reportTraceStart("exceptions",{user_id:o.core.options.account,trace_id:null===(v=null===(m=o.core)||void 0===m?void 0:m.socket)||void 0===v?void 0:v.sessionId,start_time:c,action:1}),o.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof b.code?b.code:0,description:b.message||""+b.code,operation_type:0,target:t,context:a?us(a):""}),o.core.reporter.reportTraceEnd("exceptions",1),h}))},t.uploadFile=function uploadFile(t){var a=this,o=(new Date).getTime();return Tc.uploadFile(t).catch((function(c){var h,m,v=c;a.core.reporter.reportTraceStart("exceptions",{user_id:a.core.options.account,trace_id:null===(m=null===(h=a.core)||void 0===h?void 0:h.socket)||void 0===m?void 0:m.sessionId,start_time:o,action:1});var b="BROWSER"===Tc.platform?t.chunkUploadHost:t.commonUploadHost?t.commonUploadHost+"/"+(t.nosToken&&t.nosToken.bucket):"https://nos.netease.com/nim";throw a.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof v.code?v.code:0,description:v.message||""+v.code,operation_type:1,target:b}),a.core.reporter.reportTraceEnd("exceptions",1),c}))},CoreAdapters}();!function(t){t[t.ACTIVE=1]="ACTIVE",t[t.KICKED=2]="KICKED",t[t.OFFLINE=3]="OFFLINE"}(nd||(nd={}));var id=window&&Os(window.addEventListener)&&Os(window.removeEventListener),sd=function(t){function Core(a,o){var h;(h=t.call(this)||this).status="unconnected",h.linkUrls=[],h.eventBus=new ys,h.packetSer=1,h.retryCount=0,h.reconnectTimer=0,h.backoff=new bs({max:8e3,min:1600,jitter:.01}),h.sendingCmdMap=new es,h.pingTimer=0,h.config=Us,h.abtInfo={},validate({linkUrls:{type:"array",itemType:"string",required:!1}},a),h.options=ki(ki({},Bs),a),h.adapters=new od(c(h));var m=Tc.localStorage.getItem("__NIM_DEVC_ID__");h.options.isFixedDeviceId?(m=Tc.localStorage.getItem("__NIM_DEVC_ID__")||Du(),Tc.localStorage.setItem("__NIM_DEVC_ID__",m)):m=Du(),h.config=ki(ki(ki({},Us),o),{deviceId:m}),h.timerManager=new ad,h.logger=new Ic(h.options.debugLevel,h.options.account);var v=Tc.getSystemInfo();return h.reporter=new xc({common:{app_key:a.appkey,dev_id:m,platform:"Web",sdk_ver:"0.12.3",env:"online",os_name:v.os,os_ver:v.osVer,host_env:v.hostEnv,host_info:v.hostInfo,host_env_ver:v.hostEnvVer},request:Tc.request,logger:h.logger,autoStart:"BROWSER"===Tc.platform}),Tc.setLogger(h.logger),h.logger.log("Core init, version ","0.12.3"," sdk version ",90903," appkey ",a.appkey),h}wt(Core,t);var a=Core.prototype;return a.connect=function connect(t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,Mi.mark((function _callee(){var a,o,c,h,m,v;return Mi.wrap((function _callee$(b){for(;;)switch(b.prev=b.next){case 0:if(validate({linkUrls:{type:"array",itemType:"string",required:!1}},t),/^(unconnected|waitReconnect)$/.test(this.status)){b.next=5;break}return a="Core socket status is "+this.status+", and would not connect",this.logger.warn(a),b.abrupt("return",li.reject(a));case 5:this.status="connecting",t.linkUrls&&t.linkUrls.length>0&&(this.linkUrls=concat(o=t.linkUrls).call(o,this.linkUrls),this.linkUrls=wu(this.linkUrls)),0===this.linkUrls.length&&this.linkUrls.push("weblink.netease.im:443"),c=0;case 9:if(!(c<this.linkUrls.length)){b.next=33;break}return h=this.linkUrls[c],m=(new Date).getTime(),b.prev=12,b.next=15,this.doConnect(h);case 15:return this.reporter.reportTraceUpdate("login",{operation_type:"TCP",target:h}),this.status="connected",this.logger.log("core:: connect success with url: "+h),this.abtRequest(),b.abrupt("return",h);case 22:b.prev=22,b.t0=b.catch(12),v=b.t0,this.reporter.reportTraceUpdate("login",{operation_type:"TCP",error:"ws_handshake_failed",target:h},!1),this.reporter.reportTraceStart("exceptions",{user_id:this.options.account,start_time:m,action:0}),this.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof v.code?v.code:0,description:v.message||""+v.code,operation_type:0,target:h}),this.reporter.reportTraceEnd("exceptions",1),this.logger.warn("core:: connect failed with url: "+h,b.t0);case 30:c++,b.next=9;break;case 33:throw this.reporter.reportTraceEnd("login",!1),0===this.retryCount?this.doDisconnect(nd.ACTIVE,"SocketHandshakeFailed"):this.doDisconnect(nd.OFFLINE,"ReconnectHadRetryAllLinks"),new Error("core: socket handshake failed");case 36:case"end":return b.stop()}}),_callee,this,[[12,22]])})))},a.doConnect=function doConnect(t){var a=this;return new li((function(o,c){var h;a.socket=new Gc(a,t,a.logger),a.socket.on("connect",(function(){a.logger.log("socket on connect",t),o()})),a.socket.on("message",bind$1(h=a.onMessage).call(h,a)),a.socket.on("disconnect",(function(t){a.logger.log("core:: socket on disconnect",t),a.doDisconnect(nd.OFFLINE,"SocketOnDisconnect")})),a.socket.on("handshakeFailed",(function(){a.logger.warn("core:: socket handshake failed"),c(new vc("handshake failed",{},408))}))}))},a.resetConnectStatus=function resetConnectStatus(){clearTimeout(this.reconnectTimer),this.backoff.reset(),this.retryCount=0,this.initOnlineListener()},a.doDisconnect=function doDisconnect(t,a){if(this.logger.log("doDisconnect: type "+t+", description "+a),"unconnected"!==this.status){this.markAllCmdInvaild(new vc("Packet timeout due to instance disconnect",{},408)),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0);var o=!this.options.needReconnect||this.retryCount>=this.options.reconnectionAttempts;if(t===nd.ACTIVE||o)this.logger.log("doDisconnect: emit disconnect, type "+t,o),this.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.eventBus.emit("disconnect"),this.emit("disconnect"),this.destroyOnlineListener();else if(t===nd.KICKED){this.logger.log("doDisconnect: kicked"),this.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer);var c="string"==typeof a?{reason:"unknow",message:a}:a;this.eventBus.emit("kicked",c),this.emit("kicked",c),this.destroyOnlineListener()}else t===nd.OFFLINE?(this.logger.log("doDisconnect: start to reconnect"),this.attempToReconnect()):this.logger.log("doDisconnect: nothing to do")}else this.logger.warn("doDisconnect: already unconnected")},a.attempToReconnect=function attempToReconnect(){var t=this;if("waitReconnect"!==this.status){var a=this.backoff.duration();this.retryCount++,this.logger.log("willReconnect "+this.retryCount+" "+a),this.eventBus.emit("willReconnect",{retryCount:this.retryCount,duration:a}),this.emit("willReconnect",{retryCount:this.retryCount,duration:a}),this.status="waitReconnect",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectTimer=cs((function(){"waitReconnect"===t.status?t.connect({isAutoReconnect:!0}).catch((function(){t.logger.error("core::attempToReconnect failed "+t.retryCount)})):t.logger.warn("doDisconnect: reconnectTimer status is "+t.status+", would not go on reconnecting")}),a)}else this.logger.warn("doDisconnect: already is waiting reconnect")},a.sendCmd=function sendCmd(t,a,o){var c=this;if("logined"!==this.status&&"login"!==t&&"chatroomLogin"!==t&&"qchatLogin"!==t)return this.logger.warn("nim status is "+this.status+", so can not sendCmd "+t),li.reject({cmd:t,error:{code:"No_connected",message:"Connection not established",timetag:(new Date).getTime()}});if(!this.socket||!this.socket.send)return li.reject("No_socket");var h="heartbeat"!==t,m=h?this.packetSer++:0,v=function createCmd(t,a,o,c){var h=Bc[t];if(!h)return o.error("createCmd:: can not find cmd config: ",t),null;var m,v={SER:a,SID:h.sid,CID:h.cid,Q:[]};return h.params&&c&&forEach$1(m=h.params).call(m,(function(t){var a=c[t.name];if(!Uc(a)){var o=t.type,h=t.reflectMapper;switch(t.type){case"PropertyArray":o="ArrayMable",a=map(a).call(a,(function(t){return{t:"Property",v:h?serialize(t,h):t}}));break;case"Property":a=h?serialize(a,h):a;break;case"Bool":case"bool":a=a?"true":"false"}v.Q.push({t:o,v:a})}})),{packet:v,isNoResponse:h.isNoResponse||!1}}(t,m,this.logger,a);if(!v){var b="SendCmd "+m+" "+t+" error";return this.logger.error(b),li.reject(b)}var C=v.packet,S=v.isNoResponse,M=us(C);h&&("debug"===this.options.debugLevel?this.logger.debug("core::sendCmd",t,"ser:"+m,M):this.logger.log("core::sendCmd",t,"ser:"+m));var w=(new Date).getTime();return new li((function(h,v){c.sendingCmdMap.set(m,{cmd:t,params:a,callback:[h,v],timer:S?null:cs((function(){var a,o=new bc(504,t,"Packet Timeout",(new Date).getTime(),{message:"ser "+m+" cmd "+t+" timeout"});o.callFunc="sendCmd",c.markCmdInvalid(m,o,t),c.reporter.reportTraceStart("exceptions",{user_id:c.options.account,trace_id:null===(a=c.socket)||void 0===a?void 0:a.sessionId,start_time:w,action:2}),c.reporter.reportTraceUpdateV2("exceptions",{code:408,description:"Packet timeout",operation_type:1,target:C.SID+"-"+C.CID,context:""+C.SER}),c.reporter.reportTraceEnd("exceptions",1)}),o&&o.timeout?o.timeout:c.config.timeout)});try{c.socket.send(M)}catch(a){var b=new bc(415,t,a&&a.message||"Unable to send packet",(new Date).getTime(),{message:"send json error",rawError:a});b.callFunc="sendCmd",c.markCmdInvalid(m,b,t),v(a)}}))},a.onMessage=function onMessage(t){var a=parseCmd(t,this.logger);if(a){var o=a.raw.ser;if(a.error&&this.logger.error("core:onMessage packet error",a.raw.sid+"_"+a.raw.cid+", ser:"+o+",",a.error),!a.notFound)return"heartbeat"!==a.cmd&&("debug"===this.options.debugLevel?this.logger.debug("imsocket::recvCmd ser:"+o,a.cmd,a.content):this.logger.log("imsocket::recvCmd ser:"+o,a.cmd)),a.__receiveTime=hs(),a;this.logger.warn("core::onMessage packet not found",a.raw.sid+"_"+a.raw.cid+", ser:"+o)}},a.markCmdInvalid=function markCmdInvalid(t,a,o){var c=this.sendingCmdMap.get(t);if(c){var h=c.callback,m=c.timer;m&&clearTimeout(m),this.sendingCmdMap.delete(t),this.logger.warn("packet "+t+", "+o+" is invalid:",a),h[1](a)}},a.markAllCmdInvaild=function markAllCmdInvaild(t){var a;this.logger.log("markAllCmdInvaild"),forEach$1(a=this.sendingCmdMap).call(a,(function(a){var o=a.callback,c=a.timer;c&&clearTimeout(c),o[1](t)})),this.sendingCmdMap.clear()},a.ping=function ping(){return __awaiter(this,void 0,void 0,Mi.mark((function _callee2(){var t=this;return Mi.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return clearTimeout(this.pingTimer),a.prev=1,a.next=4,this.sendCmd("heartbeat");case 4:a.next=14;break;case 6:return a.prev=6,a.t0=a.catch(1),a.next=10,this.testHeartBeat5Timeout();case 10:if(!a.sent){a.next=14;break}return this.doDisconnect(nd.OFFLINE,"PingError"),a.abrupt("return");case 14:this.pingTimer=cs((function(){t.ping()}),3e4);case 15:case"end":return a.stop()}}),_callee2,this,[[1,6]])})))},a.testHeartBeat5Timeout=function testHeartBeat5Timeout(){return __awaiter(this,void 0,void 0,Mi.mark((function _callee3(){var t;return Mi.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){a.next=15;break}return a.prev=3,a.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return a.abrupt("return",!1);case 9:a.prev=9,a.t0=a.catch(3),this.logger.debug("core:: test heartbeat "+t+" Timeout");case 12:t++,a.next=2;break;case 15:return a.abrupt("return",!0);case 16:case"end":return a.stop()}}),_callee3,this,[[3,9]])})))},a.initOnlineListener=function initOnlineListener(){var t,a;this.onlineListener||(id?(this.onlineListener=bind$1(t=function _context7(){"logined"===this.status&&this.ping()}).call(t,this),this.offlineListener=bind$1(a=function _context8(){this.logger.log("offline"),this.doDisconnect(nd.OFFLINE,"OfflineListener")}).call(a,this),window.addEventListener("online",this.onlineListener),window.addEventListener("offline",this.offlineListener)):this.logger.warn("initOnlineListener not support add listener"))},a.destroyOnlineListener=function destroyOnlineListener(){this.onlineListener&&(window.removeEventListener("online",this.onlineListener),this.onlineListener=void 0),this.offlineListener&&(window.removeEventListener("offline",this.offlineListener),this.offlineListener=void 0)},a.disconnect=function disconnect(){switch(this.status){case"connected":case"logined":case"connecting":case"waitReconnect":return this.doDisconnect(nd.ACTIVE,"UserActiveDisconnect"),li.resolve();case"unconnected":case"destroyed":return li.resolve()}},a.destroy=function destroy(){var t=this;return this.disconnect().then((function(){t.status="destroyed",t.removeAllListeners(),t.eventBus.removeAllListeners(),t.reporter.destroy(),t.connect=function(){return li.resolve()},t.disconnect=function(){return li.resolve()},t.destroy=function(){return li.resolve()}}))},a.abtRequest=function abtRequest(){var t,a;return __awaiter(this,void 0,void 0,Mi.mark((function _callee4(){var o,c;return Mi.wrap((function _callee4$(h){for(;;)switch(h.prev=h.next){case 0:if(this.options.isAbtestEnable){h.next=2;break}return h.abrupt("return");case 2:if(!this.abtInfo.experiments){h.next=4;break}return h.abrupt("return");case 4:if(this.options.abtestUrl){h.next=6;break}return h.abrupt("return");case 6:return h.prev=6,h.next=9,this.adapters.request(this.options.abtestUrl,{method:"POST",dataType:"json",headers:{sdktype:"ABTest"},params:{clientInfo:{projectKey:this.options.abtestProjectKey,appKey:this.options.appkey,osType:"Web",sdkVersion:"0.12.3",deviceId:this.config.deviceId},useLocalCache:!0}});case 9:o=h.sent,h.next=15;break;case 12:h.prev=12,h.t0=h.catch(6),this.logger.warn("ABTest request failed");case 15:this.abtInfo=(null===(a=null===(t=null==o?void 0:o.data)||void 0===t?void 0:t.data)||void 0===a?void 0:a.abtInfo)||{},this.abtInfo.experiments&&this.abtInfo.experiments.length>0&&this.reporter.reportImmediately("https://statistic.live.126.net/statics/report/abtest/result",{params:{app_key:this.options.appkey,biz_sdk_type:"IM",sdk_ver:"0.12.3",device_id:this.config.deviceId,platform:"Web",projectKey:this.options.abtestProjectKey,experiments:map(c=this.abtInfo.experiments).call(c,(function(t){return{experimentKey:t.experimentKey,schemeKey:t.schemeKey}}))},headers:{sdktype:"ABTest"},method:"POST",dataType:"json"});case 17:case"end":return h.stop()}}),_callee4,this,[[6,12]])})))},Core}(ys);sd.setAdapters=function setAdapters(t){ki(Tc,t)};var cd=wr.some,ld=arrayMethodIsStrict("some");_export({target:"Array",proto:!0,forced:!ld},{some:function some(t){return cd(this,t,arguments.length>1?arguments[1]:void 0)}});var ud=entryVirtual("Array").some,dd=Array.prototype,some=function(t){var a=t.some;return t===dd||Q(dd,t)&&a===dd.some?ud:a};var pd=function stackClear(){this.__data__=new Al,this.size=0};var hd=function stackDelete(t){var a=this.__data__,o=a.delete(t);return this.size=a.size,o};var fd=function stackGet(t){return this.__data__.get(t)};var md=function stackHas(t){return this.__data__.has(t)};var vd=function stackSet(t,a){var o=this.__data__;if(o instanceof Al){var c=o.__data__;if(!Ol||c.length<199)return c.push([t,a]),this.size=++o.size,this;o=this.__data__=new $l(c)}return o.set(t,a),this.size=o.size,this};function Stack(t){var a=this.__data__=new Al(t);this.size=a.size}Stack.prototype.clear=pd,Stack.prototype.delete=hd,Stack.prototype.get=fd,Stack.prototype.has=md,Stack.prototype.set=vd;var gd=Stack;var yd=function arraySome(t,a){for(var o=-1,c=null==t?0:t.length;++o<c;)if(a(t[o],o,t))return!0;return!1};var bd=function equalArrays(t,a,o,c,h,m){var v=1&o,b=t.length,C=a.length;if(b!=C&&!(v&&C>b))return!1;var S=m.get(t),M=m.get(a);if(S&&M)return S==a&&M==t;var w=-1,I=!0,x=2&o?new Wl:void 0;for(m.set(t,a),m.set(a,t);++w<b;){var T=t[w],k=a[w];if(c)var R=v?c(k,T,w,a,t,m):c(T,k,w,t,a,m);if(void 0!==R){if(R)continue;I=!1;break}if(x){if(!yd(a,(function(t,a){if(!Zl(x,a)&&(T===t||h(T,t,o,c,m)))return x.push(a)}))){I=!1;break}}else if(T!==k&&!h(T,k,o,c,m)){I=!1;break}}return m.delete(t),m.delete(a),I},Cd=Ms.Uint8Array;var Sd=function mapToArray(t){var a=-1,o=Array(t.size);return t.forEach((function(t,c){o[++a]=[c,t]})),o},Md=_s?_s.prototype:void 0,_d=Md?Md.valueOf:void 0;var wd=function equalByTag(t,a,o,c,h,m,v){switch(o){case"[object DataView]":if(t.byteLength!=a.byteLength||t.byteOffset!=a.byteOffset)return!1;t=t.buffer,a=a.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=a.byteLength||!m(new Cd(t),new Cd(a)));case"[object Boolean]":case"[object Date]":case"[object Number]":return xl(+t,+a);case"[object Error]":return t.name==a.name&&t.message==a.message;case"[object RegExp]":case"[object String]":return t==a+"";case"[object Map]":var b=Sd;case"[object Set]":var C=1&c;if(b||(b=Cu),t.size!=a.size&&!C)return!1;var S=v.get(t);if(S)return S==a;c|=2,v.set(t,a);var M=bd(b(t),b(a),c,h,m,v);return v.delete(t),M;case"[object Symbol]":if(_d)return _d.call(t)==_d.call(a)}return!1};var Id=function arrayPush(t,a){for(var o=-1,c=a.length,h=t.length;++o<c;)t[h+o]=a[o];return t},xd=Array.isArray;var Td=function baseGetAllKeys(t,a,o){var c=a(t);return xd(t)?c:Id(c,o(t))};var kd=function arrayFilter(t,a){for(var o=-1,c=null==t?0:t.length,h=0,m=[];++o<c;){var v=t[o];a(v,o,t)&&(m[h++]=v)}return m};var Rd=function stubArray(){return[]},qd=Object.prototype.propertyIsEnumerable,Ed=Object.getOwnPropertySymbols,Pd=Ed?function(t){return null==t?[]:(t=Object(t),kd(Ed(t),(function(a){return qd.call(t,a)})))}:Rd,Ad=Pd;var Od=function baseTimes(t,a){for(var o=-1,c=Array(t);++o<t;)c[o]=a(o);return c};var Ud=function baseIsArguments(t){return Jc(t)&&"[object Arguments]"==Ps(t)},Bd=Object.prototype,jd=Bd.hasOwnProperty,Ld=Bd.propertyIsEnumerable,Nd=Ud(function(){return arguments}())?Ud:function(t){return Jc(t)&&jd.call(t,"callee")&&!Ld.call(t,"callee")},Fd=Nd;var Gd=function stubFalse(){return!1},$d=createCommonjsModule((function(t,a){var o=a&&!a.nodeType&&a,c=o&&t&&!t.nodeType&&t,h=c&&c.exports===o?Ms.Buffer:void 0,m=(h?h.isBuffer:void 0)||Gd;t.exports=m})),Dd=/^(?:0|[1-9]\d*)$/;var Qd=function isIndex(t,a){var o=typeof t;return!!(a=null==a?9007199254740991:a)&&("number"==o||"symbol"!=o&&Dd.test(t))&&t>-1&&t%1==0&&t<a},Wd={};Wd["[object Float32Array]"]=Wd["[object Float64Array]"]=Wd["[object Int8Array]"]=Wd["[object Int16Array]"]=Wd["[object Int32Array]"]=Wd["[object Uint8Array]"]=Wd["[object Uint8ClampedArray]"]=Wd["[object Uint16Array]"]=Wd["[object Uint32Array]"]=!0,Wd["[object Arguments]"]=Wd["[object Array]"]=Wd["[object ArrayBuffer]"]=Wd["[object Boolean]"]=Wd["[object DataView]"]=Wd["[object Date]"]=Wd["[object Error]"]=Wd["[object Function]"]=Wd["[object Map]"]=Wd["[object Number]"]=Wd["[object Object]"]=Wd["[object RegExp]"]=Wd["[object Set]"]=Wd["[object String]"]=Wd["[object WeakMap]"]=!1;var Vd=function baseIsTypedArray(t){return Jc(t)&&pu(t.length)&&!!Wd[Ps(t)]},Kd=Zc&&Zc.isTypedArray,zd=Kd?Xc(Kd):Vd,Hd=Object.prototype.hasOwnProperty;var Jd=function arrayLikeKeys(t,a){var o=xd(t),c=!o&&Fd(t),h=!o&&!c&&$d(t),m=!o&&!c&&!h&&zd(t),v=o||c||h||m,b=v?Od(t.length,String):[],C=b.length;for(var S in t)!a&&!Hd.call(t,S)||v&&("length"==S||h&&("offset"==S||"parent"==S)||m&&("buffer"==S||"byteLength"==S||"byteOffset"==S)||Qd(S,C))||b.push(S);return b},Yd=Object.prototype;var Xd=function isPrototype(t){var a=t&&t.constructor;return t===("function"==typeof a&&a.prototype||Yd)};var Zd=function overArg(t,a){return function(o){return t(a(o))}},ep=Zd(Object.keys,Object),tp=Object.prototype.hasOwnProperty;var rp=function baseKeys(t){if(!Xd(t))return ep(t);var a=[];for(var o in Object(t))tp.call(t,o)&&"constructor"!=o&&a.push(o);return a};var np=function keys(t){return hu(t)?Jd(t):rp(t)};var ap=function getAllKeys(t){return Td(t,np,Ad)},op=Object.prototype.hasOwnProperty;var ip=function equalObjects(t,a,o,c,h,m){var v=1&o,b=ap(t),C=b.length;if(C!=ap(a).length&&!v)return!1;for(var S=C;S--;){var M=b[S];if(!(v?M in a:op.call(a,M)))return!1}var w=m.get(t),I=m.get(a);if(w&&I)return w==a&&I==t;var x=!0;m.set(t,a),m.set(a,t);for(var T=v;++S<C;){var k=t[M=b[S]],R=a[M];if(c)var q=v?c(R,k,M,a,t,m):c(k,R,M,t,a,m);if(!(void 0===q?k===R||h(k,R,o,c,m):q)){x=!1;break}T||(T="constructor"==M)}if(x&&!T){var E=t.constructor,P=a.constructor;E==P||!("constructor"in t)||!("constructor"in a)||"function"==typeof E&&E instanceof E&&"function"==typeof P&&P instanceof P||(x=!1)}return m.delete(t),m.delete(a),x},sp=ml(Ms,"DataView"),cp=ml(Ms,"Promise"),lp=ml(Ms,"WeakMap"),up="[object Map]",dp="[object Promise]",pp="[object Set]",hp="[object WeakMap]",fp="[object DataView]",mp=il(sp),vp=il(Ol),gp=il(cp),yp=il(yu),bp=il(lp),Cp=Ps;(sp&&Cp(new sp(new ArrayBuffer(1)))!=fp||Ol&&Cp(new Ol)!=up||cp&&Cp(cp.resolve())!=dp||yu&&Cp(new yu)!=pp||lp&&Cp(new lp)!=hp)&&(Cp=function(t){var a=Ps(t),o="[object Object]"==a?t.constructor:void 0,c=o?il(o):"";if(c)switch(c){case mp:return fp;case vp:return up;case gp:return dp;case yp:return pp;case bp:return hp}return a});var Sp=Cp,Mp="[object Arguments]",_p="[object Array]",wp="[object Object]",Ip=Object.prototype.hasOwnProperty;var xp=function baseIsEqualDeep(t,a,o,c,h,m){var v=xd(t),b=xd(a),C=v?_p:Sp(t),S=b?_p:Sp(a),M=(C=C==Mp?wp:C)==wp,w=(S=S==Mp?wp:S)==wp,I=C==S;if(I&&$d(t)){if(!$d(a))return!1;v=!0,M=!1}if(I&&!M)return m||(m=new gd),v||zd(t)?bd(t,a,o,c,h,m):wd(t,a,C,o,c,h,m);if(!(1&o)){var x=M&&Ip.call(t,"__wrapped__"),T=w&&Ip.call(a,"__wrapped__");if(x||T){var k=x?t.value():t,R=T?a.value():a;return m||(m=new gd),h(k,R,o,c,m)}}return!!I&&(m||(m=new gd),ip(t,a,o,c,h,m))};var Tp=function baseIsEqual(t,a,o,c,h){return t===a||(null==t||null==a||!Jc(t)&&!Jc(a)?t!=t&&a!=a:xp(t,a,o,c,baseIsEqual,h))};var kp=function baseIsMatch(t,a,o,c){var h=o.length,m=h,v=!c;if(null==t)return!m;for(t=Object(t);h--;){var b=o[h];if(v&&b[2]?b[1]!==t[b[0]]:!(b[0]in t))return!1}for(;++h<m;){var C=(b=o[h])[0],S=t[C],M=b[1];if(v&&b[2]){if(void 0===S&&!(C in t))return!1}else{var w=new gd;if(c)var I=c(S,M,C,t,a,w);if(!(void 0===I?Tp(M,S,3,c,w):I))return!1}}return!0};var Rp=function isStrictComparable(t){return t==t&&!As(t)};var qp=function getMatchData(t){for(var a=np(t),o=a.length;o--;){var c=a[o],h=t[c];a[o]=[c,h,Rp(h)]}return a};var Ep=function matchesStrictComparable(t,a){return function(o){return null!=o&&(o[t]===a&&(void 0!==a||t in Object(o)))}};var Pp=function baseMatches(t){var a=qp(t);return 1==a.length&&a[0][2]?Ep(a[0][0],a[0][1]):function(o){return o===t||kp(o,t,a)}};var Ap=function isSymbol(t){return"symbol"==typeof t||Jc(t)&&"[object Symbol]"==Ps(t)},Op=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Up=/^\w*$/;var Bp=function isKey(t,a){if(xd(t))return!1;var o=typeof t;return!("number"!=o&&"symbol"!=o&&"boolean"!=o&&null!=t&&!Ap(t))||(Up.test(t)||!Op.test(t)||null!=a&&t in Object(a))};function memoize(t,a){if("function"!=typeof t||null!=a&&"function"!=typeof a)throw new TypeError("Expected a function");var memoized=function(){var o=arguments,c=a?a.apply(this,o):o[0],h=memoized.cache;if(h.has(c))return h.get(c);var m=t.apply(this,o);return memoized.cache=h.set(c,m)||h,m};return memoized.cache=new(memoize.Cache||$l),memoized}memoize.Cache=$l;var jp=memoize;var Lp=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Np=/\\(\\)?/g,Fp=function memoizeCapped(t){var a=jp(t,(function(t){return 500===o.size&&o.clear(),t})),o=a.cache;return a}((function(t){var a=[];return 46===t.charCodeAt(0)&&a.push(""),t.replace(Lp,(function(t,o,c,h){a.push(c?h.replace(Np,"$1"):o||t)})),a})),Gp=Fp,$p=_s?_s.prototype:void 0,Dp=$p?$p.toString:void 0;var Qp=function baseToString(t){if("string"==typeof t)return t;if(xd(t))return Xl(t,baseToString)+"";if(Ap(t))return Dp?Dp.call(t):"";var a=t+"";return"0"==a&&1/t==-Infinity?"-0":a};var Wp=function toString(t){return null==t?"":Qp(t)};var Vp=function castPath(t,a){return xd(t)?t:Bp(t,a)?[t]:Gp(Wp(t))};var Kp=function toKey(t){if("string"==typeof t||Ap(t))return t;var a=t+"";return"0"==a&&1/t==-Infinity?"-0":a};var zp=function baseGet(t,a){for(var o=0,c=(a=Vp(a,t)).length;null!=t&&o<c;)t=t[Kp(a[o++])];return o&&o==c?t:void 0};var Hp=function get(t,a,o){var c=null==t?void 0:zp(t,a);return void 0===c?o:c};var Jp=function baseHasIn(t,a){return null!=t&&a in Object(t)};var Yp=function hasPath(t,a,o){for(var c=-1,h=(a=Vp(a,t)).length,m=!1;++c<h;){var v=Kp(a[c]);if(!(m=null!=t&&o(t,v)))break;t=t[v]}return m||++c!=h?m:!!(h=null==t?0:t.length)&&pu(h)&&Qd(v,h)&&(xd(t)||Fd(t))};var Xp=function hasIn(t,a){return null!=t&&Yp(t,a,Jp)};var Zp=function baseMatchesProperty(t,a){return Bp(t)&&Rp(a)?Ep(Kp(t),a):function(o){var c=Hp(o,t);return void 0===c&&c===a?Xp(o,t):Tp(a,c,3)}};var eh=function baseProperty(t){return function(a){return null==a?void 0:a[t]}};var th=function basePropertyDeep(t){return function(a){return zp(a,t)}};var rh=function property(t){return Bp(t)?eh(Kp(t)):th(t)};var nh=function baseIteratee(t){return"function"==typeof t?t:null==t?tu:"object"==typeof t?xd(t)?Zp(t[0],t[1]):Pp(t):rh(t)};var ah=function baseAssignValue(t,a,o){"__proto__"==a&&iu?iu(t,a,{configurable:!0,enumerable:!0,value:o,writable:!0}):t[a]=o},oh=Object.prototype.hasOwnProperty;var ih=function assignValue(t,a,o){var c=t[a];oh.call(t,a)&&xl(c,o)&&(void 0!==o||a in t)||ah(t,a,o)};var sh=function baseSet(t,a,o,c){if(!As(t))return t;for(var h=-1,m=(a=Vp(a,t)).length,v=m-1,b=t;null!=b&&++h<m;){var C=Kp(a[h]),S=o;if("__proto__"===C||"constructor"===C||"prototype"===C)return t;if(h!=v){var M=b[C];void 0===(S=c?c(M,C,b):void 0)&&(S=As(M)?M:Qd(a[h+1])?[]:{})}ih(b,C,S),b=b[C]}return t};var ch=function basePickBy(t,a,o){for(var c=-1,h=a.length,m={};++c<h;){var v=a[c],b=zp(t,v);o(b,v)&&sh(m,Vp(v,t),b)}return m},lh=Zd(Object.getPrototypeOf,Object),uh=Object.getOwnPropertySymbols?function(t){for(var a=[];t;)Id(a,Ad(t)),t=lh(t);return a}:Rd;var dh=function nativeKeysIn(t){var a=[];if(null!=t)for(var o in Object(t))a.push(o);return a},ph=Object.prototype.hasOwnProperty;var hh=function baseKeysIn(t){if(!As(t))return dh(t);var a=Xd(t),o=[];for(var c in t)("constructor"!=c||!a&&ph.call(t,c))&&o.push(c);return o};var fh=function keysIn(t){return hu(t)?Jd(t,!0):hh(t)};var mh=function getAllKeysIn(t){return Td(t,fh,uh)};var vh,gh,yh=function pickBy(t,a){if(null==t)return{};var o=Xl(mh(t),(function(t){return[t]}));return a=nh(a),ch(t,o,(function(t,o){return a(t,o[0])}))},bh={"6_2":"getNosToken","6_22":"getOriginUrl","6_26":"getNosCdnHost","6_27":"getGrayscaleConfig","6_28":"getMixStorePolicy","6_29":"getMixStoreToken","6_30":"getFileAuthToken"},Ch={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},mixStoreTokenReqTag:{provider:0,tokenCount:1,fileExpireSec:2,tag:3,returnBody:4},nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4},grayConfigTag:{config:0,ttl:1},mixStorePolicyTag:{providers:0,ttl:1,mixEnable:2,nosPolicy:3,s3Policy:4},mixStoreTokenResTag:{provider:0,accessKeyId:1,secretAccessKey:2,sessionToken:3,token:4,expireTime:5,bucket:6,objectName:7,fileExpireSec:8,tag:9,shortUrl:10,region:11},nosSafeUrlTag:{safeUrl:0,originUrl:1},mixStoreAuthTokenReqTag:{type:1,urls:2},mixStoreAuthTokenResTag:{type:1,tokens:2,token:3,ttl:4}},Sh=invertSerializeMap(Ch),Mh={getNosToken:{sid:6,cid:2,service:"cloudStorage",response:[{type:"Property",name:"nosToken",reflectMapper:Sh.nosToken}],params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken",reflectMapper:Ch.nosToken}]},getOriginUrl:{sid:6,cid:22,service:"cloudStorage",response:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:Sh.nosSafeUrlTag}],params:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:Ch.nosSafeUrlTag}]},getNosCdnHost:{sid:6,cid:26,service:"misc",response:[{type:"Property",name:"nosConfigTag",reflectMapper:Sh.nosConfigTag}]},getGrayscaleConfig:{sid:6,cid:27,service:"cloudStorage",response:[{type:"Property",name:"grayConfigTag",reflectMapper:Sh.grayConfigTag}],params:[{type:"Property",name:"config"}]},getMixStorePolicy:{sid:6,cid:28,service:"cloudStorage",params:[{type:"LongArray",name:"supportType"}],response:[{type:"Property",name:"mixStorePolicyTag",reflectMapper:Sh.mixStorePolicyTag}]},getMixStoreToken:{sid:6,cid:29,service:"cloudStorage",params:[{type:"Property",name:"mixStoreTokenReqTag",reflectMapper:Ch.mixStoreTokenReqTag}],response:[{type:"Property",name:"mixStoreTokenResTag",reflectMapper:Sh.mixStoreTokenResTag}]},getFileAuthToken:{sid:6,cid:30,service:"cloudStorage",params:[{type:"Property",name:"mixStoreAuthTokenReqTag",reflectMapper:Ch.mixStoreAuthTokenReqTag}],response:[{type:"Property",name:"mixStoreAuthTokenResTag",reflectMapper:Sh.mixStoreAuthTokenResTag}]}};!function(t){t[t.nos=1]="nos",t[t.s3=2]="s3"}(vh||(vh={})),function(t){t[t.dontNeed=-1]="dontNeed",t[t.time=2]="time",t[t.urls=3]="urls"}(gh||(gh={}));var _h,wh,Ih={chunkUploadHost:"https://wanproxy-web.127.net",commonUploadHost:"https://nos.netease.com",chunkMaxSize:4194304e4,commonMaxSize:104857600,uploadReplaceFormat:"https://{host}/{object}",cdn:{defaultCdnDomain:"nim.nosdn.127.net",cdnDomain:"",bucket:"",objectNamePrefix:""},downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHostList:["nos.netease.com"],nosCdnEnable:!0,isNeedToGetUploadPolicyFromServer:!0},xh={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}},Th={accessKeyId:"",secretAccessKey:"",sessionToken:"",region:"",maxRetries:0,bucket:"",objectName:"",token:"",shortUrl:""};function getUploadResponseFormat(t){return void 0===t&&(t="file"),us(xh[t]||{}).replace(/"/gi,'\\"')}!function(t){t[t.nos=1]="nos",t[t.s3=2]="s3"}(_h||(_h={})),function(t){t[t.dontNeed=-1]="dontNeed",t[t.time=2]="time",t[t.urls=3]="urls"}(wh||(wh={}));var kh=function(){function CloudStorageService(t,a){void 0===a&&(a={}),this.GRAYKEY="AllGrayscaleConfig",this.MIXSTOREKEY="AllMixStorePolicy",this.config={},this.nosCdnHostTimer=0,this.grayConfig={mixStoreEnable:!1,timeStamp:0,ttl:0},this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.curProvider=_h.nos,this.s3=null,this.mixStoreErrorCount=10,this.nosErrorCount=0,this.circuitTimer=0,this.name="cloudStorage",this.logger=t.logger,this.core=t,registerParser({cmdMap:bh,cmdConfig:Mh}),this.setOptions(a)}var t=CloudStorageService.prototype;return t.setOptions=function setOptions(t){void 0===t&&(t={});var a=t.storageKeyPrefix||"NIMClient";this.GRAYKEY=a+"-AllGrayscaleConfig",this.MIXSTOREKEY=a+"-AllMixStorePolicy";var o=t.s3,c=__rest(t,["s3"]),h=ki({},Ih,this.config);if(c&&Object.prototype.hasOwnProperty.call(c,"cdn")){var m={cdn:ki(ki({},h.cdn),c.cdn)};this.config=ki({},h,c,m)}else this.config=ki({},h,c);o&&(this.s3=o)},t.init=function init(){return __awaiter(this,void 0,void 0,Mi.mark((function _callee(){return Mi.wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:if(this.grayConfig=null,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.curProvider=_h.nos,this.mixStoreErrorCount=10,!this.config.isNeedToGetUploadPolicyFromServer){t.next=9;break}return t.next=7,this.getGrayscaleConfig(this.core.options.appkey);case 7:return t.next=9,this.getNosCdnHost();case 9:case"end":return t.stop()}}),_callee,this)})))},t.uploadFile=function uploadFile(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee2(){var a,o,c;return Mi.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:if(validate({maxSize:{type:"number",required:!1},type:{type:"enum",values:["file","image","audio","video"]}},t),t.fileInput||t.file||t.filePath){h.next=3;break}throw new Error("uploadFile needs target file object or a filePath");case 3:if(!t.type||"file"===t.type){h.next=7;break}if("string"!=typeof(a=Hp(t,"file.type"))||-1!==indexOf(a).call(a,t.type)){h.next=7;break}throw new Error('The meta type "'+a+'" does not match "'+t.type+'"');case 7:if(this.grayConfig&&this.grayConfig.mixStoreEnable&&this.mixStorePolicy.providers.length){h.next=10;break}return this.logger.log("uploadFile:: uploadFile begin, use old nos"),h.abrupt("return",this.nosUpload(t));case 10:return this.logger.log("uploadFile:: uploadFile begin,Current settings grayConfig mixStoreEnable:"+this.grayConfig.mixStoreEnable+" curProvider:"+this.curProvider),this.s3||(this.curProvider=_h.nos),o=Th,h.prev=13,h.next=16,this.core.sendCmd("getMixStoreToken",{mixStoreTokenReqTag:{provider:this.curProvider,tokenCount:1,tag:"qchat",returnBody:getUploadResponseFormat(t.type)}});case 16:c=h.sent,o=c.content.mixStoreTokenResTag,h.next=24;break;case 20:throw h.prev=20,h.t0=h.catch(13),this.core.logger.error("uploadFile:: getMixStoreToken error",h.t0),new Sc("getMixStoreToken error",h.t0,this.curProvider,this.mixStorePolicy);case 24:return h.abrupt("return",this.curProvider===_h.s3?this.s3Upload(t,o):this.nosUpload(t,o));case 25:case"end":return h.stop()}}),_callee2,this,[[13,20]])})))},t.nosUpload=function nosUpload(t,a){var o,c;return __awaiter(this,void 0,void 0,Mi.mark((function _callee3(){var h,m,v,b,C,S,M,w,I,x,T,k,R;return Mi.wrap((function _callee3$(q){for(;;)switch(q.prev=q.next){case 0:if(h=Hp(this.core,"config.cdn.bucket"),m={tag:t.nosScenes||h||"nim",expireSec:t.nosSurvivalTime},a){q.next=13;break}return q.prev=3,q.next=6,this.core.sendCmd("getNosToken",{responseBody:getUploadResponseFormat(t.type),nosToken:m});case 6:v=q.sent,q.next=13;break;case 9:throw q.prev=9,q.t0=q.catch(3),this.core.logger.error("uploadFile:: getNosToken error",q.t0),new Sc("getNosToken error",q.t0,1);case 13:return q.prev=13,C=v?v.content.nosToken:a,this.core.logger.debug("uploadFile:: uploadFile params",{nosToken:C,chunkUploadHost:this.config.chunkUploadHost,commonUploadHost:this.config.commonUploadHost,platform:Tc.platform}),q.next=18,this.core.adapters.uploadFile(ki(ki({},t),{nosToken:C,chunkUploadHost:this.config.chunkUploadHost,commonUploadHost:this.config.commonUploadHost,maxSize:t.maxSize||this.config.chunkMaxSize}));case 18:b=q.sent,q.next=42;break;case 21:if(q.prev=21,q.t1=q.catch(13),this.core.logger.error("uploadFile::nos uploadFile error",q.t1),!a){q.next=41;break}if(0!==this.nosErrorCount){q.next=37;break}q.prev=26,this._addCircuitTimer(),q.next=33;break;case 30:throw q.prev=30,q.t2=q.catch(26),new Sc("upload file error",q.t2,this.curProvider,this.mixStorePolicy,t.file||t.filePath);case 33:return this.nosErrorCount=null===(o=this.mixStorePolicy.nosPolicy)||void 0===o?void 0:o.uploadConfig.retryPolicy.retry,q.abrupt("return",this.uploadFile(t));case 37:return this.nosErrorCount--,q.abrupt("return",this.nosUpload(t,a));case 39:q.next=42;break;case 41:throw new Sc("nos uploadFile error",q.t1,1);case 42:if(S=null==b?void 0:b.type,M=S&&indexOf(S).call(S,"/")>-1?slice(S).call(S,0,indexOf(S).call(S,"/")):"",w={image:"imageInfo",video:"vinfo",audio:"vinfo"},I=this.config.uploadReplaceFormat.replace("{host}",this.config.cdn.cdnDomain||this.config.cdn.defaultCdnDomain).replace("{object}",v?v.content.nosToken.objectName:null==a?void 0:a.objectName),a&&a.shortUrl&&(I=a.shortUrl),w[M]){q.next=49;break}return q.abrupt("return",ki({url:I},b));case 49:if(q.prev=49,!(indexOf(I).call(I,"_im_url=1")<0)){q.next=54;break}return q.next=53,this.core.adapters.request(I+"?"+w[M],{method:"GET",dataType:"json",timeout:5e3});case 53:x=q.sent;case 54:q.next=60;break;case 56:return q.prev=56,q.t3=q.catch(49),this.core.logger.error("uploadFile:: fetch file info error",q.t3),q.abrupt("return",ki({url:I},b));case 60:if(!x){q.next=67;break}return T=x.data,k="imageInfo"===w[M]?T:null===(c=null==T?void 0:T.GetVideoInfo)||void 0===c?void 0:c.VideoInfo,R={url:I,name:b.name,size:b.size,ext:b.ext,w:k.Width,h:k.Height,orientation:k.Orientation,dur:k.Duration,audioCodec:k.AudioCodec,videoCodec:k.VideoCodec,container:k.Container},q.abrupt("return",yh(R,(function(t,a){return void 0!==a})));case 67:return q.abrupt("return",ki({url:I},b));case 68:case"end":return q.stop()}}),_callee3,this,[[3,9],[13,21],[26,30],[49,56]])})))},t.getNosCdnHost=function getNosCdnHost(){var t;return __awaiter(this,void 0,void 0,Mi.mark((function _callee4(){var a,o,c,h=this;return Mi.wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:return m.prev=0,m.next=3,this.core.sendCmd("getNosCdnHost");case 3:a=m.sent,m.next=10;break;case 6:return m.prev=6,m.t0=m.catch(0),this.logger.error("getNosCdnHost::error",m.t0),m.abrupt("return");case 10:if(a){m.next=12;break}return m.abrupt("return");case 12:o=null===(t=null==a?void 0:a.content)||void 0===t?void 0:t.nosConfigTag,0!==(c=$u(null==o?void 0:o.expire))&&o.cdnDomain?-1===c?(this.config.cdn.bucket=o.bucket,this.config.cdn.cdnDomain=o.cdnDomain,this.config.cdn.objectNamePrefix=o.objectNamePrefix):(this.config.cdn.bucket=o.bucket,this.config.cdn.cdnDomain=o.cdnDomain,this.config.cdn.objectNamePrefix=o.objectNamePrefix,this.nosCdnHostTimer=this.core.timerManager.addTimer((function(){h.getNosCdnHost()}),1e3*c)):(this.config.cdn.bucket="",this.config.cdn.cdnDomain="",this.config.cdn.objectNamePrefix="");case 15:case"end":return m.stop()}}),_callee4,this,[[0,6]])})))},t.getGrayscaleConfig=function getGrayscaleConfig(t){var a;return __awaiter(this,void 0,void 0,Mi.mark((function _callee5(){var o,c;return Mi.wrap((function _callee5$(h){for(;;)switch(h.prev=h.next){case 0:if(Tc.localStorage)try{Tc.localStorage.getItem&&Tc.localStorage.getItem(this.GRAYKEY)&&(this.grayConfig=JSON.parse(Tc.localStorage.getItem(this.GRAYKEY))[t])}catch(t){Tc.localStorage.getItem(this.GRAYKEY)&&this.core.logger.error("uploadFile:: JSON.parse grayscaleConfig error ",t)}if(this.grayConfig&&!(this.grayConfig.timeStamp+1e3*this.grayConfig.ttl<(new Date).getTime())){h.next=17;break}return h.next=4,this.core.sendCmd("getGrayscaleConfig",{config:{}});case 4:if(!(o=h.sent).content||!o.content.grayConfigTag){h.next=16;break}this.logger.log("uploadFile::getAppGrayConfigRequest success ");try{this.grayConfig=JSON.parse(o.content.grayConfigTag.config),this.grayConfig.ttl=JSON.parse(o.content.grayConfigTag.ttl)}catch(t){this.logger.error("getGrayscaleConfig error",t)}if(this.grayConfig){h.next=10;break}return h.abrupt("return");case 10:c=Tc.localStorage.getItem(this.GRAYKEY)?JSON.parse(Tc.localStorage.getItem(this.GRAYKEY)):{},this.grayConfig.timeStamp=(new Date).getTime(),c[t]=this.grayConfig,Tc.localStorage.setItem(this.GRAYKEY,us(c)),h.next=17;break;case 16:this.logger.debug("uploadFile:: result grayConfig:",o.content);case 17:if(!(null===(a=this.grayConfig)||void 0===a?void 0:a.mixStoreEnable)){h.next=20;break}return h.next=20,this._getMixStorePolicy(t);case 20:case"end":return h.stop()}}),_callee5,this)})))},t._getMixStorePolicy=function _getMixStorePolicy(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee6(){var a,o,c,h,m,v,b;return Mi.wrap((function _callee6$(C){for(;;)switch(C.prev=C.next){case 0:if(a=(new Date).getTime(),Tc.localStorage)try{this.mixStorePolicy=JSON.parse(Tc.localStorage.getItem(this.MIXSTOREKEY))[t],this.curProvider=$u(this.mixStorePolicy.providers[0]),this.mixStorePolicy.timeStamp&&this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl>a&&(c=this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl-a,this.core.timerManager.addTimer(bind$1(o=this._getMixStorePolicy).call(o,this,t),c))}catch(a){Tc.localStorage.getItem(this.MIXSTOREKEY)&&JSON.parse(Tc.localStorage.getItem(this.MIXSTOREKEY))[t]&&this.core.logger.error("uploadFile:: JSON.parse mixStorePolicy error ",a)}if(this.mixStorePolicy&&!(this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl<=a)){C.next=30;break}return C.prev=3,C.next=6,this.core.sendCmd("getMixStorePolicy",{supportType:this.s3?[1,2]:[1]});case 6:m=C.sent,v=m.content.mixStorePolicyTag,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.mixStorePolicy.ttl=Number(v.ttl),this.mixStorePolicy.providers=v.providers.split(","),this.circuitTimer&&this.core.timerManager.deleteTimer(this.circuitTimer),this.curProvider=$u(this.mixStorePolicy.providers[0]),this.mixStorePolicy.nosPolicy=v.nosPolicy?JSON.parse(v.nosPolicy):null,this.mixStorePolicy.s3Policy=v.s3Policy?JSON.parse(v.s3Policy):null,null===this.mixStorePolicy.s3Policy?this.mixStorePolicy.providers=["1"]:null===this.mixStorePolicy.nosPolicy?this.mixStorePolicy.providers=["2"]:this.mixStorePolicy.providers=this.mixStorePolicy.s3Policy.priority<this.mixStorePolicy.nosPolicy.priority?["2","1"]:["1","2"],this.core.timerManager.addTimer(bind$1(h=this._getMixStorePolicy).call(h,this,t),1e3*this.mixStorePolicy.ttl),b=Tc.localStorage.getItem(this.MIXSTOREKEY)?JSON.parse(Tc.localStorage.getItem(this.MIXSTOREKEY)):{},this.mixStorePolicy.timeStamp=(new Date).getTime(),b[t]=this.mixStorePolicy,Tc.localStorage.setItem(this.MIXSTOREKEY,us(b)),C.next=30;break;case 23:if(C.prev=23,C.t0=C.catch(3),this.logger.error("getMixStorePolicy error",C.t0),0!==this.mixStoreErrorCount){C.next=28;break}throw new Error("getMixStorePolicy all count error");case 28:this._getMixStorePolicy(t),this.mixStoreErrorCount--;case 30:this.mixStorePolicy.nosPolicy&&(this.nosErrorCount=this.mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry);case 31:case"end":return C.stop()}}),_callee6,this,[[3,23]])})))},t.s3Upload=function s3Upload(t,a){return __awaiter(this,void 0,void 0,Mi.mark((function _callee7(){var o,c,h,m,v,b,C,S,M,w,I=this;return Mi.wrap((function _callee7$(x){for(;;)switch(x.prev=x.next){case 0:if(!t.file){x.next=4;break}o=t.file,x.next=19;break;case 4:if("string"!=typeof t.fileInput){x.next=14;break}if(this.logger.warn("fileInput will abandon,Please use file or filepath"),!((c=document.getElementById(t.fileInput))&&c.files&&c.files[0])){x.next=11;break}o=c.files[0],x.next=12;break;case 11:throw new Error("Can not get file from fileInput");case 12:x.next=19;break;case 14:if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0])){x.next=18;break}o=t.fileInput.files[0],x.next=19;break;case 18:throw new Error("Can not get file from fileInput "+t.fileInput);case 19:if(this.mixStorePolicy.s3Policy){x.next=21;break}throw new Error("dont get s3 policy");case 21:return h={accessKeyId:a.accessKeyId,secretAccessKey:a.secretAccessKey,sessionToken:a.sessionToken,region:a.region,maxRetries:this.mixStorePolicy.s3Policy.uploadConfig.retryPolicy.retry},m=this.s3,(v=new m).config.update(h),b=decodeURIComponent(a.bucket),C=decodeURIComponent(a.objectName),M={Bucket:b,Key:C,Body:S=o,Metadata:{token:a.token},ContentType:S.type||"application/octet-stream"},this.core.logger.debug("uploadFile:: s3 upload params:",M),w=v.upload(M),x.abrupt("return",new li((function(o){var c=(new Date).getTime();w.send((function(h,m){var v,b;if(h){I.logger.error("uploadFile:","api::s3:upload file failed",h),I.core.reporter.reportTraceStart("exceptions",{user_id:I.core.options.account,trace_id:null===(b=null===(v=I.core)||void 0===v?void 0:v.socket)||void 0===b?void 0:b.sessionId,start_time:c,action:1}),I.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof h.status?h.status:"number"==typeof h.code?h.code:0,description:h.message||""+h.code,operation_type:1,target:h.hostname}),I.core.reporter.reportTraceEnd("exceptions",1);try{I._addCircuitTimer()}catch(h){throw new Sc("upload file error",h,I.curProvider,I.mixStorePolicy,t.file||t.filePath)}o(I.uploadFile(t))}else{var C=I.mixStorePolicy.s3Policy.cdnSchema;C=(C=C.replace("{cdnDomain}",I.mixStorePolicy.s3Policy.dlcdn)).replace("{objectName}",m.Key),o({size:S.size,name:S.name,url:a.shortUrl?a.shortUrl:C,ext:S.name.split(".")[1]||"unknown"})}}))})));case 32:case"end":return x.stop()}}),_callee7,this)})))},t.getPrivateUrl=function getPrivateUrl(t){var a;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(t))return this.logger.error("illegal file url:"+t),"";var o=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(t);o[0];var c=o[1];o[2];var h=o[3];o[4];var m=o[5];if(o[6],o[7],null===(a=this.grayConfig)||void 0===a?void 0:a.mixStoreEnable){var v=this._getUrlType(t);return v===_h.s3&&this.mixStorePolicy.s3Policy&&(t=this.mixStorePolicy.s3Policy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",m)),v===_h.nos&&this.mixStorePolicy.nosPolicy&&(t=this.mixStorePolicy.nosPolicy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",m)),t}var b=this.config,C=b.downloadUrl,S=b.downloadHostList,M=b.nosCdnEnable,w=this.config.cdn.cdnDomain,I=this.config.cdn.objectNamePrefix?decodeURIComponent(this.config.cdn.objectNamePrefix):"",x=decodeURIComponent(m),T=indexOf(x).call(x,I);if(w&&T>-1&&M)return""+c+w+"/"+slice(x).call(x,T);if(includes(S).call(S,h)&&includes(m).call(m,"/")){var k=indexOf(m).call(m,"/"),R=m.substring(0,k),q=m.substring(k+1);return C.replace("{bucket}",R).replace("{object}",q)}var E=filter(S).call(S,(function(t){return"string"==typeof h&&includes(h).call(h,t)}))[0],P=E?h.replace(E,"").replace(/\W/g,""):null;return P?C.replace("{bucket}",P).replace("{object}",m):t},t.getOriginUrl=function getOriginUrl(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee8(){var a;return Mi.wrap((function _callee8$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.sendCmd("getOriginUrl",{nosSafeUrlTag:{safeUrl:t}});case 2:return a=o.sent,o.abrupt("return",a.content.nosSafeUrlTag.originUrl);case 4:case"end":return o.stop()}}),_callee8,this)})))},t.getFileToken=function getFileToken(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee9(){var a,o,c,h,m,v=this;return Mi.wrap((function _callee9$(b){for(;;)switch(b.prev=b.next){case 0:if(validate({type:{type:"number",min:2,max:3},urls:{type:"array",required:!1,itemType:"string"}},t),a=this.mixStorePolicy.nosPolicy?this.mixStorePolicy.nosPolicy.authPolicy.policyType:null,o=this.mixStorePolicy.s3Policy?this.mixStorePolicy.s3Policy.authPolicy.policyType:null,a!==String(wh.dontNeed)||o!==String(wh.dontNeed)){b.next=8;break}throw this.logger.error("don't need token"),new Error("don't need token");case 8:if(t.type!==wh.time){b.next=17;break}if(!(a&&indexOf(a).call(a,String(wh.time))>=0||o&&indexOf(o).call(o,String(wh.time))>0)){b.next=13;break}return b.abrupt("return",this.getFileAuthToken(t));case 13:throw this.logger.error("don't support time token "),new Error("don't support type time token ");case 15:b.next=33;break;case 17:if(t.urls&&t.urls.length){b.next=20;break}throw this.logger.error("urls is required when urls token"),new Error("urls is required when urls token");case 20:if(h=[],m=[],forEach$1(c=t.urls).call(c,(function(t){var a=v._getUrlType(t);a===_h.nos&&m.push(t),a===_h.s3&&h.push(t)})),(!o||0!==h.length&&indexOf(o).call(o,String(wh.urls))<0)&&(this.logger.warn("s3 url don't support url token"),h=[]),(!a||0!==m.length&&indexOf(a).call(a,String(wh.urls))<0)&&(this.logger.warn("nos url don't support url token"),m=[]),0!==h.length||0!==m.length){b.next=30;break}throw this.logger.error("not support urls"),new Error("not support urls");case 30:if(0!==h.length&&0!==m.length){b.next=33;break}return t.urls=us(t.urls),b.abrupt("return",this.getFileAuthToken(t));case 33:case"end":return b.stop()}}),_callee9,this)})))},t.getFileAuthToken=function getFileAuthToken(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee10(){var a;return Mi.wrap((function _callee10$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.sendCmd("getFileAuthToken",{mixStoreAuthTokenReqTag:t});case 2:return a=o.sent,o.abrupt("return",a.content.mixStoreAuthTokenResTag);case 4:case"end":return o.stop()}}),_callee10,this)})))},t._getUrlType=function _getUrlType(t){var a,o;return this.mixStorePolicy.nosPolicy&&some(a=this.mixStorePolicy.nosPolicy.dlcdns).call(a,(function(a){return indexOf(t).call(t,a)>=0}))?_h.nos:this.mixStorePolicy.s3Policy&&some(o=this.mixStorePolicy.s3Policy.dlcdns).call(o,(function(a){return indexOf(t).call(t,a)>=0}))?_h.s3:null},t._addCircuitTimer=function _addCircuitTimer(){var t=this,a=this.mixStorePolicy.providers,o=a[(indexOf(a).call(a,String(this.curProvider))+1)%a.length];if(o===a[0])throw new Error("uploadFile all policy fail");var c=Hp(this.mixStorePolicy,"s3Policy.uploadConfig.retryPolicy");if(c&&c.retryNext&&o&&(this.logger.log("uploadFile:: upload policy will change,now policy:"+this.curProvider+" nextProvider:"+o),this.curProvider=$u(o),this.mixStorePolicy.nosPolicy&&this.mixStorePolicy.s3Policy)){var h=this.mixStorePolicy[this.curProvider===_h.nos?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!h||0===h)return;this.circuitTimer=this.core.timerManager.addTimer((function(){t.logger.log("uploadFile:: upload policy will change,now policy:"+t.curProvider+" nextProvider:"+$u(t.mixStorePolicy.providers[0])),t.curProvider=$u(t.mixStorePolicy.providers[0]),t.core.timerManager.deleteTimer(t.circuitTimer)}),1e3*h)}},t.process=function process(t){var a=this[t.cmd+"Handler"];return"function"==typeof a?a.call(this,t):t.error&&!t.error.ignore?li.reject(t.error):li.resolve(t)},CloudStorageService}(),Rh=Math.floor,mergeSort=function(t,a){var o=t.length,c=Rh(o/2);return o<8?insertionSort(t,a):merge(t,mergeSort(arraySliceSimple(t,0,c),a),mergeSort(arraySliceSimple(t,c),a),a)},insertionSort=function(t,a){for(var o,c,h=t.length,m=1;m<h;){for(c=m,o=t[m];c&&a(t[c-1],o)>0;)t[c]=t[--c];c!==m++&&(t[c]=o)}return t},merge=function(t,a,o,c){for(var h=a.length,m=o.length,v=0,b=0;v<h||b<m;)t[v+b]=v<h&&b<m?c(a[v],o[b])<=0?a[v++]:o[b++]:v<h?a[v++]:o[b++];return t},qh=mergeSort,Eh=W.match(/firefox\/(\d+)/i),Ph=!!Eh&&+Eh[1],Ah=/MSIE|Trident/.test(W),Oh=W.match(/AppleWebKit\/(\d+)\./),Uh=!!Oh&&+Oh[1],Bh=[],jh=T(Bh.sort),Lh=T(Bh.push),Nh=fails((function(){Bh.sort(void 0)})),Fh=fails((function(){Bh.sort(null)})),Gh=arrayMethodIsStrict("sort"),$h=!fails((function(){if(Y)return Y<70;if(!(Ph&&Ph>3)){if(Ah)return!0;if(Uh)return Uh<603;var t,a,o,c,h="";for(t=65;t<76;t++){switch(a=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:o=3;break;case 68:case 71:o=4;break;default:o=2}for(c=0;c<47;c++)Bh.push({k:a+c,v:o})}for(Bh.sort((function(t,a){return a.v-t.v})),c=0;c<Bh.length;c++)a=Bh[c].k.charAt(0),h.charAt(h.length-1)!==a&&(h+=a);return"DGBEFHACIJK"!==h}}));_export({target:"Array",proto:!0,forced:Nh||!Fh||!Gh||!$h},{sort:function sort(t){void 0!==t&&aCallable(t);var a=toObject(this);if($h)return void 0===t?jh(a):jh(a,t);var o,c,h=[],m=lengthOfArrayLike(a);for(c=0;c<m;c++)c in a&&Lh(h,a[c]);for(qh(h,function(t){return function(a,o){return void 0===o?-1:void 0===a?1:void 0!==t?+t(a,o)||0:toString$1(a)>toString$1(o)?1:-1}}(t)),o=lengthOfArrayLike(h),c=0;c<o;)a[c]=h[c++];for(;c<m;)deletePropertyOrThrow(a,c++);return a}});var Dh,Qh,Wh,Vh=entryVirtual("Array").sort,Kh=Array.prototype,sort=function(t){var a=t.sort;return t===Kh||Q(Kh,t)&&a===Kh.sort?Vh:a};!function(t){t[t.ASC=1]="ASC",t[t.DESC=2]="DESC"}(Dh||(Dh={})),function(t){t[t.reorderWeight=0]="reorderWeight",t[t.createTime=1]="createTime",t[t.totalMember=2]="totalMember"}(Qh||(Qh={})),function(t){t[t.square=1]="square",t[t.person=2]="person"}(Wh||(Wh={}));var zh=function(){function Service(t,a){this.name=t,this.core=a,this.name=t,this.logger=a.logger,this.core=a}return Service.prototype.process=function process(t){var a=this[t.cmd+"Handler"];return"function"==typeof a?a.call(this,t):t.error&&!t.error.ignore?li.reject(t.error):li.resolve(t)},Service}(),Hh={"24_15":"qchatSubscribe","24_27":"qchatGetUnreadInfo","24_48":"qchatCreateChannel","24_49":"qchatDeleteChannel","24_50":"qchatUpdateChannel","24_51":"qchatGetChannels","24_52":"qchatGetChannelsByPage","24_53":"qchatGetMembersByPage","24_54":"qchatUpdateWhiteBlackRole","24_55":"qchatGetWhiteBlackRolesPage","24_56":"qchatUpdateWhiteBlackMembers","24_57":"qchatGetWhiteBlackMembersPage","24_58":"qchatGetExistingWhiteBlackRoles","24_59":"qchatGetExistingWhiteBlackMembers","24_60":"qchatUpdateCategoryInfoOfChannel","24_109":"qchatCreateChannelCategory","24_110":"qchatRemoveChannelCategory","24_111":"qchatUpdateChannelCategory","24_112":"qchatGetChannelCategoriesByID","24_113":"qchatUpdateChannelCategoryWhiteBlackRole","24_114":"qchatGetChannelCategoryWhiteBlackRolesPage","24_115":"qchatUpdateChannelCategoryWhiteBlackMembers","24_116":"qchatGetChannelCategoryWhiteBlackMembersPage","24_117":"qchatGetChannelCategoryWhiteBlackRoles","24_118":"qchatGetChannelCategoryWhiteBlackMembers","24_119":"qchatGetChannelCategoriesPage","24_120":"qchatGetChannelCategoryChannelsPage","24_93":"qchatGetChannelSearchByPage","24_95":"qchatChannelMemberSearch","25_8":"qchatGetRoleIdsByServerId","25_9":"qchatSubscribeAsVisitor"},Jh={serverId:1,channelId:2,ackTimestamp:3,unreadCount:4,mentionedCount:5,maxCount:6,lastMsgTime:7},Yh={channelInfo:{channelId:1,serverId:2,name:4,topic:5,ext:6,type:7,validFlag:8,createTime:9,updateTime:10,owner:11,viewMode:12,categoryId:13,syncMode:14,reorderWeight:15,visitorMode:16},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11},qchatSubReqTag:{type:1,opeType:2},qchatChannelIdInfoTag:{serverId:1,channelId:2},unreadInfo:Jh,qchatGetChannelListPageTag:{serverId:1,timetag:2,limit:3},qchatGetMembersByPageTag:{serverId:1,channelId:2,timetag:3,limit:4},qchatUpdateWhiteBlackRoleTag:{serverId:1,channelId:2,type:3,opeType:4,roleId:5},qchatGetWhiteBlackRolesPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatUpdateWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,opeType:4,toAccids:5},qchatGetWhiteBlackMembersPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatGetExistingWhiteBlackRolesTag:{serverId:1,channelId:2,type:3,roleIds:4},qchatGetExistingWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,accids:4},QChatChannelCategoryInfo:{categoryId:1,serverId:2,name:4,ext:5,owner:6,viewMode:7,validFlag:8,createTime:9,updateTime:10,channelNumber:11},qchatUpdateChannelCategoryWhiteBlackRoleTag:{serverId:1,categoryId:2,type:3,opeType:4,roleId:5},qchatGetChannelCategoryWhiteBlackRolesPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatUpdateChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,opeType:4,toAccids:5},qchatGetChannelCategoryWhiteBlackMembersPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatGetChannelCategoryWhiteBlackRolesTag:{serverId:1,categoryId:2,type:3,roleIds:4},qchatGetChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,accids:4},qchatGetChannelCategoriesPageTag:{serverId:1,timetag:2,limit:3},qchatGetChannelCategoryChannelsPageTag:{serverId:1,categoryId:2,timetag:3,limit:4},qchatGetChannelSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverId:6,sort:7,cursor:8},qchatUpdateChannelTag:{channelId:1,name:4,topic:5,ext:6,viewMode:12,visitorMode:16},serverRoles:{serverId:1,roleIds:2,timeTag:3},qchatChannelMemberSearchTag:{serverId:1,channelId:2,keyword:3,limit:4},qchatChannelMemberInfo:{serverId:1,channelId:2,avatar:3,accid:4,nick:5,createTime:6,updateTime:7}},Xh=invertSerializeMap(Yh),Zh={qchatCreateChannel:{sid:24,cid:48,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:Yh.channelInfo},{type:"Property",name:"antispamTag",reflectMapper:Yh.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:Xh.channelInfo}]},qchatDeleteChannel:{sid:24,cid:49,service:"qchatChannel",params:[{type:"Long",name:"channelId"}]},qchatUpdateChannel:{sid:24,cid:50,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:Yh.qchatUpdateChannelTag},{type:"Property",name:"antispamTag",reflectMapper:Yh.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:Xh.channelInfo}]},qchatGetChannels:{sid:24,cid:51,service:"qchatChannel",params:[{type:"LongArray",name:"channelIds"}],response:[{type:"PropertyArray",name:"channelList",reflectMapper:Xh.channelInfo}]},qchatGetChannelsByPage:{sid:24,cid:52,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelListPageTag",reflectMapper:Yh.qchatGetChannelListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Xh.channelInfo}]},qchatGetMembersByPage:{sid:24,cid:53,service:"qchatChannel",params:[{type:"Property",name:"qchatGetMembersByPageTag",reflectMapper:Yh.qchatGetMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Xh.memberInfo}]},qchatUpdateWhiteBlackRole:{sid:24,cid:54,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackRoleTag",reflectMapper:Yh.qchatUpdateWhiteBlackRoleTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Xh.memberInfo}]},qchatGetWhiteBlackRolesPage:{sid:24,cid:55,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackRolesPageTag",reflectMapper:Yh.qchatGetWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Xh.serverRole}]},qchatUpdateWhiteBlackMembers:{sid:24,cid:56,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackMembersTag",reflectMapper:Yh.qchatUpdateWhiteBlackMembersTag}]},qchatGetWhiteBlackMembersPage:{sid:24,cid:57,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackMembersPageTag",reflectMapper:Yh.qchatGetWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Xh.memberInfo}]},qchatGetExistingWhiteBlackRoles:{sid:24,cid:58,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackRolesTag",reflectMapper:Yh.qchatGetExistingWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Xh.serverRole}]},qchatGetExistingWhiteBlackMembers:{sid:24,cid:59,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackMembersTag",reflectMapper:Yh.qchatGetExistingWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Xh.memberInfo}]},qchatUpdateCategoryInfoOfChannel:{sid:24,cid:60,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateCategoryInfoOfChannelTag",reflectMapper:Yh.channelInfo}],response:[{type:"Property",name:"channelInfo",reflectMapper:Xh.channelInfo}]},qchatCreateChannelCategory:{sid:24,cid:109,service:"qchatChannel",params:[{type:"Property",name:"qchatCreateChannelCategoryTag",reflectMapper:Yh.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:Xh.QChatChannelCategoryInfo}]},qchatRemoveChannelCategory:{sid:24,cid:110,service:"qchatChannel",params:[{type:"Long",name:"categoryId"}]},qchatUpdateChannelCategory:{sid:24,cid:111,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryTag",reflectMapper:Yh.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:Xh.QChatChannelCategoryInfo}]},qchatGetChannelCategoriesByID:{sid:24,cid:112,service:"qchatChannel",params:[{type:"LongArray",name:"categoryIds"}],response:[{type:"PropertyArray",name:"channelCategoryList",reflectMapper:Xh.QChatChannelCategoryInfo}]},qchatUpdateChannelCategoryWhiteBlackRole:{sid:24,cid:113,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackRoleTag",reflectMapper:Yh.qchatUpdateChannelCategoryWhiteBlackRoleTag}]},qchatGetChannelCategoryWhiteBlackRolesPage:{sid:24,cid:114,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesPageTag",reflectMapper:Yh.qchatGetChannelCategoryWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Xh.serverRole}]},qchatUpdateChannelCategoryWhiteBlackMembers:{sid:24,cid:115,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackMembersTag",reflectMapper:Yh.qchatUpdateChannelCategoryWhiteBlackMembersTag}]},qchatGetChannelCategoryWhiteBlackMembersPage:{sid:24,cid:116,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersPageTag",reflectMapper:Yh.qchatGetChannelCategoryWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Xh.memberInfo}]},qchatGetChannelCategoryWhiteBlackRoles:{sid:24,cid:117,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesTag",reflectMapper:Yh.qchatGetChannelCategoryWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Xh.serverRole}]},qchatGetChannelCategoryWhiteBlackMembers:{sid:24,cid:118,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersTag",reflectMapper:Yh.qchatGetChannelCategoryWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Xh.memberInfo}]},qchatGetChannelCategoriesPage:{sid:24,cid:119,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoriesPageTag",reflectMapper:Yh.qchatGetChannelCategoriesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Xh.QChatChannelCategoryInfo}]},qchatGetChannelCategoryChannelsPage:{sid:24,cid:120,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryChannelsPageTag",reflectMapper:Yh.qchatGetChannelCategoryChannelsPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:Xh.channelInfo}]},qchatSubscribe:{sid:24,cid:15,service:"qchatChannel",params:[{type:"Property",name:"qchatSubReqTag",reflectMapper:Yh.qchatSubReqTag},{type:"PropertyArray",name:"channels",reflectMapper:Yh.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:Xh.unreadInfo},{type:"PropertyArray",name:"failedChannels",reflectMapper:Xh.qchatChannelIdInfoTag}]},qchatGetUnreadInfo:{sid:24,cid:27,service:"qchatChannel",params:[{type:"PropertyArray",name:"channels",reflectMapper:Yh.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:Xh.unreadInfo}]},qchatGetChannelSearchByPage:{sid:24,cid:93,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelSearchByPageTag",reflectMapper:Yh.qchatGetChannelSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:Xh.channelInfo}]},qchatGetRoleIdsByServerId:{sid:25,cid:8,service:"qchatChannel",params:[{type:"Property",name:"qchatGetRoleIdsByServerIdTag",reflectMapper:{serverIdTimeTags:1}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:Xh.serverRoles},{type:"LongArray",name:"failServerIds"}]},qchatChannelMemberSearch:{sid:24,cid:95,service:"qchatChannel",params:[{type:"Property",name:"qchatChannelMemberSearchTag",reflectMapper:Yh.qchatChannelMemberSearchTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Xh.qchatChannelMemberInfo}]},qchatSubscribeAsVisitor:{sid:25,cid:9,service:"qchatChannel",params:[{type:"Property",name:"tag",reflectMapper:Yh.qchatSubReqTag},{type:"PropertyArray",name:"datas",reflectMapper:Yh.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"failedArr",reflectMapper:Xh.qchatChannelIdInfoTag}]}},ef={"24_31":"qchatCreateServer","24_32":"qchatDeleteServer","24_33":"qchatUpdateServer","24_34":"qchatGetServers","24_35":"qchatGetServersByPage","24_36":"qchatInviteServerMembers","24_37":"qchatAcceptServerInvite","24_38":"qchatRejectInviteServer","24_39":"qchatApplyServerJoin","24_40":"qchatAcceptServerApply","24_41":"qchatRejectServerApply","24_42":"qchatKickServerMembers","24_43":"qchatLeaveServer","24_44":"qchatUpdateMyMemberInfo","24_45":"qchatUpdateServerMemberInfo","24_46":"qchatGetServerMembers","24_47":"qchatGetServerMembersByPage","24_104":"qchatUpdateServerMemberBan","24_105":"qchatGetBannedMembersByPage","24_91":"qchatServerSearchByPage","24_92":"qchatServerMemberSearchByPage","24_122":"qchatGenerateInviteCode","24_123":"qchatJoinByInviteCode","24_124":"qchatGetInviteApplyRecordOfServer","24_125":"qchatGetInviteApplyRecordOfSelf","25_5":"qchatClearServersUnread","25_7":"qchatSubscribeChannelsByServers","25_10":"qchatEnterAsVisitor","25_11":"qchatLeaveAsVisitor"},tf={serverInfo:{serverId:1,name:3,icon:4,ext:5,owner:6,memberNumber:7,inviteMode:8,applyMode:9,validFlag:10,createTime:11,updateTime:12,channelNumber:13,categoryNumber:14,searchType:15,searchEnable:16,reorderWeight:17},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},otherMemberInfo:{serverId:1,accid:3,nick:4,avatar:5,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},getServerListPageTag:{timestamp:1,limit:2},getServerMemberListPageTag:{serverId:1,timetag:2,limit:3},updateServerMemberBanTag:{serverId:1,opeType:2,accid:3,ext:4},getBannedMembersByPageTag:{serverId:1,timetag:2,limit:3},serverMemberBanInfo:{serverId:1,appid:2,accid:3,ext:4,banTime:5,validFlag:6,createTime:7,updateTime:8},serverSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverType:6,searchType:7,sort:8,cursor:9},serverMemberSearchByPageTag:{serverId:1,keyword:3,limit:4},inviteRespParamTag:{requestId:1},applyRespParamTag:{requestId:1,expireTime:2},inviteApplyRecord:{accid:1,type:2,serverId:3,status:4,requestId:5,createTime:6,updateTime:7,expireTime:8,data:9,recordId:10},clearServersUnreadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},unreadInfo:Jh},rf=invertSerializeMap(tf),nf={qchatCreateServer:{sid:24,cid:31,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:tf.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:tf.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:rf.serverInfo}]},qchatDeleteServer:{sid:24,cid:32,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateServer:{sid:24,cid:33,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:tf.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:tf.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:rf.serverInfo}]},qchatGetServers:{sid:24,cid:34,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"serverList",reflectMapper:rf.serverInfo}]},qchatGetServersByPage:{sid:24,cid:35,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:tf.getServerListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:rf.serverInfo}]},qchatInviteServerMembers:{sid:24,cid:36,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"StrArray",name:"failByOverAccids"},{type:"StrArray",name:"failByBanAccids"},{type:"Property",name:"record",reflectMapper:rf.applyRespParamTag}]},qchatAcceptServerInvite:{sid:24,cid:37,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:tf.inviteRespParamTag}]},qchatRejectInviteServer:{sid:24,cid:38,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:tf.inviteRespParamTag}]},qchatApplyServerJoin:{sid:24,cid:39,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"Property",name:"data",reflectMapper:rf.applyRespParamTag}]},qchatAcceptServerApply:{sid:24,cid:40,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:tf.applyRespParamTag}]},qchatRejectServerApply:{sid:24,cid:41,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:tf.applyRespParamTag}]},qchatKickServerMembers:{sid:24,cid:42,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"}]},qchatLeaveServer:{sid:24,cid:43,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateMyMemberInfo:{sid:24,cid:44,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:tf.memberInfo},{type:"Property",name:"antispamTag",reflectMapper:tf.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:rf.memberInfo}]},qchatUpdateServerMemberInfo:{sid:24,cid:45,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:tf.otherMemberInfo},{type:"Property",name:"antispamTag",reflectMapper:tf.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:rf.memberInfo}]},qchatGetServerMembers:{sid:24,cid:46,service:"qchatServer",params:[{type:"StrArray",name:"accids"}],response:[{type:"PropertyArray",name:"accidList",reflectMapper:rf.memberInfo}]},qchatGetServerMembersByPage:{sid:24,cid:47,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:tf.getServerMemberListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:rf.memberInfo}]},qchatUpdateServerMemberBan:{sid:24,cid:104,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:tf.updateServerMemberBanTag}]},qchatGetBannedMembersByPage:{sid:24,cid:105,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:tf.getBannedMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:rf.serverMemberBanInfo}]},qchatServerSearchByPage:{sid:24,cid:91,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:tf.serverSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:rf.serverInfo}]},qchatServerMemberSearchByPage:{sid:24,cid:92,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:tf.serverMemberSearchByPageTag}],response:[{type:"PropertyArray",name:"members",reflectMapper:rf.serverMemberBanInfo}]},qchatGenerateInviteCode:{sid:24,cid:122,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,ttl:2}}],response:[{type:"Property",name:"data",reflectMapper:{1:"serverId",2:"requestId",3:"inviteCode",4:"expireTime"}}]},qchatJoinByInviteCode:{sid:24,cid:123,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,inviteCode:2,ps:3}}]},qchatGetInviteApplyRecordOfServer:{sid:24,cid:124,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,fromTime:2,toTime:3,reverse:4,limit:5,cursor:6}}],response:[{type:"PropertyArray",name:"data",reflectMapper:rf.inviteApplyRecord}]},qchatGetInviteApplyRecordOfSelf:{sid:24,cid:125,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{fromTime:1,toTime:2,reverse:3,limit:4,cursor:5}}],response:[{type:"PropertyArray",name:"data",reflectMapper:rf.inviteApplyRecord}]},qchatClearServersUnread:{sid:25,cid:5,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"Property",name:"clearServersUnreadTag",reflectMapper:rf.clearServersUnreadTag}]},qchatSubscribeChannelsByServers:{sid:25,cid:7,service:"qchatServer",params:[{type:"int",name:"type"},{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:rf.unreadInfo},{type:"LongArray",name:"failServerIds"}]},qchatEnterAsVisitor:{sid:25,cid:10,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"LongArray",name:"failServerIds"}]},qchatLeaveAsVisitor:{sid:25,cid:11,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"LongArray",name:"failServerIds"}]}},af=Function.prototype,sf=Object.prototype,cf=af.toString,lf=sf.hasOwnProperty,uf=cf.call(Object);var df=function isPlainObject(t){if(!Jc(t)||"[object Object]"!=Ps(t))return!1;var a=lh(t);if(null===a)return!0;var o=lf.call(a,"constructor")&&a.constructor;return"function"==typeof o&&o instanceof o&&cf.call(o)==uf};function format(t,a){if(!df(a))return{};var o=JSON.parse(us(a)),c=doFormat(t,o);return JSON.parse(us(ki(ki({},o),c)))}function doFormat(t,a){if(!df(a))return{};var o={},c=Oc(t);return forEach$1(c).call(c,(function(c){var h=t[c].type;if("string"!=typeof h){var m=doFormat(t[c],a);Oc(m).length>0&&(o[c]=m)}else{var v=t[c],b=v.rawKey||c,C=pf[h](a,b,v);void 0!==C&&(a[b]=void 0,o[c]=C)}})),o}var pf={number:function number(t,a){if(void 0!==t[a])return+t[a]},string:function string(t,a){if(void 0!==t[a])return t[a]},boolean:function boolean(t,a){return+t[a]>0||0!=+t[a]&&void 0},enum:function _enum(t,a,o){return values(o)[t[a]]},object:function object(t,a){if(void 0!==t[a])try{return JSON.parse(t[a])}catch(t){return{}}}};function formatReverse(t,a){if(!df(a))return{};var o=JSON.parse(us(a)),c=doFormatReverse(t,o);return JSON.parse(us(ki(ki({},o),c)))}function doFormatReverse(t,a){var o;if(!df(a))return reduce(o=Oc(t)).call(o,(function(a,o){return a[t[o].rawKey||o]=void 0,a}),{});var c={},h=Oc(t);return forEach$1(h).call(h,(function(o){var h=t[o].type;if("string"!=typeof h){var m=doFormatReverse(t[o],a[o]);return ki(c,m),void(a[o]=void 0)}var v=t[o],b=v.rawKey||o,C=hf[h](a,o,v);a[b]=void 0,c[b]=C})),c}var hf={number:function number(t,a){return t[a]},string:function string(t,a){return t[a]},boolean:function boolean(t,a){return!0===t[a]?1:!1===t[a]?0:void 0},enum:function _enum(t,a,o){return values(o)[t[a]]},object:function object(t,a){if(void 0!==t[a])try{return us(t[a])}catch(t){return""}}},ff=hf,mf={serverId:{type:"string"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"},owner:{type:"string"},memberNumber:{type:"number"},inviteMode:{type:"number"},applyMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"},categoryNumber:{type:"number"},searchType:{type:"number"},searchEnable:{type:"boolean"},reorderWeight:{type:"string"}},vf={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},gf={serverId:{type:"string"},appid:{type:"string"},accid:{type:"string"},ext:{type:"string"},banTime:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}};function formatServer(t){return format(mf,t)}function formatServers(t){return Wc(t)&&t.length>0?map(t).call(t,(function(t){return formatServer(t)})):[]}function formatMember$1(t){return format(vf,t)}function formatMembers$1(t){return Wc(t)&&t.length>0?map(t).call(t,(function(t){return formatMember$1(t)})):[]}function formatServerMemberBanInfos(t){return Wc(t)&&t.length>0?map(t).call(t,(function(t){return function formatServerMemberBanInfo(t){return format(gf,t)}(t)})):[]}function generateAntispamTag(t){var a,o,c;if(!t.antispamTag)return{};var h=ki({},t.antispamTag);return(null===(a=t.antispamTag)||void 0===a?void 0:a.antiSpamBusinessId)&&"string"!=typeof(null===(o=t.antispamTag)||void 0===o?void 0:o.antiSpamBusinessId)&&(h.antiSpamBusinessId=us(null===(c=t.antispamTag)||void 0===c?void 0:c.antiSpamBusinessId)),h}var yf={accid:{type:"string"},type:{type:"number"},serverId:{type:"string"},status:{type:"number"},requestId:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"},expireTime:{type:"number"},data:{type:"object"}};function formatInviteApplyRecord(t){return format(yf,t)}function formatInviteApplyRecords(t){return Wc(t)&&t.length>0?map(t).call(t,(function(t){return formatInviteApplyRecord(t)})):[]}var bf,Cf,Sf,Mf,_f={successServerIds:{type:"object"},failServerIds:{type:"object"},ackTimestamp:{type:"number"}};function formatClearServersUnread(t){return format(_f,t)}!function(t){t[t.reorderWeight=0]="reorderWeight",t[t.createTime=1]="createTime"}(bf||(bf={})),function(t){t[t.white=1]="white",t[t.black=2]="black"}(Cf||(Cf={})),function(t){t[t.add=1]="add",t[t.remove=2]="remove"}(Sf||(Sf={})),function(t){t[t.message=0]="message",t[t.media=1]="media",t[t.ext=100]="ext"}(Mf||(Mf={}));var wf={channelId:{type:"string"},serverId:{type:"string"},name:{type:"string"},topic:{type:"string"},ext:{type:"string"},type:{type:"enum",values:Mf},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},viewMode:{type:"number"},categoryId:{type:"string"},syncMode:{type:"number"},visitorMode:{type:"number"},reorderWeight:{type:"string"}},If={serverId:{type:"string"},channelId:{type:"string"},ackTimestamp:{type:"number"},unreadCount:{type:"number"},mentionedCount:{type:"number"},maxCount:{type:"number"},lastMsgTime:{type:"number"}},xf={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:Cf},opeType:{type:"enum",values:Sf},toAccids:{type:"object"}},Tf={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:Cf},opeType:{type:"enum",values:Sf},roleId:{type:"string"}},kf={categoryId:{type:"string"},serverId:{type:"string"},name:{type:"string"},ext:{type:"string"},owner:{type:"string"},viewMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"}},Rf={serverId:{type:"string"},channelId:{type:"string"},accid:{type:"string"},avatar:{type:"string"},nick:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function formatUpdateWhiteBlackRole(t){return format(Tf,t)}function formatChannel(t){return format(wf,t)}function formatChannels(t){return Wc(t)&&t.length>0?map(t).call(t,(function(t){return formatChannel(t)})):[]}function formatUnreadInfo(t){return format(If,t)}function formatUnreadInfos(t){return Wc(t)&&t.length>0?map(t).call(t,(function(t){return formatUnreadInfo(t)})):[]}function formatChannelCategory(t){return format(kf,t)}function formatChannelCategorys(t){return Wc(t)&&t.length>0?map(t).call(t,(function(t){return formatChannelCategory(t)})):[]}function formatChannelMembers(t){return Wc(t)&&t.length>0?map(t).call(t,(function(t){return function formatChannelMember(t){return format(Rf,t)}(t)})):[]}var qf=_s?_s.isConcatSpreadable:void 0;var Ef=function isFlattenable(t){return xd(t)||Fd(t)||!!(qf&&t&&t[qf])};var Pf=function baseFlatten(t,a,o,c,h){var m=-1,v=t.length;for(o||(o=Ef),h||(h=[]);++m<v;){var b=t[m];a>0&&o(b)?a>1?baseFlatten(b,a-1,o,c,h):Id(h,b):c||(h[h.length]=b)}return h},Af=du((function(t,a){return fu(t)?eu(t,Pf(a,1,fu,!0)):[]})),Of=Af;function _createForOfIteratorHelperLoose(t,a){var o,c=void 0!==Kn&&rd(t)||t["@@iterator"];if(c)return bind$1(o=(c=c.call(t)).next).call(o,c);if(Wc(t)||(c=function _unsupportedIterableToArray(t,a){var o;if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,a);var c=slice(o=Object.prototype.toString.call(t)).call(o,8,-1);"Object"===c&&t.constructor&&(c=t.constructor.name);if("Map"===c||"Set"===c)return td(t);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray(t,a)}(t))||a&&t&&"number"==typeof t.length){c&&(t=c);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayLikeToArray(t,a){(null==a||a>t.length)&&(a=t.length);for(var o=0,c=new Array(a);o<a;o++)c[o]=t[o];return c}var Uf,Bf,jf,Lf,Nf=function(t){function QChatServerService(a){var o;return(o=t.call(this,"qchatServer",a)||this).core=a,registerParser({cmdMap:ef,cmdConfig:nf}),o}wt(QChatServerService,t);var a=QChatServerService.prototype;return a.createServer=function createServer(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee(){var a;return Mi.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return validate({icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatCreateServer",{serverInfo:ki(ki({},t),{searchEnable:!1===t.searchEnable?0:1}),antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatServer(a.content.serverInfo));case 5:case"end":return o.stop()}}),_callee,this)})))},a.deleteServer=function deleteServer(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee2(){return Mi.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatDeleteServer",t);case 3:case"end":return a.stop()}}),_callee2,this)})))},a.updateServer=function updateServer(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee3(){var a;return Mi.wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",min:1},icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateServer",{serverInfo:ki(ki({},t),{searchEnable:!1===t.searchEnable?0:1}),antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatServer(a.content.serverInfo));case 5:case"end":return o.stop()}}),_callee3,this)})))},a.getServers=function getServers(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee4(){var a;return Mi.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverIds:{type:"array",itemType:"string",min:1}},t),o.next=3,this.core.sendCmd("qchatGetServers",t);case 3:return a=o.sent,o.abrupt("return",formatServers(a.content.serverList));case 5:case"end":return o.stop()}}),_callee4,this)})))},a.getServersByPage=function getServersByPage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee5(){var a,o,c,h;return Mi.wrap((function _callee5$(m){for(;;)switch(m.prev=m.next){case 0:return validate({timestamp:{type:"number"},limit:{type:"number",min:1,required:!1}},t),m.next=3,this.core.sendCmd("qchatGetServersByPage",{tag:t});case 3:return a=m.sent,o=a.content,c=o.datas,h=o.listQueryTag,m.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:$u(h.nextTimetag)},datas:formatServers(c)});case 6:case"end":return m.stop()}}),_callee5,this)})))},a.inviteServerMembers=function inviteServerMembers(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee6(){var a,o;return Mi.wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},t),c.next=3,this.core.sendCmd("qchatInviteServerMembers",t);case 3:return a=c.sent,o=a.content.record||{},c.abrupt("return",{failByOverAccids:a.content.failByOverAccids,failByBanAccids:a.content.failByBanAccids,recordInfo:formatInviteApplyRecord(o)});case 6:case"end":return c.stop()}}),_callee6,this)})))},a.acceptServerInvite=function acceptServerInvite(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee7(){return Mi.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatAcceptServerInvite",t);case 3:case"end":return a.stop()}}),_callee7,this)})))},a.rejectInviteServer=function rejectInviteServer(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee8(){return Mi.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatRejectInviteServer",t);case 3:case"end":return a.stop()}}),_callee8,this)})))},a.applyServerJoin=function applyServerJoin(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee9(){var a;return Mi.wrap((function _callee9$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},t),o.next=3,this.core.sendCmd("qchatApplyServerJoin",t);case 3:return a=o.sent,o.abrupt("return",formatInviteApplyRecord(a.content.data));case 5:case"end":return o.stop()}}),_callee9,this)})))},a.acceptServerApply=function acceptServerApply(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee10(){return Mi.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatAcceptServerApply",t);case 3:case"end":return a.stop()}}),_callee10,this)})))},a.rejectServerApply=function rejectServerApply(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee11(){return Mi.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatRejectServerApply",t);case 3:case"end":return a.stop()}}),_callee11,this)})))},a.kickServerMembers=function kickServerMembers(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee12(){return Mi.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatKickServerMembers",t);case 3:case"end":return a.stop()}}),_callee12,this)})))},a.leaveServer=function leaveServer(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee13(){return Mi.wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatLeaveServer",t);case 3:case"end":return a.stop()}}),_callee13,this)})))},a.updateMyMemberInfo=function updateMyMemberInfo(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee14(){var a;return Mi.wrap((function _callee14$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",required:!1},nick:{type:"string",required:!1},avatar:{type:"string",required:!1},ext:{type:"string",required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateMyMemberInfo",{memberInfo:t,antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatMember$1(a.content.memberInfo));case 5:case"end":return o.stop()}}),_callee14,this)})))},a.updateServerMemberInfo=function updateServerMemberInfo(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee15(){var a;return Mi.wrap((function _callee15$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},nick:{type:"string",required:!1},avatar:{type:"string",required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateServerMemberInfo",{memberInfo:t,antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatMember$1(a.content.memberInfo));case 5:case"end":return o.stop()}}),_callee15,this)})))},a.getServerMembers=function getServerMembers(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee16(){var a,o,c,h,m;return Mi.wrap((function _callee16$(v){for(;;)switch(v.prev=v.next){case 0:if(validate({accids:{type:"array"}},t),a=[],t.accids.length)for(o=_createForOfIteratorHelperLoose(t.accids);!(c=o()).done;)h=c.value,a.push(h.serverId+"|"+h.accid);return v.next=5,this.core.sendCmd("qchatGetServerMembers",{accids:a});case 5:return m=v.sent,v.abrupt("return",formatMembers$1(m.content.accidList));case 7:case"end":return v.stop()}}),_callee16,this)})))},a.getServerMembersByPage=function getServerMembersByPage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee17(){var a,o,c,h;return Mi.wrap((function _callee17$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),m.next=3,this.core.sendCmd("qchatGetServerMembersByPage",{tag:t});case 3:return a=m.sent,o=a.content,c=o.datas,h=o.listQueryTag,m.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:$u(h.nextTimetag)},datas:formatMembers$1(c)});case 6:case"end":return m.stop()}}),_callee17,this)})))},a.subscribeServer=function subscribeServer(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee18(){var a,o,c,h;return Mi.wrap((function _callee18$(m){for(;;)switch(m.prev=m.next){case 0:if(validate({type:{type:"number",min:4,max:4,required:!1},opeType:{type:"number",min:1,max:2}},t),t.type||(t.type=4),!t.servers.length){m.next=10;break}return o=ki(ki({},t),{channels:map(a=t.servers).call(a,(function(t){return{serverId:t.serverId,channelId:""}}))}),m.next=6,this.core.qchatChannel.subscribeModuleService.subscribe(o);case 6:return c=m.sent,h=c.failedChannels,this.core.qchatChannel.subscribeModuleService.cacheSubscribe(o),m.abrupt("return",{failedServers:h});case 10:case"end":return m.stop()}}),_callee18,this)})))},a.banServerMember=function banServerMember(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee19(){return Mi.wrap((function _callee19$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:ki(ki({},t),{opeType:1})});case 3:case"end":return a.stop()}}),_callee19,this)})))},a.unbanServerMember=function unbanServerMember(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee20(){return Mi.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:ki(ki({},t),{opeType:2})});case 3:case"end":return a.stop()}}),_callee20,this)})))},a.getBannedMembersByPage=function getBannedMembersByPage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee21(){var a,o,c,h;return Mi.wrap((function _callee21$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),m.next=3,this.core.sendCmd("qchatGetBannedMembersByPage",{tag:t});case 3:return a=m.sent,o=a.content,c=o.datas,h=o.listQueryTag,m.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:$u(h.nextTimetag)},datas:formatServerMemberBanInfos(c)});case 6:case"end":return m.stop()}}),_callee21,this)})))},a.serverSearchByPage=function serverSearchByPage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee22(){var a,o,c,h;return Mi.wrap((function _callee22$(m){for(;;)switch(m.prev=m.next){case 0:if(validate({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},serverType:{type:"array",itemType:"number",min:0,required:!1},order:{type:"enum",values:getEnumKeys(Dh),required:!1},searchType:{type:"enum",values:getEnumKeys(Wh)},sort:{type:"enum",values:getEnumKeys(Qh),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),!(t.startTime&&t.endTime&&t.startTime>=t.endTime)){m.next=3;break}throw new gc("startTime more than endTime",t,"timeRule");case 3:return m.next=5,this.core.sendCmd("qchatServerSearchByPage",{tag:ki(ki({},t),{order:t.order&&Dh[t.order],searchType:Wh[t.searchType],sort:sort(t)&&Qh[sort(t)],serverType:us(t.serverType)})});case 5:return a=m.sent,o=a.content,c=o.datas,h=o.listQueryTag,m.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:$u(h.nextTimetag),cursor:h.cursor},datas:formatServers(c)});case 8:case"end":return m.stop()}}),_callee22,this)})))},a.serverMemberSearchByPage=function serverMemberSearchByPage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee23(){var a;return Mi.wrap((function _callee23$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatServerMemberSearchByPage",{tag:t});case 3:return a=o.sent,o.abrupt("return",formatMembers$1(a.content.members));case 5:case"end":return o.stop()}}),_callee23,this)})))},a.generateInviteCode=function generateInviteCode(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee24(){var a;return Mi.wrap((function _callee24$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},ttl:{type:"number",min:0,required:!1}},t),o.next=3,this.core.sendCmd("qchatGenerateInviteCode",{tag:t});case 3:return a=o.sent,o.abrupt("return",format({expireTime:{type:"number"}},a.content.data));case 5:case"end":return o.stop()}}),_callee24,this)})))},a.joinByInviteCode=function joinByInviteCode(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee25(){return Mi.wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},inviteCode:{type:"string",allowEmpty:!1},ps:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("qchatJoinByInviteCode",{tag:t});case 3:case"end":return a.stop()}}),_callee25,this)})))},a.getInviteApplyRecordOfServer=function getInviteApplyRecordOfServer(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee26(){var a;return Mi.wrap((function _callee26$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfServer",{tag:ki(ki({},t),{reverse:reverse(t)?1:0})});case 3:return a=o.sent,o.abrupt("return",formatInviteApplyRecords(a.content.data));case 5:case"end":return o.stop()}}),_callee26,this)})))},a.getInviteApplyRecordOfSelf=function getInviteApplyRecordOfSelf(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee27(){var a;return Mi.wrap((function _callee27$(o){for(;;)switch(o.prev=o.next){case 0:return validate({fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfSelf",{tag:ki(ki({},t),{reverse:reverse(t)?1:0})});case 3:return a=o.sent,o.abrupt("return",formatInviteApplyRecords(a.content.data));case 5:case"end":return o.stop()}}),_callee27,this)})))},a.markRead=function markRead(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee28(){var a,o,c,h;return Mi.wrap((function _callee28$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverIds:{type:"array",itemType:"string",required:!0}},t),m.next=3,this.core.sendCmd("qchatClearServersUnread",t);case 3:return a=m.sent,o=formatClearServersUnread(a.content.clearServersUnreadTag),c=o.successServerIds,h=o.ackTimestamp,this.logger.log("qchatServer::clearServersUnread:: begin auto clear servers unreadInfo"),this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",c,h),m.abrupt("return",o);case 9:case"end":return m.stop()}}),_callee28,this)})))},a.subscribeAllChannel=function subscribeAllChannel(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee29(){var a,o,c,h,m=this;return Mi.wrap((function _callee29$(v){for(;;)switch(v.prev=v.next){case 0:return validate({type:{type:"number",required:!0},serverIds:{type:"array",itemType:"string",required:!0,max:10}},t),v.next=3,this.core.sendCmd("qchatSubscribeChannelsByServers",t,{timeout:3e4});case 3:(o=v.sent).content.unreadInfos=formatUnreadInfos(o.content.unreadInfos),this.core.eventBus.emit("qchatChannel/cacheUnreadCount",o.content.unreadInfos),c={type:t.type,opeType:1,channels:map(a=o.content.unreadInfos).call(a,(function(t){return{serverId:t.serverId,channelId:t.channelId}}))},this.core.eventBus.emit("qchatChannel/cacheSubscribe",c),this.core.eventBus.emit("qchatChannel/getRoleIdsByServerId",t.serverIds),this.core.emit("unreadInfos",o.content.unreadInfos);try{o.content.failServerIds=JSON.parse(o.content.failServerIds),forEach$1(h=Of(t.serverIds,o.content.failServerIds)).call(h,(function(t){m.core.emit("serverUnreadInfo",m.core.qchatChannel.subscribeModuleService.getServerUnreadInfo(t))}))}catch(t){this.core.logger.error("qchatServer::subscribeAllChannel: JSON parse failServerIds error",t)}return v.abrupt("return",o.content);case 12:case"end":return v.stop()}}),_callee29,this)})))},a.enterAsVisitor=function enterAsVisitor(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee30(){var a,o,c;return Mi.wrap((function _callee30$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverIds:{type:"array",itemType:"string",min:1}},t),h.next=3,this.core.sendCmd("qchatEnterAsVisitor",{tag:{serverIds:us(t.serverIds)}});case 3:a=h.sent,o=[];try{o=JSON.parse(a.content.failServerIds)}catch(t){o=[]}return c=Of(t.serverIds,o),this.core.qchatChannel.subscribeForVisitorService.cacheServer(c),h.abrupt("return",{failedServers:o});case 9:case"end":return h.stop()}}),_callee30,this)})))},a.leaveAsVisitor=function leaveAsVisitor(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee31(){var a,o,c,h=this;return Mi.wrap((function _callee31$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverIds:{type:"array",itemType:"string",min:1}},t),m.next=3,this.core.sendCmd("qchatLeaveAsVisitor",{tag:{serverIds:us(t.serverIds)}});case 3:a=m.sent,o=[];try{o=JSON.parse(a.content.failServerIds)}catch(t){o=[]}return c=Of(t.serverIds,o),forEach$1(c).call(c,(function(t){h.core.qchatChannel.subscribeForVisitorService.deleteServer(t)})),m.abrupt("return",{failedServers:o});case 9:case"end":return m.stop()}}),_callee31,this)})))},a.subscribeAsVisitor=function subscribeAsVisitor(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee32(){return Mi.wrap((function _callee32$(a){for(;;)switch(a.prev=a.next){case 0:if(validate({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},serverIds:{type:"array",itemType:"string",min:1}},t),!t.serverIds.length){a.next=5;break}return a.next=4,this.core.qchatChannel.subscribeForVisitorService.subscribeServerAsVisitor(t);case 4:return a.abrupt("return",a.sent);case 5:return a.abrupt("return",{failedServers:[]});case 6:case"end":return a.stop()}}),_callee32,this)})))},QChatServerService}(zh);!function(t){t[t.everyone=1]="everyone",t[t.custom=2]="custom"}(Uf||(Uf={})),function(t){t[t.normal=0]="normal",t[t.owner=1]="owner"}(Bf||(Bf={})),function(t){t[t.ignore=0]="ignore",t[t.deny=-1]="deny",t[t.allow=1]="allow"}(jf||(jf={})),function(t){t[t.manageServer=1]="manageServer",t[t.manageChannel=2]="manageChannel",t[t.manageRole=3]="manageRole",t[t.sendMsg=4]="sendMsg",t[t.accountInfoSelf=5]="accountInfoSelf",t[t.inviteServer=6]="inviteServer",t[t.kickServer=7]="kickServer",t[t.accountInfoOther=8]="accountInfoOther",t[t.recallMsg=9]="recallMsg",t[t.deleteMsg=10]="deleteMsg",t[t.remindOther=11]="remindOther",t[t.remindEveryone=12]="remindEveryone",t[t.manageBlackWhiteList=13]="manageBlackWhiteList",t[t.banServerMember=14]="banServerMember",t[t.RTCChannelConnect=15]="RTCChannelConnect",t[t.RTCChannelDisconnectOther=16]="RTCChannelDisconnectOther",t[t.RTCChannelOpenMicrophone=17]="RTCChannelOpenMicrophone",t[t.RTCChannelOpenCamera=18]="RTCChannelOpenCamera",t[t.RTCChannelOpenCloseOtherMicrophone=19]="RTCChannelOpenCloseOtherMicrophone",t[t.RTCChannelOpenCloseOtherCamera=20]="RTCChannelOpenCloseOtherCamera",t[t.RTCChannelOpenCloseEveryoneMicrophone=21]="RTCChannelOpenCloseEveryoneMicrophone",t[t.RTCChannelOpenCloseEveryoneCamera=22]="RTCChannelOpenCloseEveryoneCamera",t[t.RTCChannelOpenShareScreen=23]="RTCChannelOpenShareScreen",t[t.RTCChannelCloseOtherShareScreen=24]="RTCChannelCloseOtherShareScreen",t[t.manageInviteApply=25]="manageInviteApply",t[t.manageInviteApplyHistory=26]="manageInviteApplyHistory",t[t.mentionedRole=27]="mentionedRole"}(Lf||(Lf={}));var Ff={type:{type:"enum",values:Uf},memberType:{type:"enum",values:Bf},createTime:{type:"number"},updateTime:{type:"number"},priority:{type:"number"},memberCount:{type:"number"},joinTime:{type:"number"}},Gf={roleId:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},type:{type:"enum",values:Uf},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"}},$f={id:{type:"string"},accid:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},memberType:{type:"enum",values:Bf},joinTime:{type:"number"},inviter:{type:"string"}};function generatorRoleForCmd(t){var a=ki({},t),o=formatReverse(Ff,a);return o.auths&&(o.auths=function generateRoleAuthsForCmd(t){var a,o=reduce(a=Oc(t)).call(a,(function(a,o){var c=Lf[o];return c?a[c]=jf[t[o]]:a[o]=jf[t[o]],a}),{});return us(o)}(o.auths)),o}function formatRoleAuths(t){var a;return reduce(a=Oc(t)).call(a,(function(a,o){var c=getEnumKeyByEnumValue(Lf,o);c?a[c]=jf[t[o]]:a[$u(o)]=jf[t[o]];return a}),{})}function formatRole(t){var a=format(Ff,t);return t.auths&&(a.auths=formatRoleAuths(JSON.parse(a.auths))),a.isMember&&delete a.isMember,a}function formatRoles(t){return Wc(t)&&t.length>0?map(t).call(t,(function(t){return formatRole(t)})):[]}function formatChannelCategoryRole(t){return t.auths&&(t.auths=formatRoleAuths(JSON.parse(t.auths))),format(Gf,t)}function formatChannelCategoryMemberRole(t){return t.auths&&(t.auths=formatRoleAuths(JSON.parse(t.auths))),format($f,t)}collection("Set",(function(t){return function Set(){return t(this,arguments.length?arguments[0]:void 0)}}),$i);var Df=D.Set;_export({target:"Set",stat:!0,forced:!0},{from:Wi}),_export({target:"Set",stat:!0,forced:!0},{of:Vi});_export({target:"Set",proto:!0,real:!0,forced:!0},{addAll:function addAll(){for(var t=anObject(this),a=aCallable(t.add),o=0,c=arguments.length;o<c;o++)q(a,t,arguments[o]);return t}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{deleteAll:Ki});var Qf=getIterator;_export({target:"Set",proto:!0,real:!0,forced:!0},{every:function every(t){var a=anObject(this),o=Qf(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return!iterate(o,(function(t,o){if(!c(t,t,a))return o()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{difference:function difference(t){var a=anObject(this),o=new(speciesConstructor(a,getBuiltIn("Set")))(a),c=aCallable(o.delete);return iterate(t,(function(t){q(c,o,t)})),o}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{filter:function filter(t){var a=anObject(this),o=Qf(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0),h=new(speciesConstructor(a,getBuiltIn("Set"))),m=aCallable(h.add);return iterate(o,(function(t){c(t,t,a)&&q(m,h,t)}),{IS_ITERATOR:!0}),h}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{find:function find(t){var a=anObject(this),o=Qf(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(o,(function(t,o){if(c(t,t,a))return o(t)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{intersection:function intersection(t){var a=anObject(this),o=new(speciesConstructor(a,getBuiltIn("Set"))),c=aCallable(a.has),h=aCallable(o.add);return iterate(t,(function(t){q(c,a,t)&&q(h,o,t)})),o}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{isDisjointFrom:function isDisjointFrom(t){var a=anObject(this),o=aCallable(a.has);return!iterate(t,(function(t,c){if(!0===q(o,a,t))return c()}),{INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{isSubsetOf:function isSubsetOf(t){var a=getIterator(this),o=anObject(t),c=o.has;return isCallable(c)||(o=new(getBuiltIn("Set"))(t),c=aCallable(o.has)),!iterate(a,(function(t,a){if(!1===q(c,o,t))return a()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{isSupersetOf:function isSupersetOf(t){var a=anObject(this),o=aCallable(a.has);return!iterate(t,(function(t,c){if(!1===q(o,a,t))return c()}),{INTERRUPTED:!0}).stopped}});var Wf=T([].join),Vf=[].push;_export({target:"Set",proto:!0,real:!0,forced:!0},{join:function join(t){var a=anObject(this),o=Qf(a),c=void 0===t?",":toString$1(t),h=[];return iterate(o,Vf,{that:h,IS_ITERATOR:!0}),Wf(h,c)}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{map:function map(t){var a=anObject(this),o=Qf(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0),h=new(speciesConstructor(a,getBuiltIn("Set"))),m=aCallable(h.add);return iterate(o,(function(t){q(m,h,c(t,t,a))}),{IS_ITERATOR:!0}),h}});var Kf=TypeError;_export({target:"Set",proto:!0,real:!0,forced:!0},{reduce:function reduce(t){var a=anObject(this),o=Qf(a),c=arguments.length<2,h=c?void 0:arguments[1];if(aCallable(t),iterate(o,(function(o){c?(c=!1,h=o):h=t(h,o,o,a)}),{IS_ITERATOR:!0}),c)throw Kf("Reduce of empty set with no initial value");return h}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{some:function some(t){var a=anObject(this),o=Qf(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0);return iterate(o,(function(t,o){if(c(t,t,a))return o()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{symmetricDifference:function symmetricDifference(t){var a=anObject(this),o=new(speciesConstructor(a,getBuiltIn("Set")))(a),c=aCallable(o.delete),h=aCallable(o.add);return iterate(t,(function(t){q(c,o,t)||q(h,o,t)})),o}}),_export({target:"Set",proto:!0,real:!0,forced:!0},{union:function union(t){var a=anObject(this),o=new(speciesConstructor(a,getBuiltIn("Set")))(a);return iterate(t,aCallable(o.add),{that:o}),o}});var zf,Hf,Jf,Yf,Xf,Zf,em,tm=Df;!function(t){t[t.sendTime=1]="sendTime"}(zf||(zf={})),function(t){t[t.text=0]="text",t[t.image=1]="image",t[t.audio=2]="audio",t[t.video=3]="video",t[t.geo=4]="geo",t[t.notification=5]="notification",t[t.file=6]="file",t[t.tip=10]="tip",t[t.robot=11]="robot",t[t.g2=12]="g2",t[t.custom=100]="custom"}(Hf||(Hf={})),function(t){t[t.sending=1]="sending",t[t.success=2]="success",t[t.failed=3]="failed"}(Jf||(Jf={})),function(t){t[t.notifyAll=1]="notifyAll",t[t.notifySubscribe=2]="notifySubscribe"}(Yf||(Yf={})),function(t){t[t.unknown=0]="unknown",t[t.server=1]="server",t[t.channel=2]="channel",t[t.serverAccids=3]="serverAccids",t[t.channelAccids=4]="channelAccids",t[t.accids=5]="accids"}(Xf||(Xf={})),function(t){t[t.serverMemberInvite=1]="serverMemberInvite",t[t.serverMemberInviteReject=2]="serverMemberInviteReject",t[t.serverMemberApply=3]="serverMemberApply",t[t.serverMemberApplyReject=4]="serverMemberApplyReject",t[t.serverCreate=5]="serverCreate",t[t.serverRemove=6]="serverRemove",t[t.serverUpdate=7]="serverUpdate",t[t.serverMemberInviteDone=8]="serverMemberInviteDone",t[t.serverMemberInviteAccept=9]="serverMemberInviteAccept",t[t.serverMemberApplyDone=10]="serverMemberApplyDone",t[t.serverMemberApplyAccept=11]="serverMemberApplyAccept",t[t.serverMemberKick=12]="serverMemberKick",t[t.serverMemberLeave=13]="serverMemberLeave",t[t.serverMemberUpdate=14]="serverMemberUpdate",t[t.channelCreate=15]="channelCreate",t[t.channelRemove=16]="channelRemove",t[t.channelUpdate=17]="channelUpdate",t[t.channelUpdateWhiteBlackIdentify=18]="channelUpdateWhiteBlackIdentify",t[t.channelUpdateWhiteBlackIdentifyUser=19]="channelUpdateWhiteBlackIdentifyUser",t[t.updateQuickComment=20]="updateQuickComment",t[t.channelCategoryCreate=21]="channelCategoryCreate",t[t.channelCategoryRemove=22]="channelCategoryRemove",t[t.channelCategoryUpdate=23]="channelCategoryUpdate",t[t.channelCategoryUpdateWhiteBlackIdentify=24]="channelCategoryUpdateWhiteBlackIdentify",t[t.channelCategoryUpdateWhiteBlackIdentifyUser=25]="channelCategoryUpdateWhiteBlackIdentifyUser",t[t.serverIdentifyAdd=26]="serverIdentifyAdd",t[t.serverIdentifyRemove=27]="serverIdentifyRemove",t[t.serverIdentifyUpdate=28]="serverIdentifyUpdate",t[t.channelIdentifyUpdate=29]="channelIdentifyUpdate",t[t.userIdentifyUpdate=30]="userIdentifyUpdate",t[t.channelVisibilityUpdate=31]="channelVisibilityUpdate",t[t.serverEnterLeave=32]="serverEnterLeave",t[t.serverMemberJoinByInviteCode=33]="serverMemberJoinByInviteCode",t[t.channelVisibilityToVisitorUpdate=34]="channelVisibilityToVisitorUpdate",t[t.myMemberInfoUpdated=35]="myMemberInfoUpdated",t[t.custom=100]="custom",t[t.msgTyping=101]="msgTyping"}(Zf||(Zf={})),function(t){t[t.reply=1]="reply",t[t.thread=2]="thread",t[t.all=3]="all"}(em||(em={}));var now_1=function(){return Ms.Date.now()},rm=/\s/;var nm=function trimmedEndIndex(t){for(var a=t.length;a--&&rm.test(t.charAt(a)););return a},am=/^\s+/;var om=function baseTrim(t){return t?t.slice(0,nm(t)+1).replace(am,""):t},im=/^[-+]0x[0-9a-f]+$/i,sm=/^0b[01]+$/i,cm=/^0o[0-7]+$/i,lm=parseInt;var um=function toNumber(t){if("number"==typeof t)return t;if(Ap(t))return NaN;if(As(t)){var a="function"==typeof t.valueOf?t.valueOf():t;t=As(a)?a+"":a}if("string"!=typeof t)return 0===t?t:+t;t=om(t);var o=sm.test(t);return o||cm.test(t)?lm(t.slice(2),o?2:8):im.test(t)?NaN:+t},dm=Math.max,pm=Math.min;var hm=function debounce(t,a,o){var c,h,m,v,b,C,S=0,M=!1,w=!1,I=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function invokeFunc(a){var o=c,m=h;return c=h=void 0,S=a,v=t.apply(m,o)}function leadingEdge(t){return S=t,b=setTimeout(timerExpired,a),M?invokeFunc(t):v}function shouldInvoke(t){var o=t-C;return void 0===C||o>=a||o<0||w&&t-S>=m}function timerExpired(){var t=now_1();if(shouldInvoke(t))return trailingEdge(t);b=setTimeout(timerExpired,function remainingWait(t){var o=a-(t-C);return w?pm(o,m-(t-S)):o}(t))}function trailingEdge(t){return b=void 0,I&&c?invokeFunc(t):(c=h=void 0,v)}function debounced(){var t=now_1(),o=shouldInvoke(t);if(c=arguments,h=this,C=t,o){if(void 0===b)return leadingEdge(C);if(w)return clearTimeout(b),b=setTimeout(timerExpired,a),invokeFunc(C)}return void 0===b&&(b=setTimeout(timerExpired,a)),v}return a=um(a)||0,As(o)&&(M=!!o.leading,m=(w="maxWait"in o)?dm(um(o.maxWait)||0,a):m,I="trailing"in o?!!o.trailing:I),debounced.cancel=function cancel(){void 0!==b&&clearTimeout(b),S=0,c=C=h=b=void 0},debounced.flush=function flush(){return void 0===b?v:trailingEdge(now_1())},debounced};var fm=function throttle(t,a,o){var c=!0,h=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return As(o)&&(c="leading"in o?!!o.leading:c,h="trailing"in o?!!o.trailing:h),hm(t,a,{leading:c,maxWait:a,trailing:h})},mm=Math.min;var vm=function baseIntersection(t,a,o){for(var c=o?Yl:Jl,h=t[0].length,m=t.length,v=m,b=Array(m),C=1/0,S=[];v--;){var M=t[v];v&&a&&(M=Xl(M,Xc(a))),C=mm(M.length,C),b[v]=!o&&(a||h>=120&&M.length>=120)?new Wl(v&&M):void 0}M=t[0];var w=-1,I=b[0];e:for(;++w<h&&S.length<C;){var x=M[w],T=a?a(x):x;if(x=o||0!==x?x:0,!(I?Zl(I,T):c(S,T,o))){for(v=m;--v;){var k=b[v];if(!(k?Zl(k,T):c(t[v],T,o)))continue e}I&&I.push(T),S.push(x)}}return S};var gm=function castArrayLikeObject(t){return fu(t)?t:[]},ym=du((function(t){var a=Xl(t,gm);return a.length&&a[0]===t[0]?vm(a):[]}));var bm=function baseSlice(t,a,o){var c=-1,h=t.length;a<0&&(a=-a>h?0:h+a),(o=o>h?h:o)<0&&(o+=h),h=a>o?0:o-a>>>0,a>>>=0;for(var m=Array(h);++c<h;)m[c]=t[c+a];return m};var Cm=function isIterateeCall(t,a,o){if(!As(o))return!1;var c=typeof a;return!!("number"==c?hu(o)&&Qd(a,o.length):"string"==c&&a in o)&&xl(o[a],t)},Sm=1/0;var Mm=function toFinite(t){return t?(t=um(t))===Sm||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var _m=function toInteger(t){var a=Mm(t),o=a%1;return a==a?o?a-o:a:0},wm=Math.ceil,Im=Math.max;var xm,Tm=function chunk(t,a,o){a=(o?Cm(t,a,o):void 0===a)?1:Im(_m(a),0);var c=null==t?0:t.length;if(!c||a<1)return[];for(var h=0,m=0,v=Array(wm(c/a));h<c;)v[m++]=bm(t,h,h+=a);return v};!function(t){t[t.sub=1]="sub",t[t.unSub=2]="unSub"}(xm||(xm={}));var km,Rm=function(){function UnreadInfoModuleService(t){var a=this;this.unreadCount={},this.autoSubscribeUnreadMap={},this.autoSubscribeServerMap={},this.autoSubscribeTypingMap={},this.unreadServerCount={},this.serverRoleIdsMap={},this._serverUnreadInfo=fm((function(t){a.core.emit("serverUnreadInfo",a.getServerUnreadInfo(t))}),100),this.core=t}var t=UnreadInfoModuleService.prototype;return t.changeCacheServerRoleIds=function changeCacheServerRoleIds(t){var a,o=this,c=t.attach.serverIdentifyInfo,h=c.serverId,m=c.roleId,v=this.serverRoleIdsMap[h];if(v&&!(t.time<v.timeTag)){t.type===Zf[Zf.serverIdentifyAdd]?v.roleIds.add(m):v.roleIds.delete(m),this.core.logger.debug("QChatChannel::qchatChannel/serverIdentifyChange::now "+h+" roleIds is",concat(a=[]).call(a,v.roleIds));var b=this.unreadServerCount[h];if(b){var C=Tm(Oc(b),100);forEach$1(C).call(C,(function(t){o.core.qchatChannel.getChannelUnreadInfos({channels:map(t).call(t,(function(t){return{serverId:h,channelId:t}}))})}))}}},t.getRoleIdsByServerId=function getRoleIdsByServerId(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee(){var a,o,c,h,m=this;return Mi.wrap((function _callee$(v){for(;;)switch(v.prev=v.next){case 0:if((o=filter(t).call(t,(function(t){return!m.serverRoleIdsMap[t]}))).length){v.next=3;break}return v.abrupt("return");case 3:return c={serverIdTimeTags:o},this.core.logger.debug("QChatChannel:: getRoleIdsByServerId params is",c),v.next=7,this.core.sendCmd("qchatGetRoleIdsByServerId",{qchatGetRoleIdsByServerIdTag:c});case 7:h=v.sent,this.core.logger.debug("QChatChannel:: getRoleIdsByServerId result is",h),forEach$1(a=h.content.serverRoles).call(a,(function(t){try{t.roleIds=JSON.parse(t.roleIds)}catch(t){m.core.logger.error("QChatChannel:: getRoleIdsByServerId JSON parse roleIds error",t)}m.serverRoleIdsMap[t.serverId]={roleIds:new tm(t.roleIds),timeTag:t.timeTag}}));case 10:case"end":return v.stop()}}),_callee,this)})))},t._unSubscribeChannel=function _unSubscribeChannel(t,a){return __awaiter(this,void 0,void 0,Mi.mark((function _callee2(){var o,c;return Mi.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:if(o=t+"_"+a,c=this.autoSubscribeUnreadMap[o]){h.next=4;break}return h.abrupt("return");case 4:this.subscribe({opeType:xm.unSub,type:c,channels:[{serverId:t,channelId:a}]}),this.autoSubscribeUnreadMap[o]=void 0;case 6:case"end":return h.stop()}}),_callee2,this)})))},t.subscribe=function subscribe(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee4(){var a,o,c,h,m=this;return Mi.wrap((function _callee4$(v){for(;;)switch(v.prev=v.next){case 0:return validate({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},t),v.next=3,this.core.sendCmd("qchatSubscribe",{qchatSubReqTag:{type:t.type,opeType:t.opeType},channels:t.channels});case 3:return o=v.sent,c=new tm,forEach$1(a=t.channels).call(a,(function(t){return __awaiter(m,void 0,void 0,Mi.mark((function _callee3(){return Mi.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:this.serverRoleIdsMap[t.serverId]||c.add(t.serverId);case 1:case"end":return a.stop()}}),_callee3,this)})))})),h=Tm(td(c),10),forEach$1(h).call(h,(function(t){m.getRoleIdsByServerId(t)})),v.abrupt("return",o.content);case 9:case"end":return v.stop()}}),_callee4,this)})))},t.resumeSubscribe=function resumeSubscribe(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee7(){var a,o,c,h,m,v,b,C=this;return Mi.wrap((function _callee7$(S){for(;;)switch(S.prev=S.next){case 0:if(this.serverRoleIdsMap={},this.unreadServerCount={},this.unreadCount={},m=100,t.isAutoReconnect){S.next=6;break}return S.abrupt("return");case 6:return v={},forEach$1(a=Oc(this.autoSubscribeUnreadMap)).call(a,(function(t){var a=C.autoSubscribeUnreadMap[t];if(a){var o=t.split("_"),c={serverId:o[0],channelId:o[1]};v[a]=v[a]||[],v[a].push(c)}})),v[5]=[],forEach$1(o=Oc(this.autoSubscribeTypingMap)).call(o,(function(t){return __awaiter(C,void 0,void 0,Mi.mark((function _callee5(){var a,o,c,h;return Mi.wrap((function _callee5$(m){for(;;)switch(m.prev=m.next){case 0:this.autoSubscribeTypingMap[t]&&(a=t.split("_"),o=a[0],c=a[1],h={serverId:o,channelId:c},v[5].push(h));case 2:case"end":return m.stop()}}),_callee5,this)})))})),v[4]=[],forEach$1(c=Oc(this.autoSubscribeServerMap)).call(c,(function(t){return __awaiter(C,void 0,void 0,Mi.mark((function _callee6(){var a;return Mi.wrap((function _callee6$(o){for(;;)switch(o.prev=o.next){case 0:this.autoSubscribeServerMap[t]&&(a={serverId:t},v[4].push(a));case 2:case"end":return o.stop()}}),_callee6,this)})))})),b=[],forEach$1(h=Oc(v)).call(h,(function(t){var a=v[t];if(a&&0===a.length)return li.resolve();if(a.length>m){var o=Tm(a,100);return forEach$1(o).call(o,(function(a){b.push(C.createSubscribePromise(a,t))}))}b.push(C.createSubscribePromise(a,t))})),S.next=16,li.all(b);case 16:case"end":return S.stop()}}),_callee7,this)})))},t.createSubscribePromise=function createSubscribePromise(t,a){var o=this,c={type:$u(a),opeType:1,channels:t};return this.core.logger.debug("qchatChannel:: autoSubscribeUnread params",c),this.subscribe(c).then((function(t){var a=t.unreadInfos;a&&a.length>0&&(a=formatUnreadInfos(a),o.cacheUnreadCount(a))})).catch((function(t){o.core.logger.error("qchatChannel:: autoSubscribeUnread error ",t)}))},t.cacheSubscribe=function cacheSubscribe(t){var a,o=this;forEach$1(a=t.channels).call(a,(function(a){var c=a.channelId?a.serverId+"_"+a.channelId:""+a.serverId,h=5===t.type?o.autoSubscribeTypingMap:4===t.type?o.autoSubscribeServerMap:o.autoSubscribeUnreadMap;t.opeType===xm.sub?h[c]=t.type:t.opeType===xm.unSub&&(h[c]=void 0)}))},t.cacheUnreadCount=function cacheUnreadCount(t){var a=this;forEach$1(t).call(t,(function(t){var o=t.serverId+"_"+t.channelId;a.unreadCount[o]=ki({},t),a.unreadServerCount[t.serverId]||(a.unreadServerCount[t.serverId]={}),a.unreadServerCount[t.serverId][t.channelId]=!0}))},t.getServerUnreadInfo=function getServerUnreadInfo(t){var a,o=this,c={serverId:t,unreadCount:0,mentionedCount:0,maxCount:0},h=this.unreadServerCount[t];h&&(forEach$1(a=Oc(h)).call(a,(function(a){var h=t+"_"+a,m=o.unreadCount[h];c.unreadCount+=m.unreadCount,c.mentionedCount+=m.mentionedCount,void 0!==m.maxCount&&(c.maxCount=m.maxCount)})),c.unreadCount=c.unreadCount>c.maxCount?c.maxCount:c.unreadCount,c.mentionedCount=c.mentionedCount>c.maxCount?c.maxCount:c.mentionedCount);return c},t.getUnreadInfo=function getUnreadInfo(t){validate({serverId:{type:"string"},channelId:{type:"string"}},t);var a=t.serverId+"_"+t.channelId;return this.unreadCount[a]?this.unreadCount[a]:null},t.shouldChangeUnread=function shouldChangeUnread(t,a){if(!t.serverId||!t.channelId)return!1;if(this.core.qchatChannel.subscribeForVisitorService.isInSubscribeChannels(t.serverId,t.channelId))return!1;if(!1===t.historyEnable)return!1;if(!1===t.needBadge)return!1;if(t.fromAccount===this.core.account)return!1;if(a&&2!==(null==t?void 0:t.status))return!1;if(t.notifyReason&&t.notifyReason===getEnumKeyByEnumValue(Yf,Yf.notifySubscribe)){if(!t.serverId||!t.channelId)return!1;var o=this.getUnreadInfo({serverId:t.serverId,channelId:t.channelId}),c=a?"ackTimestamp":"lastMsgTime";if(!o)return!1;if(t.time&&o[c]&&o[c]>t.time)return!1}return!0},t.shouldChangeMentionedUnread=function shouldChangeMentionedUnread(t,a){return void 0===a&&(a=!1),__awaiter(this,void 0,void 0,Mi.mark((function _callee8(){var o,c;return Mi.wrap((function _callee8$(h){for(;;)switch(h.prev=h.next){case 0:if(!t.accidsOfMentionedRoles||!includes(o=t.accidsOfMentionedRoles).call(o,this.core.account)){h.next=2;break}return h.abrupt("return",!0);case 2:if(!t.mentionRoleIds||!t.serverId){h.next=16;break}if(this.serverRoleIdsMap[t.serverId]){h.next=9;break}if(a){h.next=7;break}return this.handledRoleMsg(t),h.abrupt("return",!1);case 7:return h.next=9,this.getRoleIdsByServerId([t.serverId]);case 9:c=0;case 10:if(!(c<t.mentionRoleIds.length)){h.next=16;break}if(!this.serverRoleIdsMap[t.serverId].roleIds.has(t.mentionRoleIds[c])){h.next=13;break}return h.abrupt("return",!0);case 13:c++,h.next=10;break;case 16:return h.abrupt("return",!1);case 17:case"end":return h.stop()}}),_callee8,this)})))},t.handledRoleMsg=function handledRoleMsg(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee9(){var a,o,c,h,m,v=this;return Mi.wrap((function _callee9$(b){for(;;)switch(b.prev=b.next){case 0:if(t.mentionRoleIds){b.next=2;break}return b.abrupt("return");case 2:if(this.serverRoleIdsMap[t.serverId]){b.next=5;break}return b.next=5,this.getRoleIdsByServerId([t.serverId]);case 5:if(this.serverRoleIdsMap[t.serverId]){b.next=8;break}return this.core.logger.warn("QChatChannel::handledRoleMsg::can not get serverRoleIds,server id",t.serverId),b.abrupt("return");case 8:if(o=!1,forEach$1(a=t.mentionRoleIds).call(a,(function(a){v.serverRoleIdsMap[t.serverId].roleIds.has(a)&&(o=!0,v.core.logger.debug("QChatChannel::handledRoleMsg::will update message mentionedCount，message is ",t))})),o){b.next=12;break}return b.abrupt("return");case 12:if(c=this.unreadCount[t.serverId+"_"+t.channelId],h=2===(null==t?void 0:t.status),c.mentionedCount=h?c.mentionedCount?c.mentionedCount-1:0:c.mentionedCount?c.mentionedCount+1:1,"number"!=typeof c.maxCount){b.next=24;break}if(!((m=(m=c.mentionedCount)>c.maxCount?c.maxCount:m)>c.maxCount)){b.next=21;break}return this.core.logger.debug("QChatChannel::handledRoleMsg::tempUnreadCount more than maxCount"),b.abrupt("return");case 21:this.core.emit("unreadInfo",ki(ki({},c),{mentionedCount:m})),this.core.emit("unreadInfos",[ki(ki({},c),{mentionedCount:m})]),this._serverUnreadInfo(t.serverId);case 24:case"end":return b.stop()}}),_callee9,this)})))},t.getMentionedFlag=function getMentionedFlag(t,a){return void 0===a&&(a=!1),__awaiter(this,void 0,void 0,Mi.mark((function _callee10(){var o;return Mi.wrap((function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:if(!t.mentionAll){c.next=4;break}return c.abrupt("return",!0);case 4:if(!t.mentionRoleIds&&!t.accidsOfMentionedRoles){c.next=10;break}return c.next=7,this.shouldChangeMentionedUnread(t,a);case 7:return c.abrupt("return",c.sent);case 10:if(!t.mentionAccids||!includes(o=t.mentionAccids).call(o,this.core.account)){c.next=12;break}return c.abrupt("return",!0);case 12:return c.abrupt("return",!1);case 13:case"end":return c.stop()}}),_callee10,this)})))},t.changeUnread=function changeUnread(t,a){return __awaiter(this,void 0,void 0,Mi.mark((function _callee11(){var o,c,h,m,v,b,C,S,M;return Mi.wrap((function _callee11$(w){for(;;)switch(w.prev=w.next){case 0:if(o=t.serverId,c=t.channelId,h=o+"_"+c,this.shouldChangeUnread(t,a)){w.next=6;break}return this.core.logger.debug("changeUnread: "+h+" does not need to update unreadInfo"),w.abrupt("return");case 6:if(this.unreadCount[h]){w.next=11;break}return w.next=9,this.core.qchatChannel.getChannelUnreadInfos({channels:[{serverId:o,channelId:c}]});case 9:return!this.serverRoleIdsMap[o]&&t.mentionRoleIds&&this.getRoleIdsByServerId([o]),w.abrupt("return");case 11:return m=this.unreadCount[h],v=2===(null==t?void 0:t.status),w.next=15,this.getMentionedFlag(t);case 15:if(b=w.sent,v?(m.unreadCount=m.unreadCount?m.unreadCount-1:0,b&&(m.mentionedCount=m.mentionedCount?m.mentionedCount-1:0),this.core.logger.debug("changeUnread: "+h+" unread reduce ",m)):(m.unreadCount=m.unreadCount?m.unreadCount+1:1,b&&(m.mentionedCount=m.mentionedCount?m.mentionedCount+1:1),this.core.logger.debug("changeUnread: "+h+" unread add ",m)),delete m.lastMsgTime,C=m.maxCount,S=m.mentionedCount,M=m.unreadCount,"number"!=typeof C){w.next=27;break}if(S=S>C?C:S,!((M=M>C?C:M)>C)){w.next=27;break}return this.core.logger.debug("QChatChannel::subscribe::tempUnreadCount more than maxCount"),w.abrupt("return");case 27:this.core.logger.warn("unreadInfo event will abandon,please use unreadInfos"),this.core.emit("unreadInfo",ki(ki({},m),{mentionedCount:S,unreadCount:M})),this.core.emit("unreadInfos",[ki(ki({},m),{mentionedCount:S,unreadCount:M})]),this._serverUnreadInfo(o);case 31:case"end":return w.stop()}}),_callee11,this)})))},t.updateUnread=function updateUnread(t){var a=t.serverId,o=t.channelId,c=a+"_"+o,h=this.unreadCount[c];h&&h.ackTimestamp&&t&&t.ackTimestamp&&h.ackTimestamp>t.ackTimestamp?this.core.logger.debug("qchat channel updateUnread exist: ",null==h?void 0:h.ackTimestamp,null==t?void 0:t.ackTimestamp):(this.core.logger.debug("qchat channel updateUnread: ",t),this.unreadCount[c]=t,this.unreadServerCount[a]||(this.unreadServerCount[a]={}),this.unreadServerCount[a][o]=!0,this.core.logger.warn("unreadInfo event will abandon,please use unreadInfos"),this.core.emit("unreadInfo",this.unreadCount[c]),this.core.emit("unreadInfos",[this.unreadCount[c]]),this._serverUnreadInfo(a))},t.clearUnreadCountByServers=function clearUnreadCountByServers(t,a){var o,c=this,h=[];forEach$1(t).call(t,(function(t){var a;c.unreadServerCount[t]&&forEach$1(a=Oc(c.unreadServerCount[t])).call(a,(function(a){h.push(t+"_"+a)}))})),forEach$1(h).call(h,(function(t){c.unreadCount[t].unreadCount=c.unreadCount[t].mentionedCount=0,c.unreadCount[t].ackTimestamp=a})),this.core.emit("unreadInfos",map(h).call(h,(function(t){return c.unreadCount[t]}))),forEach$1(o=ym(t,Oc(this.unreadServerCount))).call(o,(function(t){c.core.emit("serverUnreadInfo",c.getServerUnreadInfo(t))}))},UnreadInfoModuleService}(),qm=function(){function SubscribeForVisitorService(t){this.limitForBatchEnter=10,this.limitForBatchSubscribe=100,this.autoServers=new tm,this.autoVisitorSubscribeServer=new tm,this.autoVisitorSubscribeChannel=new tm,this.core=t}var t=SubscribeForVisitorService.prototype;return t.subscribeChannelAsVisitor=function subscribeChannelAsVisitor(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee(){var a,o,c,h,m=this;return Mi.wrap((function _callee$(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:t.type||6,opeType:t.opeType},datas:t.channels});case 2:return o=v.sent,c=o.content.failedArr,h=filter(a=t.channels).call(a,(function(t){return!some(c).call(c,(function(a){return a.channelId===t.channelId&&a.serverId===t.serverId}))})),forEach$1(h).call(h,(function(a){1===t.opeType?m.autoVisitorSubscribeChannel.add(a.serverId+"&"+a.channelId):m.autoVisitorSubscribeChannel.delete(a.serverId+"&"+a.channelId)})),v.abrupt("return",{failedChannels:c});case 7:case"end":return v.stop()}}),_callee,this)})))},t.subscribeServerAsVisitor=function subscribeServerAsVisitor(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee2(){var a,o,c,h,m,v,b=this;return Mi.wrap((function _callee2$(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:t.type||7,opeType:t.opeType},datas:map(a=t.serverIds).call(a,(function(t){return{serverId:t}}))});case 2:return h=C.sent,m=h.content.failedArr,v=filter(o=t.serverIds).call(o,(function(t){return!some(m).call(m,(function(a){return a.serverId===t}))})),forEach$1(v).call(v,(function(a){1===t.opeType?b.autoVisitorSubscribeServer.add(a):b.autoVisitorSubscribeServer.delete(a)})),C.abrupt("return",{failedServers:map(c=h.content.failedArr).call(c,(function(t){return t.serverId}))});case 7:case"end":return C.stop()}}),_callee2,this)})))},t.deleteServer=function deleteServer(t){var a;this.autoServers.delete(t),this.autoVisitorSubscribeServer.has(t)&&this.subscribeServerAsVisitor({opeType:2,serverIds:[t]});var o=[];forEach$1(a=this.autoVisitorSubscribeChannel).call(a,(function(a){if(0===indexOf(a).call(a,t)){var c=a.replace(t+"&","");o.push({serverId:t,channelId:c})}})),o.length>0&&this.subscribeChannelAsVisitor({opeType:2,channels:o})},t.deleteAutoSetInServerId=function deleteAutoSetInServerId(t){var a,o=this;this.autoServers.delete(t),this.autoVisitorSubscribeServer.delete(t),forEach$1(a=this.autoVisitorSubscribeChannel).call(a,(function(a){0===indexOf(a).call(a,t)&&o.autoVisitorSubscribeChannel.delete(a)}))},t.deleteAutoSetInChannel=function deleteAutoSetInChannel(t,a){this.autoVisitorSubscribeChannel.delete(t+"&"+a)},t.unSubscribeChannel=function unSubscribeChannel(t,a){this.subscribeChannelAsVisitor({opeType:2,channels:[{serverId:t,channelId:a}]})},t.isInSubscribeChannels=function isInSubscribeChannels(t,a){return this.autoVisitorSubscribeChannel.has(t+"&"+a)},t.isInAutoServers=function isInAutoServers(t){return this.autoServers.has(t)},t.doAutoSubscribe=function doAutoSubscribe(){var t=this,a=[],o=Tm(td(this.autoVisitorSubscribeServer),this.limitForBatchSubscribe);forEach$1(o).call(o,(function(o){a.push(t.subscribeServerAsVisitor({opeType:1,serverIds:o}))}));var c=Tm(td(this.autoVisitorSubscribeChannel),this.limitForBatchSubscribe);return forEach$1(c).call(c,(function(o){a.push(t.subscribeChannelAsVisitor({opeType:1,channels:map(o).call(o,(function(t){var a=indexOf(t).call(t,"&");return{serverId:slice(t).call(t,0,a),channelId:slice(t).call(t,a+1)}}))}))})),li.all(a)},t.doAutoEnterServer=function doAutoEnterServer(){return __awaiter(this,void 0,void 0,Mi.mark((function _callee3(){var t,a,o,c=this;return Mi.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:return t=Tm(td(this.autoServers),this.limitForBatchEnter),a=[],forEach$1(t).call(t,(function(t){a.push(c.core.qchatServer.enterAsVisitor({serverIds:t}))})),h.next=5,li.all(a);case 5:o=h.sent,forEach$1(o).call(o,(function(t){var a;forEach$1(a=t.failedServers).call(a,(function(t){c.deleteAutoSetInServerId(t)}))}));case 7:case"end":return h.stop()}}),_callee3,this)})))},t.resumeSubscribe=function resumeSubscribe(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee4(){return Mi.wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:if(!t.isAutoReconnect){a.next=7;break}return a.next=3,this.doAutoEnterServer();case 3:return a.next=5,this.doAutoSubscribe();case 5:a.next=10;break;case 7:this.autoServers.clear(),this.autoVisitorSubscribeChannel.clear(),this.autoVisitorSubscribeServer.clear();case 10:case"end":return a.stop()}}),_callee4,this)})))},t.cacheServer=function cacheServer(t){var a=this;forEach$1(t).call(t,(function(t){return a.autoServers.add(t)}))},SubscribeForVisitorService}();!function(t){t[t.sub=1]="sub",t[t.unSub=2]="unSub"}(km||(km={}));var Em=function(t){function QChatChannelService(a){var o,c,h,m,v,b,C;return(C=t.call(this,"qchatChannel",a)||this).core=a,registerParser({cmdMap:Hh,cmdConfig:Zh}),C.subscribeModuleService=new Rm(a),C.subscribeForVisitorService=new qm(a),C.core.eventBus.on("qchatChannel/changeUnread",bind$1(o=C.subscribeModuleService.changeUnread).call(o,C.subscribeModuleService)),C.core.eventBus.on("qchatChannel/updateUnread",bind$1(c=C.subscribeModuleService.updateUnread).call(c,C.subscribeModuleService)),C.core.eventBus.on("qchatChannel/cacheUnreadCount",bind$1(h=C.subscribeModuleService.cacheUnreadCount).call(h,C.subscribeModuleService)),C.core.eventBus.on("qchatChannel/cacheSubscribe",bind$1(m=C.subscribeModuleService.cacheSubscribe).call(m,C.subscribeModuleService)),C.core.eventBus.on("qchatChannel/clearUnreadCountByServers",bind$1(v=C.subscribeModuleService.clearUnreadCountByServers).call(v,C.subscribeModuleService)),C.core.eventBus.on("qchatChannel/getRoleIdsByServerId",bind$1(b=C.subscribeModuleService.getRoleIdsByServerId).call(b,C.subscribeModuleService)),C.core.eventBus.on("logined",(function(t){C.subscribeModuleService.resumeSubscribe(t),C.subscribeForVisitorService.resumeSubscribe(t)})),C.core.eventBus.on("qchatChannel/autoUnSubscribe",(function(t){if(C.logger.log("QChatChannel::enter autoUnSubscribe sysMsg is",t),t.type===Zf[Zf.channelVisibilityUpdate])C.logger.log("QChatChannel::begin autoUnSubscribe channel key is",t.serverId+"_"+t.channelId),C.subscribeModuleService._unSubscribeChannel(t.serverId,t.channelId),C.logger.log("QChatChannel::autoUnSubscribe channel done key is",t.serverId+"_"+t.channelId);else if(t.type===Zf[Zf.serverEnterLeave]){var a;C.subscribeModuleService.autoSubscribeServerMap[t.serverId]&&(C.logger.log("QChatChannel::begin autoUnSubscribe server key is",t.serverId),C.subscribeModuleService.subscribe({type:4,opeType:km.unSub,channels:[{serverId:t.serverId,channelId:""}]}),C.logger.log("QChatChannel::autoUnSubscribe server done key is",t.serverId));var o=C.subscribeModuleService.unreadServerCount[t.serverId];if(!o)return;C.logger.log("QChatChannel::begin autoUnSubscribe channels key is",Oc(o)),forEach$1(a=Oc(o)).call(a,(function(a){C.subscribeModuleService._unSubscribeChannel(t.serverId,a)})),C.logger.log("QChatChannel::autoUnSubscribe channels done key is",Oc(o))}})),C.core.eventBus.on("qchatChannel/serverIdentifyChange",(function(t){C.subscribeModuleService.changeCacheServerRoleIds(t)})),C}wt(QChatChannelService,t);var a=QChatChannelService.prototype;return a.createChannel=function createChannel(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee(){var a;return Mi.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Mf)},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},t),o.next=3,this.core.sendCmd("qchatCreateChannel",{channelInfo:ki(ki({},t),{type:Mf[t.type]}),antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatChannel(a.content.channelInfo));case 5:case"end":return o.stop()}}),_callee,this)})))},a.deleteChannel=function deleteChannel(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee2(){return Mi.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatDeleteChannel",t);case 3:case"end":return a.stop()}}),_callee2,this)})))},a.updateChannel=function updateChannel(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee3(){var a,o;return Mi.wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return validate({channelId:{type:"string",min:1},serverId:{type:"string",required:!1},type:{type:"enum",values:getEnumKeys(Mf),required:!1},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},t),a=t,t.type&&(a.type=Mf[t.type]),c.next=5,this.core.sendCmd("qchatUpdateChannel",{channelInfo:a,antispamTag:generateAntispamTag(t)});case 5:return o=c.sent,c.abrupt("return",formatChannel(o.content.channelInfo));case 7:case"end":return c.stop()}}),_callee3,this)})))},a.getChannels=function getChannels(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee4(){var a;return Mi.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return validate({channelIds:{type:"array",itemType:"string",min:1}},t),o.next=3,this.core.sendCmd("qchatGetChannels",t);case 3:return a=o.sent,o.abrupt("return",formatChannels(a.content.channelList));case 5:case"end":return o.stop()}}),_callee4,this)})))},a.getChannelsByPage=function getChannelsByPage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee5(){var a,o,c,h;return Mi.wrap((function _callee5$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),m.next=3,this.core.sendCmd("qchatGetChannelsByPage",{qchatGetChannelListPageTag:ki({limit:100},t)});case 3:return a=m.sent,o=a.content,c=o.datas,h=o.listQueryTag,m.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:$u(h.nextTimetag)},datas:formatChannels(c)});case 6:case"end":return m.stop()}}),_callee5,this)})))},a.getMembersByPage=function getMembersByPage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee6(){var a,o,c,h;return Mi.wrap((function _callee6$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),m.next=3,this.core.sendCmd("qchatGetMembersByPage",{qchatGetMembersByPageTag:t});case 3:return a=m.sent,o=a.content,c=o.datas,h=o.listQueryTag,m.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:$u(h.nextTimetag)},datas:formatMembers$1(c)});case 6:case"end":return m.stop()}}),_callee6,this)})))},a.updateWhiteBlackRole=function updateWhiteBlackRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee7(){return Mi.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},roleId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Cf)},opeType:{type:"enum",values:getEnumKeys(Sf)}},t),a.next=3,this.core.sendCmd("qchatUpdateWhiteBlackRole",{qchatUpdateWhiteBlackRoleTag:ki(ki({},t),{type:Cf[t.type],opeType:Sf[t.opeType]})});case 3:case"end":return a.stop()}}),_callee7,this)})))},a.getWhiteBlackRolesPage=function getWhiteBlackRolesPage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee8(){var a,o,c,h;return Mi.wrap((function _callee8$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Cf)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),m.next=3,this.core.sendCmd("qchatGetWhiteBlackRolesPage",{qchatGetWhiteBlackRolesPageTag:ki(ki({},t),{type:Cf[t.type]})});case 3:return a=m.sent,o=a.content,c=o.datas,h=o.listQueryTag,m.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:$u(h.nextTimetag)},datas:formatRoles(c)});case 6:case"end":return m.stop()}}),_callee8,this)})))},a.updateWhiteBlackMembers=function updateWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee9(){return Mi.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Cf)},opeType:{type:"enum",values:getEnumKeys(Sf)},toAccids:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatUpdateWhiteBlackMembers",{qchatUpdateWhiteBlackMembersTag:ki(ki({},t),{type:Cf[t.type],opeType:Sf[t.opeType],toAccids:us(t.toAccids)})});case 3:case"end":return a.stop()}}),_callee9,this)})))},a.getWhiteBlackMembersPage=function getWhiteBlackMembersPage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee10(){var a,o,c,h;return Mi.wrap((function _callee10$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Cf)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),m.next=3,this.core.sendCmd("qchatGetWhiteBlackMembersPage",{qchatGetWhiteBlackMembersPageTag:ki(ki({limit:100},t),{type:Cf[t.type]})});case 3:return a=m.sent,o=a.content,c=o.datas,h=o.listQueryTag,m.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:$u(h.nextTimetag)},datas:formatMembers$1(c)});case 6:case"end":return m.stop()}}),_callee10,this)})))},a.getExistingWhiteBlackRoles=function getExistingWhiteBlackRoles(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee11(){var a,o;return Mi.wrap((function _callee11$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Cf)},roleIds:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackRoles",{qchatGetExistingWhiteBlackRolesTag:ki(ki({},t),{type:Cf[t.type],roleIds:us(t.roleIds)})});case 3:return a=c.sent,o=a.content.datas,c.abrupt("return",{datas:formatRoles(o)});case 6:case"end":return c.stop()}}),_callee11,this)})))},a.getExistingWhiteBlackMembers=function getExistingWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee12(){var a,o;return Mi.wrap((function _callee12$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Cf)},accids:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackMembers",{qchatGetExistingWhiteBlackMembersTag:ki(ki({},t),{type:Cf[t.type],accids:us(t.accids)})});case 3:return a=c.sent,o=a.content.datas,c.abrupt("return",{datas:formatMembers$1(o)});case 6:case"end":return c.stop()}}),_callee12,this)})))},a.updateCategoryInfoOfChannel=function updateCategoryInfoOfChannel(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee13(){var a;return Mi.wrap((function _callee13$(o){for(;;)switch(o.prev=o.next){case 0:return validate({channelId:{type:"string",min:1},categoryId:{type:"string",allowEmpty:!1,required:!1},syncMode:{type:"number",min:0,max:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateCategoryInfoOfChannel",{qchatUpdateCategoryInfoOfChannelTag:t});case 3:return a=o.sent,o.abrupt("return",formatChannel(a.content.channelInfo));case 5:case"end":return o.stop()}}),_callee13,this)})))},a.createChannelCategory=function createChannelCategory(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee14(){var a;return Mi.wrap((function _callee14$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatCreateChannelCategory",{qchatCreateChannelCategoryTag:t});case 3:return a=o.sent,o.abrupt("return",formatChannelCategory(a.content.QChatChannelCategoryInfo));case 5:case"end":return o.stop()}}),_callee14,this)})))},a.removeChannelCategory=function removeChannelCategory(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee15(){return Mi.wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelCategory",t);case 3:case"end":return a.stop()}}),_callee15,this)})))},a.updateChannelCategory=function updateChannelCategory(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee16(){var a;return Mi.wrap((function _callee16$(o){for(;;)switch(o.prev=o.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateChannelCategory",{qchatUpdateChannelCategoryTag:t});case 3:return a=o.sent,o.abrupt("return",formatChannelCategory(a.content.QChatChannelCategoryInfo));case 5:case"end":return o.stop()}}),_callee16,this)})))},a.getChannelCategoriesByID=function getChannelCategoriesByID(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee17(){var a;return Mi.wrap((function _callee17$(o){for(;;)switch(o.prev=o.next){case 0:return validate({categoryIds:{type:"array",itemType:"string",min:1}},t),o.next=3,this.core.sendCmd("qchatGetChannelCategoriesByID",t);case 3:return a=o.sent,o.abrupt("return",formatChannelCategorys(a.content.channelCategoryList));case 5:case"end":return o.stop()}}),_callee17,this)})))},a.updateChannelCategoryWhiteBlackRole=function updateChannelCategoryWhiteBlackRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee18(){return Mi.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Cf)},opeType:{type:"enum",values:getEnumKeys(Sf)},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackRole",{qchatUpdateChannelCategoryWhiteBlackRoleTag:ki(ki({},t),{type:Cf[t.type],opeType:Sf[t.opeType]})});case 3:case"end":return a.stop()}}),_callee18,this)})))},a.getChannelCategoryWhiteBlackRolesPage=function getChannelCategoryWhiteBlackRolesPage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee19(){var a,o,c,h;return Mi.wrap((function _callee19$(m){for(;;)switch(m.prev=m.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Cf)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),m.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRolesPage",{qchatGetChannelCategoryWhiteBlackRolesPageTag:ki(ki({},t),{type:Cf[t.type]})});case 3:return a=m.sent,o=a.content,c=o.datas,h=o.listQueryTag,m.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:$u(h.nextTimetag)},datas:formatRoles(c)});case 6:case"end":return m.stop()}}),_callee19,this)})))},a.updateChannelCategoryWhiteBlackMembers=function updateChannelCategoryWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee20(){return Mi.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Cf)},opeType:{type:"enum",values:getEnumKeys(Sf)},toAccids:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackMembers",{qchatUpdateChannelCategoryWhiteBlackMembersTag:ki(ki({},t),{type:Cf[t.type],opeType:Sf[t.opeType],toAccids:us(t.toAccids)})});case 3:case"end":return a.stop()}}),_callee20,this)})))},a.getChannelCategoryWhiteBlackMembersPage=function getChannelCategoryWhiteBlackMembersPage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee21(){var a,o,c,h;return Mi.wrap((function _callee21$(m){for(;;)switch(m.prev=m.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Cf)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),m.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembersPage",{qchatGetChannelCategoryWhiteBlackMembersPageTag:ki(ki({},t),{type:Cf[t.type]})});case 3:return a=m.sent,o=a.content,c=o.datas,h=o.listQueryTag,m.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:$u(h.nextTimetag)},datas:formatMembers$1(c)});case 6:case"end":return m.stop()}}),_callee21,this)})))},a.getChannelCategoryWhiteBlackRoles=function getChannelCategoryWhiteBlackRoles(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee22(){var a,o;return Mi.wrap((function _callee22$(c){for(;;)switch(c.prev=c.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Cf)},roleIds:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRoles",{qchatGetChannelCategoryWhiteBlackRolesTag:ki(ki({},t),{type:Cf[t.type],roleIds:us(t.roleIds)})});case 3:return a=c.sent,o=a.content.datas,c.abrupt("return",formatRoles(o));case 6:case"end":return c.stop()}}),_callee22,this)})))},a.getChannelCategoryWhiteBlackMembers=function getChannelCategoryWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee23(){var a,o;return Mi.wrap((function _callee23$(c){for(;;)switch(c.prev=c.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Cf)},accids:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembers",{qchatGetChannelCategoryWhiteBlackMembersTag:ki(ki({},t),{type:Cf[t.type],accids:us(t.accids)})});case 3:return a=c.sent,o=a.content.datas,c.abrupt("return",formatMembers$1(o));case 6:case"end":return c.stop()}}),_callee23,this)})))},a.getChannelCategoriesPage=function getChannelCategoriesPage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee24(){var a,o,c,h;return Mi.wrap((function _callee24$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),m.next=3,this.core.sendCmd("qchatGetChannelCategoriesPage",{qchatGetChannelCategoriesPageTag:t});case 3:return a=m.sent,o=a.content,c=o.datas,h=o.listQueryTag,m.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:$u(h.nextTimetag)},datas:formatChannelCategorys(c)});case 6:case"end":return m.stop()}}),_callee24,this)})))},a.getChannelCategoryChannelsPage=function getChannelCategoryChannelsPage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee25(){var a,o,c,h;return Mi.wrap((function _callee25$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),m.next=3,this.core.sendCmd("qchatGetChannelCategoryChannelsPage",{qchatGetChannelCategoryChannelsPageTag:t});case 3:return a=m.sent,o=a.content,c=o.datas,h=o.listQueryTag,m.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:$u(h.nextTimetag)},datas:formatChannels(c)});case 6:case"end":return m.stop()}}),_callee25,this)})))},a.subscribeChannel=function subscribeChannel(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee26(){var a,o;return Mi.wrap((function _callee26$(c){for(;;)switch(c.prev=c.next){case 0:return validate({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},t),c.next=3,this.subscribeModuleService.subscribe(t);case 3:if((a=c.sent).unreadInfos=formatUnreadInfos(a.unreadInfos),1===t.opeType&&(t.channels=map(o=a.unreadInfos).call(o,(function(t){return{serverId:t.serverId,channelId:t.channelId}}))),this.logger.debug("QChatChannel::subscribeChannel:: cacheSubscribe ",t),this.subscribeModuleService.cacheSubscribe(t),5!==t.type){c.next=10;break}return c.abrupt("return");case 10:return this.subscribeModuleService.cacheUnreadCount(a.unreadInfos),c.abrupt("return",a);case 12:case"end":return c.stop()}}),_callee26,this)})))},a.getChannelUnreadInfos=function getChannelUnreadInfos(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee27(){var a,o,c=this;return Mi.wrap((function _callee27$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("qchatGetUnreadInfo",t);case 2:return a=h.sent,o=formatUnreadInfos(a.content.unreadInfos),forEach$1(o).call(o,(function(t){return c.subscribeModuleService.updateUnread(t)})),h.abrupt("return",o);case 6:case"end":return h.stop()}}),_callee27,this)})))},a.getChannelSearchByPage=function getChannelSearchByPage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee28(){var a,o,c,h;return Mi.wrap((function _callee28$(m){for(;;)switch(m.prev=m.next){case 0:if(validate({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:1,required:!1},order:{type:"enum",values:getEnumKeys(Dh),required:!1},limit:{type:"number",min:1,required:!1},serverId:{type:"string",required:!1},sort:{type:"enum",values:getEnumKeys(bf),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),!(t.startTime&&t.endTime&&t.startTime>=t.endTime)){m.next=3;break}throw new gc("startTime more than endTime",t,"timeRule");case 3:return m.next=5,this.core.sendCmd("qchatGetChannelSearchByPage",{qchatGetChannelSearchByPageTag:ki(ki({},t),{order:t.order&&Dh[t.order],sort:sort(t)&&bf[sort(t)]})});case 5:return a=m.sent,o=a.content,c=o.datas,h=o.listQueryTag,m.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:$u(h.nextTimetag),cursor:h.cursor},datas:formatChannels(c)});case 8:case"end":return m.stop()}}),_callee28,this)})))},a.channelMemberSearch=function channelMemberSearch(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee29(){var a;return Mi.wrap((function _callee29$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatChannelMemberSearch",{qchatChannelMemberSearchTag:t});case 3:return a=o.sent,o.abrupt("return",formatChannelMembers(a.content.datas));case 5:case"end":return o.stop()}}),_callee29,this)})))},a.subscribeAsVisitor=function subscribeAsVisitor(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee30(){return Mi.wrap((function _callee30$(a){for(;;)switch(a.prev=a.next){case 0:return validate({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},channels:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},min:1}},t),a.next=3,this.subscribeForVisitorService.subscribeChannelAsVisitor(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee30,this)})))},QChatChannelService}(zh),Pm={"24_61":"qchatCreateServerRole","24_62":"qchatDeleteServerRole","24_63":"qchatUpdateServerRole","24_64":"qchatGetServerRoles","24_65":"qchatAddChannelRole","24_66":"qchatRemoveChannelRole","24_67":"qchatUpdateChannelRole","24_68":"qchatGetChannelRoles","24_69":"qchatAddMemberRole","24_70":"qchatRemoveMemberRole","24_71":"qchatUpdateMemberRole","24_72":"qchatGetMemberRoles","24_73":"qchatAddMembersToServerRole","24_74":"qchatRemoveMembersFromServerRole","24_75":"qchatGetMembersFromServerRole","24_76":"qchatGetServerRolesByAccid","24_77":"qchatGetExistingServerRolesByAccids","24_78":"qchatGetExistingChannelRolesByServerRoleIds","24_79":"qchatGetExistingAccidsOfMemberRoles","24_80":"qchatUpdateServerRolePriorities","24_81":"qchatGetExistingAccidsInServerRole","24_82":"qchatCheckPermission","24_83":"qchatAddChannelCategoryRole","24_84":"qchatRemoveChannelCategoryRole","24_85":"qchatUpdateChannelCategoryRole","24_86":"qchatGetChannelCategoryRole","24_87":"qchatAddChannelCategoryMemberRole","24_88":"qchatRemoveChannelCategoryMemberRole","24_89":"qchatUpdateChannelCategoryMemberRole","24_90":"qchatGetChannelCategoryMemberRole","24_126":"qchatCheckPermissions"},Am={channelRole:{serverId:1,roleId:2,parentRoleId:3,channelId:4,name:5,icon:6,ext:7,auths:8,type:9,createTime:10,updateTime:11},memberRole:{serverId:1,id:2,accid:3,channelId:4,auths:5,createTime:6,updateTime:7,nick:8,avatar:9,ext:10,memberType:11,joinTime:12,inviter:13},antispamTag:{antiSpamBusinessId:1},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11,isMember:12},getRoleByPagesTag:{serverId:1,channelId:2,time:3,limit:4},checkPermissionTag:{serverId:1,channelId:2,auth:3},member:{serverId:1,roleId:2,accid:3,createTime:4,updateTime:5,nick:6,avatar:7,ext:8,type:9,joinTime:10,inviter:11},qchatAddChannelCategoryRoleTag:{categoryId:3,serverId:4,parentRoleId:5},channelCategoryRole:{roleId:1,categoryId:3,serverId:4,parentRoleId:5,type:6,validFlag:7,createTime:8,updateTime:9,auths:10,name:11,icon:12,ext:13},qchatGetChannelCategoryRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},channelCategoryMemberRole:{id:1,accid:3,categoryId:4,serverId:5,validFlag:6,createTime:7,updateTime:8,auths:9,nick:10,avatar:11,ext:12,memberType:13,joinTime:14,inviter:15},qchatGetChannelCategoryMemberRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},checkPermissionsTag:{serverId:1,channelId:2,auths:3}},Om=invertSerializeMap(Am),Um={qchatCreateServerRole:{service:"qchatRole",sid:24,cid:61,params:[{type:"Property",name:"serverRole",reflectMapper:Am.serverRole},{type:"Property",name:"antispamTag",reflectMapper:Am.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:Om.serverRole}]},qchatDeleteServerRole:{service:"qchatRole",sid:24,cid:62,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"}]},qchatUpdateServerRole:{service:"qchatRole",sid:24,cid:63,params:[{type:"Property",name:"updateServerRoleTag",reflectMapper:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,priority:7}},{type:"Property",name:"antispamTag",reflectMapper:Am.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:Om.serverRole}]},qchatGetServerRoles:{service:"qchatRole",sid:24,cid:64,params:[{type:"Property",name:"getServerRolesTag",reflectMapper:{serverId:1,timetag:2,limit:3,priority:4,channelId:5,categoryId:6}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:Om.serverRole}]},qchatAddChannelRole:{service:"qchatRole",sid:24,cid:65,params:[{type:"Property",name:"channelRole",reflectMapper:Am.channelRole}],response:[{type:"Property",name:"channelRole",reflectMapper:Om.channelRole}]},qchatRemoveChannelRole:{service:"qchatRole",sid:24,cid:66,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelRole:{service:"qchatRole",sid:24,cid:67,params:[{type:"Property",name:"updateChannelRoleTag",reflectMapper:{serverId:1,roleId:2,channelId:3,auths:4}}],response:[{type:"Property",name:"channelRole",reflectMapper:Om.channelRole}]},qchatGetChannelRoles:{service:"qchatRole",sid:24,cid:68,params:[{type:"Property",name:"getChannelRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:Om.channelRole}]},qchatAddMemberRole:{service:"qchatRole",sid:24,cid:69,params:[{type:"Property",name:"memberRole",reflectMapper:Am.memberRole}],response:[{type:"Property",name:"memberRole",reflectMapper:Om.memberRole}]},qchatRemoveMemberRole:{service:"qchatRole",sid:24,cid:70,params:[{type:"Property",name:"memberRole",reflectMapper:Am.memberRole}]},qchatUpdateMemberRole:{service:"qchatRole",sid:24,cid:71,params:[{type:"Property",name:"updateMemberRoleTag",reflectMapper:{serverId:1,accid:2,channelId:3,auths:4}}],response:[{type:"Property",name:"memberRole",reflectMapper:Om.memberRole}]},qchatGetMemberRoles:{service:"qchatRole",sid:24,cid:72,params:[{type:"Property",name:"getMemberRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:Om.memberRole}]},qchatAddMembersToServerRole:{service:"qchatRole",sid:24,cid:73,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatRemoveMembersFromServerRole:{service:"qchatRole",sid:24,cid:74,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatGetMembersFromServerRole:{service:"qchatRole",sid:24,cid:75,params:[{type:"Property",name:"getMembersFromServerRoleTag",reflectMapper:{serverId:1,roleId:2,timetag:3,accid:4,limit:5}}],response:[{type:"PropertyArray",name:"members",reflectMapper:Om.member}]},qchatGetServerRolesByAccid:{service:"qchatRole",sid:24,cid:76,params:[{type:"Property",name:"getServerRolesByAccidTag",reflectMapper:{serverId:1,accid:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:Om.serverRole}]},qchatGetExistingServerRolesByAccids:{service:"qchatRole",sid:24,cid:77,params:[{type:"Long",name:"serverId"},{type:"String",name:"accids"}],response:[{type:"String",name:"serverRoles"}]},qchatGetExistingChannelRolesByServerRoleIds:{service:"qchatRole",sid:24,cid:78,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"roleIds"}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:Om.channelRole}]},qchatGetExistingAccidsOfMemberRoles:{service:"qchatRole",sid:24,cid:79,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:Om.memberRole}]},qchatUpdateServerRolePriorities:{service:"qchatRole",sid:24,cid:80,params:[{type:"Long",name:"serverId"},{type:"PropertyArray",name:"serverRoles",reflectMapper:{serverId:1,roleId:2,priority:7}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:Om.serverRole}]},qchatGetExistingAccidsInServerRole:{service:"qchatRole",sid:24,cid:81,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"members",reflectMapper:Om.member}]},qchatCheckPermission:{service:"qchatRole",sid:24,cid:82,params:[{type:"Property",name:"checkPermissionTag",reflectMapper:Am.checkPermissionTag}],response:[{type:"Boolean",name:"checked"}]},qchatAddChannelCategoryRole:{service:"qchatRole",sid:24,cid:83,params:[{type:"Property",name:"qchatAddChannelCategoryRoleTag",reflectMapper:Am.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:Om.channelCategoryRole}]},qchatRemoveChannelCategoryRole:{service:"qchatRole",sid:24,cid:84,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelCategoryRole:{service:"qchatRole",sid:24,cid:85,params:[{type:"Property",name:"qchatUpdateChannelCategoryRoleTag",reflectMapper:Am.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:Om.channelCategoryRole}]},qchatGetChannelCategoryRole:{service:"qchatRole",sid:24,cid:86,params:[{type:"Property",name:"qchatGetChannelCategoryRoleTag",reflectMapper:Am.qchatGetChannelCategoryRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:Om.channelCategoryRole}]},qchatAddChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:87,params:[{type:"Property",name:"qchatAddChannelCategoryMemberRoleTag",reflectMapper:Am.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:Om.channelCategoryMemberRole}]},qchatRemoveChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:88,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"String",name:"accid"}]},qchatUpdateChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:89,params:[{type:"Property",name:"qchatUpdateChannelCategoryMemberRoleTag",reflectMapper:Am.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:Om.channelCategoryMemberRole}]},qchatGetChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:90,params:[{type:"Property",name:"qchatGetChannelCategoryMemberRoleTag",reflectMapper:Am.qchatGetChannelCategoryMemberRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:Om.channelCategoryMemberRole}]},qchatCheckPermissions:{service:"qchatRole",sid:24,cid:126,params:[{type:"Property",name:"checkPermissionsTag",reflectMapper:Am.checkPermissionsTag}],response:[{type:"PropertyArray",name:"checkPermissionsResult",reflectMapper:{1:"auth",2:"isAllow"}}]}},Bm=function(){function CategoryModuleService(t){this.core=t}var t=CategoryModuleService.prototype;return t.addChannelCategoryRole=function addChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee(){var a;return Mi.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatAddChannelCategoryRole",{qchatAddChannelCategoryRoleTag:t});case 3:return a=o.sent,o.abrupt("return",formatChannelCategoryRole(a.content.channelCategoryRole));case 5:case"end":return o.stop()}}),_callee,this)})))},t.removeChannelCategoryRole=function removeChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee2(){return Mi.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelCategoryRole",t);case 3:case"end":return a.stop()}}),_callee2,this)})))},t.updateChannelCategoryRole=function updateChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee3(){var a;return Mi.wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object"}},t),o.next=3,this.core.sendCmd("qchatUpdateChannelCategoryRole",{qchatUpdateChannelCategoryRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=o.sent).raw.code){o.next=6;break}throw new vc("No update required",{},406);case 6:return o.abrupt("return",formatChannelCategoryRole(a.content.channelCategoryRole));case 7:case"end":return o.stop()}}),_callee3,this)})))},t.getChannelCategoryRole=function getChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee4(){var a;return Mi.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetChannelCategoryRole",{qchatGetChannelCategoryRoleTag:t});case 3:return a=o.sent,o.abrupt("return",(c=a.content.list,Wc(c)&&c.length>0?map(c).call(c,(function(t){return formatChannelCategoryRole(t)})):[]));case 5:case"end":return o.stop()}var c}),_callee4,this)})))},t.addChannelCategoryMemberRole=function addChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee5(){var a;return Mi.wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatAddChannelCategoryMemberRole",{qchatAddChannelCategoryMemberRoleTag:t});case 3:return a=o.sent,o.abrupt("return",formatChannelCategoryMemberRole(a.content.channelCategoryMemberRole));case 5:case"end":return o.stop()}}),_callee5,this)})))},t.removeChannelCategoryMemberRole=function removeChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee6(){return Mi.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelCategoryMemberRole",t);case 3:case"end":return a.stop()}}),_callee6,this)})))},t.updateChannelCategoryMemberRole=function updateChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee7(){var a;return Mi.wrap((function _callee7$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object"}},t),o.next=3,this.core.sendCmd("qchatUpdateChannelCategoryMemberRole",{qchatUpdateChannelCategoryMemberRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=o.sent).raw.code){o.next=6;break}throw new vc("No update required",{},406);case 6:return o.abrupt("return",formatChannelCategoryMemberRole(a.content.channelCategoryMemberRole));case 7:case"end":return o.stop()}}),_callee7,this)})))},t.getChannelCategoryMemberRole=function getChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee8(){var a;return Mi.wrap((function _callee8$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetChannelCategoryMemberRole",{qchatGetChannelCategoryMemberRoleTag:t});case 3:return a=o.sent,o.abrupt("return",(c=a.content.list,Wc(c)&&c.length>0?map(c).call(c,(function(t){return formatChannelCategoryMemberRole(t)})):[]));case 5:case"end":return o.stop()}var c}),_callee8,this)})))},CategoryModuleService}(),jm=function(t){function QChatRoleService(a){var o;return(o=t.call(this,"qchatRole",a)||this).core=a,registerParser({cmdMap:Pm,cmdConfig:Um}),o.category=new Bm(a),o}wt(QChatRoleService,t);var a=QChatRoleService.prototype;return a.createServerRole=function createServerRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee(){var a;return Mi.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1},priority:{type:"number",min:1},icon:{type:"string",required:!1},ext:{type:"string",required:!1}},t),o.next=3,this.core.sendCmd("qchatCreateServerRole",{serverRole:ki(ki({},generatorRoleForCmd(t)),{type:Uf.custom}),antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatRole(a.content.serverRole));case 5:case"end":return o.stop()}}),_callee,this)})))},a.updateServerRole=function updateServerRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee2(){var a;return Mi.wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},name:{type:"string",required:!1},icon:{type:"string",required:!1},ext:{type:"string",required:!1},priority:{type:"number",required:!1},auths:{type:"object",required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateServerRole",{updateServerRoleTag:generatorRoleForCmd(t),antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatRole(a.content.serverRole));case 5:case"end":return o.stop()}}),_callee2,this)})))},a.deleteServerRole=function deleteServerRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee3(){return Mi.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatDeleteServerRole",t);case 3:case"end":return a.stop()}}),_callee3,this)})))},a.getServerRoles=function getServerRoles(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee4(){var a,o,c;return Mi.wrap((function _callee4$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},categoryId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},priority:{type:"number",required:!1}},t),h.next=3,this.core.sendCmd("qchatGetServerRoles",{getServerRolesTag:generatorRoleForCmd(t)});case 3:return o=h.sent,c=filter(a=o.content.serverRoles).call(a,(function(t){return 1===$u(t.isMember)})),c=map(c).call(c,(function(t){return t.roleId})),h.abrupt("return",{roles:formatRoles(o.content.serverRoles),isMemberRoles:c});case 7:case"end":return h.stop()}}),_callee4,this)})))},a.addChannelRole=function addChannelRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee5(){var a;return Mi.wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatAddChannelRole",{channelRole:generatorRoleForCmd(t)});case 3:return a=o.sent,o.abrupt("return",formatRole(a.content.channelRole));case 5:case"end":return o.stop()}}),_callee5,this)})))},a.getChannelRoles=function getChannelRoles(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee6(){var a;return Mi.wrap((function _callee6$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetChannelRoles",{getChannelRolesTag:t});case 3:return a=o.sent,o.abrupt("return",formatRoles(a.content.channelRoles));case 5:case"end":return o.stop()}}),_callee6,this)})))},a.removeChannelRole=function removeChannelRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee7(){return Mi.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelRole",t);case 3:case"end":return a.stop()}}),_callee7,this)})))},a.updateChannelRole=function updateChannelRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee8(){var a;return Mi.wrap((function _callee8$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateChannelRole",{updateChannelRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=o.sent).raw.code){o.next=6;break}throw new vc("No update required",{},406);case 6:return o.abrupt("return",formatRole(a.content.channelRole));case 7:case"end":return o.stop()}}),_callee8,this)})))},a.addMemberRole=function addMemberRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee9(){var a;return Mi.wrap((function _callee9$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatAddMemberRole",{memberRole:t});case 3:return a=o.sent,o.abrupt("return",formatRole(a.content.memberRole));case 5:case"end":return o.stop()}}),_callee9,this)})))},a.getMemberRoles=function getMemberRoles(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee10(){var a;return Mi.wrap((function _callee10$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetMemberRoles",{getMemberRolesTag:t});case 3:return a=o.sent,o.abrupt("return",formatRoles(a.content.memberRoles));case 5:case"end":return o.stop()}}),_callee10,this)})))},a.removeMemberRole=function removeMemberRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee11(){return Mi.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveMemberRole",{memberRole:t});case 3:case"end":return a.stop()}}),_callee11,this)})))},a.updateMemberRole=function updateMemberRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee12(){var a;return Mi.wrap((function _callee12$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateMemberRole",{updateMemberRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=o.sent).raw.code){o.next=6;break}throw new vc("No update required",{},406);case 6:return o.abrupt("return",formatRole(a.content.memberRole));case 7:case"end":return o.stop()}}),_callee12,this)})))},a.addMembersToServerRole=function addMembersToServerRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee13(){var a,o,c;return Mi.wrap((function _callee13$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},t),h.next=3,this.core.sendCmd("qchatAddMembersToServerRole",ki(ki({},t),{accids:us(t.accids)}));case 3:return a=h.sent,o=Hp(a,"content.accids.successAccids"),c=Hp(a,"content.accids.failedAccids"),h.abrupt("return",{successAccids:o?JSON.parse(o):[],failedAccids:c?JSON.parse(c):[]});case 7:case"end":return h.stop()}}),_callee13,this)})))},a.removeMembersFromServerRole=function removeMembersFromServerRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee14(){var a,o,c;return Mi.wrap((function _callee14$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},t),h.next=3,this.core.sendCmd("qchatRemoveMembersFromServerRole",ki(ki({},t),{accids:us(t.accids)}));case 3:return a=h.sent,o=Hp(a,"content.accids.successAccids"),c=Hp(a,"content.accids.failedAccids"),h.abrupt("return",{successAccids:o?JSON.parse(o):[],failedAccids:c?JSON.parse(c):[]});case 7:case"end":return h.stop()}}),_callee14,this)})))},a.getMembersFromServerRole=function getMembersFromServerRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee15(){var a;return Mi.wrap((function _callee15$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},accid:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetMembersFromServerRole",{getMembersFromServerRoleTag:t});case 3:return a=o.sent,o.abrupt("return",formatRoles(a.content.members));case 5:case"end":return o.stop()}}),_callee15,this)})))},a.getServerRolesByAccid=function getServerRolesByAccid(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee16(){var a;return Mi.wrap((function _callee16$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetServerRolesByAccid",{getServerRolesByAccidTag:t});case 3:return a=o.sent,o.abrupt("return",formatRoles(a.content.serverRoles));case 5:case"end":return o.stop()}}),_callee16,this)})))},a.getExistingServerRolesByAccids=function getExistingServerRolesByAccids(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee17(){var a,o,c;return Mi.wrap((function _callee17$(h){for(;;)switch(h.prev=h.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},t),h.next=3,this.core.sendCmd("qchatGetExistingServerRolesByAccids",{serverId:t.serverId,accids:us(t.accids)});case 3:return a=h.sent,h.prev=4,c=JSON.parse(a.content.serverRoles),forEach$1(o=Oc(c)).call(o,(function(t){var a;forEach$1(a=c[t]).call(a,(function(a,o){c[t][o]=deserialize(a,Om.serverRole)})),c[t]=formatRoles(c[t])})),h.abrupt("return",c);case 10:throw h.prev=10,h.t0=h.catch(4),this.logger.error("can not parse serverRolesGroupByAccid from "+t.serverId+" and "+t.accids,a.content.serverRoles),h.t0;case 14:case"end":return h.stop()}}),_callee17,this,[[4,10]])})))},a.getExistingChannelRolesByServerRoleIds=function getExistingChannelRolesByServerRoleIds(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee18(){var a;return Mi.wrap((function _callee18$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleIds:{type:"array",itemType:"string"}},t),o.next=3,this.core.sendCmd("qchatGetExistingChannelRolesByServerRoleIds",{serverId:t.serverId,channelId:t.channelId,roleIds:us(t.roleIds)});case 3:return a=o.sent,o.abrupt("return",formatRoles(a.content.channelRoles));case 5:case"end":return o.stop()}}),_callee18,this)})))},a.getExistingAccidsOfMemberRoles=function getExistingAccidsOfMemberRoles(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee19(){var a,o;return Mi.wrap((function _callee19$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},t),c.next=3,this.core.sendCmd("qchatGetExistingAccidsOfMemberRoles",{serverId:t.serverId,channelId:t.channelId,accids:us(t.accids)});case 3:return a=c.sent,o=a.content.memberRoles,c.abrupt("return",o&&o.length>0?map(o).call(o,(function(t){return t.accid})):[]);case 6:case"end":return c.stop()}}),_callee19,this)})))},a.getExistingAccidsInServerRole=function getExistingAccidsInServerRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee20(){var a,o;return Mi.wrap((function _callee20$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},t),c.next=3,this.core.sendCmd("qchatGetExistingAccidsInServerRole",{serverId:t.serverId,roleId:t.roleId,accids:us(t.accids)});case 3:return a=c.sent,o=a.content.members,c.abrupt("return",o&&o.length>0?map(o).call(o,(function(t){return t.accid})):[]);case 6:case"end":return c.stop()}}),_callee20,this)})))},a.updateServerRolePriorities=function updateServerRolePriorities(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee21(){var a,o;return Mi.wrap((function _callee21$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},serverRoles:{type:"array"}},t),c.next=3,this.core.sendCmd("qchatUpdateServerRolePriorities",{serverId:t.serverId,serverRoles:map(a=t.serverRoles).call(a,(function(t){return{serverId:t.serverId,roleId:t.roleId,priority:t.priority}}))});case 3:return o=c.sent,c.abrupt("return",formatRoles(o.content.serverRoles));case 5:case"end":return c.stop()}}),_callee21,this)})))},a.checkPermission=function checkPermission(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee22(){var a;return Mi.wrap((function _callee22$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auth:{type:"string"}},t),o.next=3,this.core.sendCmd("qchatCheckPermission",{checkPermissionTag:ki(ki({},t),{auth:Lf[t.auth]||t.auth})});case 3:return a=o.sent,o.abrupt("return",a.content.checked);case 5:case"end":return o.stop()}}),_callee22,this)})))},a.addChannelCategoryRole=function addChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee23(){return Mi.wrap((function _callee23$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.addChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee23,this)})))},a.removeChannelCategoryRole=function removeChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee24(){return Mi.wrap((function _callee24$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.removeChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee24,this)})))},a.updateChannelCategoryRole=function updateChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee25(){return Mi.wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.updateChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee25,this)})))},a.getChannelCategoryRole=function getChannelCategoryRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee26(){return Mi.wrap((function _callee26$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.getChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee26,this)})))},a.addChannelCategoryMemberRole=function addChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee27(){return Mi.wrap((function _callee27$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.addChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee27,this)})))},a.removeChannelCategoryMemberRole=function removeChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee28(){return Mi.wrap((function _callee28$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.removeChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee28,this)})))},a.updateChannelCategoryMemberRole=function updateChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee29(){return Mi.wrap((function _callee29$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.updateChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee29,this)})))},a.getChannelCategoryMemberRole=function getChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee30(){return Mi.wrap((function _callee30$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.getChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee30,this)})))},a.checkPermissions=function checkPermissions(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee31(){var a,o,c,h;return Mi.wrap((function _callee31$(m){for(;;)switch(m.prev=m.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auths:{type:"array",itemType:"string"}},t),this.core.logger.log("qchatRole::checkPermission options is",t),m.next=4,this.core.sendCmd("qchatCheckPermissions",{checkPermissionsTag:ki(ki({},t),{auths:us(map(a=t.auths).call(a,(function(t){return Lf[t]||t})))})});case 4:return c=m.sent,this.core.logger.log("qchatRole::checkPermission result is",c.content),h={},forEach$1(o=c.content.checkPermissionsResult).call(o,(function(t){h[t.auth]=t.isAllow})),this.core.logger.log("qchatRole::checkPermission auths is",h),m.abrupt("return",formatRoleAuths(h));case 10:case"end":return m.stop()}}),_callee31,this)})))},QChatRoleService}(zh);var Lm=function basePick(t,a){return ch(t,a,(function(a,o){return Xp(t,o)}))};var Nm=function flatten(t){return(null==t?0:t.length)?Pf(t,1):[]};var Fm,Gm,$m=function flatRest(t){return uu(au(t,void 0,Nm),t+"")}((function(t,a){return null==t?{}:Lm(t,a)})),Dm={"24_10":"qchatSendMsg","24_11":"qchatOnMsg","24_12":"qchatOnRecvUnreadInfo","24_13":"qchatSendCustomSysMsg","24_14":"qchatOnSysMsg","24_16":"qchatGetHistoryMsg","24_17":"qchatMarkMessageRead","24_18":"qchatMultiSyncMessageRead","24_22":"qchatUpdateSystemNotification","24_23":"qchatMultiSyncSystemNotificationUpdate","24_24":"qchatSyncSystemNotification","24_25":"qchatUpdateMessage","24_26":"qchatRecvMessageUpdate","24_28":"qchatMarkSysMsgRead","24_94":"qchatMessageSearchByPage","24_100":"qchatGetMessageHistoryByIds","24_101":"qchatGetThreadMessages","24_102":"qchatUpdateQuickComment","24_103":"qchatGetQuickComments","24_108":"qchatGetThreadRootMessagesMeta","24_121":"qchatGetLastMessageOfChannels","24_127":"qchatGetMentionedMeMessages","25_6":"qchatMultiSyncServersMessageRead"},Qm={getHistoryMsgTag:{serverId:1,channelId:2,beginTime:3,endTime:4,excludeMsgId:5,limit:6,reverse:7},getThreadHistoryMsgTag:{beginTime:1,endTime:2,excludeMsgId:3,limit:4,reverse:5},qchatMsgTag:{serverId:1,channelId:2,fromAccount:3,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,updateTime:8,type:9,body:10,attach:11,ext:12,msgIdClient:13,msgIdServer:14,resendFlag:15,status:16,pushPayload:17,pushContent:18,mentionAccids:19,mentionAll:20,env:21,callbackExt:22,replyMsgFromAccount:23,replyMsgTime:24,replyMsgIdServer:25,replyMsgIdClient:26,threadMsgFromAccount:27,threadMsgTime:28,threadMsgIdServer:29,threadMsgIdClient:30,useCustomContent:31,antiSpamContent:32,antiSpamBusinessId:33,antiSpamUsingYidun:34,yidunCallback:35,yidunAntiCheating:36,yidunAntiSpamExt:37,yidunAntiSpamRes:38,mentionRoleIds:41,accidsOfMentionedRoles:42,updateContent:39,updateOperatorInfo:40,subType:61,historyEnable:100,pushEnable:101,needBadge:102,needPushNick:103,notifyReason:104,routeEnable:105,isAntispam:106},sysMsg:{toType:1,serverId:2,channelId:3,toAccids:4,fromAccount:5,fromClientType:6,fromDeviceId:7,fromNick:8,time:9,updateTime:10,type:11,msgIdClient:12,msgIdServer:13,body:14,attach:15,ext:16,resendFlag:17,status:18,pushPayload:19,pushContent:20,env:21,callbackExt:22,persistEnable:100,pushEnable:101,needBadge:102,needPushNick:103,routeEnable:104},qchatMsgUpdateTag:{operatorAccount:1,operatorClientType:2,ps:3,ext:4,pushContent:5,pushPayload:6,env:7,routeEnable:100},markMsgReadTag:{serverId:1,channelId:2,time:3},qchatQuickCommentRequestTag:{serverId:1,channelId:2,fromAccount:3,msgIdServer:4,time:5,type:6,opeType:7,opeAccid:8},qchatQuickCommentQueryTag:{serverId:1,channelId:2,msgIdServerList:3},qchatGetLastMessageOfChannelsTag:{serverId:1,channelIdList:2},qchatMultiSyncServersMessageReadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},qchatMessageSearchByPageTag:{keyword:1,serverId:2,channelId:3,fromAccid:4,fromTime:5,toTime:6,msgTypes:7,subTypes:8,includeSelf:9,order:10,limit:11,sort:12,cursor:13},qchatPageQueryTag:{hasMore:1,nextTimetag:2,cursor:3},unreadInfo:Jh},Wm=invertSerializeMap(Qm),Vm={qchatSendMsg:{service:"qchatMsg",sid:24,cid:10,params:[{type:"Property",name:"qchatMsg",reflectMapper:Qm.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:Wm.qchatMsgTag}]},qchatOnMsg:{service:"qchatMsg",sid:24,cid:11,response:[{type:"Property",name:"qchatMsg",reflectMapper:Wm.qchatMsgTag}]},qchatOnRecvUnreadInfo:{service:"qchatMsg",sid:24,cid:12,response:[{type:"Property",name:"qchatMsg",reflectMapper:Wm.qchatMsgTag}]},qchatSendCustomSysMsg:{service:"qchatMsg",sid:24,cid:13,params:[{type:"Property",name:"sysMsg",reflectMapper:Qm.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:Wm.sysMsg}]},qchatOnSysMsg:{service:"qchatMsg",sid:24,cid:14,response:[{type:"Property",name:"sysMsg",reflectMapper:Wm.sysMsg}]},qchatGetHistoryMsg:{service:"qchatMsg",sid:24,cid:16,params:[{type:"Property",name:"getHistoryMsgTag",reflectMapper:Qm.getHistoryMsgTag}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:Wm.qchatMsgTag}]},qchatUpdateMessage:{service:"qchatMsg",sid:24,cid:25,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:Qm.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:Qm.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:Wm.qchatMsgTag}]},qchatRecvMessageUpdate:{service:"qchatMsg",sid:24,cid:26,response:[{type:"Property",name:"qchatMsgUpdateInfo",reflectMapper:Wm.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:Wm.qchatMsgTag}]},qchatMarkMessageRead:{sid:24,cid:17,service:"qchatMsg",params:[{type:"Property",name:"markMsgReadTag",reflectMapper:Qm.markMsgReadTag}],response:[{type:"Property",name:"unreadInfo",reflectMapper:Wm.unreadInfo}]},qchatMultiSyncMessageRead:{sid:24,cid:18,service:"qchatMsg",response:[{type:"Property",name:"unreadInfo",reflectMapper:Wm.unreadInfo}]},qchatUpdateSystemNotification:{service:"qchatMsg",sid:24,cid:22,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:Qm.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:Qm.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:Wm.sysMsg}]},qchatMultiSyncSystemNotificationUpdate:{service:"qchatMsg",sid:24,cid:23,response:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:Wm.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:Wm.sysMsg}]},qchatSyncSystemNotification:{service:"qchatMsg",sid:24,cid:24,response:[{type:"PropertyArray",name:"systemNotifications",reflectMapper:Wm.sysMsg}]},qchatMarkSysMsgRead:{service:"qchatMsg",sid:24,cid:28,params:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:Qm.sysMsg}]},qchatMessageSearchByPage:{service:"qchatMsg",sid:24,cid:94,params:[{type:"Property",name:"qchatMessageSearchByPageTag",reflectMapper:Qm.qchatMessageSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:Wm.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:Wm.qchatMsgTag}]},qchatGetMessageHistoryByIds:{service:"qchatMsg",sid:24,cid:100,params:[{type:"Property",name:"channelInfo",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"messageReferList",reflectMapper:{msgIdServer:1,time:2}}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:Wm.qchatMsgTag}]},qchatGetThreadMessages:{service:"qchatMsg",sid:24,cid:101,params:[{type:"Property",name:"qchatMsg",reflectMapper:Qm.qchatMsgTag},{type:"Property",name:"getThreadHistoryMsgTag",reflectMapper:Qm.getThreadHistoryMsgTag}],response:[{type:"Property",name:"thread",reflectMapper:Wm.qchatMsgTag},{type:"Property",name:"threadInfo",reflectMapper:{1:"messageCount",2:"lastMessageTimestamp"}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:Wm.qchatMsgTag}]},qchatUpdateQuickComment:{service:"qchatMsg",sid:24,cid:102,params:[{type:"Property",name:"tag",reflectMapper:Qm.qchatQuickCommentRequestTag}]},qchatGetQuickComments:{service:"qchatMsg",sid:24,cid:103,params:[{type:"Property",name:"tag",reflectMapper:Qm.qchatQuickCommentQueryTag}],response:[{type:"PropertyArray",name:"quickCommentResponse",reflectMapper:{1:"serverId",2:"channelId",3:"msgIdServer",4:"totalCount",5:"lastUpdateTime",6:"details"}}]},qchatGetThreadRootMessagesMeta:{service:"qchatMsg",sid:24,cid:108,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:{time:7,msgIdServer:14}}],response:[{type:"PropertyArray",name:"metas",reflectMapper:{1:"total",2:"timestamp",3:"msgIdServer",4:"msgTime"}}]},qchatGetLastMessageOfChannels:{service:"qchatMsg",sid:24,cid:121,params:[{type:"Property",name:"tag",reflectMapper:Qm.qchatGetLastMessageOfChannelsTag}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Wm.qchatMsgTag}]},qchatMultiSyncServersMessageRead:{service:"qchatMsg",sid:25,cid:6,response:[{type:"Property",name:"qchatMultiSyncServersMessageReadTag",reflectMapper:Wm.qchatMultiSyncServersMessageReadTag}]},qchatGetMentionedMeMessages:{service:"qchatMsg",sid:24,cid:127,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2,timestamp:3,limit:4}}],response:[{type:"Property",name:"page",reflectMapper:Wm.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:Wm.qchatMsgTag}]}};!function(t){t[t.Android=1]="Android",t[t.iOS=2]="iOS",t[t.PC=4]="PC",t[t.WindowsPhone=8]="WindowsPhone",t[t.Web=16]="Web",t[t.Server=32]="Server",t[t.Mac=64]="Mac"}(Fm||(Fm={}));var Km=["image","audio","video","file"],zm={time:{type:"number"},updateTime:{type:"number"},resendFlag:{type:"boolean"},persistEnable:{type:"boolean"},routeEnable:{type:"boolean"},pushEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},type:{type:"enum",values:Zf},fromClientType:{type:"enum",values:Fm},status:{type:"number"},toAccids:{type:"object"},toType:{type:"number"},attach:{type:"object"},pushPayload:{type:"object"}};function generatorSysMsgForCmd(t,a){var o=ki({},t),c=ki({type:a||Zf.custom},formatReverse(zm,o));return c.serverId&&c.channelId&&c.toAccids?c.toType=Xf.channelAccids:c.serverId&&c.toAccids?c.toType=Xf.serverAccids:c.serverId&&c.channelId?c.toType=Xf.channel:c.serverId?c.toType=Xf.server:c.toAccids?c.toType=Xf.accids:c.toType=Xf.unknown,c}function generatorSysMsgMarkersForCmd(t){var a=$m(t,["msgIdServer","type"]);return formatReverse(zm,a)}var Hm=((Gm={})[Zf.channelUpdateWhiteBlackIdentify]=function(t){return t.notify=formatUpdateWhiteBlackRole(deserialize(t.notify,Xh.qchatUpdateWhiteBlackRoleTag)),t},Gm[Zf.channelUpdateWhiteBlackIdentifyUser]=function(t){return t.notify=function formatUpdateWhiteBlackMembers(t){return format(xf,t)}(deserialize(t.notify,Xh.qchatUpdateWhiteBlackMembersTag)),t},Gm[Zf.updateQuickComment]=function(t){return t.notify=function formatQuickCommentRequest(t){return format(Xm,t)}(deserialize(t.notify,Wm.qchatQuickCommentRequestTag)),t},Gm[Zf.channelCategoryCreate]=function(t){return t.categoryInfo=formatChannelCategory(deserialize(t.categoryInfo,Xh.QChatChannelCategoryInfo)),t},Gm[Zf.channelCategoryUpdate]=function(t){return t.categoryInfo=formatChannelCategory(deserialize(t.categoryInfo,Xh.QChatChannelCategoryInfo)),t},Gm[Zf.channelCategoryUpdateWhiteBlackIdentify]=function(t){return t.notify=formatUpdateWhiteBlackRole(deserialize(t.notify,Xh.qchatUpdateChannelCategoryWhiteBlackRoleTag)),t},Gm[Zf.channelCategoryUpdateWhiteBlackIdentifyUser]=function(t){return t.notify=formatUpdateWhiteBlackRole(deserialize(t.notify,Xh.qchatUpdateChannelCategoryWhiteBlackMembersTag)),t},Gm[Zf.serverIdentifyAdd]=function(t){return t.serverIdentifyInfo=formatRole(deserialize(t.serverIdentifyInfo,Om.serverRole)),t},Gm[Zf.serverIdentifyRemove]=function(t){return t.serverIdentifyInfo=formatRole(deserialize(t.serverIdentifyInfo,Om.serverRole)),t},Gm[Zf.serverIdentifyUpdate]=function(t){return t.serverIdentifyInfo=formatRole(deserialize(t.serverIdentifyInfo,Om.serverRole)),t},Gm[Zf.channelIdentifyUpdate]=function(t){return t.channelIdentifyInfo=formatRole(deserialize(t.channelIdentifyInfo,Om.channelRole)),t},Gm[Zf.userIdentifyUpdate]=function(t){return t.userIdentifyInfo=formatRole(deserialize(t.userIdentifyInfo,Om.memberRole)),t},Gm[Zf.myMemberInfoUpdated]=function(t){var a,o=Hp(t,"userInfo.name"),c=Hp(t,"userInfo.icon");return t.updatedInfos=map(a=t.reuseServers).call(a,(function(t){var a={serverId:t.serverId};return 1==(1&t.bits)&&"string"==typeof o&&ki(a,{nickChanged:!0,nick:o}),2==(2&t.bits)&&"string"==typeof c&&ki(a,{avatarChanged:!0,avatar:c}),a})),delete t.userInfo,delete t.reuseServers,t},Gm);function formatSystemNotification(t,a){var o=format(zm,t);if(!o.attach)return o;if(o.attach.serverInfo&&(o.attach.serverInfo=formatServer(deserialize(o.attach.serverInfo,rf.serverInfo))),o.attach.channelInfo&&(o.attach.channelInfo=formatChannel(deserialize(o.attach.channelInfo,Xh.channelInfo))),o.attach.serverMember&&(o.attach.serverMember=formatMember$1(deserialize(o.attach.serverMember,rf.memberInfo))),Hm[o.attach.type]&&(o.attach=Hm[o.attach.type](o.attach)),o.attach.updateAuths)try{o.attach.updateAuths=formatRoleAuths(JSON.parse(o.attach.updateAuths))}catch(t){a.error("formatSystemNotification:JSON parse updateAuths error: ",t)}return o.attach.type&&(o.attach.rawType=o.attach.type,o.attach.type=Zf[o.attach.type]),o}var Jm={type:{type:"enum",values:Hf},fromClientType:{type:"enum",values:Fm},status:{type:"number"},resendFlag:{type:"boolean"},mentionAll:{type:"boolean"},notifyReason:{type:"enum",values:Yf},pushEnable:{type:"boolean"},historyEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},routeEnable:{type:"boolean"},time:{type:"number"},updateTime:{type:"number"},mentionAccids:{type:"object"},mentionRoleIds:{type:"object"},accidsOfMentionedRoles:{type:"object"},attach:{type:"object"},pushPayload:{type:"object"},isAntispam:{type:"boolean"},antiSpamInfo:{useCustomContent:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBusinessId:{type:"string"},antiSpamUsingYidun:{type:"boolean"},yidunCallback:{type:"string"},yidunAntiCheating:{type:"object"},yidunAntiSpamExt:{type:"object"},yidunAntiSpamRes:{type:"string"}},replyRefer:{fromAccount:{type:"string",rawKey:"replyMsgFromAccount"},time:{type:"number",rawKey:"replyMsgTime"},msgIdServer:{type:"string",rawKey:"replyMsgIdServer"},msgIdClient:{type:"string",rawKey:"replyMsgIdClient"}},threadRefer:{fromAccount:{type:"string",rawKey:"threadMsgFromAccount"},time:{type:"number",rawKey:"threadMsgTime"},msgIdServer:{type:"string",rawKey:"threadMsgIdServer"},msgIdClient:{type:"string",rawKey:"threadMsgIdClient"}}};function generatorMsgForCmd(t){t.onSendBefore,t.onUploadStart,t.onUploadDone,t.onUploadProgress;var a=__rest(t,["onSendBefore","onUploadStart","onUploadDone","onUploadProgress"]),o=formatReverse(Jm,a);if(o.msgIdClient=t.resendFlag?t.msgIdClient:Du(),!o.msgIdClient)throw new Cc("msgIdClient is required for resend a message","msgIdClient","required");return t.replyMessage&&t.replyMessage.msgIdServer&&(o.replyMsgFromAccount=t.replyMessage.fromAccount,o.replyMsgTime=+t.replyMessage.time,o.replyMsgIdServer=t.replyMessage.msgIdServer,o.replyMsgIdClient=t.replyMessage.msgIdClient,t.replyMessage.threadRefer&&t.replyMessage.threadRefer.msgIdServer?(o.threadMsgFromAccount=t.replyMessage.threadRefer.fromAccount,o.threadMsgTime=+t.replyMessage.threadRefer.time,o.threadMsgIdServer=t.replyMessage.threadRefer.msgIdServer,o.threadMsgIdClient=t.replyMessage.threadRefer.msgIdClient):(o.threadMsgFromAccount=t.replyMessage.fromAccount,o.threadMsgTime=+t.replyMessage.time,o.threadMsgIdServer=t.replyMessage.msgIdServer,o.threadMsgIdClient=t.replyMessage.msgIdClient),delete o.replyMessage),o}function formatMsgOperatorInfo(t){return format({operatorClientType:{type:"enum",values:Fm},pushPayload:{type:"object"}},t)}function formatMsg(t,a,o){var c,h;return void 0===a&&(a={}),__awaiter(this,void 0,void 0,Mi.mark((function _callee(){var m,v,b;return Mi.wrap((function _callee$(C){for(;;)switch(C.prev=C.next){case 0:return(m=format(Jm,t)).deliveryStatus=a.deliveryStatus?Jf[a.deliveryStatus]:Jf[Jf.success],a.time&&(m.time=a.time),m.updateContent&&(v=format({status:{type:"number"}},v=deserialize(v=JSON.parse(m.updateContent),Wm.qchatMsgTag)),m.updateContent=v),m.updateOperatorInfo&&(b=formatMsgOperatorInfo(deserialize(b=JSON.parse(m.updateOperatorInfo),Wm.qchatMsgUpdateTag)),m.updateOperatorInfo=b),""===(null===(c=null==m?void 0:m.threadRefer)||void 0===c?void 0:c.fromAccount)&&delete m.threadRefer,""===(null===(h=null==m?void 0:m.replyRefer)||void 0===h?void 0:h.fromAccount)&&delete m.replyRefer,m.attach&&a.attachUrl&&(m.attach.url=a.attachUrl),C.next=10,formatMsgAttach(m,o);case 10:return C.abrupt("return",C.sent);case 11:case"end":return C.stop()}}),_callee)})))}function formatMsgAttach(t,a){return __awaiter(this,void 0,void 0,Mi.mark((function _callee2(){var o;return Mi.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:if(includes(Km).call(Km,t.type)&&t.attach&&t.attach.url){c.next=2;break}return c.abrupt("return",t);case 2:if(a&&a.cloudStorage&&"function"==typeof a.cloudStorage.getPrivateUrl&&"function"==typeof a.cloudStorage.getOriginUrl){c.next=4;break}return c.abrupt("return",t);case 4:if(!(indexOf(o=t.attach.url).call(o,"_im_url=1")<0)){c.next=7;break}return t.attach.url=a.cloudStorage.getPrivateUrl(t.attach.url),c.abrupt("return",t);case 7:return c.prev=7,c.next=10,a.cloudStorage.getOriginUrl(t.attach.url);case 10:t.attach.url=c.sent,c.next=16;break;case 13:throw c.prev=13,c.t0=c.catch(7),new Cc('url "'+t.attach.url+'" parse error',"message.attach.url","parse error");case 16:return c.abrupt("return",t);case 17:case"end":return c.stop()}}),_callee2,null,[[7,13]])})))}function formatMsgs(t,a,o){return void 0===a&&(a={}),__awaiter(this,void 0,void 0,Mi.mark((function _callee3(){var c;return Mi.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:if(Wc(t)&&t.length>0){h.next=2;break}return h.abrupt("return",[]);case 2:return c=map(t).call(t,(function(t){return formatMsg(t,a,o)})),h.next=5,li.all(c);case 5:return h.abrupt("return",h.sent);case 6:case"end":return h.stop()}}),_callee3)})))}var Ym={totalCount:{type:"number"},lastUpdateTime:{type:"number"},details:{type:"object"}};function formatQuickComments(t){var a=map(t).call(t,(function(t){var a,o=format(Ym,t);return o.details=map(a=o.details).call(a,(function(t){return{count:t.count,hasSelf:t.self,severalAccids:t.topN,type:t.type}})),o})),o={};return forEach$1(a).call(a,(function(t){return o[t.msgIdServer]=t})),o}var Xm={type:{type:"number"},time:{type:"number"},opeType:{type:"number"}};var Zm={includeSelf:{type:"number"},order:{type:"enum",values:Dh},sort:{type:"enum",values:zf},msgTypes:{type:"object"},subTypes:{type:"object"}};var ev={hasMore:{type:"boolean"},nextTimetag:{type:"number"},cursor:{type:"string"}};var tv={6:function _(t){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInServerId(t.serverId),!0},16:function _(t){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInChannel(t.serverId,t.channelId),!0},26:function _(t){var a=Hp(t,"attach.addAccids");return a&&includes(a).call(a,this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",t),!0},27:function _(t){var a=Hp(t,"attach.deleteAccids");return a&&includes(a).call(a,this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",t),!0},31:function _(t){return 2===t.attach.event&&(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",t),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",t)),!0},32:function _(t){return 2===t.attach.event?(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",t),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",t)):1===t.attach.event&&this.core.qchatChannel.subscribeForVisitorService.deleteServer(t.serverId),!0},34:function _(t){return 2===t.attach.event&&this.core.qchatChannel.subscribeForVisitorService.unSubscribeChannel(t.serverId,t.channelId),!0},101:function _(t){var a=$m(t,["serverId","channelId","ext","fromAccount","fromNick","time"]);return this.logger.log("qchat on recvTypingEvent: ",a),this.core.emit("recvTypingEvent",a),!1}},rv=function(){function NotificationModuleService(t){this.core=t,this.logger=t.logger}var t=NotificationModuleService.prototype;return t.sendSystemNotification=function sendSystemNotification(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee(){var a,o;return Mi.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:generatorSysMsgForCmd(t)});case 2:return a=c.sent,o=formatSystemNotification(a.content.sysMsg,this.logger),"debug"===this.core.options.debugLevel?this.logger.debug("sendCustomSysMsg success",o):this.logger.log("sendCustomSysMsg success",o.serverId,o.channelId,o.msgIdServer),c.abrupt("return",o);case 6:case"end":return c.stop()}}),_callee,this)})))},t.updateSystemNotification=function updateSystemNotification(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee2(){var a,o,c,h,m;return Mi.wrap((function _callee2$(v){for(;;)switch(v.prev=v.next){case 0:return a=t.systemNotification,o=__rest(t,["systemNotification"]),c=$m(a,["msgIdServer","type","body","ext","status"]),h=generatorSysMsgForCmd(c),v.next=5,this.core.sendCmd("qchatUpdateSystemNotification",{sysMsg:h,qchatMsgUpdateTag:ki(ki({},o),{operatorAccount:this.core.account,operatorClientType:Fm.Web,pushPayload:us(t.pushPayload),routeEnable:ff.boolean(t,"routeEnable")})});case 5:return m=v.sent,v.abrupt("return",formatSystemNotification(m.content.sysMsg,this.logger));case 7:case"end":return v.stop()}}),_callee2,this)})))},t.markSystemNotificationsRead=function markSystemNotificationsRead(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee3(){var a;return Mi.wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.sendCmd("qchatMarkSysMsgRead",{sysMsgs:map(a=t.systemNotifications).call(a,(function(t){return generatorSysMsgMarkersForCmd(t)}))});case 2:case"end":return o.stop()}}),_callee3,this)})))},t.onSysMsg=function onSysMsg(t){var a=t.content.sysMsg;if(a){var o=formatSystemNotification(a,this.core.logger),c=tv[Zf[o.type]];if(c)if(!1===c.call(this,o))return;var h={feature:"default",systemNotifications:[o]};this.logger.log("qchat on systemNotification: ",h),this.core.emit("systemNotification",h)}else this.core.logger.warn("No sysMsg in onSysMsg packet")},t.onMultiSysMsg=function onMultiSysMsg(t){var a=t.content.sysMsg;if(a){var o=formatSystemNotification(a,this.logger);this.core.emit("systemNotificationUpdate",o)}},t.onSyncSysMsg=function onSyncSysMsg(t){var a=this,o=t.content.systemNotifications;if(o&&o.length>0){var c=map(o).call(o,(function(t){return formatSystemNotification(t,a.logger)}));this.core.emit("systemNotification",{feature:"sync",systemNotifications:c})}else this.logger.warn("sync system notification not exist")},NotificationModuleService}(),nv=["image","audio","video","file"],av=function(){function MessageModuleService(t){var a=this;this.markMessageRead=fm((function(t){return __awaiter(a,void 0,void 0,Mi.mark((function _callee(){var a,o;return Mi.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("qchatMarkMessageRead",{markMsgReadTag:t});case 2:a=c.sent,o=formatUnreadInfo(a.content.unreadInfo),this.core.eventBus.emit("qchatChannel/updateUnread",o);case 5:case"end":return c.stop()}}),_callee,this)})))}),200),this.core=t,this.logger=t.logger}var t=MessageModuleService.prototype;return t.sendMessage=function sendMessage(t){var a,o,c,h;return __awaiter(this,void 0,void 0,Mi.mark((function _callee2(){var m,v,b,C,S,M;return Mi.wrap((function _callee2$(w){for(;;)switch(w.prev=w.next){case 0:if(!(indexOf(nv).call(nv,t.type)>-1)){w.next=4;break}return w.next=3,this.doSendFile(t);case 3:t.attach=w.sent;case 4:return m=generatorMsgForCmd(ki({fromAccount:this.core.account},t)),w.next=7,formatMsg(m,{time:(new Date).getTime(),deliveryStatus:Jf.sending},this.core);case 7:v=w.sent;try{t.onSendBefore&&t.onSendBefore(v)}catch(t){this.logger.error("sendMsg: options.onSendBefore error",t)}return w.prev=9,w.next=12,this.core.sendCmd("qchatSendMsg",{qchatMsg:m});case 12:b=w.sent,w.next=22;break;case 15:return w.prev=15,w.t0=w.catch(9),w.next=19,formatMsg(m,{time:(new Date).getTime(),deliveryStatus:Jf.failed,attachUrl:null===(a=v.attach)||void 0===a?void 0:a.url},this.core);case 19:throw C=w.sent,w.t0.msg=C,w.t0;case 22:return S=b.content,w.next=25,formatMsg(ki({},S.qchatMsg),{deliveryStatus:Jf.success,attachUrl:null===(o=v.attach)||void 0===o?void 0:o.url},this.core);case 25:if(!(M=w.sent).isAntispam){w.next=29;break}throw{code:10403,msg:M,message:(null===(c=null==M?void 0:M.antiSpamInfo)||void 0===c?void 0:c.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(h=null==M?void 0:M.antiSpamInfo)||void 0===h?void 0:h.yidunAntiSpamRes)||""};case 29:return w.abrupt("return",M);case 30:case"end":return w.stop()}}),_callee2,this,[[9,15]])})))},t.doSendFile=function doSendFile(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee3(){var a;return Mi.wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:if(validate({type:{type:"enum",values:["image","audio","video","file"]},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},t),a=t.attach){o.next=23;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){o.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return o.prev=5,o.next=8,this.core.cloudStorage.uploadFile(t);case 8:a=o.sent,o.next=15;break;case 11:throw o.prev=11,o.t0=o.catch(5),this.logger.error("sendFile:: upload File error or abort",o.t0),o.t0;case 15:o.prev=15,t.onUploadDone&&t.onUploadDone(a),o.next=23;break;case 19:throw o.prev=19,o.t1=o.catch(15),this.logger.error("sendFile options.onUploadDone err",o.t1),o.t1;case 23:return o.abrupt("return",a);case 24:case"end":return o.stop()}}),_callee3,this,[[5,11],[15,19]])})))},t.resendMessage=function resendMessage(t){var a,o;return __awaiter(this,void 0,void 0,Mi.mark((function _callee4(){var c,h,m,v,b;return Mi.wrap((function _callee4$(C){for(;;)switch(C.prev=C.next){case 0:return(c=generatorMsgForCmd(ki(ki({},t),{resendFlag:!0}))).deliveryStatus=Jf.sending,C.prev=2,C.next=5,this.core.sendCmd("qchatSendMsg",{qchatMsg:c});case 5:h=C.sent,C.next=15;break;case 8:return C.prev=8,C.t0=C.catch(2),C.next=12,formatMsg(c,{time:(new Date).getTime(),deliveryStatus:Jf.failed},this.core);case 12:throw m=C.sent,C.t0.msg=m,C.t0;case 15:return v=h.content,C.next=18,formatMsg(ki({},v.qchatMsg),{deliveryStatus:Jf.success},this.core);case 18:if(!(b=C.sent).isAntispam){C.next=22;break}throw{code:10403,msg:b,message:(null===(a=null==b?void 0:b.antiSpamInfo)||void 0===a?void 0:a.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(o=null==b?void 0:b.antiSpamInfo)||void 0===o?void 0:o.yidunAntiSpamRes)||""};case 22:return C.abrupt("return",b);case 23:case"end":return C.stop()}}),_callee4,this,[[2,8]])})))},t.doUpdateMessage=function doUpdateMessage(t){var a,o;return __awaiter(this,void 0,void 0,Mi.mark((function _callee5(){var c,h,m,v,b;return Mi.wrap((function _callee5$(C){for(;;)switch(C.prev=C.next){case 0:return c=t.message,h=__rest(t,["message"]),(m=generatorMsgForCmd(c)).msgIdClient=void 0,m.time=c.time,C.next=6,this.core.sendCmd("qchatUpdateMessage",{qchatMsg:m,qchatMsgUpdateTag:ki(ki({},h),{operatorAccount:this.core.account,operatorClientType:Fm.Web,pushPayload:us(t.pushPayload),routeEnable:ff.boolean(t,"routeEnable")})});case 6:return v=C.sent,C.next=9,formatMsg(v.content.qchatMsg,{},this.core);case 9:if(b=C.sent,this.core.eventBus.emit("qchatChannel/changeUnread",b,!0),!v.content.qchatMsg.isAntispam){C.next=14;break}throw{code:10403,msg:m,message:(null===(a=v.content.qchatMsg)||void 0===a?void 0:a.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(o=v.content.qchatMsg)||void 0===o?void 0:o.yidunAntiSpamRes)||""};case 14:return C.abrupt("return",b);case 15:case"end":return C.stop()}}),_callee5,this)})))},t.getHistoryMessage=function getHistoryMessage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee6(){var a,o,c,h=this;return Mi.wrap((function _callee6$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.core.sendCmd("qchatGetHistoryMsg",{getHistoryMsgTag:ki(ki({},t),{reverse:reverse(t)?1:0})});case 2:return o=m.sent,c=o.content,m.next=6,li.all(map(a=c.qchatMsgs).call(a,(function(t){return formatMsg(t,{},h.core)})));case 6:return m.abrupt("return",m.sent);case 7:case"end":return m.stop()}}),_callee6,this)})))},t.getMentionedMeMessages=function getMentionedMeMessages(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee7(){var a,o,c,h,m,v=this;return Mi.wrap((function _callee7$(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this.core.sendCmd("qchatGetMentionedMeMessages",{tag:t});case 2:return o=b.sent,c=o.content,C=c.page,h=format(ev,C),b.next=7,li.all(map(a=c.datas).call(a,(function(t){return formatMsg(t,{},v.core)})));case 7:return m=b.sent,b.abrupt("return",{pageInfo:h,messages:m});case 9:case"end":return b.stop()}var C}),_callee7,this)})))},t.areMentionedMeMessages=function areMentionedMeMessages(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee8(){var a,o,c;return Mi.wrap((function _callee8$(h){for(;;)switch(h.prev=h.next){case 0:a={},o=0;case 2:if(!(o<t.length)){h.next=13;break}if((c=t[o]).fromAccount!==this.core.account){h.next=7;break}return a[c.msgIdClient]=!1,h.abrupt("continue",10);case 7:return h.next=9,this.core.qchatChannel.subscribeModuleService.getMentionedFlag(c,!0);case 9:a[c.msgIdClient]=h.sent;case 10:o++,h.next=2;break;case 13:return h.abrupt("return",a);case 14:case"end":return h.stop()}}),_callee8,this)})))},t.getLastMessageOfChannels=function getLastMessageOfChannels(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee9(){var a,o,c;return Mi.wrap((function _callee9$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("qchatGetLastMessageOfChannels",{tag:t});case 2:return a=h.sent,o=a.content.msgs,h.next=6,formatMsgs(o,{},this.core);case 6:return c=h.sent,h.abrupt("return",reduce(c).call(c,(function(t,a){return t[a.channelId]=a,t}),{}));case 8:case"end":return h.stop()}}),_callee9,this)})))},t.messageSearchByPage=function messageSearchByPage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee10(){var a,o,c,h,m;return Mi.wrap((function _callee10$(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.core.sendCmd("qchatMessageSearchByPage",{qchatMessageSearchByPageTag:ki(ki({},(b=t,formatReverse(Zm,b))),{includeSelf:t.includeSelf?1:""})});case 2:return a=v.sent,o=a.content,c=o.datas,h=o.listQueryTag,v.next=6,formatMsgs(c,{},this.core);case 6:return m=v.sent,v.abrupt("return",{listQueryTag:{hasMore:1==+h.hasMore,nextTimetag:h.nextTimetag?$u(h.nextTimetag):0,cursor:h.cursor},datas:m});case 8:case"end":return v.stop()}var b}),_callee10,this)})))},t.onMsg=function onMsg(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee11(){var a,o;return Mi.wrap((function _callee11$(c){for(;;)switch(c.prev=c.next){case 0:if(a=t.content.qchatMsg){c.next=4;break}return this.logger.warn("No qchatMsg in qchatMsg packet"),c.abrupt("return");case 4:return c.next=6,formatMsg(a,{},this.core);case 6:o=c.sent,this.core.eventBus.emit("qchatChannel/changeUnread",o,!1),this.core.emit("message",o);case 9:case"end":return c.stop()}}),_callee11,this)})))},t.onRecvUnreadInfo=function onRecvUnreadInfo(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee12(){var a,o;return Mi.wrap((function _callee12$(c){for(;;)switch(c.prev=c.next){case 0:if(a=t.content.qchatMsg){c.next=3;break}return c.abrupt("return");case 3:return c.next=5,formatMsg(a);case 5:o=c.sent,this.core.eventBus.emit("qchatChannel/changeUnread",o,!1);case 7:case"end":return c.stop()}}),_callee12,this)})))},t.onMultiSyncRead=function onMultiSyncRead(t){var a=t.content.unreadInfo;if(a){var o=formatUnreadInfo(a);this.core.eventBus.emit("qchatChannel/updateUnread",o)}},t.onMultiSyncServersRead=function onMultiSyncServersRead(t){var a=t.content.qchatMultiSyncServersMessageReadTag;if(a){var o=formatClearServersUnread(a),c=o.successServerIds,h=o.ackTimestamp;this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",c,h)}},t.onRecvMsgUpdate=function onRecvMsgUpdate(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee13(){var a,o,c,h;return Mi.wrap((function _callee13$(m){for(;;)switch(m.prev=m.next){case 0:if(a=t.content.qchatMsg,o=t.content.qchatMsgUpdateInfo,a){m.next=4;break}return m.abrupt("return");case 4:return m.next=6,formatMsg(a,{},this.core);case 6:c=m.sent,h=formatMsgOperatorInfo(o),this.core.eventBus.emit("qchatChannel/changeUnread",c,!0),this.core.emit("messageUpdate",c,h);case 10:case"end":return m.stop()}}),_callee13,this)})))},MessageModuleService}(),ov=function(){function ExtendModuleService(t){var a=this;this._sendTypingEvent=fm((function(t){return __awaiter(a,void 0,void 0,Mi.mark((function _callee(){return Mi.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:generatorSysMsgForCmd(ki(ki({},t),{resendFlag:!1,persistEnable:!1,routeEnable:!1,pushEnable:!1,needBadge:!1,needPushNick:!1}),Zf.msgTyping)});case 2:case"end":return a.stop()}}),_callee,this)})))}),3e3),this.core=t,this.logger=t.logger,this.lastChannelIdInTyping=""}var t=ExtendModuleService.prototype;return t.getMessageHistoryByIds=function getMessageHistoryByIds(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee2(){var a,o;return Mi.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("qchatGetMessageHistoryByIds",{channelInfo:{serverId:t.serverId,channelId:t.channelId},messageReferList:t.messageReferList});case 2:return o=c.sent,c.abrupt("return",li.all(map(a=o.content.qchatMsgs).call(a,(function(t){return formatMsg(t)}))));case 4:case"end":return c.stop()}}),_callee2,this)})))},t.getReferMessages=function getReferMessages(t){var a,o;return __awaiter(this,void 0,void 0,Mi.mark((function _callee3(){var c;return Mi.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:if((null===(a=t.message.replyRefer)||void 0===a?void 0:a.msgIdServer)&&(null===(o=t.message.threadRefer)||void 0===o?void 0:o.msgIdServer)){h.next=2;break}throw new Error("Message has no reply");case 2:return h.next=4,this.getMessageHistoryByIds({serverId:t.message.serverId,channelId:t.message.channelId,messageReferList:[t.message.replyRefer,t.message.threadRefer]});case 4:if(c=h.sent,t.referType!==em[em.all]){h.next=9;break}return h.abrupt("return",{replyMessage:c[0],threadMessage:c[1]});case 9:if(t.referType!==em[em.reply]){h.next=13;break}return h.abrupt("return",{replyMessage:c[0]});case 13:if(t.referType!==em[em.thread]){h.next=15;break}return h.abrupt("return",{threadMessage:c[1]});case 15:return h.abrupt("return",{replyMessage:c[0],threadMessage:c[1]});case 16:case"end":return h.stop()}}),_callee3,this)})))},t.getThreadMessages=function getThreadMessages(t){var a;return __awaiter(this,void 0,void 0,Mi.mark((function _callee4(){var o,c,h,m,v;return Mi.wrap((function _callee4$(b){for(;;)switch(b.prev=b.next){case 0:return c=(null===(a=t.message.threadRefer)||void 0===a?void 0:a.msgIdServer)?ki({serverId:t.message.serverId,channelId:t.message.channelId},t.message.threadRefer):t.message,b.next=3,this.core.sendCmd("qchatGetThreadMessages",{qchatMsg:c,getThreadHistoryMsgTag:ki(ki({},t.messageQueryOption),{reverse:ff.boolean(t.messageQueryOption,"reverse")})});case 3:return h=b.sent,b.next=6,formatMsg(h.content.thread);case 6:return m=b.sent,b.next=9,li.all(map(o=h.content.qchatMsgs).call(o,(function(t){return formatMsg(t)})));case 9:return v=b.sent,b.abrupt("return",{thread:m,threadInfo:{messageCount:+h.content.threadInfo.messageCount,lastMessageTimestamp:+h.content.threadInfo.lastMessageTimestamp},messages:v});case 11:case"end":return b.stop()}}),_callee4,this)})))},t.getThreadRootMessagesMeta=function getThreadRootMessagesMeta(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee5(){var a,o,c,h;return Mi.wrap((function _callee5$(m){for(;;)switch(m.prev=m.next){case 0:return a=t.threadRootMessages,o=__rest(t,["threadRootMessages"]),m.next=3,this.core.sendCmd("qchatGetThreadRootMessagesMeta",{qchatMsgs:a,tag:o});case 3:if(c=m.sent,!((h=c.content.metas)&&h.length>0)){m.next=7;break}return m.abrupt("return",map(h).call(h,(function(t){return ki(ki({},t),{total:$u(t.total),timestamp:$u(t.timestamp),msgTime:$u(t.msgTime)})})));case 7:return m.abrupt("return",[]);case 8:case"end":return m.stop()}}),_callee5,this)})))},t.getQuickComments=function getQuickComments(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee6(){var a,o,c;return Mi.wrap((function _callee6$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.core.sendCmd("qchatGetQuickComments",{tag:{serverId:t.serverId,channelId:t.channelId,msgIdServerList:us(map(a=t.msgList).call(a,(function(t){return t.msgIdServer})))}});case 2:return o=h.sent,c=o.content.quickCommentResponse,h.abrupt("return",formatQuickComments(c));case 5:case"end":return h.stop()}}),_callee6,this)})))},t.updateQuickComment=function updateQuickComment(t,a){return __awaiter(this,void 0,void 0,Mi.mark((function _callee7(){var o,c,h,m,v,b;return Mi.wrap((function _callee7$(C){for(;;)switch(C.prev=C.next){case 0:return validate({type:{type:"number"},commentMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},t),o=t.commentMessage,c=o.serverId,h=o.channelId,m=o.fromAccount,v=o.msgIdServer,b=o.time,C.next=4,this.core.sendCmd("qchatUpdateQuickComment",{tag:{serverId:c,channelId:h,fromAccount:m,msgIdServer:v,time:b,type:t.type,opeType:a,opeAccid:this.core.account}});case 4:case"end":return C.stop()}}),_callee7,this)})))},t.sendTypingEvent=function sendTypingEvent(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee8(){return Mi.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:if(t.channelId!==this.lastChannelIdInTyping){a.next=4;break}return this.logger.log("qchatMsg sendTypingEvent throttle"),this._sendTypingEvent(t),a.abrupt("return");case 4:this.lastChannelIdInTyping=t.channelId,this._sendTypingEvent.flush(),this._sendTypingEvent(t);case 7:case"end":return a.stop()}}),_callee8,this)})))},ExtendModuleService}(),iv=function(t){function QChatMsgService(a){var o;return(o=t.call(this,"qchatMsg",a)||this).core=a,o.lastChannelIdInMark="",registerParser({cmdMap:Dm,cmdConfig:Vm}),o.notificationModuleService=new rv(a),o.messageModuleService=new av(a),o.extendModuleService=new ov(a),o}wt(QChatMsgService,t);var a=QChatMsgService.prototype;return a.sendMessage=function sendMessage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee(){return Mi.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Hf)},ext:{type:"string",required:!1},mentionAll:{type:"boolean",required:!1},mentionAccids:{type:"array",itemType:"string",required:!1},mentionRoleIds:{type:"array",itemType:"string",required:!1,min:1},historyEnable:{type:"boolean",required:!1},pushEnable:{type:"boolean",required:!1}},t),a.next=3,this.messageModuleService.sendMessage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee,this)})))},a.updateMessage=function updateMessage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee2(){return Mi.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(validate({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0},body:{type:"string",required:!1},ext:{type:"string",required:!1}}}},t),!("number"==typeof t.message.status&&t.message.status<1e4)){a.next=3;break}throw new vc("Status should be greater than or equal to 10000");case 3:return a.next=5,this.messageModuleService.doUpdateMessage(t);case 5:return a.abrupt("return",a.sent);case 6:case"end":return a.stop()}}),_callee2,this)})))},a.resendMessage=function resendMessage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee3(){return Mi.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdClient:{type:"string",allowEmpty:!1}},t),a.next=3,this.messageModuleService.resendMessage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee3,this)})))},a.deleteMessage=function deleteMessage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee4(){var a;return Mi.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return validate({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},t),(a=JSON.parse(us(t))).message.status=2,o.next=5,this.messageModuleService.doUpdateMessage(a);case 5:return o.abrupt("return",o.sent);case 6:case"end":return o.stop()}}),_callee4,this)})))},a.revokeMessage=function revokeMessage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee5(){var a;return Mi.wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return validate({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},t),(a=JSON.parse(us(t))).message=$m(a.message,["serverId","channelId","msgIdServer","time"]),a.message.status=1,o.next=6,this.messageModuleService.doUpdateMessage(a);case 6:return o.abrupt("return",o.sent);case 7:case"end":return o.stop()}}),_callee5,this)})))},a.markMessageRead=function markMessageRead(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee6(){return Mi.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:validate({serverId:{type:"string"},channelId:{type:"string"},time:{type:"number",min:0}},t),t.channelId!==this.lastChannelIdInMark&&this.messageModuleService.markMessageRead.flush(),this.lastChannelIdInMark=t.channelId,this.messageModuleService.markMessageRead(t);case 4:case"end":return a.stop()}}),_callee6,this)})))},a.replyMessage=function replyMessage(t){validate({replyMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},t);var replyMessage=t.replyMessage;if(t.serverId!==replyMessage.serverId||t.channelId!==replyMessage.channelId)throw new vc("Forbid replying to message from other server, channel");return this.sendMessage(t)},a.getMessageHistoryByIds=function getMessageHistoryByIds(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee7(){return Mi.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},messageReferList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},t),a.next=3,this.extendModuleService.getMessageHistoryByIds(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee7,this)})))},a.getReferMessages=function getReferMessages(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee8(){return Mi.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return validate({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},referType:{type:"enum",values:getEnumKeys(em),required:!1}},t),a.next=3,this.extendModuleService.getReferMessages(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee8,this)})))},a.getThreadMessages=function getThreadMessages(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee9(){return Mi.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},messageQueryOption:{type:"object",rules:{beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},excludeMsgId:{type:"string",required:!1},limit:{type:"number",required:!1},reverse:{type:"boolean",required:!1}}}},t),a.next=3,this.extendModuleService.getThreadMessages(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee9,this)})))},a.getThreadRootMessagesMeta=function getThreadRootMessagesMeta(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee10(){return Mi.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},threadRootMessages:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},t),a.next=3,this.extendModuleService.getThreadRootMessagesMeta(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee10,this)})))},a.sendSystemNotification=function sendSystemNotification(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee11(){return Mi.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},attach:{type:"object",required:!1}},t),a.next=3,this.notificationModuleService.sendSystemNotification(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee11,this)})))},a.updateSystemNotification=function updateSystemNotification(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee12(){return Mi.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return validate({systemNotification:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Zf)},body:{type:"string",required:!1},ext:{type:"string",required:!1},status:{type:"number",required:!1}}}},t),a.next=3,this.notificationModuleService.updateSystemNotification(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee12,this)})))},a.markSystemNotificationsRead=function markSystemNotificationsRead(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee13(){return Mi.wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:return validate({systemNotifications:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1}},min:1}},t),a.next=3,this.notificationModuleService.markSystemNotificationsRead(t);case 3:case"end":return a.stop()}}),_callee13,this)})))},a.getHistoryMessage=function getHistoryMessage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee14(){return Mi.wrap((function _callee14$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},beginTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},excludeMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},t),a.next=3,this.messageModuleService.getHistoryMessage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee14,this)})))},a.getMentionedMeMessages=function getMentionedMeMessages(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee15(){return Mi.wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timestamp:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),a.next=3,this.messageModuleService.getMentionedMeMessages(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee15,this)})))},a.areMentionedMeMessages=function areMentionedMeMessages(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee16(){var a;return Mi.wrap((function _callee16$(o){for(;;)switch(o.prev=o.next){case 0:if(validate({messages:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1}},min:1}},t),every(a=t.messages).call(a,(function(a){return t.messages[0].serverId===a.serverId}))){o.next=4;break}throw new vc("Different serverId",t,10414);case 4:if(!this.core.qchatChannel.subscribeForVisitorService.isInAutoServers(t.messages[0].serverId)){o.next=7;break}throw new vc("Not allowed for visitor",t,10403);case 7:return o.next=9,this.messageModuleService.areMentionedMeMessages(t.messages);case 9:return o.abrupt("return",o.sent);case 10:case"end":return o.stop()}}),_callee16,this)})))},a.addQuickComment=function addQuickComment(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee17(){return Mi.wrap((function _callee17$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.extendModuleService.updateQuickComment(t,1);case 2:case"end":return a.stop()}}),_callee17,this)})))},a.removeQuickComment=function removeQuickComment(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee18(){return Mi.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.extendModuleService.updateQuickComment(t,2);case 2:case"end":return a.stop()}}),_callee18,this)})))},a.getQuickComments=function getQuickComments(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee19(){return Mi.wrap((function _callee19$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1}},min:1}},t),a.next=3,this.extendModuleService.getQuickComments(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee19,this)})))},a.sendTypingEvent=function sendTypingEvent(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee20(){return Mi.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.extendModuleService.sendTypingEvent(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee20,this)})))},a.getLastMessageOfChannels=function getLastMessageOfChannels(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee21(){return Mi.wrap((function _callee21$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelIdList:{type:"array",itemType:"string"}},t),a.next=3,this.messageModuleService.getLastMessageOfChannels(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee21,this)})))},a.qchatOnMsgHandler=function qchatOnMsgHandler(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee22(){return Mi.wrap((function _callee22$(a){for(;;)switch(a.prev=a.next){case 0:this.messageModuleService.onMsg(t);case 1:case"end":return a.stop()}}),_callee22,this)})))},a.qchatOnRecvUnreadInfoHandler=function qchatOnRecvUnreadInfoHandler(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee23(){return Mi.wrap((function _callee23$(a){for(;;)switch(a.prev=a.next){case 0:this.messageModuleService.onRecvUnreadInfo(t);case 1:case"end":return a.stop()}}),_callee23,this)})))},a.qchatOnSysMsgHandler=function qchatOnSysMsgHandler(t){this.notificationModuleService.onSysMsg(t)},a.qchatMultiSyncMessageReadHandler=function qchatMultiSyncMessageReadHandler(t){this.messageModuleService.onMultiSyncRead(t)},a.qchatMultiSyncSystemNotificationUpdateHandler=function qchatMultiSyncSystemNotificationUpdateHandler(t){this.notificationModuleService.onMultiSysMsg(t)},a.qchatSyncSystemNotificationHandler=function qchatSyncSystemNotificationHandler(t){this.notificationModuleService.onSyncSysMsg(t)},a.qchatRecvMessageUpdateHandler=function qchatRecvMessageUpdateHandler(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee24(){return Mi.wrap((function _callee24$(a){for(;;)switch(a.prev=a.next){case 0:this.messageModuleService.onRecvMsgUpdate(t);case 1:case"end":return a.stop()}}),_callee24,this)})))},a.searchMsgByPage=function searchMsgByPage(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee25(){return Mi.wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:return validate({keyword:{type:"string",allowEmpty:!1,required:!1},serverId:{type:"string",allowEmpty:!1,required:!0},channelId:{type:"string",allowEmpty:!1,required:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},fromTime:{type:"number",allowEmpty:!1,required:!1},toTime:{type:"number",allowEmpty:!1,required:!1},msgTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!0},subTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!1},includeSelf:{type:"boolean",allowEmpty:!1,required:!1},order:{type:"enum",values:getEnumKeys(Dh),required:!1},limit:{type:"number",min:0,required:!1},sort:{type:"enum",values:getEnumKeys(zf),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),a.next=3,this.messageModuleService.messageSearchByPage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee25,this)})))},a.qchatMultiSyncServersMessageReadHandler=function qchatMultiSyncServersMessageReadHandler(t){this.messageModuleService.onMultiSyncServersRead(t)},QChatMsgService}(zh);function formatLoginInfo(t,a){void 0===a&&(a=1);var o=format({clientPort:{type:"number"},clientType:{type:"enum",values:Fm},customClientType:{type:"number"},loginTime:{type:"number"},hasTokenPreviously:{type:"boolean"},pushType:{type:"number"}},t);return ki(ki({},o),{account:o.account,connectionId:o.connectionId,deviceId:o.deviceId,ip:o.ip,mac:o.ip,os:o.os,clientType:o.clientType,time:o.time,online:2!==a})}var sv={1:{reason:"samePlatformKick",message:"The same account is not allowed to multiple login at the same time"},2:{reason:"serverKick",message:"Kicked out by IM server"},3:{reason:"otherPlatformKick",message:"Kicked out by other client of your account"},4:{reason:"silentlyKick",message:"Quietly kicked"}};var cv,lv,uv={BROWSER:0,RN:2,UNIAPP:3,WECHAT:6},dv=function(t){function QChatAuthService(a){var o;return(o=t.call(this,"qchatAuth",a)||this).syncTimeTag=0,o}wt(QChatAuthService,t);var a=QChatAuthService.prototype;return a.doLogin=function doLogin(t){var a;return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,Mi.mark((function _callee(){var o,c,h,m,v,b,C;return Mi.wrap((function _callee$(S){for(;;)switch(S.prev=S.next){case 0:return o=this.core.options,c=Tc.getSystemInfo(),h=ki(ki({},o),{appLogin:t?0:1,clientType:16,clientSession:null===(a=this.core.socket)||void 0===a?void 0:a.sessionId,deviceId:this.core.config.deviceId,sdkVersion:90903,sdkType:uv[Tc.platform]||0,userAgent:"Native/0.12.3",sdkHumanVersion:"0.12.3",os:c.os,browser:c.browser}),S.next=5,this.core.sendCmd("qchatLogin",{qchatLoginReqTag:h});case 5:if(!(m=S.sent).error){S.next=8;break}throw m.error;case 8:return v=m.content,b=v.qchatLoginResTag,C=v.qchatMultiLoginResult,b.isAutoReconnect=t,S.abrupt("return",{loginResult:formatLoginInfo(b),multiLoginResults:map(C).call(C,(function(t){return formatLoginInfo(t)}))});case 11:case"end":return S.stop()}}),_callee,this)})))},a.kick=function kick(t){var a;return __awaiter(this,void 0,void 0,Mi.mark((function _callee2(){var o;return Mi.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("qchatKick",t);case 2:return o=c.sent,c.abrupt("return",null===(a=o.content)||void 0===a?void 0:a.deviceIds);case 4:case"end":return c.stop()}}),_callee2,this)})))},a.sync=function sync(){return __awaiter(this,void 0,void 0,Mi.mark((function _callee3(){return Mi.wrap((function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatSync",{qchatSyncTag:{systemNotification:this.syncTimeTag||0}});case 2:case"end":return t.stop()}}),_callee3,this)})))},a.qchatSyncHandler=function qchatSyncHandler(t){var a,o;this.logger.log("sync: emit syncdone",null===(a=t.content)||void 0===a?void 0:a.timetag),this.core.emit("syncdone"),this.syncTimeTag=(null===(o=t.content)||void 0===o?void 0:o.timetag)||0},a.qchatMultiSpotLoginHandler=function qchatMultiSpotLoginHandler(t){if(t.error)this.logger.error("qchatMultiPortLoginHandler:: error, ",t.error);else{var a=t.content,o=formatLoginInfo(a.qchatLoginResTag,a.state);this.core.emit("multiSpotLogin",[o])}},a.qchatBeKickedHandler=function qchatBeKickedHandler(t){if(t.error)this.logger.error("qchatBeKickedHandler error, ",t.error);else{var a=function formatBeKickedTag(t){var a=format({clientType:{type:"enum",values:Fm},customClientType:{type:"number"}},t),o=sv[a.reason];return ki(a,o=o||{reason:"unknow",message:"Unknown reason"})}(t.content.beKickedTag);this.logger.warn("bekicked::",a),this.core.doDisconnect(nd.KICKED,a)}},QChatAuthService}(zh);!function(t){t.UNKNOWN="UNKNOWN",t.LOGIN_STATE_ERROR="LOGIN_STATE_ERROR",t.CLOSE_BY_BACKEND="CLOSE_BY_BACKEND",t.ALL_MEMBERS_OUT="ALL_MEMBERS_OUT",t.END_OF_LIFE="END_OF_LIFE",t.CLOSE_BY_MEMBER="CLOSE_BY_MEMBER",t.KICK_OUT="KICK_OUT",t.SYNC_DATA_ERROR="SYNC_DATA_ERROR",t.LEAVE_BY_SELF="LEAVE_BY_SELF",t.kICK_BY_SELF="kICK_BY_SELF"}(cv||(cv={})),function(t){t.offNotAllowSelfOn="offNotAllowSelfOn",t.offAllowSelfOn="offAllowSelfOn",t.disable="disable"}(lv||(lv={}));var pv={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},hv={limit:{type:"number"}};function formatMembers(t){return Wc(t)&&t.length>0?map(t).call(t,(function(t){return function formatMember(t){return format(pv,t)}(t)})):[]}function formatRTCChannelConfig(t){try{t.audio&&(t.audio=JSON.parse(t.audio))}catch(t){throw new gc('result "audio" JSON parse error',{key:"audio"},"JSON parse error")}try{t.video&&(t.video=JSON.parse(t.video))}catch(t){throw new gc('result "video" JSON parse error',{key:"video"},"JSON parse error")}return format(hv,t)}var fv={"25_1":"qchatGetNeroomToken","25_2":"qchatUpdateRTCChannelConfig","25_3":"qchatGetRTCChannelConfig","25_4":"qchatGetRTCChannelMembers"},mv={QChatRTCChannelConfigTag:{serverId:1,channelId:2,limit:3,audio:4,video:5},QChatRTCChannelConfigResultTag:{limit:1,audio:2,video:3},QChatGetRTCParams:{serverId:1,channelId:2},qchatGetRTCChannelMembersTag:{serverId:1,channelId:2},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},QChatGetNeroomTokenResultTag:{token:1,expire:2},QChatGetNeroomTokenParams:{neroomDeviceId:1}},vv=invertSerializeMap(mv),gv={qchatGetNeroomToken:{sid:25,cid:1,service:"qchatMedia",params:[{type:"Property",name:"qchatGetNeroomTokenTag",reflectMapper:mv.QChatGetNeroomTokenParams}],response:[{type:"Property",name:"neroomToken",reflectMapper:vv.QChatGetNeroomTokenResultTag}]},qchatUpdateRTCChannelConfig:{sid:25,cid:2,service:"qchatMedia",params:[{type:"Property",name:"RTCChannelConfig",reflectMapper:mv.QChatRTCChannelConfigTag}]},qchatGetRTCChannelConfig:{sid:25,cid:3,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelConfigTag",reflectMapper:mv.QChatGetRTCParams}],response:[{type:"Property",name:"RTCChannelConfig",reflectMapper:vv.QChatRTCChannelConfigResultTag}]},qchatGetRTCChannelMembers:{sid:25,cid:4,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelMembersTag",reflectMapper:mv.QChatGetRTCParams}],response:[{type:"PropertyArray",name:"memberList",reflectMapper:vv.memberInfo}]}},yv=function(t){function QChatMediaService(a){var o;return(o=t.call(this,"qchatMedia",a)||this).tokenExpireTime=24e4,o.getTokenState=!1,o.core=a,registerParser({cmdMap:fv,cmdConfig:gv}),o.core.on("disconnect",(function(){return __awaiter(c(o),void 0,void 0,Mi.mark((function _callee(){return Mi.wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:if(!this.roomContext){t.next=3;break}return t.next=3,this.disconnectChannel();case 3:this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0);case 4:case"end":return t.stop()}}),_callee,this)})))})),o.core.on("kicked",(function(){return __awaiter(c(o),void 0,void 0,Mi.mark((function _callee2(){return Mi.wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(!this.roomContext){t.next=3;break}return t.next=3,this.disconnectChannel();case 3:this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0);case 4:case"end":return t.stop()}}),_callee2,this)})))})),o.core.eventBus.on("qchatMedia/serverOrChannelLeave",(function(t){return __awaiter(c(o),void 0,void 0,Mi.mark((function _callee3(){return Mi.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:if(!(t.type===Zf[Zf.channelVisibilityUpdate]&&t.channelId===this.channelId||t.type===Zf[Zf.serverEnterLeave]&&t.serverId===this.serverId)){a.next=4;break}if(!this.roomContext||!this.roomContext.roomUuid){a.next=4;break}return a.next=4,this.disconnectChannel();case 4:case"end":return a.stop()}}),_callee3,this)})))})),o.tokenExpireTime=24e4,o.channelId="",o.serverId="",o}wt(QChatMediaService,t);var a=QChatMediaService.prototype;return a.setNeroom=function setNeroom(t){this.neroom=new t},a._checkPermission=function _checkPermission(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee4(){var a;return Mi.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.qchatRole.checkPermission(t);case 2:return a=o.sent,o.abrupt("return",a);case 4:case"end":return o.stop()}}),_callee4,this)})))},a._checkConnectState=function _checkConnectState(){if("connect"!==this.state)throw new vc("QChatMedia::you should connect first")},a.kickMemberOut=function kickMemberOut(t){var a;return __awaiter(this,void 0,void 0,Mi.mark((function _callee5(){return Mi.wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),o.prev=2,o.next=5,null===(a=this.roomContext)||void 0===a?void 0:a.kickMemberOut(t.accid);case 5:o.next=11;break;case 7:throw o.prev=7,o.t0=o.catch(2),this.logger.error("QChatMedia::kickMemberOut error params is "+us(t),o.t0),new vc("QChatMedia::kickMemberOut error",o.t0);case 11:case"end":return o.stop()}}),_callee5,this,[[2,7]])})))},a.disconnectChannel=function disconnectChannel(){var t;return __awaiter(this,void 0,void 0,Mi.mark((function _callee6(){return Mi.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),this.logger.debug("QChatMedia::disconnect begin disconnect"),a.prev=2,a.next=5,null===(t=this.roomContext)||void 0===t?void 0:t.leaveRoom();case 5:a.next=10;break;case 7:a.prev=7,a.t0=a.catch(2),this.logger.error("QChatMedia::disconnect error",a.t0);case 10:if(!this.authService){a.next=13;break}return a.next=13,this.authService.logout();case 13:this._setStateInit(),this.core.emit("qchatMediaDisconnect");case 15:case"end":return a.stop()}}),_callee6,this,[[2,7]])})))},a._setStateInit=function _setStateInit(){this.logger.debug("QChatMedia::disconnect end"),this.roomContext=void 0,this.rtcController=void 0,this.state="init",this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0),this.channelId="",this.serverId=""},a.muteAudio=function muteAudio(t){var a,o,c,h,m;return __awaiter(this,void 0,void 0,Mi.mark((function _callee7(){var v;return Mi.wrap((function _callee7$(b){for(;;)switch(b.prev=b.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),(null===(a=this.roomContext)||void 0===a?void 0:a.localMember.uuid)!==t.accid){b.next=14;break}return b.prev=3,b.next=6,null===(o=this.rtcController)||void 0===o?void 0:o.muteMyAudio();case 6:b.next=12;break;case 8:throw b.prev=8,b.t0=b.catch(3),this.logger.error("QChatMedia::muteAudio error",b.t0),new vc("QChatMedia::muteAudio error",b.t0);case 12:case 25:b.next=31;break;case 14:if(b.prev=14,!(v=null===(c=this.roomContext)||void 0===c?void 0:c.roomProperties.audioOff)||(null===(h=v.value)||void 0===h?void 0:h.split("_")[0])!==lv.offNotAllowSelfOn){b.next=23;break}return b.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 19:if(b.sent){b.next=23;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),b.abrupt("return");case 23:return b.next=25,null===(m=this.rtcController)||void 0===m?void 0:m.muteMemberAudio(t.accid);case 27:throw b.prev=27,b.t1=b.catch(14),this.logger.error("QChatMedia::muteAudio error params is "+us(t),b.t1),new vc("QChatMedia::muteAudio error",b.t1);case 31:case"end":return b.stop()}}),_callee7,this,[[3,8],[14,27]])})))},a.unMuteAudio=function unMuteAudio(t){var a,o,c,h,m;return __awaiter(this,void 0,void 0,Mi.mark((function _callee8(){var v;return Mi.wrap((function _callee8$(b){for(;;)switch(b.prev=b.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),!(v=null===(a=this.roomContext)||void 0===a?void 0:a.roomProperties.audioOff)||(null===(o=v.value)||void 0===o?void 0:o.split("_")[0])!==lv.offNotAllowSelfOn){b.next=10;break}return b.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 6:if(b.sent){b.next=10;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),b.abrupt("return");case 10:if((null===(c=this.roomContext)||void 0===c?void 0:c.localMember.uuid)!==t.accid){b.next=22;break}return b.prev=11,b.next=14,null===(h=this.rtcController)||void 0===h?void 0:h.unmuteMyAudio();case 14:b.next=20;break;case 16:throw b.prev=16,b.t0=b.catch(11),this.logger.error("QChatMedia::unMuteAudio error",b.t0),new vc("QChatMedia::unMuteAudio error",b.t0);case 20:case 25:b.next=31;break;case 22:return b.prev=22,b.next=25,null===(m=this.rtcController)||void 0===m?void 0:m.unmuteMemberAudio(t.accid);case 27:throw b.prev=27,b.t1=b.catch(22),this.logger.error("QChatMedia::unMuteAudio error params is "+us(t),b.t1),new vc("QChatMedia::unMuteAudio error",b.t1);case 31:case"end":return b.stop()}}),_callee8,this,[[11,16],[22,27]])})))},a.muteVideo=function muteVideo(t){var a,o,c,h,m;return __awaiter(this,void 0,void 0,Mi.mark((function _callee9(){var v;return Mi.wrap((function _callee9$(b){for(;;)switch(b.prev=b.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),(null===(a=this.roomContext)||void 0===a?void 0:a.localMember.uuid)!==t.accid){b.next=14;break}return b.prev=3,b.next=6,null===(o=this.rtcController)||void 0===o?void 0:o.muteMyVideo();case 6:b.next=12;break;case 8:throw b.prev=8,b.t0=b.catch(3),this.logger.error("QChatMedia::muteVideo error",b.t0),new vc("QChatMedia::muteVideo error",b.t0);case 12:case 25:b.next=31;break;case 14:if(b.prev=14,!(v=null===(c=this.roomContext)||void 0===c?void 0:c.roomProperties.videoOff)||(null===(h=v.value)||void 0===h?void 0:h.split("_")[0])!==lv.offNotAllowSelfOn){b.next=23;break}return b.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 19:if(b.sent){b.next=23;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),b.abrupt("return");case 23:return b.next=25,null===(m=this.rtcController)||void 0===m?void 0:m.muteMemberVideo(t.accid);case 27:throw b.prev=27,b.t1=b.catch(14),this.logger.error("QChatMedia::muteVideo error params is "+us(t),b.t1),new vc("QChatMedia::muteVideo error",b.t1);case 31:case"end":return b.stop()}}),_callee9,this,[[3,8],[14,27]])})))},a.unMuteVideo=function unMuteVideo(t){var a,o,c,h,m;return __awaiter(this,void 0,void 0,Mi.mark((function _callee10(){var v;return Mi.wrap((function _callee10$(b){for(;;)switch(b.prev=b.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),!(v=null===(a=this.roomContext)||void 0===a?void 0:a.roomProperties.videoOff)||(null===(o=v.value)||void 0===o?void 0:o.split("_")[0])!==lv.offNotAllowSelfOn){b.next=10;break}return b.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 6:if(b.sent){b.next=10;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),b.abrupt("return");case 10:if((null===(c=this.roomContext)||void 0===c?void 0:c.localMember.uuid)!==t.accid){b.next=22;break}return b.prev=11,b.next=14,null===(h=this.rtcController)||void 0===h?void 0:h.unmuteMyVideo();case 14:b.next=20;break;case 16:throw b.prev=16,b.t0=b.catch(11),this.logger.error("QChatMedia::unMuteVideo error",b.t0),new vc("QChatMedia::unMuteVideo error",b.t0);case 20:b.next=30;break;case 22:b.prev=22,null===(m=this.rtcController)||void 0===m||m.unmuteMemberVideo(t.accid),b.next=30;break;case 26:throw b.prev=26,b.t1=b.catch(22),this.logger.error("QChatMedia::unMuteVideo error",b.t1),new vc("QChatMedia::unMuteVideo error",b.t1);case 30:case"end":return b.stop()}}),_callee10,this,[[11,16],[22,26]])})))},a.startScreenShare=function startScreenShare(){var t;return __awaiter(this,void 0,void 0,Mi.mark((function _callee11(){return Mi.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:this._checkConnectState(),a.prev=1,null===(t=this.rtcController)||void 0===t||t.startScreenShare(),a.next=9;break;case 5:throw a.prev=5,a.t0=a.catch(1),this.logger.error("QChatMedia::startScreenShare error",a.t0),new vc("QChatMedia::startScreenShare error",a.t0);case 9:case"end":return a.stop()}}),_callee11,this,[[1,5]])})))},a.stopScreenShare=function stopScreenShare(){var t;return __awaiter(this,void 0,void 0,Mi.mark((function _callee12(){return Mi.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:this._checkConnectState(),a.prev=1,null===(t=this.rtcController)||void 0===t||t.stopScreenShare(),a.next=9;break;case 5:throw a.prev=5,a.t0=a.catch(1),this.logger.error("QChatMedia::stopScreenShare error",a.t0),new vc("QChatMedia::stopScreenShare error",a.t0);case 9:case"end":return a.stop()}}),_callee12,this,[[1,5]])})))},a.stopMemberScreenShare=function stopMemberScreenShare(t){var a;return __awaiter(this,void 0,void 0,Mi.mark((function _callee13(){return Mi.wrap((function _callee13$(o){for(;;)switch(o.prev=o.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),o.prev=2,null===(a=this.rtcController)||void 0===a||a.stopMemberScreenShare(t.accid),o.next=10;break;case 6:throw o.prev=6,o.t0=o.catch(2),this.logger.error("QChatMedia::stopMemberScreenShare error",o.t0),new vc("QChatMedia::stopMemberScreenShare error",o.t0);case 10:case"end":return o.stop()}}),_callee13,this,[[2,6]])})))},a.subscribeRemoteVideoStream=function subscribeRemoteVideoStream(t){var a;return __awaiter(this,void 0,void 0,Mi.mark((function _callee14(){return Mi.wrap((function _callee14$(o){for(;;)switch(o.prev=o.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},t),o.prev=2,null===(a=this.rtcController)||void 0===a||a.subscribeRemoteVideoStream(t.accid,t.streamType),o.next=10;break;case 6:throw o.prev=6,o.t0=o.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoStream error",o.t0),new vc("QChatMedia::subscribeRemoteVideoStream error",o.t0);case 10:case"end":return o.stop()}}),_callee14,this,[[2,6]])})))},a.unSubscribeRemoteVideoStream=function unSubscribeRemoteVideoStream(t){var a;return __awaiter(this,void 0,void 0,Mi.mark((function _callee15(){return Mi.wrap((function _callee15$(o){for(;;)switch(o.prev=o.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},t),o.prev=2,null===(a=this.rtcController)||void 0===a||a.unsubscribeRemoteVideoStream(t.accid,t.streamType),o.next=10;break;case 6:throw o.prev=6,o.t0=o.catch(2),this.logger.error("QChatMedia::unSubscribeRemoteVideoStream error",o.t0),new vc("QChatMedia::unSubscribeRemoteVideoStream error",o.t0);case 10:case"end":return o.stop()}}),_callee15,this,[[2,6]])})))},a.setupVideoCanvas=function setupVideoCanvas(t){var a;if(this._checkConnectState(),(null===(a=this.roomContext)||void 0===a?void 0:a.localMember.uuid)===t.accid)try{return this.rtcController.setupLocalVideoCanvas(t.videoView)}catch(t){throw this.logger.error("QChatMedia::setupVideoCanvas error",t),new vc("QChatMedia::setupVideoCanvas error",t)}else try{return this.rtcController.setupRemoteVideoCanvas(t.videoView,t.accid)}catch(t){throw this.logger.error("QChatMedia::setupVideoCanvas error",t),new vc("QChatMedia::setupVideoCanvas error",t)}},a.setupRemoteVideoSubStreamCanvas=function setupRemoteVideoSubStreamCanvas(t){this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t);try{return this.rtcController.setupRemoteVideoSubStreamCanvas(t.videoView,t.accid)}catch(t){throw this.logger.error("QChatMedia::setupRemoteVideoSubStreamCanvas error",t),new vc("QChatMedia::setupRemoteVideoSubStreamCanvas error",t)}},a.getScreenSharingUserUuid=function getScreenSharingUserUuid(){this._checkConnectState();try{return this.rtcController.getScreenSharingUserUuid()}catch(t){throw this.logger.error("QChatMedia::getScreenSharingUserUuid error",t),new vc("QChatMedia::getScreenSharingUserUuid error",t)}},a.initQChatMedia=function initQChatMedia(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee16(){return Mi.wrap((function _callee16$(a){for(;;)switch(a.prev=a.next){case 0:if(this.neroom){a.next=3;break}return this.logger.warn("QChatMedia::init::you should import neroom SDK"),a.abrupt("return");case 3:if(void 0===this.state){a.next=6;break}return this.logger.error("QChatMedia::init::you already init QChatMedia"),a.abrupt("return");case 6:a.prev=6,this.neroom.initialize({appKey:this.core.options.appkey,serverConfig:t.serverConfig}),a.next=14;break;case 10:throw a.prev=10,a.t0=a.catch(6),this.logger.error("QChatMedia::initQChatMedia error",a.t0),new vc("QChatMedia::initQChatMedia error",a.t0);case 14:this.authService=this.neroom.authService,this.roomService=this.neroom.roomService,this.messageChannelService=this.neroom.messageChannelService,this.state="init";case 18:case"end":return a.stop()}}),_callee16,this,[[6,10]])})))},a.loginByIM=function loginByIM(){var t;return __awaiter(this,void 0,void 0,Mi.mark((function _callee17(){var a,o;return Mi.wrap((function _callee17$(c){for(;;)switch(c.prev=c.next){case 0:if("init"===this.state){c.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),c.abrupt("return");case 3:return a=this.core.options,c.next=6,this._getToken();case 6:return o=c.sent,c.prev=7,c.next=10,null===(t=this.authService)||void 0===t?void 0:t.loginByIM(a.account,o,a.token);case 10:c.next=16;break;case 12:throw c.prev=12,c.t0=c.catch(7),this.logger.error("QChatMedia::loginByIM error",c.t0),new vc("QChatMedia::loginByIM error",c.t0);case 16:this.state="login";case 17:case"end":return c.stop()}}),_callee17,this,[[7,12]])})))},a._getToken=function _getToken(){var t;return __awaiter(this,void 0,void 0,Mi.mark((function _callee19(){var a,o,c,h,m=this;return Mi.wrap((function _callee19$(v){for(;;)switch(v.prev=v.next){case 0:return this.logger.log("QChatMedia::getToken begin getToken"),v.next=3,this.core.sendCmd("qchatGetNeroomToken",{qchatGetNeroomTokenTag:{neroomDeviceId:null===(t=this.neroom)||void 0===t?void 0:t.deviceId}});case 3:return a=v.sent,o=a.content.neroomToken,c=o.token,h=o.expire,this.logger.log("QChatMedia::getToken success token is "+c+",expire is "+h+" "),this.tokenTimer||(this.logger.debug("QChatMedia::getToken set token timer,expire is "+(1e3*h-this.tokenExpireTime)+" "),this.tokenTimer=this.core.timerManager.addTimer((function(){return __awaiter(m,void 0,void 0,Mi.mark((function _callee18(){var t;return Mi.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return this.tokenTimer&&this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0,a.next=4,this._getToken();case 4:t=a.sent,this.authService&&this.authService.renewToken(t);case 6:case"end":return a.stop()}}),_callee18,this)})))}),1e3*h-this.tokenExpireTime)),v.abrupt("return",c);case 8:case"end":return v.stop()}}),_callee19,this)})))},a.connectChannel=function connectChannel(t){var a,o;return __awaiter(this,void 0,void 0,Mi.mark((function _callee20(){var c;return Mi.wrap((function _callee20$(h){for(;;)switch(h.prev=h.next){case 0:if(void 0!==this.state){h.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),h.abrupt("return");case 3:if("init"!==this.state){h.next=6;break}return h.next=6,this.loginByIM();case 6:return this.serverId=t.serverId,this.channelId=t.channelId,h.prev=8,h.next=11,null===(a=this.roomService)||void 0===a?void 0:a.joinRoom({roomUuid:t.channelId,role:"qchatAudience",userName:this.core.options.account,initialProperties:{}},{});case 11:h.next=17;break;case 13:throw h.prev=13,h.t0=h.catch(8),this.logger.error("QChatMedia::connectChannel error",h.t0),new vc("QChatMedia::connectChannel error",h.t0);case 17:if(!(c=null===(o=this.roomService)||void 0===o?void 0:o.getRoomContext(t.channelId))){h.next=27;break}return this.roomContext=c,this.rtcController=this.roomContext.rtcController,this.state="connect",h.next=24,this.rtcController.joinRtcChannel();case 24:this.core.emit("connectChannel"),h.next=28;break;case 27:this.logger.error("QChatMedia::connect room not exited");case 28:case"end":return h.stop()}}),_callee20,this,[[8,13]])})))},a.updateRTCChannelInfo=function updateRTCChannelInfo(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee21(){return Mi.wrap((function _callee21$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},limit:{type:"number",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateRTCChannelConfig",{RTCChannelConfig:ki(ki({},t),{audio:us(t.audio),video:us(t.video)})});case 3:case"end":return a.stop()}}),_callee21,this)})))},a.getRTCChannelInfo=function getRTCChannelInfo(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee22(){var a;return Mi.wrap((function _callee22$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatGetRTCChannelConfig",{qchatGetRTCChannelConfigTag:t});case 3:return a=o.sent,o.abrupt("return",formatRTCChannelConfig(a.content.RTCChannelConfig));case 5:case"end":return o.stop()}}),_callee22,this)})))},a.getRTCChannelOnlineMembers=function getRTCChannelOnlineMembers(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee23(){var a;return Mi.wrap((function _callee23$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatGetRTCChannelMembers",{qchatGetRTCChannelMembersTag:t});case 3:return a=o.sent,o.abrupt("return",formatMembers(a.content.memberList));case 5:case"end":return o.stop()}}),_callee23,this)})))},a.addRTCChannelListener=function addRTCChannelListener(){var t,a,o=this;this._checkConnectState();try{null===(t=this.authService)||void 0===t||t.addAuthListener({onAuthEvent:function onAuthEvent(t){return __awaiter(o,void 0,void 0,Mi.mark((function _callee24(){var a;return Mi.wrap((function _callee24$(o){for(;;)switch(o.prev=o.next){case 0:if(1026!==t||this.getTokenState){o.next=10;break}return this.logger.log("QChatMedia::loginByIM token expire,begin get new token "),this.getTokenState=!0,o.next=5,this._getToken();case 5:if(a=o.sent,!this.authService){o.next=9;break}return o.next=9,this.authService.renewToken(a);case 9:this.getTokenState=!1;case 10:case"end":return o.stop()}}),_callee24,this)})))}})}catch(t){throw this.getTokenState=!1,this.logger.error("QChatMedia::loginByIM addAuthListener error",t),new vc("QChatMedia::loginByIM addAuthListener error",t)}null===(a=this.roomContext)||void 0===a||a.addRoomListener({onRoomPropertiesChanged:function onRoomPropertiesChanged(t){var a,c,h,m,v,b;if(o.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesChanged",t),t.audioOff){var C=null===(a=t.audioOff.value)||void 0===a?void 0:a.split("_")[0];C!==lv.offNotAllowSelfOn&&C!==lv.offAllowSelfOn||(null===(c=o.roomContext)||void 0===c?void 0:c.localMember.isAudioOn)&&(null===(h=o.rtcController)||void 0===h||h.muteMyAudio())}else if(t.videoOff){var S=null===(m=t.videoOff.value)||void 0===m?void 0:m.split("_")[0];S!==lv.offNotAllowSelfOn&&S!==lv.offAllowSelfOn||(null===(v=o.roomContext)||void 0===v?void 0:v.localMember.isVideoOn)&&(null===(b=o.rtcController)||void 0===b||b.muteMyVideo())}},onRoomPropertiesDeleted:function onRoomPropertiesDeleted(t){o.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesDeleted",t)},onMemberJoinRtcChannel:function onMemberJoinRtcChannel(t){o.logger.log("QChatMedia::addRTCChannelListener::onMemberJoinRTCChannel",t);var a=map(t).call(t,(function(t){return t.uuid}));o.core.emit("memberJoinRTCChannel",a)},onMemberLeaveRoom:function onMemberLeaveRoom(t){o.logger.log("QChatMedia::addRTCChannelListener::onMemberLeaveRoom",t);var a=map(t).call(t,(function(t){return t.uuid}));o.core.emit("memberLeaveRTCChannel",a)},onRoomEnded:function onRoomEnded(t){o.authService&&o.authService.logout(),o._setStateInit(),o.logger.log("QChatMedia::addRTCChannelListener::onRoomEnded",t),o.core.emit("RTCChannelEnded",t)},onRtcChannelError:function onRtcChannelError(t){o.logger.log("QChatMedia::addRTCChannelListener::onRtcChannelError",t),"SOCKET_ERROR"===t&&o.disconnectChannel(),o.core.emit("RTCChannelError",t)},onRtcAudioVolumeIndication:function onRtcAudioVolumeIndication(t){o.logger.log("QChatMedia::addRTCChannelListener::onRtcAudioVolumeIndication",t),o.core.emit("onRtcAudioVolumeIndication",t)},onMemberAudioMuteChanged:function onMemberAudioMuteChanged(t,a,c){o.logger.log("QChatMedia::addRTCChannelListener::onMemberAudioMuteChanged",t,a),o.core.emit("memberAudioMuteChanged",{memberAccId:t.uuid,mute:a,operateByAccId:c.uuid})},onMemberScreenShareStateChanged:function onMemberScreenShareStateChanged(t,a,c){o.logger.log("QChatMedia::addRTCChannelListener::onMemberScreenShareStateChanged",t,a),o.core.emit("memberScreenShareStateChanged",{memberAccId:t.uuid,isSharing:a,operateByAccId:c.uuid})},onMemberVideoMuteChanged:function onMemberVideoMuteChanged(t,a,c){o.logger.log("QChatMedia::addRTCChannelListener::onMemberVideoMuteChanged",t,a),o.core.emit("memberVideoMuteChanged",{memberAccId:t.uuid,mute:a,operateByAccId:c.uuid})}})},a.enumCameraDevices=function enumCameraDevices(){var t=this;return this._checkConnectState(),this.rtcController.enumCameraDevices().then((function(t){return t.data}),(function(a){throw t.logger.error("QChatMedia::enumCameraDevices error",a),new vc("QChatMedia::enumCameraDevices error",a)}))},a.enumPlayoutDevices=function enumPlayoutDevices(){var t=this;return this._checkConnectState(),this.rtcController.enumPlayoutDevices().then((function(t){return t.data}),(function(a){throw t.logger.error("QChatMedia::enumPlayoutDevices error",a),new vc("QChatMedia::enumPlayoutDevices error",a)}))},a.enumRecordDevices=function enumRecordDevices(){var t=this;return this._checkConnectState(),this.rtcController.enumRecordDevices().then((function(t){return t.data}),(function(a){throw t.logger.error("QChatMedia::enumRecordDevices error",a),new vc("QChatMedia::enumRecordDevices error",a)}))},a.removeRTCChannelListener=function removeRTCChannelListener(){var t,a;this._checkConnectState(),null===(t=this.roomContext)||void 0===t||t.removeRoomListener({}),null===(a=this.authService)||void 0===a||a.removeAuthListener({})},a.setSelectedCameraDevice=function setSelectedCameraDevice(t){var a=this;return this._checkConnectState(),validate({deviceId:{type:"string",allowEmpty:!1}},t),this.rtcController.setSelectedCameraDevice(t.deviceId).then((function(t){return t.data}),(function(t){throw a.logger.error("QChatMedia::setSelectedCameraDevice error",t),new vc("QChatMedia::setSelectedCameraDevice error",t)}))},a.setSelectedPlayoutDevice=function setSelectedPlayoutDevice(t){var a=this;return this._checkConnectState(),validate({deviceId:{type:"string",allowEmpty:!1}},t),this.rtcController.setSelectedPlayoutDevice(t.deviceId).then((function(t){return t.data}),(function(t){throw a.logger.error("QChatMedia::setSelectedPlayoutDevice error",t),new vc("QChatMedia::setSelectedPlayoutDevice error",t)}))},a.setSelectedRecordDevice=function setSelectedRecordDevice(t){var a=this;return this._checkConnectState(),validate({deviceId:{type:"string",allowEmpty:!1}},t),this.rtcController.setSelectedRecordDevice(t.deviceId).then((function(t){return t.data}),(function(t){throw a.logger.error("QChatMedia::setSelectedRecordDevice error",t),new vc("QChatMedia::setSelectedRecordDevice error",t)}))},a.getRTCMembers=function getRTCMembers(){var t,a;return this._checkConnectState(),map(t=filter(a=this.roomContext.remoteMembers).call(a,(function(t){return t.isInRtcChannel}))).call(t,(function(t){return{accid:t.uuid,isAudioOn:!!t.isAudioOn,isVideoOn:!!t.isVideoOn,isSharingScreen:!!t.isSharingScreen,properties:t.properties}}))},a.subscribeRemoteVideoSubStream=function subscribeRemoteVideoSubStream(t){var a;return __awaiter(this,void 0,void 0,Mi.mark((function _callee25(){return Mi.wrap((function _callee25$(o){for(;;)switch(o.prev=o.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),o.prev=2,null===(a=this.rtcController)||void 0===a||a.subscribeRemoteVideoSubStream(t.accid),o.next=10;break;case 6:throw o.prev=6,o.t0=o.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoSubStream error",o.t0),new vc("QChatMedia::subscribeRemoteVideoSubStream error",o.t0);case 10:case"end":return o.stop()}}),_callee25,this,[[2,6]])})))},a.unsubscribeRemoteVideoSubStream=function unsubscribeRemoteVideoSubStream(t){var a;return __awaiter(this,void 0,void 0,Mi.mark((function _callee26(){return Mi.wrap((function _callee26$(o){for(;;)switch(o.prev=o.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),o.prev=2,null===(a=this.rtcController)||void 0===a||a.unsubscribeRemoteVideoSubStream(t.accid),o.next=10;break;case 6:throw o.prev=6,o.t0=o.catch(2),this.logger.error("QChatMedia::unsubscribeRemoteVideoSubStream error",o.t0),new vc("QChatMedia::unsubscribeRemoteVideoSubStream error",o.t0);case 10:case"end":return o.stop()}}),_callee26,this,[[2,6]])})))},a.muteAllAudio=function muteAllAudio(){var t;return __awaiter(this,void 0,void 0,Mi.mark((function _callee27(){return Mi.wrap((function _callee27$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("audioOff",us({value:lv.offNotAllowSelfOn+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::muteAllAudio error",a.t0),new vc("QChatMedia::muteAllAudio error",a.t0);case 15:case"end":return a.stop()}}),_callee27,this,[[7,11]])})))},a.muteAllVideo=function muteAllVideo(){var t;return __awaiter(this,void 0,void 0,Mi.mark((function _callee28(){return Mi.wrap((function _callee28$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("videoOff",us({value:lv.offNotAllowSelfOn+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::muteAllVideo error",a.t0),new vc("QChatMedia::muteAllVideo error",a.t0);case 15:case"end":return a.stop()}}),_callee28,this,[[7,11]])})))},a.unMuteAllAudio=function unMuteAllAudio(){var t;return __awaiter(this,void 0,void 0,Mi.mark((function _callee29(){return Mi.wrap((function _callee29$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("audioOff",us({value:lv.disable+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::unMuteAllAudio error",a.t0),new vc("QChatMedia::unMuteAllAudio error",a.t0);case 15:case"end":return a.stop()}}),_callee29,this,[[7,11]])})))},a.unMuteAllVideo=function unMuteAllVideo(){var t;return __awaiter(this,void 0,void 0,Mi.mark((function _callee30(){return Mi.wrap((function _callee30$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("videoOff",us({value:lv.disable+"_"+(new Date).getTime()})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::unMuteAllVideo error",a.t0),new vc("QChatMedia::unMuteAllVideo error",a.t0);case 15:case"end":return a.stop()}}),_callee30,this,[[7,11]])})))},QChatMediaService}(zh),bv={"1_2":"heartbeat","24_2":"qchatLogin","24_4":"qchatExit","24_5":"qchatBeKicked","24_8":"qchatMultiSpotLogin","24_9":"qchatKick","24_19":"qchatSync"},Cv={qchatLoginTag:{appkey:1,account:2,authType:3,token:4,loginExt:5,clientType:6,clientSession:7,deviceId:8,sdkVersion:9,sdkType:10,userAgent:11,customTag:12,customClientType:13,sdkHumanVersion:14,pushTokenName:20,pushToken:21,pushkitTokenName:22,pushkitToken:23,deviceInfo:24,customPushContentType:25,os:30,mac:31,bundleId:32,simCarrierCode:33,simCountryCode:34,networkCode:35,browser:36,deviceModel:37,androidid:38,imei:39,idfv:40,openuuid:41,pushType:100,hasTokenPreviously:101,consid:102,clientIP:103,clientPort:104,loginTime:105}},Sv=invertSerializeMap(Cv),Mv={heartbeat:{sid:1,cid:2,service:"qchatAuth"},qchatLogin:{sid:24,cid:2,service:"qchatAuth",params:[{type:"Property",name:"qchatLoginReqTag",reflectMapper:Cv.qchatLoginTag}],response:[{type:"Property",name:"qchatLoginResTag",reflectMapper:Sv.qchatLoginTag},{type:"PropertyArray",name:"qchatMultiLoginResult",reflectMapper:Sv.qchatLoginTag}]},qchatExit:{sid:24,cid:4,service:"qchatAuth"},qchatBeKicked:{sid:24,cid:5,service:"qchatAuth",response:[{type:"Property",name:"beKickedTag",reflectMapper:{1:"clientType",2:"reason",3:"ext",4:"customClientType"}}]},qchatMultiSpotLogin:{sid:24,cid:8,service:"qchatAuth",response:[{type:"Number",name:"state"},{type:"Property",name:"qchatLoginResTag",reflectMapper:Sv.qchatLoginTag}]},qchatKick:{sid:24,cid:9,service:"qchatAuth",params:[{type:"StrArray",name:"deviceIds"}],response:[{type:"StrArray",name:"deviceIds"}]},qchatSync:{sid:24,cid:19,service:"qchatAuth",isNoResponse:!0,params:[{type:"Property",name:"qchatSyncTag",reflectMapper:{systemNotification:1,pushConfig:2}}],response:[{type:"Number",name:"timetag"}]}},_v={debugLevel:"off",needReconnect:!0,reconnectionAttempts:_i,isAbtestEnable:!0,abtestUrl:"https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo",abtestProjectKey:"imElite_sdk_abtest_web"},wv=function(t){function QChat(a,o){var h;return void 0===o&&(o={cloudStorageConfig:{}}),(h=t.call(this,a)||this).instanceName="QChat",h.account="",h.options={},h.qchatAuth={},h.qchatServer={},h.qchatChannel={},h.qchatMsg={},h.qchatRole={},h.qchatMedia={},h.cloudStorage={},h.setOptions(a),registerParser({cmdMap:bv,cmdConfig:Mv}),registerParser({cmdMap:bh,cmdConfig:Mh}),h.qchatAuth=new dv(c(h)),h.qchatServer=new Nf(c(h)),h.qchatChannel=new Em(c(h)),h.qchatMsg=new iv(c(h)),h.qchatRole=new jm(c(h)),h.qchatMedia=new yv(c(h)),h.cloudStorage=new kh(c(h),ki({storageKeyPrefix:h.instanceName},o.cloudStorageConfig)),o&&h.setOtherOptions(o),QChat.instance=c(h),h}wt(QChat,t),QChat.getInstance=function getInstance(t,a){if(!QChat.instance){if(t)return new QChat(t,a);throw new Error("Instance not exist, please input options")}if(t){if(QChat.instance.options.account===t.account&&QChat.instance.options.appkey===t.appkey)return QChat.instance.setOptions(t),a&&QChat.instance.setOtherOptions(a),QChat.instance;throw new Error("Unexpected login")}return QChat.instance};var a=QChat.prototype;return a.connect=function connect(a){void 0===a&&(a={});var o=ut(null,{connect:{get:function get(){return t.prototype.connect}}});return __awaiter(this,void 0,void 0,Mi.mark((function _callee(){var t,c,h;return Mi.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:if(/^(unconnected|waitReconnect)$/.test(this.status)){m.next=4;break}return t="QChat status is "+this.status+", and would not connect",this.logger.warn(t),m.abrupt("return",li.reject(t));case 4:return c=a.isAutoReconnect||!1,m.next=7,o.connect.call(this,{linkUrls:this.options.linkAddresses,isAutoReconnect:c});case 7:return m.prev=7,m.next=10,this.qchatAuth.doLogin(c);case 10:h=m.sent,m.next=21;break;case 13:if(m.prev=13,m.t0=m.catch(7),this.logger.warn("qchat connect:: login failed",m.t0),0!==this.retryCount){m.next=19;break}throw this.doDisconnect(nd.ACTIVE,"FailedToInitializeLogin"),m.t0;case 19:return this.doDisconnect(nd.OFFLINE,"ReconnectLoginFailed"),m.abrupt("return");case 21:return this.status="logined",h.loginResult.appkey=this.options.appkey,this.eventBus.emit("logined",h.loginResult),this.emit("logined",h.loginResult),h.multiLoginResults&&h.multiLoginResults.length>0&&this.emit("multiSpotLogin",h.multiLoginResults),this.resetConnectStatus(),this.ping(),m.prev=28,m.next=31,this.cloudStorage.init();case 31:m.next=36;break;case 33:m.prev=33,m.t1=m.catch(28),this.logger.error("NIM:login cloudStorage init failed ",m.t1);case 36:return m.next=38,this.qchatAuth.sync();case 38:case"end":return m.stop()}}),_callee,this,[[7,13],[28,33]])})))},a.login=function login(t){return void 0===t&&(t={}),this.connect(t)},a.setOptions=function setOptions(t){validate({account:{type:"string"},appkey:{type:"string"},token:{type:"string"},linkAddresses:{type:"array",itemType:"string",min:1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},debugLevel:{type:"enum",values:wc,required:!1}},t),this.logger.log("QChat::setOptions options is",t),this.account=t.account,this.options=ki(ki({},_v),t)},a.setOtherOptions=function setOtherOptions(t){var a;(null===(a=null==t?void 0:t.QChatMedia)||void 0===a?void 0:a.neroom)&&this.qchatMedia.setNeroom(t.QChatMedia.neroom)},a.onMessage=function onMessage(a){var o,c,h=t.prototype.onMessage.call(this,a);if(h){var m=h.raw.ser,v=this.sendingCmdMap.get(m);if(v&&v.cmd===h.cmd){var b=v.callback,C=v.timer,S=v.params;if(clearTimeout(C),h.params=S,this.sendingCmdMap.delete(m),"heartbeat"===h.cmd)return void b[0]();var M=null===(o=this[h.service])||void 0===o?void 0:o.process(h);M&&"function"==typeof M.then?M.then((function(t){b[0](t)})).catch((function(t){b[1](t)})):(this.logger.log("imsocket:: handlerFn without promise",h.service,h.cmd),b[0]())}else null===(c=this[h.service])||void 0===c||c.process(h)}},a.disconnect=function disconnect(){var a=this;switch(this.status){case"connected":case"logined":return this.sendCmd("qchatExit").then((function(){t.prototype.doDisconnect.call(a,nd.ACTIVE,"UserActiveDisconnect")}));case"connecting":case"waitReconnect":return t.prototype.doDisconnect.call(this,nd.ACTIVE,"UserActiveDisconnect"),li.resolve();case"unconnected":case"destroyed":return li.resolve()}},a.logout=function logout(){return this.disconnect()},a.destroy=function destroy(){return QChat.instance=null,t.prototype.destroy.call(this)},a.kickOtherClients=function kickOtherClients(t){return validate({deviceIds:{type:"array",itemType:"string"}},t),this.qchatAuth.kick(t)},QChat}(sd);wv.instance=null;var Iv=Math.min,xv=[].lastIndexOf,Tv=!!xv&&1/[1].lastIndexOf(1,-0)<0,kv=arrayMethodIsStrict("lastIndexOf"),Rv=Tv||!kv?function lastIndexOf(t){if(Tv)return S(xv,this,arguments)||0;var a=toIndexedObject(this),o=lengthOfArrayLike(a),c=o-1;for(arguments.length>1&&(c=Iv(c,toIntegerOrInfinity(arguments[1]))),c<0&&(c=o+c);c>=0;c--)if(c in a&&a[c]===t)return c||0;return-1}:xv;_export({target:"Array",proto:!0,forced:Rv!==[].lastIndexOf},{lastIndexOf:Rv});var qv=entryVirtual("Array").lastIndexOf,Ev=Array.prototype,lastIndexOf=function(t){var a=t.lastIndexOf;return t===Ev||Q(Ev,t)&&a===Ev.lastIndexOf?qv:a},Pv=createCommonjsModule((function(a,o){(function(){var c={function:!0,object:!0}[typeof window]&&window||this,h=o,m=a&&!a.nodeType&&a,v=h&&m&&"object"==typeof t&&t;!v||v.global!==v&&v.window!==v&&v.self!==v||(c=v);var b=Math.pow(2,53)-1,C=/\bOpera/,S=Object.prototype,M=S.hasOwnProperty,w=S.toString;function capitalize(t){return(t=String(t)).charAt(0).toUpperCase()+t.slice(1)}function format(t){return t=trim(t),/^(?:webOS|i(?:OS|P))/.test(t)?t:capitalize(t)}function forOwn(t,a){for(var o in t)M.call(t,o)&&a(t[o],o,t)}function getClassOf(t){return null==t?capitalize(t):w.call(t).slice(8,-1)}function qualify(t){return String(t).replace(/([ -])(?!$)/g,"$1?")}function reduce(t,a){var o=null;return function each(t,a){var o=-1,c=t?t.length:0;if("number"==typeof c&&c>-1&&c<=b)for(;++o<c;)a(t[o],o,t);else forOwn(t,a)}(t,(function(c,h){o=a(o,c,h,t)})),o}function trim(t){return String(t).replace(/^ +| +$/g,"")}var I=function parse(t){var a=c,o=t&&"object"==typeof t&&"String"!=getClassOf(t);o&&(a=t,t=null);var h=a.navigator||{},m=h.userAgent||"";t||(t=m);var v,b,S=o?!!h.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(w.toString()),M="Object",I=o?M:"ScriptBridgingProxyObject",x=o?M:"Environment",T=o&&a.java?"JavaPackage":getClassOf(a.java),k=o?M:"RuntimeObject",R=/\bJava/.test(T)&&a.java,q=R&&getClassOf(a.environment)==x,E=R?"a":"α",P=R?"b":"β",A=a.document||{},O=a.operamini||a.opera,U=C.test(U=o&&O?O["[[Class]]"]:getClassOf(O))?U:O=null,B=t,j=[],L=null,N=t==m,G=N&&O&&"function"==typeof O.version&&O.version(),$=function getLayout(a){return reduce(a,(function(a,o){return a||RegExp("\\b"+(o.pattern||qualify(o))+"\\b","i").exec(t)&&(o.label||o)}))}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),D=function getName(a){return reduce(a,(function(a,o){return a||RegExp("\\b"+(o.pattern||qualify(o))+"\\b","i").exec(t)&&(o.label||o)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),Q=getProduct([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),W=function getManufacturer(a){return reduce(a,(function(a,o,c){return a||(o[Q]||o[/^[a-z]+(?: +[a-z]+\b)*/i.exec(Q)]||RegExp("\\b"+qualify(c)+"(?:\\b|\\w*\\d)","i").exec(t))&&c}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),V=function getOS(a){return reduce(a,(function(a,o){var c=o.pattern||qualify(o);return!a&&(a=RegExp("\\b"+c+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(a=function cleanupOS(t,a,o){var c={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return a&&o&&/^Win/i.test(t)&&!/^Windows Phone /i.test(t)&&(c=c[/[\d.]+$/.exec(t)])&&(t="Windows "+c),t=String(t),a&&o&&(t=t.replace(RegExp(a,"i"),o)),format(t.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(a,c,o.label||o)),a}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function getProduct(a){return reduce(a,(function(a,o){var c=o.pattern||qualify(o);return!a&&(a=RegExp("\\b"+c+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+c+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+c+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((a=String(o.label&&!RegExp(c,"i").test(o.label)?o.label:a).split("/"))[1]&&!/[\d.]+/.test(a[0])&&(a[0]+=" "+a[1]),o=o.label||o,a=format(a[0].replace(RegExp(c,"i"),o).replace(RegExp("; *(?:"+o+"[_-])?","i")," ").replace(RegExp("("+o+")[-_.]?(\\w)","i"),"$1 $2"))),a}))}function getVersion(a){return reduce(a,(function(a,o){return a||(RegExp(o+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if($&&($=[$]),/\bAndroid\b/.test(V)&&!Q&&(v=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(Q=trim(v[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),W&&!Q?Q=getProduct([W]):W&&Q&&(Q=Q.replace(RegExp("^("+qualify(W)+")[-_.\\s]","i"),W+" ").replace(RegExp("^("+qualify(W)+")[-_.]?(\\w)","i"),W+" $2")),(v=/\bGoogle TV\b/.exec(Q))&&(Q=v[0]),/\bSimulator\b/i.test(t)&&(Q=(Q?Q+" ":"")+"Simulator"),"Opera Mini"==D&&/\bOPiOS\b/.test(t)&&j.push("running in Turbo/Uncompressed mode"),"IE"==D&&/\blike iPhone OS\b/.test(t)?(W=(v=parse(t.replace(/like iPhone OS/,""))).manufacturer,Q=v.product):/^iP/.test(Q)?(D||(D="Safari"),V="iOS"+((v=/ OS ([\d_]+)/i.exec(t))?" "+v[1].replace(/_/g,"."):"")):"Konqueror"==D&&/^Linux\b/i.test(V)?V="Kubuntu":W&&"Google"!=W&&(/Chrome/.test(D)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(Q))||/\bAndroid\b/.test(V)&&/^Chrome/.test(D)&&/\bVersion\//i.test(t)?(D="Android Browser",V=/\bAndroid\b/.test(V)?V:"Android"):"Silk"==D?(/\bMobi/i.test(t)||(V="Android",j.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&j.unshift("accelerated")):"UC Browser"==D&&/\bUCWEB\b/.test(t)?j.push("speed mode"):"PaleMoon"==D&&(v=/\bFirefox\/([\d.]+)\b/.exec(t))?j.push("identifying as Firefox "+v[1]):"Firefox"==D&&(v=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(V||(V="Firefox OS"),Q||(Q=v[1])):!D||(v=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(D))?(D&&!Q&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(v+"/")+8))&&(D=null),(v=Q||W||V)&&(Q||W||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(V))&&(D=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(V)?V:v)+" Browser")):"Electron"==D&&(v=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&j.push("Chromium "+v),G||(G=getVersion(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",qualify(D),"(?:Firefox|Minefield|NetFront)"])),(v=("iCab"==$&&parseFloat(G)>3?"WebKit":/\bOpera\b/.test(D)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test($)&&"WebKit"||!$&&/\bMSIE\b/i.test(t)&&("Mac OS"==V?"Tasman":"Trident")||"WebKit"==$&&/\bPlayStation\b(?! Vita\b)/i.test(D)&&"NetFront")&&($=[v]),"IE"==D&&(v=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(D+=" Mobile",V="Windows Phone "+(/\+$/.test(v)?v:v+".x"),j.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(D="IE Mobile",V="Windows Phone 8.x",j.unshift("desktop mode"),G||(G=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=D&&"Trident"==$&&(v=/\brv:([\d.]+)/.exec(t))&&(D&&j.push("identifying as "+D+(G?" "+G:"")),D="IE",G=v[1]),N){if(function isHostType(t,a){var o=null!=t?typeof t[a]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(o)||"object"==o&&!t[a])}(a,"global"))if(R&&(B=(v=R.lang.System).getProperty("os.arch"),V=V||v.getProperty("os.name")+" "+v.getProperty("os.version")),q){try{G=a.require("ringo/engine").version.join("."),D="RingoJS"}catch(t){(v=a.system)&&v.global.system==a.system&&(D="Narwhal",V||(V=v[0].os||null))}D||(D="Rhino")}else"object"==typeof a.process&&!a.process.browser&&(v=a.process)&&("object"==typeof v.versions&&("string"==typeof v.versions.electron?(j.push("Node "+v.versions.node),D="Electron",G=v.versions.electron):"string"==typeof v.versions.nw&&(j.push("Chromium "+G,"Node "+v.versions.node),D="NW.js",G=v.versions.nw)),D||(D="Node.js",B=v.arch,V=v.platform,G=(G=/[\d.]+/.exec(v.version))?G[0]:null));else getClassOf(v=a.runtime)==I?(D="Adobe AIR",V=v.flash.system.Capabilities.os):getClassOf(v=a.phantom)==k?(D="PhantomJS",G=(v=v.version||null)&&v.major+"."+v.minor+"."+v.patch):"number"==typeof A.documentMode&&(v=/\bTrident\/(\d+)/i.exec(t))?(G=[G,A.documentMode],(v=+v[1]+4)!=G[1]&&(j.push("IE "+G[1]+" mode"),$&&($[1]=""),G[1]=v),G="IE"==D?String(G[1].toFixed(1)):G[0]):"number"==typeof A.documentMode&&/^(?:Chrome|Firefox)\b/.test(D)&&(j.push("masking as "+D+" "+G),D="IE",G="11.0",$=["Trident"],V="Windows");V=V&&format(V)}if(G&&(v=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(G)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(N&&h.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(L=/b/i.test(v)?"beta":"alpha",G=G.replace(RegExp(v+"\\+?$"),"")+("beta"==L?P:E)+(/\d+\+?/.exec(v)||"")),"Fennec"==D||"Firefox"==D&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(V))D="Firefox Mobile";else if("Maxthon"==D&&G)G=G.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(Q))"Xbox 360"==Q&&(V=null),"Xbox 360"==Q&&/\bIEMobile\b/.test(t)&&j.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(D)&&(!D||Q||/Browser|Mobi/.test(D))||"Windows CE"!=V&&!/Mobi/i.test(t))if("IE"==D&&N)try{null===a.external&&j.unshift("platform preview")}catch(t){j.unshift("embedded")}else(/\bBlackBerry\b/.test(Q)||/\bBB10\b/.test(t))&&(v=(RegExp(Q.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||G)?(V=((v=[v,/BB10/.test(t)])[1]?(Q=null,W="BlackBerry"):"Device Software")+" "+v[0],G=null):this!=forOwn&&"Wii"!=Q&&(N&&O||/Opera/.test(D)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==D&&/\bOS X (?:\d+\.){2,}/.test(V)||"IE"==D&&(V&&!/^Win/.test(V)&&G>5.5||/\bWindows XP\b/.test(V)&&G>8||8==G&&!/\bTrident\b/.test(t)))&&!C.test(v=parse.call(forOwn,t.replace(C,"")+";"))&&v.name&&(v="ing as "+v.name+((v=v.version)?" "+v:""),C.test(D)?(/\bIE\b/.test(v)&&"Mac OS"==V&&(V=null),v="identify"+v):(v="mask"+v,D=U?format(U.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(v)&&(V=null),N||(G=null)),$=["Presto"],j.push(v));else D+=" Mobile";(v=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(v=[parseFloat(v.replace(/\.(\d)$/,".0$1")),v],"Safari"==D&&"+"==v[1].slice(-1)?(D="WebKit Nightly",L="alpha",G=v[1].slice(0,-1)):G!=v[1]&&G!=(v[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(G=null),v[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==v[0]&&537.36==v[2]&&parseFloat(v[1])>=28&&"WebKit"==$&&($=["Blink"]),N&&(S||v[1])?($&&($[1]="like Chrome"),v=v[1]||((v=v[0])<530?1:v<532?2:v<532.05?3:v<533?4:v<534.03?5:v<534.07?6:v<534.1?7:v<534.13?8:v<534.16?9:v<534.24?10:v<534.3?11:v<535.01?12:v<535.02?"13+":v<535.07?15:v<535.11?16:v<535.19?17:v<536.05?18:v<536.1?19:v<537.01?20:v<537.11?"21+":v<537.13?23:v<537.18?24:v<537.24?25:v<537.36?26:"Blink"!=$?"27":"28")):($&&($[1]="like Safari"),v=(v=v[0])<400?1:v<500?2:v<526?3:v<533?4:v<534?"4+":v<535?5:v<537?6:v<538?7:v<601?8:v<602?9:v<604?10:v<606?11:v<608?12:"12"),$&&($[1]+=" "+(v+="number"==typeof v?".x":/[.+]/.test(v)?"":"+")),"Safari"==D&&(!G||parseInt(G)>45)?G=v:"Chrome"==D&&/\bHeadlessChrome/i.test(t)&&j.unshift("headless")),"Opera"==D&&(v=/\bzbov|zvav$/.exec(V))?(D+=" ",j.unshift("desktop mode"),"zvav"==v?(D+="Mini",G=null):D+="Mobile",V=V.replace(RegExp(" *"+v+"$"),"")):"Safari"==D&&/\bChrome\b/.exec($&&$[1])?(j.unshift("desktop mode"),D="Chrome Mobile",G=null,/\bOS X\b/.test(V)?(W="Apple",V="iOS 4.3+"):V=null):/\bSRWare Iron\b/.test(D)&&!G&&(G=getVersion("Chrome")),G&&0==G.indexOf(v=/[\d.]+$/.exec(V))&&t.indexOf("/"+v+"-")>-1&&(V=trim(V.replace(v,""))),V&&-1!=V.indexOf(D)&&!RegExp(D+" OS").test(V)&&(V=V.replace(RegExp(" *"+qualify(D)+" *"),"")),$&&!/\b(?:Avant|Nook)\b/.test(D)&&(/Browser|Lunascape|Maxthon/.test(D)||"Safari"!=D&&/^iOS/.test(V)&&/\bSafari\b/.test($[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(D)&&$[1])&&(v=$[$.length-1])&&j.push(v),j.length&&(j=["("+j.join("; ")+")"]),W&&Q&&Q.indexOf(W)<0&&j.push("on "+W),Q&&j.push((/^on /.test(j[j.length-1])?"":"on ")+Q),V&&(v=/ ([\d.+]+)$/.exec(V),b=v&&"/"==V.charAt(V.length-v[0].length-1),V={architecture:32,family:v&&!b?V.replace(v[0],""):V,version:v?v[1]:null,toString:function(){var t=this.version;return this.family+(t&&!b?" "+t:"")+(64==this.architecture?" 64-bit":"")}}),(v=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(B))&&!/\bi686\b/i.test(B)?(V&&(V.architecture=64,V.family=V.family.replace(RegExp(" *"+v),"")),D&&(/\bWOW64\b/i.test(t)||N&&/\w(?:86|32)$/.test(h.cpuClass||h.platform)&&!/\bWin64; x64\b/i.test(t))&&j.unshift("32-bit")):V&&/^OS X/.test(V.family)&&"Chrome"==D&&parseFloat(G)>=39&&(V.architecture=64),t||(t=null);var K={};return K.description=t,K.layout=$&&$[0],K.manufacturer=W,K.name=D,K.prerelease=L,K.product=Q,K.ua=t,K.version=D&&G,K.os=V||{architecture:null,family:null,version:null,toString:function(){return"null"}},K.parse=parse,K.toString=function toStringPlatform(){return this.description||""},K.version&&j.unshift(G),K.name&&j.unshift(D),V&&D&&(V!=String(V).split(" ")[0]||V!=D.split(" ")[0]&&!Q)&&j.push(Q?"("+V+")":"on "+V),j.length&&(K.description=j.join(" ")),K}();h&&m?forOwn(I,(function(t,a){h[a]=t})):c.platform=I}).call(t)})),Av=createCommonjsModule((function(t,a){self,t.exports=function(){var t={d:function(a,o){for(var c in o)t.o(o,c)&&!t.o(a,c)&&Object.defineProperty(a,c,{enumerable:!0,get:o[c]})},o:function(t,a){return Object.prototype.hasOwnProperty.call(t,a)}},a={};t.d(a,{default:function(){return w}});var o=function e(t){for(var a in function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=2,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.onError=function(t){},this.onProgress=function(t){},this.onComplete=function(t){},t)this[a]=t[a]};function n(t,a){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,a){if(t){if("string"==typeof t)return r(t,a);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?r(t,a):void 0}}(t))||a&&t&&"number"==typeof t.length){o&&(t=o);var c=0,i=function(){};return{s:i,n:function(){return c>=t.length?{done:!0}:{done:!1,value:t[c++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var h,m=!0,v=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return m=t.done,t},e:function(t){v=!0,h=t},f:function(){try{m||null==o.return||o.return()}finally{if(v)throw h}}}}function r(t,a){(null==a||a>t.length)&&(a=t.length);for(var o=0,c=new Array(a);o<a;o++)c[o]=t[o];return c}var c=window.localStorage;window.localStorage&&"function"==typeof window.localStorage.getItem&&"function"==typeof window.localStorage.setItem&&"function"==typeof window.localStorage.removeItem||(c={privateObj:{},setItem:function(t,a){c.privateObj[t]=a},getItem:function(t){return c.privateObj[t]},removeItem:function(t){delete c.privateObj[t]},getKeys:function(){return Object.keys(c.privateObj)}});var h={getFileKey:function(t){var a=t.size.toString(),o=t.lastModified.toString();return t.name+a.slice(a.length-5)+o.slice(o.length-5)},getFileInfo:function(t){var a=c.getItem(t);if(!a)return null;try{return JSON.parse(a)}catch(t){return null}},initFile:function(t,a){h.clearExpiredInfo();var o=this.getFileKey(a),m={ctx:void 0!==t.ctx?t.ctx:"",bucket:t.bucketName,obj:t.objectName,token:t.token,modifyAt:Date.now(),end:!1};return t.payload&&(m.payload=t.payload),c.setItem(o,JSON.stringify(m)),o},setUploadContext:function(t,a){var o=this.getFileInfo(t);o&&(o.ctx=a,c.setItem(t,JSON.stringify(o)))},setComplete:function(t){var a=this.getFileInfo(t);a&&(a.modifyAt=Date.now(),a.end=!0,c.setItem(t,JSON.stringify(a)))},getUploadContext:function(t){var a=this.getFileInfo(t);return a?a.ctx:""},removeFileInfo:function(t){c.removeItem(t)},clearExpiredInfo:function(){var t,a="function"==typeof c.getKeys?c.getKeys():Object.keys(c),o=Date.now(),m=[],v=n(a);try{for(v.s();!(t=v.n()).done;){var b=t.value,C=h.getFileInfo(b);null===C||o-C.modifyAt>w.expireTime?c.removeItem(b):m.push({fileInfo:C,key:b})}}catch(t){v.e(t)}finally{v.f()}if(m.length>w.maxFileCache){var S,M=n(m.sort((function(t,a){return a.fileInfo.modifyAt-t.fileInfo.modifyAt})).slice(w.maxFileCache));try{for(M.s();!(S=M.n()).done;){var I=S.value;c.removeItem(I.key)}}catch(t){M.e(t)}finally{M.f()}}}},m=h;function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t,a){return!a||"object"!==u(a)&&"function"!=typeof a?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):a}function l(t){var a="function"==typeof Map?new Map:void 0;return(l=function(t){if(null===t||(o=t,-1===Function.toString.call(o).indexOf("[native code]")))return t;var o;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==a){if(a.has(t))return a.get(t);a.set(t,n)}function n(){return s(t,arguments,y(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),d(n,t)})(t)}function s(t,a,o){return(s=p()?Reflect.construct:function(t,a,o){var c=[null];c.push.apply(c,a);var h=new(Function.bind.apply(t,c));return o&&d(h,o.prototype),h}).apply(null,arguments)}function p(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function d(t,a){return(d=Object.setPrototypeOf||function(t,a){return t.__proto__=a,t})(t,a)}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var v=function(t){!function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(a&&a.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),a&&d(t,a)}(r,t);var a,o,c=(a=r,o=p(),function(){var t,c=y(a);if(o){var h=y(this).constructor;t=Reflect.construct(c,arguments,h)}else t=c.apply(this,arguments);return f(this,t)});function r(t,a){var o;return function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,r),(o=c.call(this,"NosUploadError:"+t)).errCode=a,o.errMsg=t,o}return r}(l(Error)),b=function e(t,a,o){if("uploading"===t.uploadState){var c=t.config,h=t.param,b=m.getUploadContext(t.fileKey);if(!b)return o(0);var C=new XMLHttpRequest,S=c.directUploadAddr+"/".concat(h.bucketName)+"/".concat(encodeURIComponent(h.objectName))+"?uploadContext"+"&context=".concat(b)+"&version=".concat(c.version);C.onreadystatechange=function(){if("abort"!==t.uploadState&&4===C.readyState){var h;try{h=JSON.parse(C.responseText)}catch(t){h={errMsg:"JsonParseError in getOffset",errCode:500}}200===C.status?h.errCode?t.config.onError(new v(h.errMsg,h.errCode)):o(h.offset):C.status.toString().match(/^5/)?e(t,a-1,o):(m.removeFileInfo(t.fileKey),C.status?c.onError(new v("getOffset(".concat(S,") error: ").concat(C.status," ").concat(C.statusText))):c.onError(new v("getOffset(".concat(S,") error. no Error Code"))))}},C.open("get",S),C.setRequestHeader("x-nos-token",h.token),C.timeout=c.getOffsetTimeout,C.send()}},C=function e(t,a,o,c){if("uploading"===t.uploadState){var h=t.param,b=t.config,C=File.prototype.slice,S=void 0!==h.ctx?h.ctx:"",M=a+b.trunkSize>t.file.size,w=M?t.file.size:a+b.trunkSize,I=new XMLHttpRequest,x=b.directUploadAddr+"/".concat(h.bucketName)+"/".concat(encodeURIComponent(h.objectName));if(I.upload.onprogress=function(o){var c=0;o.lengthComputable?(c=(a+o.loaded)/t.file.size,b.onProgress(c)):b.onError(new v("browser does not support query upload progress"))},I.onreadystatechange=function(){if("abort"!==t.uploadState&&4===I.readyState){var h;try{h=JSON.parse(I.responseText)}catch(t){console.error("JsonParseError in uploadTrunk",t),h={errMsg:"JsonParseError in uploadTrunk"}}200===I.status?(t.setContext(h.context),M?(c(),t.setComplete()):e(t,h.offset,b.retryCount,c)):I.status.toString().match(/^5/)?o>0?e(t,a,o-1,c):(m.removeFileInfo(t.fileKey),b.onError(new v(h.errMsg,h.errCode))):I.status?(m.removeFileInfo(t.fileKey),b.onError(new v("uploadTrunk(".concat(x,") error: ").concat(I.status," ").concat(I.statusText)))):(console.log("upload is paused",I),b.onError(new v("uploadTrunk(".concat(x,") error. no Error Code"))))}},I.open("post",x+"?offset=".concat(a)+"&complete=".concat(M)+"&context=".concat(S)+"&version=".concat(b.version)),I.setRequestHeader("x-nos-token",h.token),t.file.type&&I.setRequestHeader("content-type",t.file.type),I.timeout=b.trunkUploadTimeout,"undefined"!=typeof FileReader){var T=new FileReader;T.addEventListener("load",(function(t){var a;(null===(a=null==t?void 0:t.target)||void 0===a?void 0:a.result)?I.send(t.target.result):b.onError(new v("Read ArrayBuffer failed"))})),T.addEventListener("error",(function(t){var a=t.target.error;b.onError(new v("Read ArrayBuffer error. ".concat(a.toString()),a.code))})),T.readAsArrayBuffer(C.call(t.file,a,w))}else I.send(C.call(t.file,a,w))}};function g(t,a){for(var o=0;o<a.length;o++){var c=a[o];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}var S=function(){function e(t,a,o){!function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this.uploadState="paused",this.config=o,this.file=t,this.param=a,this.fileKey=m.initFile(a,t),this.resume()}var t;return(t=[{key:"resume",value:function(){var t=this;if("uploading"!==this.uploadState){this.setUploadState("uploading");var a=this.config;b(this,a.retryCount,(function(o){C(t,o,a.retryCount,(function(){t.setUploadState("ended"),"function"==typeof a.onComplete&&a.onComplete(t.param)}))}))}}},{key:"pause",value:function(){this.setUploadState("paused")}},{key:"abort",value:function(){this.setUploadState("abort"),m.removeFileInfo(this.fileKey)}},{key:"setUploadState",value:function(t){t!==this.uploadState&&(this.uploadState=t)}},{key:"setContext",value:function(t){m.setUploadContext(this.fileKey,t),this.param.ctx=t}},{key:"setComplete",value:function(){m.setComplete(this.fileKey),this.setUploadState("ended")}}])&&g(e.prototype,t),e}(),M={maxFileCache:6,expireTime:864e5,getFileUploadInformation:function(t){var a=m.getFileKey(t),o=m.getFileInfo(a);return null===o?null:Date.now()-o.modifyAt>M.expireTime?(m.removeFileInfo(a),null):{uploadInfo:Object.assign({bucketName:o.bucket,objectName:o.obj,token:o.token,ctx:o.ctx},o.payload?{payload:o.payload}:{}),complete:o.end}},setMaxFileCache:function(t){M.maxFileCache=t},setExpireTime:function(t){M.expireTime=t},printCaches:function(){for(var t=0,a=Object.keys(localStorage);t<a.length;t++){var o=a[t],c=m.getFileInfo(o);c&&console.log(c,"modifiedAt",new Date(c.modifyAt).toTimeString())}},createConfig:function(t){return new o(t)},createTask:function(t,a,o){return new S(t,a,o)}},w=M;return a.default}()})),Ov=createCommonjsModule((function(t,a){t.exports=function(){const t=5e3;function object2String(t){if(t){let a="";return Object.entries(t).forEach((([t,o],c)=>{a+=0===c?"?":"&",a+=`${t}=${o}`})),a}return""}function timeoutPromise(a,o){return new Promise(((c,h)=>{setTimeout((()=>{h({message:"request timeout",params:o})}),a||t)}))}function request(a,o={dataType:"json",method:"GET",timeout:t}){const c="text"===o.dataType?"text/plain; charset=UTF-8":"application/json; charset=UTF-8";let h="GET"===o.method?object2String(o.params):"";return Promise.race([timeoutPromise(o.timeout,{url:a,params:o}),new Promise((function(t,m){if(window.fetch&&"function"==typeof window.fetch)try{let v={method:o.method,headers:Object.assign({"Content-Type":c},o.headers)};"POST"===o.method&&(v.body=JSON.stringify(o.params)),fetch(`${a}${h}`,v).then((a=>{"text"!==o.dataType?a.json().then((o=>{a.data=o,t(a)}),m):a.text().then((o=>{a.data=o,t(a)}),m)}),m)}catch(t){m(t)}else if(window.XMLHttpRequest){const v=new XMLHttpRequest;let b;if(v.onreadystatechange=function(){if(4===v.readyState)if(200===v.status){try{b=JSON.parse(v.response||"{}")}catch(t){b=v.response}t({status:v.status,data:b})}else m(v.status)},v.open(o.method,`${a}${h}`),v.setRequestHeader("Content-Type",c),o.headers)for(let t in o.headers)v.setRequestHeader(t,o.headers[t]);v.send(JSON.stringify(o.params))}else m("request no suppout")}))])}return request}()})),Uv=console;var Bv={setLogger:function setLogger(t){Uv=t},platform:"BROWSER",localStorage:window.localStorage,request:Ov,WebSocket:window.WebSocket,uploadFile:function uploadFile(t){return __awaiter(this,void 0,void 0,Mi.mark((function _callee(){var a,o,c,h,m,v;return Mi.wrap((function _callee$(b){for(;;)switch(b.prev=b.next){case 0:if(t.fileInput||t.file){b.next=2;break}throw new Error("File not exist");case 2:if(!t.file){b.next=6;break}h=t.file,b.next=20;break;case 6:if("string"!=typeof t.fileInput){b.next=15;break}if(!((m=document.getElementById(t.fileInput))&&m.files&&m.files[0])){b.next=12;break}h=m.files[0],b.next=13;break;case 12:throw new Error("Can not get file from fileInput");case 13:b.next=20;break;case 15:if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0])){b.next=19;break}h=t.fileInput.files[0],b.next=20;break;case 19:throw new Error("Can not get file from fileInput "+t.fileInput);case 20:if(!(t.maxSize&&h.size>t.maxSize)){b.next=22;break}throw new Error("The file exceeds maxSize limit. maxSize: "+t.maxSize+", get "+h.size);case 22:return b.next=24,new li((function(a,o){var c=Av.createConfig({directUploadAddr:t.chunkUploadHost,onError:function onError(t){o(t)},onProgress:t.onUploadProgress||function(){},onComplete:function onComplete(t){a(t)}}),m=Av.createTask(h,{bucketName:t.nosToken.bucket,objectName:decodeURIComponent(t.nosToken.objectName),token:t.nosToken.token},c);try{t.onUploadStart&&t.onUploadStart(m)}catch(t){Uv.error("Adapter uploadFile: options.onUploadStart error",t&&t.message),m.abort(),o(t)}}));case 24:return(v=b.sent).name=h.name,v.size=h.size,v.type=h.type,v.ext=lastIndexOf(a=v.name).call(a,".")>-1?slice(o=v.name).call(o,lastIndexOf(c=v.name).call(c,".")+1).toLowerCase():"",b.abrupt("return",v);case 30:case"end":return b.stop()}}),_callee)})))},getSystemInfo:function getSystemInfo(){var t,a;return{os:(null===(t=Pv.os)||void 0===t?void 0:t.family)||"",osVer:(null===(a=Pv.os)||void 0===a?void 0:a.version)||"",browser:Pv.name||"",browserVer:Pv.version||"",hostEnv:"BROWSER",hostEnvVer:Pv.version||"",hostInfo:Pv.ua||""}}};return wv.setAdapters(Bv),wv}));
