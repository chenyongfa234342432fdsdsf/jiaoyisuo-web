import {
  require_classnames
} from "./chunk-XBGPNVLT.js";
import {
  DeptChartSpecieEnum,
  KLineChartType,
  LanguageMapToChartMap,
  ThemeChartMap,
  ThemeEnum,
  TimeSharingType,
  WSThrottleTypeEnum,
  bollKList,
  calBoll,
  calKdj,
  calRsi,
  calWr,
  calcAmp,
  calcChg,
  calculateMACD,
  calculateSMA,
  checkIsUp,
  getCurrentQuoteShowCoin,
  getTheme,
  kdjKList,
  macdKList,
  showFormatTime,
  sortMarketChartData,
  timeLocaleLanguageMap,
  tradingviewTimeMap
} from "./chunk-SUTN43BH.js";
import {
  Modal_default,
  Table_default
} from "./chunk-VWAY4QVL.js";
import "./chunk-IY7EZ45M.js";
import "./chunk-QRK43GPU.js";
import "./chunk-BRTPICOV.js";
import "./chunk-KI37M25S.js";
import "./chunk-ZBJW5EFD.js";
import "./chunk-25RUTWTP.js";
import "./chunk-AUXHN7BJ.js";
import "./chunk-B6E3ESBA.js";
import "./chunk-SH6LTHZR.js";
import "./chunk-6V4FIFQQ.js";
import "./chunk-IOFESWT4.js";
import "./chunk-LKNNICOI.js";
import {
  require_react
} from "./chunk-XRNU55GO.js";
import "./chunk-3ULZP7K6.js";
import "./chunk-KYMHZKVH.js";
import {
  require_dayjs_min
} from "./chunk-VLVJFOHA.js";
import {
  __toESM
} from "./chunk-S5KM4IGW.js";

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/k-line/k-line-chart.tsx
var import_dayjs = __toESM(require_dayjs_min());

// node_modules/.pnpm/fancy-canvas@2.1.0/node_modules/fancy-canvas/size.mjs
function size(_a) {
  var width = _a.width, height = _a.height;
  if (width < 0) {
    throw new Error("Negative width is not allowed for Size");
  }
  if (height < 0) {
    throw new Error("Negative height is not allowed for Size");
  }
  return {
    width,
    height
  };
}
function equalSizes(first, second) {
  return first.width === second.width && first.height === second.height;
}

// node_modules/.pnpm/fancy-canvas@2.1.0/node_modules/fancy-canvas/device-pixel-ratio.mjs
var Observable = function() {
  function Observable2(win) {
    var _this = this;
    this._resolutionListener = function() {
      return _this._onResolutionChanged();
    };
    this._resolutionMediaQueryList = null;
    this._observers = [];
    this._window = win;
    this._installResolutionListener();
  }
  Observable2.prototype.dispose = function() {
    this._uninstallResolutionListener();
    this._window = null;
  };
  Object.defineProperty(Observable2.prototype, "value", {
    get: function() {
      return this._window.devicePixelRatio;
    },
    enumerable: false,
    configurable: true
  });
  Observable2.prototype.subscribe = function(next) {
    var _this = this;
    var observer = { next };
    this._observers.push(observer);
    return {
      unsubscribe: function() {
        _this._observers = _this._observers.filter(function(o3) {
          return o3 !== observer;
        });
      }
    };
  };
  Observable2.prototype._installResolutionListener = function() {
    if (this._resolutionMediaQueryList !== null) {
      throw new Error("Resolution listener is already installed");
    }
    var dppx = this._window.devicePixelRatio;
    this._resolutionMediaQueryList = this._window.matchMedia("all and (resolution: ".concat(dppx, "dppx)"));
    this._resolutionMediaQueryList.addListener(this._resolutionListener);
  };
  Observable2.prototype._uninstallResolutionListener = function() {
    if (this._resolutionMediaQueryList !== null) {
      this._resolutionMediaQueryList.removeListener(this._resolutionListener);
      this._resolutionMediaQueryList = null;
    }
  };
  Observable2.prototype._reinstallResolutionListener = function() {
    this._uninstallResolutionListener();
    this._installResolutionListener();
  };
  Observable2.prototype._onResolutionChanged = function() {
    var _this = this;
    this._observers.forEach(function(observer) {
      return observer.next(_this._window.devicePixelRatio);
    });
    this._reinstallResolutionListener();
  };
  return Observable2;
}();
function createObservable(win) {
  return new Observable(win);
}

// node_modules/.pnpm/fancy-canvas@2.1.0/node_modules/fancy-canvas/canvas-element-bitmap-size.mjs
var DevicePixelContentBoxBinding = function() {
  function DevicePixelContentBoxBinding2(canvasElement, transformBitmapSize, options) {
    var _a;
    this._canvasElement = null;
    this._bitmapSizeChangedListeners = [];
    this._suggestedBitmapSize = null;
    this._suggestedBitmapSizeChangedListeners = [];
    this._devicePixelRatioObservable = null;
    this._canvasElementResizeObserver = null;
    this._canvasElement = canvasElement;
    this._canvasElementClientSize = size({
      width: this._canvasElement.clientWidth,
      height: this._canvasElement.clientHeight
    });
    this._transformBitmapSize = transformBitmapSize !== null && transformBitmapSize !== void 0 ? transformBitmapSize : function(size2) {
      return size2;
    };
    this._allowResizeObserver = (_a = options === null || options === void 0 ? void 0 : options.allowResizeObserver) !== null && _a !== void 0 ? _a : true;
    this._chooseAndInitObserver();
  }
  DevicePixelContentBoxBinding2.prototype.dispose = function() {
    var _a, _b;
    if (this._canvasElement === null) {
      throw new Error("Object is disposed");
    }
    (_a = this._canvasElementResizeObserver) === null || _a === void 0 ? void 0 : _a.disconnect();
    this._canvasElementResizeObserver = null;
    (_b = this._devicePixelRatioObservable) === null || _b === void 0 ? void 0 : _b.dispose();
    this._devicePixelRatioObservable = null;
    this._suggestedBitmapSizeChangedListeners.length = 0;
    this._bitmapSizeChangedListeners.length = 0;
    this._canvasElement = null;
  };
  Object.defineProperty(DevicePixelContentBoxBinding2.prototype, "canvasElement", {
    get: function() {
      if (this._canvasElement === null) {
        throw new Error("Object is disposed");
      }
      return this._canvasElement;
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(DevicePixelContentBoxBinding2.prototype, "canvasElementClientSize", {
    get: function() {
      return this._canvasElementClientSize;
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(DevicePixelContentBoxBinding2.prototype, "bitmapSize", {
    get: function() {
      return size({
        width: this.canvasElement.width,
        height: this.canvasElement.height
      });
    },
    enumerable: false,
    configurable: true
  });
  DevicePixelContentBoxBinding2.prototype.resizeCanvasElement = function(clientSize) {
    this._canvasElementClientSize = size(clientSize);
    this.canvasElement.style.width = "".concat(this._canvasElementClientSize.width, "px");
    this.canvasElement.style.height = "".concat(this._canvasElementClientSize.height, "px");
    this._invalidateBitmapSize();
  };
  DevicePixelContentBoxBinding2.prototype.subscribeBitmapSizeChanged = function(listener) {
    this._bitmapSizeChangedListeners.push(listener);
  };
  DevicePixelContentBoxBinding2.prototype.unsubscribeBitmapSizeChanged = function(listener) {
    this._bitmapSizeChangedListeners = this._bitmapSizeChangedListeners.filter(function(l2) {
      return l2 !== listener;
    });
  };
  Object.defineProperty(DevicePixelContentBoxBinding2.prototype, "suggestedBitmapSize", {
    get: function() {
      return this._suggestedBitmapSize;
    },
    enumerable: false,
    configurable: true
  });
  DevicePixelContentBoxBinding2.prototype.subscribeSuggestedBitmapSizeChanged = function(listener) {
    this._suggestedBitmapSizeChangedListeners.push(listener);
  };
  DevicePixelContentBoxBinding2.prototype.unsubscribeSuggestedBitmapSizeChanged = function(listener) {
    this._suggestedBitmapSizeChangedListeners = this._suggestedBitmapSizeChangedListeners.filter(function(l2) {
      return l2 !== listener;
    });
  };
  DevicePixelContentBoxBinding2.prototype.applySuggestedBitmapSize = function() {
    if (this._suggestedBitmapSize === null) {
      return;
    }
    var oldSuggestedSize = this._suggestedBitmapSize;
    this._suggestedBitmapSize = null;
    this._resizeBitmap(oldSuggestedSize);
    this._emitSuggestedBitmapSizeChanged(oldSuggestedSize, this._suggestedBitmapSize);
  };
  DevicePixelContentBoxBinding2.prototype._resizeBitmap = function(newSize) {
    var oldSize = this.bitmapSize;
    if (equalSizes(oldSize, newSize)) {
      return;
    }
    this.canvasElement.width = newSize.width;
    this.canvasElement.height = newSize.height;
    this._emitBitmapSizeChanged(oldSize, newSize);
  };
  DevicePixelContentBoxBinding2.prototype._emitBitmapSizeChanged = function(oldSize, newSize) {
    var _this = this;
    this._bitmapSizeChangedListeners.forEach(function(listener) {
      return listener.call(_this, oldSize, newSize);
    });
  };
  DevicePixelContentBoxBinding2.prototype._suggestNewBitmapSize = function(newSize) {
    var oldSuggestedSize = this._suggestedBitmapSize;
    var finalNewSize = size(this._transformBitmapSize(newSize, this._canvasElementClientSize));
    var newSuggestedSize = equalSizes(this.bitmapSize, finalNewSize) ? null : finalNewSize;
    if (oldSuggestedSize === null && newSuggestedSize === null) {
      return;
    }
    if (oldSuggestedSize !== null && newSuggestedSize !== null && equalSizes(oldSuggestedSize, newSuggestedSize)) {
      return;
    }
    this._suggestedBitmapSize = newSuggestedSize;
    this._emitSuggestedBitmapSizeChanged(oldSuggestedSize, newSuggestedSize);
  };
  DevicePixelContentBoxBinding2.prototype._emitSuggestedBitmapSizeChanged = function(oldSize, newSize) {
    var _this = this;
    this._suggestedBitmapSizeChangedListeners.forEach(function(listener) {
      return listener.call(_this, oldSize, newSize);
    });
  };
  DevicePixelContentBoxBinding2.prototype._chooseAndInitObserver = function() {
    var _this = this;
    if (!this._allowResizeObserver) {
      this._initDevicePixelRatioObservable();
      return;
    }
    isDevicePixelContentBoxSupported().then(function(isSupported) {
      return isSupported ? _this._initResizeObserver() : _this._initDevicePixelRatioObservable();
    });
  };
  DevicePixelContentBoxBinding2.prototype._initDevicePixelRatioObservable = function() {
    var _this = this;
    if (this._canvasElement === null) {
      return;
    }
    var win = canvasElementWindow(this._canvasElement);
    if (win === null) {
      throw new Error("No window is associated with the canvas");
    }
    this._devicePixelRatioObservable = createObservable(win);
    this._devicePixelRatioObservable.subscribe(function() {
      return _this._invalidateBitmapSize();
    });
    this._invalidateBitmapSize();
  };
  DevicePixelContentBoxBinding2.prototype._invalidateBitmapSize = function() {
    var _a, _b;
    if (this._canvasElement === null) {
      return;
    }
    var win = canvasElementWindow(this._canvasElement);
    if (win === null) {
      return;
    }
    var ratio = (_b = (_a = this._devicePixelRatioObservable) === null || _a === void 0 ? void 0 : _a.value) !== null && _b !== void 0 ? _b : win.devicePixelRatio;
    var canvasRects = this._canvasElement.getClientRects();
    var newSize = canvasRects[0] !== void 0 ? predictedBitmapSize(canvasRects[0], ratio) : size({
      width: this._canvasElementClientSize.width * ratio,
      height: this._canvasElementClientSize.height * ratio
    });
    this._suggestNewBitmapSize(newSize);
  };
  DevicePixelContentBoxBinding2.prototype._initResizeObserver = function() {
    var _this = this;
    if (this._canvasElement === null) {
      return;
    }
    this._canvasElementResizeObserver = new ResizeObserver(function(entries) {
      var entry = entries.find(function(entry2) {
        return entry2.target === _this._canvasElement;
      });
      if (!entry || !entry.devicePixelContentBoxSize || !entry.devicePixelContentBoxSize[0]) {
        return;
      }
      var entrySize = entry.devicePixelContentBoxSize[0];
      var newSize = size({
        width: entrySize.inlineSize,
        height: entrySize.blockSize
      });
      _this._suggestNewBitmapSize(newSize);
    });
    this._canvasElementResizeObserver.observe(this._canvasElement, { box: "device-pixel-content-box" });
  };
  return DevicePixelContentBoxBinding2;
}();
function bindTo(canvasElement, target) {
  if (target.type === "device-pixel-content-box") {
    return new DevicePixelContentBoxBinding(canvasElement, target.transform, target.options);
  }
  throw new Error("Unsupported binding target");
}
function canvasElementWindow(canvasElement) {
  return canvasElement.ownerDocument.defaultView;
}
function isDevicePixelContentBoxSupported() {
  return new Promise(function(resolve) {
    var ro = new ResizeObserver(function(entries) {
      resolve(entries.every(function(entry) {
        return "devicePixelContentBoxSize" in entry;
      }));
      ro.disconnect();
    });
    ro.observe(document.body, { box: "device-pixel-content-box" });
  }).catch(function() {
    return false;
  });
}
function predictedBitmapSize(canvasRect, ratio) {
  return size({
    width: Math.round(canvasRect.left * ratio + canvasRect.width * ratio) - Math.round(canvasRect.left * ratio),
    height: Math.round(canvasRect.top * ratio + canvasRect.height * ratio) - Math.round(canvasRect.top * ratio)
  });
}

// node_modules/.pnpm/fancy-canvas@2.1.0/node_modules/fancy-canvas/canvas-rendering-target.mjs
var CanvasRenderingTarget2D = function() {
  function CanvasRenderingTarget2D2(context, mediaSize, bitmapSize) {
    if (mediaSize.width === 0 || mediaSize.height === 0) {
      throw new TypeError("Rendering target could only be created on a media with positive width and height");
    }
    this._mediaSize = mediaSize;
    if (bitmapSize.width === 0 || bitmapSize.height === 0) {
      throw new TypeError("Rendering target could only be created using a bitmap with positive integer width and height");
    }
    this._bitmapSize = bitmapSize;
    this._context = context;
  }
  CanvasRenderingTarget2D2.prototype.useMediaCoordinateSpace = function(f2) {
    try {
      this._context.save();
      this._context.setTransform(1, 0, 0, 1, 0, 0);
      this._context.scale(this._horizontalPixelRatio, this._verticalPixelRatio);
      return f2({
        context: this._context,
        mediaSize: this._mediaSize
      });
    } finally {
      this._context.restore();
    }
  };
  CanvasRenderingTarget2D2.prototype.useBitmapCoordinateSpace = function(f2) {
    try {
      this._context.save();
      this._context.setTransform(1, 0, 0, 1, 0, 0);
      return f2({
        context: this._context,
        mediaSize: this._mediaSize,
        bitmapSize: this._bitmapSize,
        horizontalPixelRatio: this._horizontalPixelRatio,
        verticalPixelRatio: this._verticalPixelRatio
      });
    } finally {
      this._context.restore();
    }
  };
  Object.defineProperty(CanvasRenderingTarget2D2.prototype, "_horizontalPixelRatio", {
    get: function() {
      return this._bitmapSize.width / this._mediaSize.width;
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(CanvasRenderingTarget2D2.prototype, "_verticalPixelRatio", {
    get: function() {
      return this._bitmapSize.height / this._mediaSize.height;
    },
    enumerable: false,
    configurable: true
  });
  return CanvasRenderingTarget2D2;
}();
function tryCreateCanvasRenderingTarget2D(binding, contextOptions) {
  var mediaSize = binding.canvasElementClientSize;
  if (mediaSize.width === 0 || mediaSize.height === 0) {
    return null;
  }
  var bitmapSize = binding.bitmapSize;
  if (bitmapSize.width === 0 || bitmapSize.height === 0) {
    return null;
  }
  var context = binding.canvasElement.getContext("2d", contextOptions);
  if (context === null) {
    return null;
  }
  return new CanvasRenderingTarget2D(context, mediaSize, bitmapSize);
}

// node_modules/.pnpm/@nbit+lightweight-charts@0.0.11/node_modules/@nbit/lightweight-charts/dist/lightweight-charts.production.mjs
var e = { upColor: "#26a69a", downColor: "#ef5350", wickVisible: true, borderVisible: true, borderColor: "#378658", borderUpColor: "#26a69a", borderDownColor: "#ef5350", wickColor: "#737375", wickUpColor: "#26a69a", wickDownColor: "#ef5350" };
var r = { upColor: "#26a69a", downColor: "#ef5350", openVisible: true, thinBars: true };
var h = { color: "#2196f3", lineStyle: 0, lineWidth: 3, lineType: 0, lineVisible: true, crosshairMarkerVisible: true, crosshairMarkerRadius: 4, crosshairMarkerBorderColor: "", crosshairMarkerBorderWidth: 2, crosshairMarkerBackgroundColor: "", lastPriceAnimation: 0, pointMarkersVisible: false };
var l = { topColor: "rgba( 46, 220, 135, 0.4)", bottomColor: "rgba( 40, 221, 100, 0)", invertFilledArea: false, lineColor: "#33D778", lineStyle: 0, lineWidth: 3, lineType: 0, lineVisible: true, crosshairMarkerVisible: true, crosshairMarkerRadius: 4, crosshairMarkerBorderColor: "", crosshairMarkerBorderWidth: 2, crosshairMarkerBackgroundColor: "", lastPriceAnimation: 0, pointMarkersVisible: false };
var a = { baseValue: { type: "price", price: 0 }, topFillColor1: "rgba(38, 166, 154, 0.28)", topFillColor2: "rgba(38, 166, 154, 0.05)", topLineColor: "rgba(38, 166, 154, 1)", bottomFillColor1: "rgba(239, 83, 80, 0.05)", bottomFillColor2: "rgba(239, 83, 80, 0.28)", bottomLineColor: "rgba(239, 83, 80, 1)", lineWidth: 3, lineStyle: 0, lineType: 0, lineVisible: true, crosshairMarkerVisible: true, crosshairMarkerRadius: 4, crosshairMarkerBorderColor: "", crosshairMarkerBorderWidth: 2, crosshairMarkerBackgroundColor: "", lastPriceAnimation: 0, pointMarkersVisible: false };
var o = { color: "#26a69a", base: 0 };
var _ = { color: "#2196f3" };
var u = { title: "", visible: true, lastValueVisible: true, priceLineVisible: true, priceLineSource: 0, priceLineWidth: 1, priceLineColor: "", priceLineStyle: 2, baseLineVisible: true, baseLineWidth: 1, baseLineColor: "#B2B5BE", baseLineStyle: 0, priceFormat: { type: "price", precision: 2, minMove: 0.01 } };
var c;
var d;
function f(t2, i2) {
  const n2 = { 0: [], 1: [t2.lineWidth, t2.lineWidth], 2: [2 * t2.lineWidth, 2 * t2.lineWidth], 3: [6 * t2.lineWidth, 6 * t2.lineWidth], 4: [t2.lineWidth, 4 * t2.lineWidth] }[i2];
  t2.setLineDash(n2);
}
function v(t2, i2, n2, s) {
  t2.beginPath();
  const e3 = t2.lineWidth % 2 ? 0.5 : 0;
  t2.moveTo(n2, i2 + e3), t2.lineTo(s, i2 + e3), t2.stroke();
}
function p(t2, i2) {
  if (!t2)
    throw new Error("Assertion failed" + (i2 ? ": " + i2 : ""));
}
function m(t2) {
  if (void 0 === t2)
    throw new Error("Value is undefined");
  return t2;
}
function b(t2) {
  if (null === t2)
    throw new Error("Value is null");
  return t2;
}
function w(t2) {
  return b(m(t2));
}
!function(t2) {
  t2[t2.Simple = 0] = "Simple", t2[t2.WithSteps = 1] = "WithSteps", t2[t2.Curved = 2] = "Curved";
}(c || (c = {})), function(t2) {
  t2[t2.Solid = 0] = "Solid", t2[t2.Dotted = 1] = "Dotted", t2[t2.Dashed = 2] = "Dashed", t2[t2.LargeDashed = 3] = "LargeDashed", t2[t2.SparseDotted = 4] = "SparseDotted";
}(d || (d = {}));
var g = { khaki: "#f0e68c", azure: "#f0ffff", aliceblue: "#f0f8ff", ghostwhite: "#f8f8ff", gold: "#ffd700", goldenrod: "#daa520", gainsboro: "#dcdcdc", gray: "#808080", green: "#008000", honeydew: "#f0fff0", floralwhite: "#fffaf0", lightblue: "#add8e6", lightcoral: "#f08080", lemonchiffon: "#fffacd", hotpink: "#ff69b4", lightyellow: "#ffffe0", greenyellow: "#adff2f", lightgoldenrodyellow: "#fafad2", limegreen: "#32cd32", linen: "#faf0e6", lightcyan: "#e0ffff", magenta: "#f0f", maroon: "#800000", olive: "#808000", orange: "#ffa500", oldlace: "#fdf5e6", mediumblue: "#0000cd", transparent: "#0000", lime: "#0f0", lightpink: "#ffb6c1", mistyrose: "#ffe4e1", moccasin: "#ffe4b5", midnightblue: "#191970", orchid: "#da70d6", mediumorchid: "#ba55d3", mediumturquoise: "#48d1cc", orangered: "#ff4500", royalblue: "#4169e1", powderblue: "#b0e0e6", red: "#f00", coral: "#ff7f50", turquoise: "#40e0d0", white: "#fff", whitesmoke: "#f5f5f5", wheat: "#f5deb3", teal: "#008080", steelblue: "#4682b4", bisque: "#ffe4c4", aquamarine: "#7fffd4", aqua: "#0ff", sienna: "#a0522d", silver: "#c0c0c0", springgreen: "#00ff7f", antiquewhite: "#faebd7", burlywood: "#deb887", brown: "#a52a2a", beige: "#f5f5dc", chocolate: "#d2691e", chartreuse: "#7fff00", cornflowerblue: "#6495ed", cornsilk: "#fff8dc", crimson: "#dc143c", cadetblue: "#5f9ea0", tomato: "#ff6347", fuchsia: "#f0f", blue: "#00f", salmon: "#fa8072", blanchedalmond: "#ffebcd", slateblue: "#6a5acd", slategray: "#708090", thistle: "#d8bfd8", tan: "#d2b48c", cyan: "#0ff", darkblue: "#00008b", darkcyan: "#008b8b", darkgoldenrod: "#b8860b", darkgray: "#a9a9a9", blueviolet: "#8a2be2", black: "#000", darkmagenta: "#8b008b", darkslateblue: "#483d8b", darkkhaki: "#bdb76b", darkorchid: "#9932cc", darkorange: "#ff8c00", darkgreen: "#006400", darkred: "#8b0000", dodgerblue: "#1e90ff", darkslategray: "#2f4f4f", dimgray: "#696969", deepskyblue: "#00bfff", firebrick: "#b22222", forestgreen: "#228b22", indigo: "#4b0082", ivory: "#fffff0", lavenderblush: "#fff0f5", feldspar: "#d19275", indianred: "#cd5c5c", lightgreen: "#90ee90", lightgrey: "#d3d3d3", lightskyblue: "#87cefa", lightslategray: "#789", lightslateblue: "#8470ff", snow: "#fffafa", lightseagreen: "#20b2aa", lightsalmon: "#ffa07a", darksalmon: "#e9967a", darkviolet: "#9400d3", mediumpurple: "#9370d8", mediumaquamarine: "#66cdaa", skyblue: "#87ceeb", lavender: "#e6e6fa", lightsteelblue: "#b0c4de", mediumvioletred: "#c71585", mintcream: "#f5fffa", navajowhite: "#ffdead", navy: "#000080", olivedrab: "#6b8e23", palevioletred: "#d87093", violetred: "#d02090", yellow: "#ff0", yellowgreen: "#9acd32", lawngreen: "#7cfc00", pink: "#ffc0cb", paleturquoise: "#afeeee", palegoldenrod: "#eee8aa", darkolivegreen: "#556b2f", darkseagreen: "#8fbc8f", darkturquoise: "#00ced1", peachpuff: "#ffdab9", deeppink: "#ff1493", violet: "#ee82ee", palegreen: "#98fb98", mediumseagreen: "#3cb371", peru: "#cd853f", saddlebrown: "#8b4513", sandybrown: "#f4a460", rosybrown: "#bc8f8f", purple: "#800080", seagreen: "#2e8b57", seashell: "#fff5ee", papayawhip: "#ffefd5", mediumslateblue: "#7b68ee", plum: "#dda0dd", mediumspringgreen: "#00fa9a" };
function M(t2) {
  return t2 < 0 ? 0 : t2 > 255 ? 255 : Math.round(t2) || 0;
}
function x(t2) {
  return t2 <= 0 || t2 > 0 ? t2 < 0 ? 0 : t2 > 1 ? 1 : Math.round(1e4 * t2) / 1e4 : 0;
}
var S = /^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i;
var k = /^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;
var y = /^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/;
var C = /^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;
function T(t2) {
  (t2 = t2.toLowerCase()) in g && (t2 = g[t2]);
  {
    const i2 = C.exec(t2) || y.exec(t2);
    if (i2)
      return [M(parseInt(i2[1], 10)), M(parseInt(i2[2], 10)), M(parseInt(i2[3], 10)), x(i2.length < 5 ? 1 : parseFloat(i2[4]))];
  }
  {
    const i2 = k.exec(t2);
    if (i2)
      return [M(parseInt(i2[1], 16)), M(parseInt(i2[2], 16)), M(parseInt(i2[3], 16)), 1];
  }
  {
    const i2 = S.exec(t2);
    if (i2)
      return [M(17 * parseInt(i2[1], 16)), M(17 * parseInt(i2[2], 16)), M(17 * parseInt(i2[3], 16)), 1];
  }
  throw new Error(`Cannot parse color: ${t2}`);
}
function P(t2) {
  const i2 = T(t2);
  return { t: `rgb(${i2[0]}, ${i2[1]}, ${i2[2]})`, i: (n2 = i2, 0.199 * n2[0] + 0.687 * n2[1] + 0.114 * n2[2] > 160 ? "black" : "white") };
  var n2;
}
var R = class {
  constructor() {
    this.h = [];
  }
  l(t2, i2, n2) {
    const s = { o: t2, _: i2, u: true === n2 };
    this.h.push(s);
  }
  v(t2) {
    const i2 = this.h.findIndex((i3) => t2 === i3.o);
    i2 > -1 && this.h.splice(i2, 1);
  }
  p(t2) {
    this.h = this.h.filter((i2) => i2._ !== t2);
  }
  m(t2, i2, n2) {
    const s = [...this.h];
    this.h = this.h.filter((t3) => !t3.u), s.forEach((s2) => s2.o(t2, i2, n2));
  }
  M() {
    return this.h.length > 0;
  }
  S() {
    this.h = [];
  }
};
function D(t2, ...i2) {
  for (const n2 of i2)
    for (const i3 in n2)
      void 0 !== n2[i3] && ("object" != typeof n2[i3] || void 0 === t2[i3] || Array.isArray(n2[i3]) ? t2[i3] = n2[i3] : D(t2[i3], n2[i3]));
  return t2;
}
function O(t2) {
  return "number" == typeof t2 && isFinite(t2);
}
function A(t2) {
  return "number" == typeof t2 && t2 % 1 == 0;
}
function V(t2) {
  return "string" == typeof t2;
}
function B(t2) {
  return "boolean" == typeof t2;
}
function I(t2) {
  const i2 = t2;
  if (!i2 || "object" != typeof i2)
    return i2;
  let n2, s, e3;
  for (s in n2 = Array.isArray(i2) ? [] : {}, i2)
    i2.hasOwnProperty(s) && (e3 = i2[s], n2[s] = e3 && "object" == typeof e3 ? I(e3) : e3);
  return n2;
}
function z(t2) {
  return null !== t2;
}
function E(t2) {
  return null === t2 ? void 0 : t2;
}
var L = "-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif";
function N(t2, i2, n2) {
  return void 0 === i2 && (i2 = L), `${n2 = void 0 !== n2 ? `${n2} ` : ""}${t2}px ${i2}`;
}
var F = class {
  constructor(t2) {
    this.k = { C: 1, T: 5, P: NaN, R: "", D: "", O: "", A: "", V: 0, B: 0, I: 0, L: 0, N: 0 }, this.F = t2;
  }
  W() {
    const t2 = this.k, i2 = this.j(), n2 = this.H();
    return t2.P === i2 && t2.D === n2 || (t2.P = i2, t2.D = n2, t2.R = N(i2, n2), t2.L = 2.5 / 12 * i2, t2.V = t2.L, t2.B = i2 / 12 * t2.T, t2.I = i2 / 12 * t2.T, t2.N = 0), t2.O = this.$(), t2.A = this.U(), this.k;
  }
  $() {
    return this.F.W().layout.textColor;
  }
  U() {
    return this.F.q();
  }
  j() {
    return this.F.W().layout.fontSize;
  }
  H() {
    return this.F.W().layout.fontFamily;
  }
};
var W = class {
  constructor() {
    this.Y = [];
  }
  X(t2) {
    this.Y = t2;
  }
  K(t2, i2, n2) {
    this.Y.forEach((s) => {
      s.K(t2, i2, n2);
    });
  }
};
var j = class {
  K(t2, i2, n2) {
    t2.useMediaCoordinateSpace((t3) => this.Z(t3, i2, n2));
  }
  G(t2, i2, n2) {
    t2.useMediaCoordinateSpace((t3) => this.J(t3, i2, n2));
  }
  J(t2, i2, n2) {
  }
};
var H = class extends j {
  constructor() {
    super(...arguments), this.tt = null;
  }
  it(t2) {
    this.tt = t2;
  }
  Z({ context: t2 }) {
    if (null === this.tt || null === this.tt.nt)
      return;
    const i2 = this.tt.nt, n2 = this.tt, s = (s2) => {
      t2.beginPath();
      for (let e3 = i2.to - 1; e3 >= i2.from; --e3) {
        const i3 = n2.st[e3];
        t2.moveTo(i3.et, i3.rt), t2.arc(i3.et, i3.rt, s2, 0, 2 * Math.PI);
      }
      t2.fill();
    };
    n2.ht > 0 && (t2.fillStyle = n2.lt, s(n2.ot + n2.ht)), t2.fillStyle = n2._t, s(n2.ot);
  }
};
function $() {
  return { st: [{ et: 0, rt: 0, ut: 0, ct: 0 }], _t: "", lt: "", ot: 0, ht: 0, nt: null };
}
var U = { from: 0, to: 1 };
var q = class {
  constructor(t2, i2) {
    this.dt = new W(), this.ft = [], this.vt = [], this.bt = true, this.F = t2, this.wt = i2, this.dt.X(this.ft);
  }
  gt(t2) {
    const i2 = this.F.Mt();
    i2.length !== this.ft.length && (this.vt = i2.map($), this.ft = this.vt.map((t3) => {
      const i3 = new H();
      return i3.it(t3), i3;
    }), this.dt.X(this.ft)), this.bt = true;
  }
  xt() {
    return this.bt && (this.St(), this.bt = false), this.dt;
  }
  St() {
    const t2 = 2 === this.wt.W().mode, i2 = this.F.Mt(), n2 = this.wt.kt(), s = this.F.yt();
    i2.forEach((i3, e3) => {
      var r2;
      const h2 = this.vt[e3], l2 = i3.Ct(n2);
      if (t2 || null === l2 || !i3.Tt())
        return void (h2.nt = null);
      const a2 = b(i3.Pt());
      h2._t = l2.Rt, h2.ot = l2.ot, h2.ht = l2.Dt, h2.st[0].ct = l2.ct, h2.st[0].rt = i3.At().Ot(l2.ct, a2.Vt), h2.lt = null !== (r2 = l2.Bt) && void 0 !== r2 ? r2 : this.F.It(h2.st[0].rt / i3.At().zt()), h2.st[0].ut = n2, h2.st[0].et = s.Et(n2), h2.nt = U;
    });
  }
};
var Y = class {
  K(t2, i2, n2) {
    t2.useBitmapCoordinateSpace((t3) => this.Z(t3, i2, n2));
  }
};
var X = class extends Y {
  constructor(t2) {
    super(), this.Lt = t2;
  }
  Z({ context: t2, bitmapSize: i2, horizontalPixelRatio: n2, verticalPixelRatio: s }) {
    if (null === this.Lt)
      return;
    const e3 = this.Lt.Nt.Tt, r2 = this.Lt.Ft.Tt;
    if (!e3 && !r2)
      return;
    const h2 = Math.round(this.Lt.et * n2), l2 = Math.round(this.Lt.rt * s);
    t2.lineCap = "butt", e3 && h2 >= 0 && (t2.lineWidth = Math.floor(this.Lt.Nt.ht * n2), t2.strokeStyle = this.Lt.Nt.O, t2.fillStyle = this.Lt.Nt.O, f(t2, this.Lt.Nt.Wt), function(t3, i3, n3, s2) {
      t3.beginPath();
      const e4 = t3.lineWidth % 2 ? 0.5 : 0;
      t3.moveTo(i3 + e4, n3), t3.lineTo(i3 + e4, s2), t3.stroke();
    }(t2, h2, 0, i2.height)), r2 && l2 >= 0 && (t2.lineWidth = Math.floor(this.Lt.Ft.ht * s), t2.strokeStyle = this.Lt.Ft.O, t2.fillStyle = this.Lt.Ft.O, f(t2, this.Lt.Ft.Wt), v(t2, l2, 0, i2.width));
  }
};
var K = class {
  constructor(t2) {
    this.bt = true, this.jt = { Nt: { ht: 1, Wt: 0, O: "", Tt: false }, Ft: { ht: 1, Wt: 0, O: "", Tt: false }, et: 0, rt: 0 }, this.Ht = new X(this.jt), this.$t = t2;
  }
  gt() {
    this.bt = true;
  }
  xt() {
    return this.bt && (this.St(), this.bt = false), this.Ht;
  }
  St() {
    const t2 = this.$t.Tt(), i2 = b(this.$t.Ut()), n2 = i2.qt().W().crosshair, s = this.jt;
    if (2 === n2.mode)
      return s.Ft.Tt = false, void (s.Nt.Tt = false);
    s.Ft.Tt = t2 && this.$t.Yt(i2), s.Nt.Tt = t2 && this.$t.Xt(), s.Ft.ht = n2.horzLine.width, s.Ft.Wt = n2.horzLine.style, s.Ft.O = n2.horzLine.color, s.Nt.ht = n2.vertLine.width, s.Nt.Wt = n2.vertLine.style, s.Nt.O = n2.vertLine.color, s.et = this.$t.Kt(), s.rt = this.$t.Zt();
  }
};
function Z(t2, i2, n2, s, e3, r2) {
  t2.fillRect(i2 + r2, n2, s - 2 * r2, r2), t2.fillRect(i2 + r2, n2 + e3 - r2, s - 2 * r2, r2), t2.fillRect(i2, n2, r2, e3), t2.fillRect(i2 + s - r2, n2, r2, e3);
}
function G(t2, i2, n2, s, e3, r2) {
  t2.save(), t2.globalCompositeOperation = "copy", t2.fillStyle = r2, t2.fillRect(i2, n2, s, e3), t2.restore();
}
function J(t2, i2) {
  return t2.map((t3) => 0 === t3 ? t3 : t3 + i2);
}
function Q(t2, i2, n2, s, e3, r2) {
  t2.beginPath(), t2.lineTo(i2 + s - r2[1], n2), 0 !== r2[1] && t2.arcTo(i2 + s, n2, i2 + s, n2 + r2[1], r2[1]), t2.lineTo(i2 + s, n2 + e3 - r2[2]), 0 !== r2[2] && t2.arcTo(i2 + s, n2 + e3, i2 + s - r2[2], n2 + e3, r2[2]), t2.lineTo(i2 + r2[3], n2 + e3), 0 !== r2[3] && t2.arcTo(i2, n2 + e3, i2, n2 + e3 - r2[3], r2[3]), t2.lineTo(i2, n2 + r2[0]), 0 !== r2[0] && t2.arcTo(i2, n2, i2 + r2[0], n2, r2[0]);
}
function tt(t2, i2, n2, s, e3, r2, h2 = 0, l2 = [0, 0, 0, 0], a2 = "") {
  if (t2.save(), !h2 || !a2 || a2 === r2)
    return Q(t2, i2, n2, s, e3, l2), t2.fillStyle = r2, t2.fill(), void t2.restore();
  const o3 = h2 / 2;
  if ("transparent" !== r2) {
    Q(t2, i2 + h2, n2 + h2, s - 2 * h2, e3 - 2 * h2, J(l2, -h2)), t2.fillStyle = r2, t2.fill();
  }
  if ("transparent" !== a2) {
    Q(t2, i2 + o3, n2 + o3, s - h2, e3 - h2, J(l2, -o3)), t2.lineWidth = h2, t2.strokeStyle = a2, t2.closePath(), t2.stroke();
  }
  t2.restore();
}
function it(t2, i2, n2, s, e3, r2, h2) {
  t2.save(), t2.globalCompositeOperation = "copy";
  const l2 = t2.createLinearGradient(0, 0, 0, e3);
  l2.addColorStop(0, r2), l2.addColorStop(1, h2), t2.fillStyle = l2, t2.fillRect(i2, n2, s, e3), t2.restore();
}
var nt = class {
  constructor(t2, i2) {
    this.it(t2, i2);
  }
  it(t2, i2) {
    this.Lt = t2, this.Gt = i2;
  }
  zt(t2, i2) {
    return this.Lt.Tt ? t2.P + t2.L + t2.V : 0;
  }
  K(t2, i2, n2, s) {
    if (!this.Lt.Tt || 0 === this.Lt.Jt.length)
      return;
    const e3 = this.Lt.O, r2 = this.Gt.t, h2 = t2.useBitmapCoordinateSpace((t3) => {
      const h3 = t3.context;
      h3.font = i2.R;
      const l2 = this.Qt(t3, i2, n2, s), a2 = l2.ti, o3 = (t4, i3) => {
        l2.ii ? tt(h3, a2.ni, a2.si, a2.ei, a2.ri, t4, a2.hi, [a2.ot, 0, 0, a2.ot], i3) : tt(h3, a2.li, a2.si, a2.ei, a2.ri, t4, a2.hi, [0, a2.ot, a2.ot, 0], i3);
      };
      return o3(r2, "transparent"), this.Lt.ai && (h3.fillStyle = e3, h3.fillRect(a2.li, a2.oi, a2._i - a2.li, a2.ui)), o3("transparent", r2), this.Lt.ci && (h3.fillStyle = i2.A, h3.fillRect(l2.ii ? a2.di - a2.hi : 0, a2.si, a2.hi, a2.fi - a2.si)), l2;
    });
    t2.useMediaCoordinateSpace(({ context: t3 }) => {
      const n3 = h2.vi;
      t3.font = i2.R, t3.textAlign = h2.ii ? "right" : "left", t3.textBaseline = "middle", t3.fillStyle = e3, t3.fillText(this.Lt.Jt, n3.pi, (n3.si + n3.fi) / 2 + n3.mi);
    });
  }
  Qt(t2, i2, n2, s) {
    var e3;
    const { context: r2, bitmapSize: h2, mediaSize: l2, horizontalPixelRatio: a2, verticalPixelRatio: o3 } = t2, _2 = this.Lt.ai || !this.Lt.bi ? i2.T : 0, u2 = this.Lt.wi ? i2.C : 0, c2 = i2.L + this.Gt.gi, d2 = i2.V + this.Gt.Mi, f2 = i2.B, v2 = i2.I, p2 = this.Lt.Jt, m2 = i2.P, b2 = n2.xi(r2, p2), w2 = Math.ceil(n2.Si(r2, p2)), g2 = m2 + c2 + d2, M2 = i2.C + f2 + v2 + w2 + _2, x2 = Math.max(1, Math.floor(o3));
    let S2 = Math.round(g2 * o3);
    S2 % 2 != x2 % 2 && (S2 += 1);
    const k2 = u2 > 0 ? Math.max(1, Math.floor(u2 * a2)) : 0, y2 = Math.round(M2 * a2), C2 = Math.round(_2 * a2), T2 = null !== (e3 = this.Gt.ki) && void 0 !== e3 ? e3 : this.Gt.yi, P2 = Math.round(T2 * o3) - Math.floor(0.5 * o3), R2 = Math.floor(P2 + x2 / 2 - S2 / 2), D2 = R2 + S2, O2 = "right" === s, A2 = O2 ? l2.width - u2 : u2, V2 = O2 ? h2.width - k2 : k2;
    let B2, I2, z2;
    return O2 ? (B2 = V2 - y2, I2 = V2 - C2, z2 = A2 - _2 - f2 - u2) : (B2 = V2 + y2, I2 = V2 + C2, z2 = A2 + _2 + f2), { ii: O2, ti: { si: R2, oi: P2, fi: D2, ei: y2, ri: S2, ot: 2 * a2, hi: k2, ni: B2, li: V2, _i: I2, ui: x2, di: h2.width }, vi: { si: R2 / o3, fi: D2 / o3, pi: z2, mi: b2 } };
  }
};
var st = class {
  constructor(t2) {
    this.Ci = { yi: 0, t: "#000", Mi: 0, gi: 0 }, this.Ti = { Jt: "", Tt: false, ai: true, bi: false, Bt: "", O: "#FFF", ci: false, wi: false }, this.Pi = { Jt: "", Tt: false, ai: false, bi: true, Bt: "", O: "#FFF", ci: true, wi: true }, this.bt = true, this.Ri = new (t2 || nt)(this.Ti, this.Ci), this.Di = new (t2 || nt)(this.Pi, this.Ci);
  }
  Jt() {
    return this.Oi(), this.Ti.Jt;
  }
  yi() {
    return this.Oi(), this.Ci.yi;
  }
  gt() {
    this.bt = true;
  }
  zt(t2, i2 = false) {
    return Math.max(this.Ri.zt(t2, i2), this.Di.zt(t2, i2));
  }
  Ai() {
    return this.Ci.ki || 0;
  }
  Vi(t2) {
    this.Ci.ki = t2;
  }
  Bi() {
    return this.Oi(), this.Ti.Tt || this.Pi.Tt;
  }
  Ii() {
    return this.Oi(), this.Ti.Tt;
  }
  xt(t2) {
    return this.Oi(), this.Ti.ai = this.Ti.ai && t2.W().ticksVisible, this.Pi.ai = this.Pi.ai && t2.W().ticksVisible, this.Ri.it(this.Ti, this.Ci), this.Di.it(this.Pi, this.Ci), this.Ri;
  }
  zi() {
    return this.Oi(), this.Ri.it(this.Ti, this.Ci), this.Di.it(this.Pi, this.Ci), this.Di;
  }
  Oi() {
    this.bt && (this.Ti.ai = true, this.Pi.ai = false, this.Ei(this.Ti, this.Pi, this.Ci));
  }
};
var et = class extends st {
  constructor(t2, i2, n2) {
    super(), this.$t = t2, this.Li = i2, this.Ni = n2;
  }
  Ei(t2, i2, n2) {
    if (t2.Tt = false, 2 === this.$t.W().mode)
      return;
    const s = this.$t.W().horzLine;
    if (!s.labelVisible)
      return;
    const e3 = this.Li.Pt();
    if (!this.$t.Tt() || this.Li.Fi() || null === e3)
      return;
    const r2 = P(s.labelBackgroundColor);
    n2.t = r2.t, t2.O = r2.i;
    const h2 = 2 / 12 * this.Li.P();
    n2.gi = h2, n2.Mi = h2;
    const l2 = this.Ni(this.Li);
    n2.yi = l2.yi, t2.Jt = this.Li.Wi(l2.ct, e3), t2.Tt = true;
  }
};
var rt = /[1-9]/g;
var ht = class {
  constructor() {
    this.Lt = null;
  }
  it(t2) {
    this.Lt = t2;
  }
  K(t2, i2) {
    if (null === this.Lt || false === this.Lt.Tt || 0 === this.Lt.Jt.length)
      return;
    const n2 = t2.useMediaCoordinateSpace(({ context: t3 }) => (t3.font = i2.R, Math.round(i2.ji.Si(t3, b(this.Lt).Jt, rt))));
    if (n2 <= 0)
      return;
    const s = i2.Hi, e3 = n2 + 2 * s, r2 = e3 / 2, h2 = this.Lt.$i;
    let l2 = this.Lt.yi, a2 = Math.floor(l2 - r2) + 0.5;
    a2 < 0 ? (l2 += Math.abs(0 - a2), a2 = Math.floor(l2 - r2) + 0.5) : a2 + e3 > h2 && (l2 -= Math.abs(h2 - (a2 + e3)), a2 = Math.floor(l2 - r2) + 0.5);
    const o3 = a2 + e3, _2 = Math.ceil(0 + i2.C + i2.T + i2.L + i2.P + i2.V);
    t2.useBitmapCoordinateSpace(({ context: t3, horizontalPixelRatio: n3, verticalPixelRatio: s2 }) => {
      const e4 = b(this.Lt);
      t3.fillStyle = e4.t;
      const r3 = Math.round(a2 * n3), h3 = Math.round(0 * s2), l3 = Math.round(o3 * n3), u2 = Math.round(_2 * s2), c2 = Math.round(2 * n3);
      if (t3.beginPath(), t3.moveTo(r3, h3), t3.lineTo(r3, u2 - c2), t3.arcTo(r3, u2, r3 + c2, u2, c2), t3.lineTo(l3 - c2, u2), t3.arcTo(l3, u2, l3, u2 - c2, c2), t3.lineTo(l3, h3), t3.fill(), e4.ai) {
        const r4 = Math.round(e4.yi * n3), l4 = h3, a3 = Math.round((l4 + i2.T) * s2);
        t3.fillStyle = e4.O;
        const o4 = Math.max(1, Math.floor(n3)), _3 = Math.floor(0.5 * n3);
        t3.fillRect(r4 - _3, l4, o4, a3 - l4);
      }
    }), t2.useMediaCoordinateSpace(({ context: t3 }) => {
      const n3 = b(this.Lt), e4 = 0 + i2.C + i2.T + i2.L + i2.P / 2;
      t3.font = i2.R, t3.textAlign = "left", t3.textBaseline = "middle", t3.fillStyle = n3.O;
      const r3 = i2.ji.xi(t3, "Apr0");
      t3.translate(a2 + s, e4 + r3), t3.fillText(n3.Jt, 0, 0);
    });
  }
};
var lt = class {
  constructor(t2, i2, n2) {
    this.bt = true, this.Ht = new ht(), this.jt = { Tt: false, t: "#4c525e", O: "white", Jt: "", $i: 0, yi: NaN, ai: true }, this.wt = t2, this.Ui = i2, this.Ni = n2;
  }
  gt() {
    this.bt = true;
  }
  xt() {
    return this.bt && (this.St(), this.bt = false), this.Ht.it(this.jt), this.Ht;
  }
  St() {
    const t2 = this.jt;
    if (t2.Tt = false, 2 === this.wt.W().mode)
      return;
    const i2 = this.wt.W().vertLine;
    if (!i2.labelVisible)
      return;
    const n2 = this.Ui.yt();
    if (n2.Fi())
      return;
    t2.$i = n2.$i();
    const s = this.Ni();
    if (null === s)
      return;
    t2.yi = s.yi;
    const e3 = n2.qi(this.wt.kt());
    t2.Jt = n2.Yi(b(e3)), t2.Tt = true;
    const r2 = P(i2.labelBackgroundColor);
    t2.t = r2.t, t2.O = r2.i, t2.ai = n2.W().ticksVisible;
  }
};
var at = class {
  constructor() {
    this.Xi = null, this.Ki = 0;
  }
  Zi() {
    return this.Ki;
  }
  Gi(t2) {
    this.Ki = t2;
  }
  At() {
    return this.Xi;
  }
  Ji(t2) {
    this.Xi = t2;
  }
  Qi(t2) {
    return [];
  }
  tn() {
    return [];
  }
  Tt() {
    return true;
  }
};
var ot;
!function(t2) {
  t2[t2.Normal = 0] = "Normal", t2[t2.Magnet = 1] = "Magnet", t2[t2.Hidden = 2] = "Hidden";
}(ot || (ot = {}));
var _t = class extends at {
  constructor(t2, i2) {
    super(), this.nn = null, this.sn = NaN, this.en = 0, this.rn = true, this.hn = /* @__PURE__ */ new Map(), this.ln = false, this.an = NaN, this.on = NaN, this._n = NaN, this.un = NaN, this.Ui = t2, this.cn = i2, this.dn = new q(t2, this);
    this.fn = ((t3, i3) => (n3) => {
      const s = i3(), e3 = t3();
      if (n3 === b(this.nn).vn())
        return { ct: e3, yi: s };
      {
        const t4 = b(n3.Pt());
        return { ct: n3.pn(s, t4), yi: s };
      }
    })(() => this.sn, () => this.on);
    const n2 = ((t3, i3) => () => {
      const n3 = this.Ui.yt().mn(t3()), s = i3();
      return n3 && Number.isFinite(s) ? { ut: n3, yi: s } : null;
    })(() => this.en, () => this.Kt());
    this.bn = new lt(this, t2, n2), this.wn = new K(this);
  }
  W() {
    return this.cn;
  }
  gn(t2, i2) {
    this._n = t2, this.un = i2;
  }
  Mn() {
    this._n = NaN, this.un = NaN;
  }
  xn() {
    return this._n;
  }
  Sn() {
    return this.un;
  }
  kn(t2, i2, n2) {
    this.ln || (this.ln = true), this.rn = true, this.yn(t2, i2, n2);
  }
  kt() {
    return this.en;
  }
  Kt() {
    return this.an;
  }
  Zt() {
    return this.on;
  }
  Tt() {
    return this.rn;
  }
  Cn() {
    this.rn = false, this.Tn(), this.sn = NaN, this.an = NaN, this.on = NaN, this.nn = null, this.Mn();
  }
  Pn(t2) {
    return null !== this.nn ? [this.wn, this.dn] : [];
  }
  Yt(t2) {
    return t2 === this.nn && this.cn.horzLine.visible;
  }
  Xt() {
    return this.cn.vertLine.visible;
  }
  Rn(t2, i2) {
    this.rn && this.nn === t2 || this.hn.clear();
    const n2 = [];
    return this.nn === t2 && n2.push(this.Dn(this.hn, i2, this.fn)), n2;
  }
  tn() {
    return this.rn ? [this.bn] : [];
  }
  Ut() {
    return this.nn;
  }
  On() {
    this.wn.gt(), this.hn.forEach((t2) => t2.gt()), this.bn.gt(), this.dn.gt();
  }
  An(t2) {
    return t2 && !t2.vn().Fi() ? t2.vn() : null;
  }
  yn(t2, i2, n2) {
    this.Vn(t2, i2, n2) && this.On();
  }
  Vn(t2, i2, n2) {
    const s = this.an, e3 = this.on, r2 = this.sn, h2 = this.en, l2 = this.nn, a2 = this.An(n2);
    this.en = t2, this.an = isNaN(t2) ? NaN : this.Ui.yt().Et(t2), this.nn = n2;
    const o3 = null !== a2 ? a2.Pt() : null;
    return null !== a2 && null !== o3 ? (this.sn = i2, this.on = a2.Ot(i2, o3)) : (this.sn = NaN, this.on = NaN), s !== this.an || e3 !== this.on || h2 !== this.en || r2 !== this.sn || l2 !== this.nn;
  }
  Tn() {
    const t2 = this.Ui.Mt().map((t3) => t3.In().Bn()).filter(z), i2 = 0 === t2.length ? null : Math.max(...t2);
    this.en = null !== i2 ? i2 : NaN;
  }
  Dn(t2, i2, n2) {
    let s = t2.get(i2);
    return void 0 === s && (s = new et(this, i2, n2), t2.set(i2, s)), s;
  }
};
function ut(t2) {
  return "left" === t2 || "right" === t2;
}
var ct = class {
  constructor(t2) {
    this.zn = /* @__PURE__ */ new Map(), this.En = [], this.Ln = t2;
  }
  Nn(t2, i2) {
    const n2 = function(t3, i3) {
      return void 0 === t3 ? i3 : { Fn: Math.max(t3.Fn, i3.Fn), Wn: t3.Wn || i3.Wn };
    }(this.zn.get(t2), i2);
    this.zn.set(t2, n2);
  }
  jn() {
    return this.Ln;
  }
  Hn(t2) {
    const i2 = this.zn.get(t2);
    return void 0 === i2 ? { Fn: this.Ln } : { Fn: Math.max(this.Ln, i2.Fn), Wn: i2.Wn };
  }
  $n() {
    this.Un(), this.En = [{ qn: 0 }];
  }
  Yn(t2) {
    this.Un(), this.En = [{ qn: 1, Vt: t2 }];
  }
  Xn(t2) {
    this.Kn(), this.En.push({ qn: 5, Vt: t2 });
  }
  Un() {
    this.Kn(), this.En.push({ qn: 6 });
  }
  Zn() {
    this.Un(), this.En = [{ qn: 4 }];
  }
  Gn(t2) {
    this.Un(), this.En.push({ qn: 2, Vt: t2 });
  }
  Jn(t2) {
    this.Un(), this.En.push({ qn: 3, Vt: t2 });
  }
  Qn() {
    return this.En;
  }
  ts(t2) {
    for (const i2 of t2.En)
      this.ns(i2);
    this.Ln = Math.max(this.Ln, t2.Ln), t2.zn.forEach((t3, i2) => {
      this.Nn(i2, t3);
    });
  }
  static ss() {
    return new ct(2);
  }
  static es() {
    return new ct(3);
  }
  ns(t2) {
    switch (t2.qn) {
      case 0:
        this.$n();
        break;
      case 1:
        this.Yn(t2.Vt);
        break;
      case 2:
        this.Gn(t2.Vt);
        break;
      case 3:
        this.Jn(t2.Vt);
        break;
      case 4:
        this.Zn();
        break;
      case 5:
        this.Xn(t2.Vt);
        break;
      case 6:
        this.Kn();
    }
  }
  Kn() {
    const t2 = this.En.findIndex((t3) => 5 === t3.qn);
    -1 !== t2 && this.En.splice(t2, 1);
  }
};
var dt = ".";
function ft(t2, i2) {
  if (!O(t2))
    return "n/a";
  if (!A(i2))
    throw new TypeError("invalid length");
  if (i2 < 0 || i2 > 16)
    throw new TypeError("invalid length");
  if (0 === i2)
    return t2.toString();
  return ("0000000000000000" + t2.toString()).slice(-i2);
}
var vt = class {
  constructor(t2, i2) {
    if (i2 || (i2 = 1), O(t2) && A(t2) || (t2 = 100), t2 < 0)
      throw new TypeError("invalid base");
    this.Li = t2, this.rs = i2, this.hs();
  }
  format(t2) {
    const i2 = t2 < 0 ? "\u2212" : "";
    return t2 = Math.abs(t2), i2 + this.ls(t2);
  }
  hs() {
    if (this.os = 0, this.Li > 0 && this.rs > 0) {
      let t2 = this.Li;
      for (; t2 > 1; )
        t2 /= 10, this.os++;
    }
  }
  ls(t2) {
    const i2 = this.Li / this.rs;
    let n2 = Math.floor(t2), s = "";
    const e3 = void 0 !== this.os ? this.os : NaN;
    if (i2 > 1) {
      let r2 = +(Math.round(t2 * i2) - n2 * i2).toFixed(this.os);
      r2 >= i2 && (r2 -= i2, n2 += 1), s = dt + ft(+r2.toFixed(this.os) * this.rs, e3);
    } else
      n2 = Math.round(n2 * i2) / i2, e3 > 0 && (s = dt + ft(0, e3));
    return n2.toFixed(0) + s;
  }
};
var pt = class extends vt {
  constructor(t2 = 100) {
    super(t2);
  }
  format(t2) {
    return `${super.format(t2)}%`;
  }
};
var mt = class {
  constructor(t2) {
    this._s = t2;
  }
  format(t2) {
    let i2 = "";
    return t2 < 0 && (i2 = "-", t2 = -t2), t2 < 995 ? i2 + this.us(t2) : t2 < 999995 ? i2 + this.us(t2 / 1e3) + "K" : t2 < 999999995 ? (t2 = 1e3 * Math.round(t2 / 1e3), i2 + this.us(t2 / 1e6) + "M") : (t2 = 1e6 * Math.round(t2 / 1e6), i2 + this.us(t2 / 1e9) + "B");
  }
  us(t2) {
    let i2;
    const n2 = Math.pow(10, this._s);
    return i2 = (t2 = Math.round(t2 * n2) / n2) >= 1e-15 && t2 < 1 ? t2.toFixed(this._s).replace(/\.?0+$/, "") : String(t2), i2.replace(/(\.[1-9]*)0+$/, (t3, i3) => i3);
  }
};
function bt(t2, i2, n2, s, e3, r2, h2) {
  if (0 === i2.length || s.from >= i2.length || s.to <= 0)
    return;
  const { context: l2, horizontalPixelRatio: a2, verticalPixelRatio: o3 } = t2, _2 = i2[s.from];
  let u2 = r2(t2, _2), c2 = _2;
  if (s.to - s.from < 2) {
    const i3 = e3 / 2;
    l2.beginPath();
    const n3 = { et: _2.et - i3, rt: _2.rt }, s2 = { et: _2.et + i3, rt: _2.rt };
    l2.moveTo(n3.et * a2, n3.rt * o3), l2.lineTo(s2.et * a2, s2.rt * o3), h2(t2, u2, n3, s2);
  } else {
    const e4 = (i3, n3) => {
      h2(t2, u2, c2, n3), l2.beginPath(), u2 = i3, c2 = n3;
    };
    let d2 = c2;
    l2.beginPath(), l2.moveTo(_2.et * a2, _2.rt * o3);
    for (let h3 = s.from + 1; h3 < s.to; ++h3) {
      d2 = i2[h3];
      const s2 = r2(t2, d2);
      switch (n2) {
        case 0:
          l2.lineTo(d2.et * a2, d2.rt * o3);
          break;
        case 1:
          l2.lineTo(d2.et * a2, i2[h3 - 1].rt * o3), s2 !== u2 && (e4(s2, d2), l2.lineTo(d2.et * a2, i2[h3 - 1].rt * o3)), l2.lineTo(d2.et * a2, d2.rt * o3);
          break;
        case 2: {
          const [t3, n3] = xt(i2, h3 - 1, h3);
          l2.bezierCurveTo(t3.et * a2, t3.rt * o3, n3.et * a2, n3.rt * o3, d2.et * a2, d2.rt * o3);
          break;
        }
      }
      1 !== n2 && s2 !== u2 && (e4(s2, d2), l2.moveTo(d2.et * a2, d2.rt * o3));
    }
    (c2 !== d2 || c2 === d2 && 1 === n2) && h2(t2, u2, c2, d2);
  }
}
var wt = 6;
function gt(t2, i2) {
  return { et: t2.et - i2.et, rt: t2.rt - i2.rt };
}
function Mt(t2, i2) {
  return { et: t2.et / i2, rt: t2.rt / i2 };
}
function xt(t2, i2, n2) {
  const s = Math.max(0, i2 - 1), e3 = Math.min(t2.length - 1, n2 + 1);
  var r2, h2;
  return [(r2 = t2[i2], h2 = Mt(gt(t2[n2], t2[s]), wt), { et: r2.et + h2.et, rt: r2.rt + h2.rt }), gt(t2[n2], Mt(gt(t2[e3], t2[i2]), wt))];
}
function St(t2, i2, n2, s, e3) {
  const { context: r2, horizontalPixelRatio: h2, verticalPixelRatio: l2 } = i2;
  r2.lineTo(e3.et * h2, t2 * l2), r2.lineTo(s.et * h2, t2 * l2), r2.closePath(), r2.fillStyle = n2, r2.fill();
}
var kt = class extends Y {
  constructor() {
    super(...arguments), this.tt = null;
  }
  it(t2) {
    this.tt = t2;
  }
  Z(t2) {
    var i2;
    if (null === this.tt)
      return;
    const { st: n2, nt: s, cs: e3, ht: r2, Wt: h2, ds: l2 } = this.tt, a2 = null !== (i2 = this.tt.fs) && void 0 !== i2 ? i2 : this.tt.vs ? 0 : t2.mediaSize.height;
    if (null === s)
      return;
    const o3 = t2.context;
    o3.lineCap = "butt", o3.lineJoin = "round", o3.lineWidth = r2, f(o3, h2), o3.lineWidth = 1, bt(t2, n2, l2, s, e3, this.ps.bind(this), St.bind(null, a2));
  }
};
function yt(t2, i2, n2) {
  return Math.min(Math.max(t2, i2), n2);
}
function Ct(t2, i2, n2) {
  return i2 - t2 <= n2;
}
function Tt(t2) {
  const i2 = Math.ceil(t2);
  return i2 % 2 == 0 ? i2 - 1 : i2;
}
var Pt = class {
  bs(t2, i2) {
    const n2 = this.ws, { gs: s, Ms: e3, xs: r2, Ss: h2, ks: l2, fs: a2 } = i2;
    if (void 0 === this.ys || void 0 === n2 || n2.gs !== s || n2.Ms !== e3 || n2.xs !== r2 || n2.Ss !== h2 || n2.fs !== a2 || n2.ks !== l2) {
      const n3 = t2.context.createLinearGradient(0, 0, 0, l2);
      if (n3.addColorStop(0, s), null != a2) {
        const i3 = yt(a2 * t2.verticalPixelRatio / l2, 0, 1);
        n3.addColorStop(i3, e3), n3.addColorStop(i3, r2);
      }
      n3.addColorStop(1, h2), this.ys = n3, this.ws = i2;
    }
    return this.ys;
  }
};
var Rt = class extends kt {
  constructor() {
    super(...arguments), this.Cs = new Pt();
  }
  ps(t2, i2) {
    return this.Cs.bs(t2, { gs: i2.Ts, Ms: "", xs: "", Ss: i2.Ps, ks: t2.bitmapSize.height });
  }
};
function Dt(t2, i2) {
  const n2 = t2.context;
  n2.strokeStyle = i2, n2.stroke();
}
var Ot = class extends Y {
  constructor() {
    super(...arguments), this.tt = null;
  }
  it(t2) {
    this.tt = t2;
  }
  Z(t2) {
    if (null === this.tt)
      return;
    const { st: i2, nt: n2, cs: s, ds: e3, ht: r2, Wt: h2, Rs: l2 } = this.tt;
    if (null === n2)
      return;
    const a2 = t2.context;
    a2.lineCap = "butt", a2.lineWidth = r2 * t2.verticalPixelRatio, f(a2, h2), a2.lineJoin = "round";
    const o3 = this.Ds.bind(this);
    void 0 !== e3 && bt(t2, i2, e3, n2, s, o3, Dt), l2 && function(t3, i3, n3, s2, e4) {
      const { horizontalPixelRatio: r3, verticalPixelRatio: h3, context: l3 } = t3;
      let a3 = null;
      const o4 = Math.max(1, Math.floor(r3)) % 2 / 2, _2 = n3 * h3 + o4;
      for (let n4 = s2.to - 1; n4 >= s2.from; --n4) {
        const s3 = i3[n4];
        if (s3) {
          const i4 = e4(t3, s3);
          i4 !== a3 && (l3.beginPath(), null !== a3 && l3.fill(), l3.fillStyle = i4, a3 = i4);
          const n5 = Math.round(s3.et * r3) + o4, u2 = s3.rt * h3;
          l3.moveTo(n5, u2), l3.arc(n5, u2, _2, 0, 2 * Math.PI);
        }
      }
      l3.fill();
    }(t2, i2, l2, n2, o3);
  }
};
var At = class extends Ot {
  Ds(t2, i2) {
    return i2._t;
  }
};
function Vt(t2, i2, n2, s, e3 = 0, r2 = i2.length) {
  let h2 = r2 - e3;
  for (; 0 < h2; ) {
    const r3 = h2 >> 1, l2 = e3 + r3;
    s(i2[l2], n2) === t2 ? (e3 = l2 + 1, h2 -= r3 + 1) : h2 = r3;
  }
  return e3;
}
var Bt = Vt.bind(null, true);
var It = Vt.bind(null, false);
function zt(t2, i2) {
  return t2.ut < i2;
}
function Et(t2, i2) {
  return i2 < t2.ut;
}
function Lt(t2, i2, n2) {
  const s = i2.Os(), e3 = i2.di(), r2 = Bt(t2, s, zt), h2 = It(t2, e3, Et);
  if (!n2)
    return { from: r2, to: h2 };
  let l2 = r2, a2 = h2;
  return r2 > 0 && r2 < t2.length && t2[r2].ut >= s && (l2 = r2 - 1), h2 > 0 && h2 < t2.length && t2[h2 - 1].ut <= e3 && (a2 = h2 + 1), { from: l2, to: a2 };
}
var Nt = class {
  constructor(t2, i2, n2) {
    this.As = true, this.Vs = true, this.Bs = true, this.Is = [], this.zs = null, this.Es = t2, this.Ls = i2, this.Ns = n2;
  }
  gt(t2) {
    this.As = true, "data" === t2 && (this.Vs = true), "options" === t2 && (this.Bs = true);
  }
  xt() {
    return this.Es.Tt() ? (this.Fs(), null === this.zs ? null : this.Ws) : null;
  }
  js() {
    this.Is = this.Is.map((t2) => Object.assign(Object.assign({}, t2), this.Es.$s().Hs(t2.ut)));
  }
  Us() {
    this.zs = null;
  }
  Fs() {
    this.Vs && (this.qs(), this.Vs = false), this.Bs && (this.js(), this.Bs = false), this.As && (this.Ys(), this.As = false);
  }
  Ys() {
    const t2 = this.Es.At(), i2 = this.Ls.yt();
    if (this.Us(), i2.Fi() || t2.Fi())
      return;
    const n2 = i2.Xs();
    if (null === n2)
      return;
    if (0 === this.Es.In().Ks())
      return;
    const s = this.Es.Pt();
    null !== s && (this.zs = Lt(this.Is, n2, this.Ns), this.Zs(t2, i2, s.Vt), this.Gs());
  }
};
var Ft = class extends Nt {
  constructor(t2, i2) {
    super(t2, i2, true);
  }
  Zs(t2, i2, n2) {
    i2.Js(this.Is, E(this.zs)), t2.Qs(this.Is, n2, E(this.zs));
  }
  te(t2, i2) {
    return { ut: t2, ct: i2, et: NaN, rt: NaN };
  }
  qs() {
    const t2 = this.Es.$s();
    this.Is = this.Es.In().ie().map((i2) => {
      const n2 = i2.Vt[3];
      return this.ne(i2.se, n2, t2);
    });
  }
};
var Wt = class extends Ft {
  constructor(t2, i2) {
    super(t2, i2), this.Ws = new W(), this.ee = new Rt(), this.re = new At(), this.Ws.X([this.ee, this.re]);
  }
  ne(t2, i2, n2) {
    return Object.assign(Object.assign({}, this.te(t2, i2)), n2.Hs(t2));
  }
  Gs() {
    const t2 = this.Es.W();
    this.ee.it({ ds: t2.lineType, st: this.Is, Wt: t2.lineStyle, ht: t2.lineWidth, fs: null, vs: t2.invertFilledArea, nt: this.zs, cs: this.Ls.yt().he() }), this.re.it({ ds: t2.lineVisible ? t2.lineType : void 0, st: this.Is, Wt: t2.lineStyle, ht: t2.lineWidth, nt: this.zs, cs: this.Ls.yt().he(), Rs: t2.pointMarkersVisible ? t2.pointMarkersRadius || t2.lineWidth / 2 + 2 : void 0 });
  }
};
var jt = class extends Y {
  constructor() {
    super(...arguments), this.Lt = null, this.le = 0, this.ae = 0;
  }
  it(t2) {
    this.Lt = t2;
  }
  Z({ context: t2, horizontalPixelRatio: i2, verticalPixelRatio: n2 }) {
    if (null === this.Lt || 0 === this.Lt.In.length || null === this.Lt.nt)
      return;
    if (this.le = this.oe(i2), this.le >= 2) {
      Math.max(1, Math.floor(i2)) % 2 != this.le % 2 && this.le--;
    }
    this.ae = this.Lt._e ? Math.min(this.le, Math.floor(i2)) : this.le;
    let s = null;
    const e3 = this.ae <= this.le && this.Lt.he >= Math.floor(1.5 * i2);
    for (let r2 = this.Lt.nt.from; r2 < this.Lt.nt.to; ++r2) {
      const h2 = this.Lt.In[r2];
      s !== h2.ue && (t2.fillStyle = h2.ue, s = h2.ue);
      const l2 = Math.floor(0.5 * this.ae), a2 = Math.round(h2.et * i2), o3 = a2 - l2, _2 = this.ae, u2 = o3 + _2 - 1, c2 = Math.min(h2.ce, h2.de), d2 = Math.max(h2.ce, h2.de), f2 = Math.round(c2 * n2) - l2, v2 = Math.round(d2 * n2) + l2, p2 = Math.max(v2 - f2, this.ae);
      t2.fillRect(o3, f2, _2, p2);
      const m2 = Math.ceil(1.5 * this.le);
      if (e3) {
        if (this.Lt.fe) {
          const i4 = a2 - m2;
          let s3 = Math.max(f2, Math.round(h2.ve * n2) - l2), e5 = s3 + _2 - 1;
          e5 > f2 + p2 - 1 && (e5 = f2 + p2 - 1, s3 = e5 - _2 + 1), t2.fillRect(i4, s3, o3 - i4, e5 - s3 + 1);
        }
        const i3 = a2 + m2;
        let s2 = Math.max(f2, Math.round(h2.pe * n2) - l2), e4 = s2 + _2 - 1;
        e4 > f2 + p2 - 1 && (e4 = f2 + p2 - 1, s2 = e4 - _2 + 1), t2.fillRect(u2 + 1, s2, i3 - u2, e4 - s2 + 1);
      }
    }
  }
  oe(t2) {
    const i2 = Math.floor(t2);
    return Math.max(i2, Math.floor(function(t3, i3) {
      return Math.floor(0.3 * t3 * i3);
    }(b(this.Lt).he, t2)));
  }
};
var Ht = class extends Nt {
  constructor(t2, i2) {
    super(t2, i2, false);
  }
  Zs(t2, i2, n2) {
    i2.Js(this.Is, E(this.zs)), t2.me(this.Is, n2, E(this.zs));
  }
  be(t2, i2, n2) {
    return { ut: t2, we: i2.Vt[0], ge: i2.Vt[1], Me: i2.Vt[2], xe: i2.Vt[3], et: NaN, ve: NaN, ce: NaN, de: NaN, pe: NaN };
  }
  qs() {
    const t2 = this.Es.$s();
    this.Is = this.Es.In().ie().map((i2) => this.ne(i2.se, i2, t2));
  }
};
var $t = class extends Ht {
  constructor() {
    super(...arguments), this.Ws = new jt();
  }
  ne(t2, i2, n2) {
    return Object.assign(Object.assign({}, this.be(t2, i2, n2)), n2.Hs(t2));
  }
  Gs() {
    const t2 = this.Es.W();
    this.Ws.it({ In: this.Is, he: this.Ls.yt().he(), fe: t2.openVisible, _e: t2.thinBars, nt: this.zs });
  }
};
var Ut = class extends kt {
  constructor() {
    super(...arguments), this.Cs = new Pt();
  }
  ps(t2, i2) {
    const n2 = this.tt;
    return this.Cs.bs(t2, { gs: i2.Se, Ms: i2.ke, xs: i2.ye, Ss: i2.Ce, ks: t2.bitmapSize.height, fs: n2.fs });
  }
};
var qt = class extends Ot {
  constructor() {
    super(...arguments), this.Te = new Pt();
  }
  Ds(t2, i2) {
    const n2 = this.tt;
    return this.Te.bs(t2, { gs: i2.Pe, Ms: i2.Pe, xs: i2.Re, Ss: i2.Re, ks: t2.bitmapSize.height, fs: n2.fs });
  }
};
var Yt = class extends Ft {
  constructor(t2, i2) {
    super(t2, i2), this.Ws = new W(), this.De = new Ut(), this.Oe = new qt(), this.Ws.X([this.De, this.Oe]);
  }
  ne(t2, i2, n2) {
    return Object.assign(Object.assign({}, this.te(t2, i2)), n2.Hs(t2));
  }
  Gs() {
    const t2 = this.Es.Pt();
    if (null === t2)
      return;
    const i2 = this.Es.W(), n2 = this.Es.At().Ot(i2.baseValue.price, t2.Vt), s = this.Ls.yt().he();
    this.De.it({ st: this.Is, ht: i2.lineWidth, Wt: i2.lineStyle, ds: i2.lineType, fs: n2, vs: false, nt: this.zs, cs: s }), this.Oe.it({ st: this.Is, ht: i2.lineWidth, Wt: i2.lineStyle, ds: i2.lineVisible ? i2.lineType : void 0, Rs: i2.pointMarkersVisible ? i2.pointMarkersRadius || i2.lineWidth / 2 + 2 : void 0, fs: n2, nt: this.zs, cs: s });
  }
};
var Xt = class extends Y {
  constructor() {
    super(...arguments), this.Lt = null, this.le = 0;
  }
  it(t2) {
    this.Lt = t2;
  }
  Z(t2) {
    if (null === this.Lt || 0 === this.Lt.In.length || null === this.Lt.nt)
      return;
    const { horizontalPixelRatio: i2 } = t2;
    if (this.le = function(t3, i3) {
      if (t3 >= 2.5 && t3 <= 4)
        return Math.floor(3 * i3);
      const n3 = 1 - 0.2 * Math.atan(Math.max(4, t3) - 4) / (0.5 * Math.PI), s2 = Math.floor(t3 * n3 * i3), e3 = Math.floor(t3 * i3), r2 = Math.min(s2, e3);
      return Math.max(Math.floor(i3), r2);
    }(this.Lt.he, i2), this.le >= 2) {
      Math.floor(i2) % 2 != this.le % 2 && this.le--;
    }
    const n2 = this.Lt.In;
    this.Lt.Ae && this.Ve(t2, n2, this.Lt.nt), this.Lt.ci && this.Be(t2, n2, this.Lt.nt);
    const s = this.Ie(i2);
    (!this.Lt.ci || this.le > 2 * s) && this.ze(t2, n2, this.Lt.nt);
  }
  Ve(t2, i2, n2) {
    if (null === this.Lt)
      return;
    const { context: s, horizontalPixelRatio: e3, verticalPixelRatio: r2 } = t2;
    let h2 = "", l2 = Math.min(Math.floor(e3), Math.floor(this.Lt.he * e3));
    l2 = Math.max(Math.floor(e3), Math.min(l2, this.le));
    const a2 = Math.floor(0.5 * l2);
    let o3 = null;
    for (let t3 = n2.from; t3 < n2.to; t3++) {
      const n3 = i2[t3];
      n3.Ee !== h2 && (s.fillStyle = n3.Ee, h2 = n3.Ee);
      const _2 = Math.round(Math.min(n3.ve, n3.pe) * r2), u2 = Math.round(Math.max(n3.ve, n3.pe) * r2), c2 = Math.round(n3.ce * r2), d2 = Math.round(n3.de * r2);
      let f2 = Math.round(e3 * n3.et) - a2;
      const v2 = f2 + l2 - 1;
      null !== o3 && (f2 = Math.max(o3 + 1, f2), f2 = Math.min(f2, v2));
      const p2 = v2 - f2 + 1;
      s.fillRect(f2, c2, p2, _2 - c2), s.fillRect(f2, u2 + 1, p2, d2 - u2), o3 = v2;
    }
  }
  Ie(t2) {
    let i2 = Math.floor(1 * t2);
    this.le <= 2 * i2 && (i2 = Math.floor(0.5 * (this.le - 1)));
    const n2 = Math.max(Math.floor(t2), i2);
    return this.le <= 2 * n2 ? Math.max(Math.floor(t2), Math.floor(1 * t2)) : n2;
  }
  Be(t2, i2, n2) {
    if (null === this.Lt)
      return;
    const { context: s, horizontalPixelRatio: e3, verticalPixelRatio: r2 } = t2;
    let h2 = "";
    const l2 = this.Ie(e3);
    let a2 = null;
    for (let t3 = n2.from; t3 < n2.to; t3++) {
      const n3 = i2[t3];
      n3.Le !== h2 && (s.fillStyle = n3.Le, h2 = n3.Le);
      let o3 = Math.round(n3.et * e3) - Math.floor(0.5 * this.le);
      const _2 = o3 + this.le - 1, u2 = Math.round(Math.min(n3.ve, n3.pe) * r2), c2 = Math.round(Math.max(n3.ve, n3.pe) * r2);
      if (null !== a2 && (o3 = Math.max(a2 + 1, o3), o3 = Math.min(o3, _2)), this.Lt.he * e3 > 2 * l2)
        Z(s, o3, u2, _2 - o3 + 1, c2 - u2 + 1, l2);
      else {
        const t4 = _2 - o3 + 1;
        s.fillRect(o3, u2, t4, c2 - u2 + 1);
      }
      a2 = _2;
    }
  }
  ze(t2, i2, n2) {
    if (null === this.Lt)
      return;
    const { context: s, horizontalPixelRatio: e3, verticalPixelRatio: r2 } = t2;
    let h2 = "";
    const l2 = this.Ie(e3);
    for (let t3 = n2.from; t3 < n2.to; t3++) {
      const n3 = i2[t3];
      let a2 = Math.round(Math.min(n3.ve, n3.pe) * r2), o3 = Math.round(Math.max(n3.ve, n3.pe) * r2), _2 = Math.round(n3.et * e3) - Math.floor(0.5 * this.le), u2 = _2 + this.le - 1;
      if (n3.ue !== h2) {
        const t4 = n3.ue;
        s.fillStyle = t4, h2 = t4;
      }
      this.Lt.ci && (_2 += l2, a2 += l2, u2 -= l2, o3 -= l2), a2 > o3 || s.fillRect(_2, a2, u2 - _2 + 1, o3 - a2 + 1);
    }
  }
};
var Kt = class extends Ht {
  constructor() {
    super(...arguments), this.Ws = new Xt();
  }
  ne(t2, i2, n2) {
    return Object.assign(Object.assign({}, this.be(t2, i2, n2)), n2.Hs(t2));
  }
  Gs() {
    const t2 = this.Es.W();
    this.Ws.it({ In: this.Is, he: this.Ls.yt().he(), Ae: t2.wickVisible, ci: t2.borderVisible, nt: this.zs });
  }
};
var Zt = class {
  constructor(t2, i2) {
    this.Ne = t2, this.Li = i2;
  }
  K(t2, i2, n2) {
    this.Ne.draw(t2, this.Li, i2, n2);
  }
};
var Gt = class extends Nt {
  constructor(t2, i2, n2) {
    super(t2, i2, false), this.wn = n2, this.Ws = new Zt(this.wn.renderer(), (i3) => {
      const n3 = t2.Pt();
      return null === n3 ? null : t2.At().Ot(i3, n3.Vt);
    });
  }
  Fe(t2) {
    return this.wn.priceValueBuilder(t2);
  }
  We(t2) {
    return this.wn.isWhitespace(t2);
  }
  qs() {
    const t2 = this.Es.$s();
    this.Is = this.Es.In().ie().map((i2) => Object.assign(Object.assign({ ut: i2.se, et: NaN }, t2.Hs(i2.se)), { je: i2.He }));
  }
  Zs(t2, i2) {
    i2.Js(this.Is, E(this.zs));
  }
  Gs() {
    this.wn.update({ bars: this.Is.map(Jt), barSpacing: this.Ls.yt().he(), visibleRange: this.zs }, this.Es.W());
  }
};
function Jt(t2) {
  return { x: t2.et, time: t2.ut, originalData: t2.je, barColor: t2.ue };
}
var Qt = class extends Y {
  constructor() {
    super(...arguments), this.Lt = null, this.$e = [];
  }
  it(t2) {
    this.Lt = t2, this.$e = [];
  }
  Z({ context: t2, horizontalPixelRatio: i2, verticalPixelRatio: n2 }) {
    if (null === this.Lt || 0 === this.Lt.st.length || null === this.Lt.nt)
      return;
    this.$e.length || this.Ue(i2);
    const s = Math.max(1, Math.floor(n2)), e3 = Math.round(this.Lt.qe * n2) - Math.floor(s / 2), r2 = e3 + s;
    for (let i3 = this.Lt.nt.from; i3 < this.Lt.nt.to; i3++) {
      const h2 = this.Lt.st[i3], l2 = this.$e[i3 - this.Lt.nt.from], a2 = Math.round(h2.rt * n2);
      let o3, _2;
      t2.fillStyle = h2.ue, a2 <= e3 ? (o3 = a2, _2 = r2) : (o3 = e3, _2 = a2 - Math.floor(s / 2) + s), t2.fillRect(l2.Os, o3, l2.di - l2.Os + 1, _2 - o3);
    }
  }
  Ue(t2) {
    if (null === this.Lt || 0 === this.Lt.st.length || null === this.Lt.nt)
      return void (this.$e = []);
    const i2 = Math.ceil(this.Lt.he * t2) <= 1 ? 0 : Math.max(1, Math.floor(t2)), n2 = Math.round(this.Lt.he * t2) - i2;
    this.$e = new Array(this.Lt.nt.to - this.Lt.nt.from);
    for (let i3 = this.Lt.nt.from; i3 < this.Lt.nt.to; i3++) {
      const s2 = this.Lt.st[i3], e3 = Math.round(s2.et * t2);
      let r2, h2;
      if (n2 % 2) {
        const t3 = (n2 - 1) / 2;
        r2 = e3 - t3, h2 = e3 + t3;
      } else {
        const t3 = n2 / 2;
        r2 = e3 - t3, h2 = e3 + t3 - 1;
      }
      this.$e[i3 - this.Lt.nt.from] = { Os: r2, di: h2, Ye: e3, Xe: s2.et * t2, ut: s2.ut };
    }
    for (let t3 = this.Lt.nt.from + 1; t3 < this.Lt.nt.to; t3++) {
      const n3 = this.$e[t3 - this.Lt.nt.from], s2 = this.$e[t3 - this.Lt.nt.from - 1];
      n3.ut === s2.ut + 1 && (n3.Os - s2.di !== i2 + 1 && (s2.Ye > s2.Xe ? s2.di = n3.Os - i2 - 1 : n3.Os = s2.di + i2 + 1));
    }
    let s = Math.ceil(this.Lt.he * t2);
    for (let t3 = this.Lt.nt.from; t3 < this.Lt.nt.to; t3++) {
      const i3 = this.$e[t3 - this.Lt.nt.from];
      i3.di < i3.Os && (i3.di = i3.Os);
      const n3 = i3.di - i3.Os + 1;
      s = Math.min(n3, s);
    }
    if (i2 > 0 && s < 4)
      for (let t3 = this.Lt.nt.from; t3 < this.Lt.nt.to; t3++) {
        const i3 = this.$e[t3 - this.Lt.nt.from];
        i3.di - i3.Os + 1 > s && (i3.Ye > i3.Xe ? i3.di -= 1 : i3.Os += 1);
      }
  }
};
var ti = class extends Ft {
  constructor() {
    super(...arguments), this.Ws = new Qt();
  }
  ne(t2, i2, n2) {
    return Object.assign(Object.assign({}, this.te(t2, i2)), n2.Hs(t2));
  }
  Gs() {
    const t2 = { st: this.Is, he: this.Ls.yt().he(), nt: this.zs, qe: this.Es.At().Ot(this.Es.W().base, b(this.Es.Pt()).Vt) };
    this.Ws.it(t2);
  }
};
var ii = class extends Ft {
  constructor() {
    super(...arguments), this.Ws = new At();
  }
  ne(t2, i2, n2) {
    return Object.assign(Object.assign({}, this.te(t2, i2)), n2.Hs(t2));
  }
  Gs() {
    const t2 = this.Es.W(), i2 = { st: this.Is, Wt: t2.lineStyle, ds: t2.lineVisible ? t2.lineType : void 0, ht: t2.lineWidth, Rs: t2.pointMarkersVisible ? t2.pointMarkersRadius || t2.lineWidth / 2 + 2 : void 0, nt: this.zs, cs: this.Ls.yt().he() };
    this.Ws.it(i2);
  }
};
var ni = /[2-9]/g;
var si = class {
  constructor(t2 = 50) {
    this.Ke = 0, this.Ze = 1, this.Ge = 1, this.Je = {}, this.Qe = /* @__PURE__ */ new Map(), this.tr = t2;
  }
  ir() {
    this.Ke = 0, this.Qe.clear(), this.Ze = 1, this.Ge = 1, this.Je = {};
  }
  Si(t2, i2, n2) {
    return this.nr(t2, i2, n2).width;
  }
  xi(t2, i2, n2) {
    const s = this.nr(t2, i2, n2);
    return ((s.actualBoundingBoxAscent || 0) - (s.actualBoundingBoxDescent || 0)) / 2;
  }
  nr(t2, i2, n2) {
    const s = n2 || ni, e3 = String(i2).replace(s, "0");
    if (this.Qe.has(e3))
      return m(this.Qe.get(e3)).sr;
    if (this.Ke === this.tr) {
      const t3 = this.Je[this.Ge];
      delete this.Je[this.Ge], this.Qe.delete(t3), this.Ge++, this.Ke--;
    }
    t2.save(), t2.textBaseline = "middle";
    const r2 = t2.measureText(e3);
    return t2.restore(), 0 === r2.width && i2.length || (this.Qe.set(e3, { sr: r2, er: this.Ze }), this.Je[this.Ze] = e3, this.Ke++, this.Ze++), r2;
  }
};
var ei = class {
  constructor(t2) {
    this.rr = null, this.k = null, this.hr = "right", this.lr = t2;
  }
  ar(t2, i2, n2) {
    this.rr = t2, this.k = i2, this.hr = n2;
  }
  K(t2) {
    null !== this.k && null !== this.rr && this.rr.K(t2, this.k, this.lr, this.hr);
  }
};
var ri = class {
  constructor(t2, i2, n2) {
    this._r = t2, this.lr = new si(50), this.ur = i2, this.F = n2, this.j = -1, this.Ht = new ei(this.lr);
  }
  xt() {
    const t2 = this.F.cr(this.ur);
    if (null === t2)
      return null;
    const i2 = t2.dr(this.ur) ? t2.vr() : this.ur.At();
    if (null === i2)
      return null;
    const n2 = t2.pr(i2);
    if ("overlay" === n2)
      return null;
    const s = this.F.mr();
    return s.P !== this.j && (this.j = s.P, this.lr.ir()), this.Ht.ar(this._r.zi(), s, n2), this.Ht;
  }
};
var hi = class extends Y {
  constructor() {
    super(...arguments), this.Lt = null;
  }
  it(t2) {
    this.Lt = t2;
  }
  br(t2, i2) {
    var n2;
    if (!(null === (n2 = this.Lt) || void 0 === n2 ? void 0 : n2.Tt))
      return null;
    const { rt: s, ht: e3, wr: r2 } = this.Lt;
    return i2 >= s - e3 - 7 && i2 <= s + e3 + 7 ? { gr: this.Lt, wr: r2 } : null;
  }
  Z({ context: t2, bitmapSize: i2, horizontalPixelRatio: n2, verticalPixelRatio: s }) {
    if (null === this.Lt)
      return;
    if (false === this.Lt.Tt)
      return;
    const e3 = Math.round(this.Lt.rt * s);
    e3 < 0 || e3 > i2.height || (t2.lineCap = "butt", t2.strokeStyle = this.Lt.O, t2.lineWidth = Math.floor(this.Lt.ht * n2), f(t2, this.Lt.Wt), v(t2, e3, 0, i2.width));
  }
};
var li = class {
  constructor(t2) {
    this.Mr = { rt: 0, O: "rgba(0, 0, 0, 0)", ht: 1, Wt: 0, Tt: false }, this.Sr = new hi(), this.bt = true, this.Es = t2, this.Ls = t2.qt(), this.Sr.it(this.Mr);
  }
  gt() {
    this.bt = true;
  }
  xt() {
    return this.Es.Tt() ? (this.bt && (this.kr(), this.bt = false), this.Sr) : null;
  }
};
var ai = class extends li {
  constructor(t2) {
    super(t2);
  }
  kr() {
    this.Mr.Tt = false;
    const t2 = this.Es.At(), i2 = t2.yr().yr;
    if (2 !== i2 && 3 !== i2)
      return;
    const n2 = this.Es.W();
    if (!n2.baseLineVisible || !this.Es.Tt())
      return;
    const s = this.Es.Pt();
    null !== s && (this.Mr.Tt = true, this.Mr.rt = t2.Ot(s.Vt, s.Vt), this.Mr.O = n2.baseLineColor, this.Mr.ht = n2.baseLineWidth, this.Mr.Wt = n2.baseLineStyle);
  }
};
var oi = class extends Y {
  constructor() {
    super(...arguments), this.Lt = null;
  }
  it(t2) {
    this.Lt = t2;
  }
  He() {
    return this.Lt;
  }
  Z({ context: t2, horizontalPixelRatio: i2, verticalPixelRatio: n2 }) {
    const s = this.Lt;
    if (null === s)
      return;
    const e3 = Math.max(1, Math.floor(i2)), r2 = e3 % 2 / 2, h2 = Math.round(s.Xe.x * i2) + r2, l2 = s.Xe.y * n2;
    t2.fillStyle = s.Cr, t2.beginPath();
    const a2 = Math.max(2, 1.5 * s.Tr) * i2;
    t2.arc(h2, l2, a2, 0, 2 * Math.PI, false), t2.fill(), t2.fillStyle = s.Pr, t2.beginPath(), t2.arc(h2, l2, s.ot * i2, 0, 2 * Math.PI, false), t2.fill(), t2.lineWidth = e3, t2.strokeStyle = s.Rr, t2.beginPath(), t2.arc(h2, l2, s.ot * i2 + e3 / 2, 0, 2 * Math.PI, false), t2.stroke();
  }
};
var _i = [{ Dr: 0, Or: 0.25, Ar: 4, Vr: 10, Br: 0.25, Ir: 0, zr: 0.4, Er: 0.8 }, { Dr: 0.25, Or: 0.525, Ar: 10, Vr: 14, Br: 0, Ir: 0, zr: 0.8, Er: 0 }, { Dr: 0.525, Or: 1, Ar: 14, Vr: 14, Br: 0, Ir: 0, zr: 0, Er: 0 }];
function ui(t2, i2, n2, s) {
  return function(t3, i3) {
    if ("transparent" === t3)
      return t3;
    const n3 = T(t3), s2 = n3[3];
    return `rgba(${n3[0]}, ${n3[1]}, ${n3[2]}, ${i3 * s2})`;
  }(t2, n2 + (s - n2) * i2);
}
function ci(t2, i2) {
  const n2 = t2 % 2600 / 2600;
  let s;
  for (const t3 of _i)
    if (n2 >= t3.Dr && n2 <= t3.Or) {
      s = t3;
      break;
    }
  p(void 0 !== s, "Last price animation internal logic error");
  const e3 = (n2 - s.Dr) / (s.Or - s.Dr);
  return { Pr: ui(i2, e3, s.Br, s.Ir), Rr: ui(i2, e3, s.zr, s.Er), ot: (r2 = e3, h2 = s.Ar, l2 = s.Vr, h2 + (l2 - h2) * r2) };
  var r2, h2, l2;
}
var di = class {
  constructor(t2) {
    this.Ht = new oi(), this.bt = true, this.Lr = true, this.Nr = performance.now(), this.Fr = this.Nr - 1, this.Wr = t2;
  }
  jr() {
    this.Fr = this.Nr - 1, this.gt();
  }
  Hr() {
    if (this.gt(), 2 === this.Wr.W().lastPriceAnimation) {
      const t2 = performance.now(), i2 = this.Fr - t2;
      if (i2 > 0)
        return void (i2 < 650 && (this.Fr += 2600));
      this.Nr = t2, this.Fr = t2 + 2600;
    }
  }
  gt() {
    this.bt = true;
  }
  $r() {
    this.Lr = true;
  }
  Tt() {
    return 0 !== this.Wr.W().lastPriceAnimation;
  }
  Ur() {
    switch (this.Wr.W().lastPriceAnimation) {
      case 0:
        return false;
      case 1:
        return true;
      case 2:
        return performance.now() <= this.Fr;
    }
  }
  xt() {
    return this.bt ? (this.St(), this.bt = false, this.Lr = false) : this.Lr && (this.qr(), this.Lr = false), this.Ht;
  }
  St() {
    this.Ht.it(null);
    const t2 = this.Wr.qt().yt(), i2 = t2.Xs(), n2 = this.Wr.Pt();
    if (null === i2 || null === n2)
      return;
    const s = this.Wr.Yr(true);
    if (s.Xr || !i2.Kr(s.se))
      return;
    const e3 = { x: t2.Et(s.se), y: this.Wr.At().Ot(s.ct, n2.Vt) }, r2 = s.O, h2 = this.Wr.W().lineWidth, l2 = ci(this.Zr(), r2);
    this.Ht.it({ Cr: r2, Tr: h2, Pr: l2.Pr, Rr: l2.Rr, ot: l2.ot, Xe: e3 });
  }
  qr() {
    const t2 = this.Ht.He();
    if (null !== t2) {
      const i2 = ci(this.Zr(), t2.Cr);
      t2.Pr = i2.Pr, t2.Rr = i2.Rr, t2.ot = i2.ot;
    }
  }
  Zr() {
    return this.Ur() ? performance.now() - this.Nr : 2599;
  }
};
function fi(t2, i2) {
  return Tt(Math.min(Math.max(t2, 12), 30) * i2);
}
function vi(t2, i2) {
  switch (t2) {
    case "arrowDown":
    case "arrowUp":
      return fi(i2, 1);
    case "circle":
      return fi(i2, 0.8);
    case "square":
      return fi(i2, 0.7);
  }
  return fi(i2, 1);
}
function pi(t2) {
  return function(t3) {
    const i2 = Math.ceil(t3);
    return i2 % 2 != 0 ? i2 - 1 : i2;
  }(fi(t2, 1));
}
function mi(t2) {
  return Math.max(fi(t2, 0.1), 3);
}
function bi(t2, i2, n2, s, e3) {
  const r2 = vi("square", n2), h2 = (r2 - 1) / 2, l2 = t2 - h2, a2 = i2 - h2;
  return s >= l2 && s <= l2 + r2 && e3 >= a2 && e3 <= a2 + r2;
}
function wi(t2, i2, n2, s, e3) {
  const r2 = (vi("arrowUp", e3) - 1) / 2, h2 = (Tt(e3 / 2) - 1) / 2;
  i2.beginPath(), t2 ? (i2.moveTo(n2 - r2, s), i2.lineTo(n2, s - r2), i2.lineTo(n2 + r2, s), i2.lineTo(n2 + h2, s), i2.lineTo(n2 + h2, s + r2), i2.lineTo(n2 - h2, s + r2), i2.lineTo(n2 - h2, s)) : (i2.moveTo(n2 - r2, s), i2.lineTo(n2, s + r2), i2.lineTo(n2 + r2, s), i2.lineTo(n2 + h2, s), i2.lineTo(n2 + h2, s - r2), i2.lineTo(n2 - h2, s - r2), i2.lineTo(n2 - h2, s)), i2.fill();
}
function gi(t2, i2, n2, s, e3, r2) {
  return bi(i2, n2, s, e3, r2);
}
function Mi(t2, i2, n2, s, e3, r2) {
  const h2 = (vi("arrowUp", e3) - 1) / 2;
  if (i2.beginPath(), t2) {
    !function(t3, i3, n3, s2, e4) {
      const r3 = i3, h3 = n3;
      t3.save(), t3.strokeStyle = "rgba(0,0,0,0)", t3.miterLimit = 4, t3.font = "15px ''", t3.fillStyle = "rgba(0,0,0,0)", t3.font = "   15px ''", t3.save(), t3.fillStyle = e4, t3.font = "   15px ''", t3.beginPath(), t3.moveTo(16.2463 + r3, 23.2271 + h3), t3.bezierCurveTo(20.778 + r3, 21.5122 + h3, 24 + r3, 17.1324 + h3, 24 + r3, 12 + h3), t3.bezierCurveTo(24 + r3, 5.37258 + h3, 18.6274 + r3, 0 + h3, 12 + r3, 0 + h3), t3.bezierCurveTo(5.37258 + r3, 0 + h3, 0 + r3, 5.37258 + h3, 0 + r3, 12 + h3), t3.bezierCurveTo(0 + r3, 17.4569 + h3, 3.64241 + r3, 22.0631 + h3, 8.6286 + r3, 23.5199 + h3), t3.lineTo(11.5839 + r3, 26.4752 + h3), t3.bezierCurveTo(11.9744 + r3, 26.8658 + h3, 12.6076 + r3, 26.8658 + h3, 12.9981 + r3, 26.4752 + h3), t3.lineTo(16.2463 + r3, 23.2271 + h3), t3.closePath(), t3.fill("evenodd"), t3.stroke(), t3.restore(), t3.save(), t3.fillStyle = "rgba(0,0,0,0)", t3.strokeStyle = s2, t3.lineWidth = 1.5, t3.lineCap = "round", t3.lineJoin = "round", t3.font = "   15px ''", t3.beginPath(), t3.moveTo(12 + r3, 16.7967 + h3), t3.lineTo(12 + r3, 7.39258 + h3), t3.fill(), t3.stroke(), t3.restore(), t3.save(), t3.fillStyle = "rgba(0,0,0,0)", t3.strokeStyle = s2, t3.lineWidth = 1.5, t3.lineCap = "round", t3.lineJoin = "round", t3.font = "   15px ''", t3.beginPath(), t3.moveTo(15.6004 + r3, 10.7238 + h3), t3.lineTo(12.0004 + r3, 7.19727 + h3), t3.lineTo(8.40039 + r3, 10.7238 + h3), t3.fill(), t3.stroke(), t3.restore(), t3.restore();
    }(i2, n2 - 12, s - 5 * h2, r2.color, r2.bgColor);
  } else {
    !function(t3, i3, n3, s2, e4) {
      const r3 = i3, h3 = n3;
      t3.save(), t3.strokeStyle = "rgba(0,0,0,0)", t3.miterLimit = 4, t3.font = "15px ''", t3.fillStyle = "rgba(0,0,0,0)", t3.font = "   15px ''", t3.save(), t3.fillStyle = e4, t3.font = "   15px ''", t3.beginPath(), t3.moveTo(8.20531 + r3, 3.37993 + h3), t3.bezierCurveTo(3.43761 + r3, 4.96791 + h3, 151253e-11 + r3, 9.4663 + h3, 104907e-11 + r3, 14.7676 + h3), t3.bezierCurveTo(469686e-12 + r3, 21.395 + h3, 5.37258 + r3, 26.7676 + h3, 12 + r3, 26.7676 + h3), t3.bezierCurveTo(18.6274 + r3, 26.7676 + h3, 24 + r3, 21.395 + h3, 24 + r3, 14.7676 + h3), t3.bezierCurveTo(24 + r3, 9.4663 + h3, 20.5624 + r3, 4.96792 + h3, 15.7947 + r3, 3.37993 + h3), t3.lineTo(12.7071 + r3, 0.292346 + h3), t3.bezierCurveTo(12.3166 + r3, -0.098178 + h3, 11.6834 + r3, -0.098178 + h3, 11.2929 + r3, 0.292346 + h3), t3.lineTo(8.20531 + r3, 3.37993 + h3), t3.closePath(), t3.fill("evenodd"), t3.stroke(), t3.restore(), t3.save(), t3.fillStyle = "rgba(0,0,0,0)", t3.strokeStyle = s2, t3.lineWidth = 1.5, t3.lineCap = "round", t3.lineJoin = "round", t3.font = "   15px ''", t3.beginPath(), t3.moveTo(12 + r3, 9.97092 + h3), t3.lineTo(12 + r3, 19.375 + h3), t3.fill(), t3.stroke(), t3.restore(), t3.save(), t3.fillStyle = "rgba(0,0,0,0)", t3.strokeStyle = s2, t3.lineWidth = 1.5, t3.lineCap = "round", t3.lineJoin = "round", t3.font = "   15px ''", t3.beginPath(), t3.moveTo(8.39961 + r3, 16.0438 + h3), t3.lineTo(11.9996 + r3, 19.5703 + h3), t3.lineTo(15.5996 + r3, 16.0438 + h3), t3.fill(), t3.stroke(), t3.restore(), t3.restore();
    }(i2, n2 - 12, s - h2, r2.color, r2.bgColor);
  }
  i2.fill();
}
function xi(t2, i2, n2, s, e3, r2) {
  const h2 = (vi("arrowUp", e3) - 1) / 2;
  if (i2.beginPath(), t2) {
    !function(t3, i3, n3, s2, e4) {
      const r3 = i3, h3 = n3;
      t3.save(), t3.strokeStyle = "rgba(0,0,0,0)", t3.miterLimit = 4, t3.font = "15px ''", t3.fillStyle = "rgba(0,0,0,0)", t3.font = "   15px ''", t3.save(), t3.fillStyle = e4, t3.font = "   15px ''", t3.beginPath(), t3.moveTo(16.2463 + r3, 23.2265 + h3), t3.bezierCurveTo(20.778 + r3, 21.5116 + h3, 24 + r3, 17.1318 + h3, 24 + r3, 11.9995 + h3), t3.bezierCurveTo(24 + r3, 5.37203 + h3, 18.6274 + r3, -549786e-9 + h3, 12 + r3, -550365e-9 + h3), t3.bezierCurveTo(5.37258 + r3, -550945e-9 + h3, -368906e-13 + r3, 5.37203 + h3, -252363e-11 + r3, 11.9994 + h3), t3.bezierCurveTo(-300068e-11 + r3, 17.4564 + h3, 3.6424 + r3, 22.0625 + h3, 8.6286 + r3, 23.5194 + h3), t3.lineTo(11.5839 + r3, 26.4747 + h3), t3.bezierCurveTo(11.9744 + r3, 26.8652 + h3, 12.6076 + r3, 26.8652 + h3, 12.9981 + r3, 26.4747 + h3), t3.lineTo(16.2463 + r3, 23.2265 + h3), t3.closePath(), t3.fill("evenodd"), t3.stroke(), t3.restore(), t3.save(), t3.fillStyle = s2, t3.font = "   15px ''", t3.beginPath(), t3.moveTo(6.30986 + r3, 16.294 + h3), t3.bezierCurveTo(6.03424 + r3, 16.6032 + h3, 51.56015 + r3, 16.6304 + h3, 5.25095 + r3, 16.3548 + h3), t3.bezierCurveTo(4.94175 + r3, 16.0791 + h3, 4.91453 + r3, 15.6051 + h3, 5.19015 + r3, 15.2959 + h3), t3.lineTo(9.1127 + r3, 10.8955 + h3), t3.bezierCurveTo(9.35553 + r3, 10.623 + h3, 9.75919 + r3, 10.565 + h3, 10.069 + r3, 10.7578 + h3), t3.lineTo(12.8776 + r3, 12.5067 + h3), t3.lineTo(15.6576 + r3, 8.95574 + h3), t3.lineTo(13.6581 + r3, 8.95574 + h3), t3.bezierCurveTo(13.2439 + r3, 8.95574 + h3, 12.9081 + r3, 8.61996 + h3, 12.9081 + r3, 8.20574 + h3), t3.bezierCurveTo(12.9081 + r3, 7.79153 + h3, 13.2439 + r3, 7.45574 + h3, 13.6581 + r3, 7.45574 + h3), t3.lineTo(17.1341 + r3, 7.45574 + h3), t3.bezierCurveTo(17.46 + r3, 7.45574 + h3, 17.7486 + r3, 7.66618 + h3, 17.8482 + r3, 7.97647 + h3), t3.lineTo(18.9644 + r3, 11.4528 + h3), t3.bezierCurveTo(19.091 + r3, 11.8472 + h3, 18.874 + r3, 12.2695 + h3, 18.4796 + r3, 12.3962 + h3), t3.bezierCurveTo(18.0852 + r3, 12.5228 + h3, 17.6628 + r3, 12.3057 + h3, 17.5362 + r3, 11.9113 + h3), t3.lineTo(16.8709 + r3, 9.83927 + h3), t3.lineTo(13.6435 + r3, 13.9617 + h3), t3.bezierCurveTo(13.4073 + r3, 14.2633 + h3, 12.9818 + r3, 14.3385 + h3, 12.6565 + r3, 14.136 + h3), t3.lineTo(9.81221 + r3, 12.365 + h3), t3.lineTo(6.30986 + r3, 16.294 + h3), t3.closePath(), t3.fill("evenodd"), t3.stroke(), t3.restore(), t3.restore();
    }(i2, n2 - 12, s - 5 * h2, r2.color, r2.bgColor);
  } else {
    !function(t3, i3, n3, s2, e4) {
      const r3 = i3, h3 = n3;
      t3.save(), t3.strokeStyle = "rgba(0,0,0,0)", t3.miterLimit = 4, t3.font = "15px ''", t3.fillStyle = "rgba(0,0,0,0)", t3.font = "   15px ''", t3.save(), t3.fillStyle = e4, t3.font = "   15px ''", t3.beginPath(), t3.moveTo(7.75371 + r3, 3.54106 + h3), t3.bezierCurveTo(3.22204 + r3, 5.25593 + h3, 149776e-11 + r3, 9.63575 + h3, 104907e-11 + r3, 14.7681 + h3), t3.bezierCurveTo(469686e-12 + r3, 21.3955 + h3, 5.37258 + r3, 26.7681 + h3, 12 + r3, 26.7681 + h3), t3.bezierCurveTo(18.6274 + r3, 26.7681 + h3, 24 + r3, 21.3955 + h3, 24 + r3, 14.7681 + h3), t3.bezierCurveTo(24 + r3, 9.31121 + h3, 20.3576 + r3, 4.70503 + h3, 15.3714 + r3, 3.2482 + h3), t3.lineTo(12.4161 + r3, 0.292894 + h3), t3.bezierCurveTo(12.0256 + r3, -0.0976299 + h3, 11.3924 + r3, -0.09763 + h3, 11.0019 + r3, 0.292894 + h3), t3.lineTo(7.75371 + r3, 3.54106 + h3), t3.closePath(), t3.fill("evenodd"), t3.stroke(), t3.restore(), t3.save(), t3.fillStyle = s2, t3.font = "   15px ''", t3.beginPath(), t3.moveTo(6.30986 + r3, 10.4736 + h3), t3.bezierCurveTo(6.03424 + r3, 10.1644 + h3, 5.56015 + r3, 10.1372 + h3, 5.25095 + r3, 10.4128 + h3), t3.bezierCurveTo(4.94175 + r3, 10.6884 + h3, 4.91453 + r3, 11.1625 + h3, 5.19015 + r3, 11.4717 + h3), t3.lineTo(9.1127 + r3, 15.8721 + h3), t3.bezierCurveTo(9.35553 + r3, 16.1445 + h3, 9.75919 + r3, 16.2026 + h3, 10.069 + r3, 16.0097 + h3), t3.lineTo(12.8776 + r3, 14.2609 + h3), t3.lineTo(15.6576 + r3, 17.8118 + h3), t3.lineTo(13.6581 + r3, 17.8118 + h3), t3.bezierCurveTo(13.2439 + r3, 17.8118 + h3, 12.9081 + r3, 18.1476 + h3, 12.9081 + r3, 18.5618 + h3), t3.bezierCurveTo(12.9081 + r3, 18.976 + h3, 13.2439 + r3, 19.3118 + h3, 13.6581 + r3, 19.3118 + h3), t3.lineTo(17.1341 + r3, 19.3118 + h3), t3.bezierCurveTo(17.46 + r3, 19.3118 + h3, 17.7486 + r3, 19.1014 + h3, 17.8482 + r3, 18.7911 + h3), t3.lineTo(18.9644 + r3, 15.3148 + h3), t3.bezierCurveTo(19.091 + r3, 14.9204 + h3, 18.874 + r3, 14.4981 + h3, 18.4796 + r3, 14.3714 + h3), t3.bezierCurveTo(18.0852 + r3, 14.2448 + h3, 17.6628 + r3, 14.4619 + h3, 17.5362 + r3, 14.8562 + h3), t3.lineTo(16.8709 + r3, 16.9283 + h3), t3.lineTo(13.6435 + r3, 12.8059 + h3), t3.bezierCurveTo(13.4073 + r3, 12.5042 + h3, 12.9818 + r3, 12.4291 + h3, 12.6565 + r3, 12.6316 + h3), t3.lineTo(9.81221 + r3, 14.4026 + h3), t3.lineTo(6.30986 + r3, 10.4736 + h3), t3.closePath(), t3.fill("evenodd"), t3.stroke(), t3.restore(), t3.restore();
    }(i2, n2 - 12, s - h2, r2.color, r2.bgColor);
  }
  i2.fill();
}
var Si = class extends j {
  constructor() {
    super(...arguments), this.Lt = null, this.lr = new si(), this.j = -1, this.H = "", this.Gr = "";
  }
  it(t2) {
    this.Lt = t2;
  }
  ar(t2, i2) {
    this.j === t2 && this.H === i2 || (this.j = t2, this.H = i2, this.Gr = N(t2, i2), this.lr.ir());
  }
  br(t2, i2) {
    if (null === this.Lt || null === this.Lt.nt)
      return null;
    for (let n2 = this.Lt.nt.from; n2 < this.Lt.nt.to; n2++) {
      const s = this.Lt.st[n2];
      if (yi(s, t2, i2))
        return { gr: s.Jr, wr: s.wr };
    }
    return null;
  }
  Z({ context: t2 }, i2, n2) {
    if (null !== this.Lt && null !== this.Lt.nt) {
      t2.textBaseline = "middle", t2.font = this.Gr;
      for (let i3 = this.Lt.nt.from; i3 < this.Lt.nt.to; i3++) {
        const n3 = this.Lt.st[i3];
        void 0 !== n3.Jt && (n3.Jt.$i = this.lr.Si(t2, n3.Jt.Qr), n3.Jt.zt = this.j, n3.Jt.et = n3.et - n3.Jt.$i / 2), ki(n3, t2);
      }
    }
  }
};
function ki(t2, i2) {
  i2.fillStyle = t2.O, void 0 !== t2.Jt && function(t3, i3, n2, s) {
    t3.fillText(i3, n2, s);
  }(i2, t2.Jt.Qr, t2.Jt.et, t2.Jt.rt), function(t3, i3) {
    if (0 === t3.Ks)
      return;
    switch (t3.th) {
      case "arrowNormalDown":
        return void Mi(false, i3, t3.et, t3.rt, t3.Ks, t3);
      case "arrowNormalUp":
        return void Mi(true, i3, t3.et, t3.rt, t3.Ks, t3);
      case "arrowOptionDown":
        return void xi(false, i3, t3.et, t3.rt, t3.Ks, t3);
      case "arrowOptionUp":
        return void xi(true, i3, t3.et, t3.rt, t3.Ks, t3);
      case "arrowDown":
        return void wi(false, i3, t3.et, t3.rt, t3.Ks);
      case "arrowUp":
        return void wi(true, i3, t3.et, t3.rt, t3.Ks);
      case "circle":
        return void function(t4, i4, n2, s) {
          const e3 = (vi("circle", s) - 1) / 2;
          t4.beginPath(), t4.arc(i4, n2, e3, 0, 2 * Math.PI, false), t4.fill();
        }(i3, t3.et, t3.rt, t3.Ks);
      case "square":
        !function(t4, i4, n2, s) {
          const e3 = vi("square", s), r2 = (e3 - 1) / 2, h2 = i4 - r2, l2 = n2 - r2;
          t4.fillRect(h2, l2, e3, e3);
        }(i3, t3.et, t3.rt, t3.Ks);
    }
  }(t2, i2);
}
function yi(t2, i2, n2) {
  return !(void 0 === t2.Jt || !function(t3, i3, n3, s, e3, r2) {
    const h2 = s / 2;
    return e3 >= t3 && e3 <= t3 + n3 && r2 >= i3 - h2 && r2 <= i3 + h2;
  }(t2.Jt.et, t2.Jt.rt, t2.Jt.$i, t2.Jt.zt, i2, n2)) || function(t3, i3, n3) {
    if (0 === t3.Ks)
      return false;
    switch (t3.th) {
      case "arrowDown":
      case "arrowUp":
        return gi(0, t3.et, t3.rt, t3.Ks, i3, n3);
      case "circle":
        return function(t4, i4, n4, s, e3) {
          const r2 = 2 + vi("circle", n4) / 2, h2 = t4 - s, l2 = i4 - e3;
          return Math.sqrt(h2 * h2 + l2 * l2) <= r2;
        }(t3.et, t3.rt, t3.Ks, i3, n3);
      case "square":
        return bi(t3.et, t3.rt, t3.Ks, i3, n3);
    }
    return false;
  }(t2, i2, n2);
}
function Ci(t2, i2, n2, s, e3, r2, h2, l2, a2) {
  const o3 = O(n2) ? n2 : n2.xe, _2 = O(n2) ? n2 : n2.ge, u2 = O(n2) ? n2 : n2.Me, c2 = O(i2.size) ? Math.max(i2.size, 0) : 1, d2 = pi(l2.he()) * c2, f2 = d2 / 2;
  switch (t2.Ks = d2, i2.position) {
    case "inBar":
      return t2.rt = h2.Ot(o3, a2), void (void 0 !== t2.Jt && (t2.Jt.rt = t2.rt + f2 + r2 + 0.6 * e3));
    case "aboveBar":
      return t2.rt = h2.Ot(_2, a2) - f2 - s.ih, void 0 !== t2.Jt && (t2.Jt.rt = t2.rt - f2 - 0.6 * e3, s.ih += 1.2 * e3), void (s.ih += d2 + r2);
    case "belowBar":
      return t2.rt = h2.Ot(u2, a2) + f2 + s.nh, void 0 !== t2.Jt && (t2.Jt.rt = t2.rt + f2 + r2 + 0.6 * e3, s.nh += 1.2 * e3), void (s.nh += d2 + r2);
  }
}
var Ti = class {
  constructor(t2, i2) {
    this.bt = true, this.sh = true, this.eh = true, this.rh = null, this.Ht = new Si(), this.Wr = t2, this.Ui = i2, this.Lt = { st: [], nt: null };
  }
  gt(t2) {
    this.bt = true, this.eh = true, "data" === t2 && (this.sh = true);
  }
  xt(t2) {
    if (!this.Wr.Tt())
      return null;
    this.bt && this.hh();
    const i2 = this.Ui.W().layout;
    return this.Ht.ar(i2.fontSize, i2.fontFamily), this.Ht.it(this.Lt), this.Ht;
  }
  lh() {
    if (this.eh) {
      if (this.Wr.ah().length > 0) {
        const t2 = this.Ui.yt().he(), i2 = mi(t2), n2 = 1.5 * pi(t2) + 2 * i2;
        this.rh = { above: n2, below: n2 };
      } else
        this.rh = null;
      this.eh = false;
    }
    return this.rh;
  }
  hh() {
    const t2 = this.Wr.At(), i2 = this.Ui.yt(), n2 = this.Wr.ah();
    this.sh && (this.Lt.st = n2.map((t3) => Object.assign(Object.assign({}, t3), { ut: t3.time, et: 0, rt: 0, Ks: 0, th: t3.shape, O: t3.color, Jr: t3.Jr, wr: t3.id, Jt: void 0 })), this.sh = false);
    const s = this.Ui.W().layout;
    this.Lt.nt = null;
    const e3 = i2.Xs();
    if (null === e3)
      return;
    const r2 = this.Wr.Pt();
    if (null === r2)
      return;
    if (0 === this.Lt.st.length)
      return;
    let h2 = NaN;
    const l2 = mi(i2.he()), a2 = { ih: l2, nh: l2 };
    this.Lt.nt = Lt(this.Lt.st, e3, true);
    for (let e4 = this.Lt.nt.from; e4 < this.Lt.nt.to; e4++) {
      const o3 = n2[e4];
      o3.time !== h2 && (a2.ih = l2, a2.nh = l2, h2 = o3.time);
      const _2 = this.Lt.st[e4];
      _2.et = i2.Et(o3.time), void 0 !== o3.text && o3.text.length > 0 && (_2.Jt = { Qr: o3.text, et: 0, rt: 0, $i: 0, zt: 0 });
      const u2 = this.Wr.oh(o3.time);
      null !== u2 && Ci(_2, o3, u2, a2, s.fontSize, l2, t2, i2, r2.Vt);
    }
    this.bt = false;
  }
};
var Pi = class extends li {
  constructor(t2) {
    super(t2);
  }
  kr() {
    const t2 = this.Mr;
    t2.Tt = false;
    const i2 = this.Es.W();
    if (!i2.priceLineVisible || !this.Es.Tt())
      return;
    const n2 = this.Es.Yr(0 === i2.priceLineSource);
    n2.Xr || (t2.Tt = true, t2.rt = n2.yi, t2.O = this.Es._h(n2.O), t2.ht = i2.priceLineWidth, t2.Wt = i2.priceLineStyle);
  }
};
var Ri = class extends st {
  constructor(t2) {
    super(), this.$t = t2;
  }
  Ei(t2, i2, n2) {
    t2.Tt = false, i2.Tt = false;
    const s = this.$t;
    if (!s.Tt())
      return;
    const e3 = s.W(), r2 = e3.lastValueVisible, h2 = "" !== s.uh(), l2 = 0 === e3.seriesLastValueMode, a2 = s.Yr(false);
    if (a2.Xr)
      return;
    r2 && (t2.Jt = this.dh(a2, r2, l2), t2.Tt = 0 !== t2.Jt.length), (h2 || l2) && (i2.Jt = this.fh(a2, r2, h2, l2), i2.Tt = i2.Jt.length > 0);
    const o3 = s._h(a2.O), _2 = P(o3);
    n2.t = _2.t, n2.yi = a2.yi, i2.Bt = s.qt().It(a2.yi / s.At().zt()), t2.Bt = o3, t2.O = _2.i, i2.O = _2.i;
  }
  fh(t2, i2, n2, s) {
    let e3 = "";
    const r2 = this.$t.uh();
    return n2 && 0 !== r2.length && (e3 += `${r2} `), i2 && s && (e3 += this.$t.At().ph() ? t2.mh : t2.bh), e3.trim();
  }
  dh(t2, i2, n2) {
    return i2 ? n2 ? this.$t.At().ph() ? t2.bh : t2.mh : t2.Jt : "";
  }
};
function Di(t2, i2, n2, s) {
  const e3 = Number.isFinite(i2), r2 = Number.isFinite(n2);
  return e3 && r2 ? t2(i2, n2) : e3 || r2 ? e3 ? i2 : n2 : s;
}
var Oi = class {
  constructor(t2, i2) {
    this.wh = t2, this.gh = i2;
  }
  Mh(t2) {
    return null !== t2 && (this.wh === t2.wh && this.gh === t2.gh);
  }
  xh() {
    return new Oi(this.wh, this.gh);
  }
  Sh() {
    return this.wh;
  }
  kh() {
    return this.gh;
  }
  yh() {
    return this.gh - this.wh;
  }
  Fi() {
    return this.gh === this.wh || Number.isNaN(this.gh) || Number.isNaN(this.wh);
  }
  ts(t2) {
    return null === t2 ? this : new Oi(Di(Math.min, this.Sh(), t2.Sh(), -1 / 0), Di(Math.max, this.kh(), t2.kh(), 1 / 0));
  }
  Ch(t2) {
    if (!O(t2))
      return;
    if (0 === this.gh - this.wh)
      return;
    const i2 = 0.5 * (this.gh + this.wh);
    let n2 = this.gh - i2, s = this.wh - i2;
    n2 *= t2, s *= t2, this.gh = i2 + n2, this.wh = i2 + s;
  }
  Th(t2) {
    O(t2) && (this.gh += t2, this.wh += t2);
  }
  Ph() {
    return { minValue: this.wh, maxValue: this.gh };
  }
  static Rh(t2) {
    return null === t2 ? null : new Oi(t2.minValue, t2.maxValue);
  }
};
var Ai = class {
  constructor(t2, i2) {
    this.Dh = t2, this.Oh = i2 || null;
  }
  Ah() {
    return this.Dh;
  }
  Vh() {
    return this.Oh;
  }
  Ph() {
    return null === this.Dh ? null : { priceRange: this.Dh.Ph(), margins: this.Oh || void 0 };
  }
  static Rh(t2) {
    return null === t2 ? null : new Ai(Oi.Rh(t2.priceRange), t2.margins);
  }
};
var Vi = class extends li {
  constructor(t2, i2) {
    super(t2), this.Bh = i2;
  }
  kr() {
    const t2 = this.Mr;
    t2.Tt = false;
    const i2 = this.Bh.W();
    if (!this.Es.Tt() || !i2.lineVisible)
      return;
    const n2 = this.Bh.Ih();
    null !== n2 && (t2.Tt = true, t2.rt = n2, t2.O = i2.color, t2.ht = i2.lineWidth, t2.Wt = i2.lineStyle, t2.wr = this.Bh.W().id);
  }
};
var Bi = class extends st {
  constructor(t2, i2) {
    super(), this.Wr = t2, this.Bh = i2;
  }
  Ei(t2, i2, n2) {
    t2.Tt = false, i2.Tt = false;
    const s = this.Bh.W(), e3 = s.axisLabelVisible, r2 = "" !== s.title, h2 = this.Wr;
    if (!e3 || !h2.Tt())
      return;
    const l2 = this.Bh.Ih();
    if (null === l2)
      return;
    r2 && (i2.Jt = s.title, i2.Tt = true), i2.Bt = h2.qt().It(l2 / h2.At().zt()), t2.Jt = this.zh(s.price), t2.Tt = true;
    const a2 = P(s.axisLabelColor || s.color);
    n2.t = a2.t;
    const o3 = s.axisLabelTextColor || a2.i;
    t2.O = o3, i2.O = o3, n2.yi = l2;
  }
  zh(t2) {
    const i2 = this.Wr.Pt();
    return null === i2 ? "" : this.Wr.At().Wi(t2, i2.Vt);
  }
};
var Ii = class {
  constructor(t2, i2) {
    this.Wr = t2, this.cn = i2, this.Eh = new Vi(t2, this), this._r = new Bi(t2, this), this.Lh = new ri(this._r, t2, t2.qt());
  }
  Nh(t2) {
    D(this.cn, t2), this.gt(), this.Wr.qt().Fh();
  }
  W() {
    return this.cn;
  }
  Wh() {
    return this.Eh;
  }
  jh() {
    return this.Lh;
  }
  Hh() {
    return this._r;
  }
  gt() {
    this.Eh.gt(), this._r.gt();
  }
  Ih() {
    const t2 = this.Wr, i2 = t2.At();
    if (t2.qt().yt().Fi() || i2.Fi())
      return null;
    const n2 = t2.Pt();
    return null === n2 ? null : i2.Ot(this.cn.price, n2.Vt);
  }
};
var zi = class extends at {
  constructor(t2) {
    super(), this.Ui = t2;
  }
  qt() {
    return this.Ui;
  }
};
var Ei = { Bar: (t2, i2, n2, s) => {
  var e3;
  const r2 = i2.upColor, h2 = i2.downColor, l2 = b(t2(n2, s)), a2 = w(l2.Vt[0]) <= w(l2.Vt[3]);
  return { ue: null !== (e3 = l2.O) && void 0 !== e3 ? e3 : a2 ? r2 : h2 };
}, Candlestick: (t2, i2, n2, s) => {
  var e3, r2, h2;
  const l2 = i2.upColor, a2 = i2.downColor, o3 = i2.borderUpColor, _2 = i2.borderDownColor, u2 = i2.wickUpColor, c2 = i2.wickDownColor, d2 = b(t2(n2, s)), f2 = w(d2.Vt[0]) <= w(d2.Vt[3]);
  return { ue: null !== (e3 = d2.O) && void 0 !== e3 ? e3 : f2 ? l2 : a2, Le: null !== (r2 = d2.Bt) && void 0 !== r2 ? r2 : f2 ? o3 : _2, Ee: null !== (h2 = d2.$h) && void 0 !== h2 ? h2 : f2 ? u2 : c2 };
}, Custom: (t2, i2, n2, s) => {
  var e3;
  return { ue: null !== (e3 = b(t2(n2, s)).O) && void 0 !== e3 ? e3 : i2.color };
}, Area: (t2, i2, n2, s) => {
  var e3, r2, h2, l2;
  const a2 = b(t2(n2, s));
  return { ue: null !== (e3 = a2._t) && void 0 !== e3 ? e3 : i2.lineColor, _t: null !== (r2 = a2._t) && void 0 !== r2 ? r2 : i2.lineColor, Ts: null !== (h2 = a2.Ts) && void 0 !== h2 ? h2 : i2.topColor, Ps: null !== (l2 = a2.Ps) && void 0 !== l2 ? l2 : i2.bottomColor };
}, Baseline: (t2, i2, n2, s) => {
  var e3, r2, h2, l2, a2, o3;
  const _2 = b(t2(n2, s));
  return { ue: _2.Vt[3] >= i2.baseValue.price ? i2.topLineColor : i2.bottomLineColor, Pe: null !== (e3 = _2.Pe) && void 0 !== e3 ? e3 : i2.topLineColor, Re: null !== (r2 = _2.Re) && void 0 !== r2 ? r2 : i2.bottomLineColor, Se: null !== (h2 = _2.Se) && void 0 !== h2 ? h2 : i2.topFillColor1, ke: null !== (l2 = _2.ke) && void 0 !== l2 ? l2 : i2.topFillColor2, ye: null !== (a2 = _2.ye) && void 0 !== a2 ? a2 : i2.bottomFillColor1, Ce: null !== (o3 = _2.Ce) && void 0 !== o3 ? o3 : i2.bottomFillColor2 };
}, Line: (t2, i2, n2, s) => {
  var e3, r2;
  const h2 = b(t2(n2, s));
  return { ue: null !== (e3 = h2.O) && void 0 !== e3 ? e3 : i2.color, _t: null !== (r2 = h2.O) && void 0 !== r2 ? r2 : i2.color };
}, Histogram: (t2, i2, n2, s) => {
  var e3;
  return { ue: null !== (e3 = b(t2(n2, s)).O) && void 0 !== e3 ? e3 : i2.color };
} };
var Li = class {
  constructor(t2) {
    this.Uh = (t3, i2) => void 0 !== i2 ? i2.Vt : this.Wr.In().qh(t3), this.Wr = t2, this.Yh = Ei[t2.Xh()];
  }
  Hs(t2, i2) {
    return this.Yh(this.Uh, this.Wr.W(), t2, i2);
  }
};
var Ni;
!function(t2) {
  t2[t2.NearestLeft = -1] = "NearestLeft", t2[t2.None = 0] = "None", t2[t2.NearestRight = 1] = "NearestRight";
}(Ni || (Ni = {}));
var Fi = 30;
var Wi = class {
  constructor() {
    this.Kh = [], this.Zh = /* @__PURE__ */ new Map(), this.Gh = /* @__PURE__ */ new Map();
  }
  Jh() {
    return this.Ks() > 0 ? this.Kh[this.Kh.length - 1] : null;
  }
  Qh() {
    return this.Ks() > 0 ? this.tl(0) : null;
  }
  Bn() {
    return this.Ks() > 0 ? this.tl(this.Kh.length - 1) : null;
  }
  Ks() {
    return this.Kh.length;
  }
  Fi() {
    return 0 === this.Ks();
  }
  Kr(t2) {
    return null !== this.il(t2, 0);
  }
  qh(t2) {
    return this.nl(t2);
  }
  nl(t2, i2 = 0) {
    const n2 = this.il(t2, i2);
    return null === n2 ? null : Object.assign(Object.assign({}, this.sl(n2)), { se: this.tl(n2) });
  }
  ie() {
    return this.Kh;
  }
  el(t2, i2, n2) {
    if (this.Fi())
      return null;
    let s = null;
    for (const e3 of n2) {
      s = ji(s, this.rl(t2, i2, e3));
    }
    return s;
  }
  it(t2) {
    this.Gh.clear(), this.Zh.clear(), this.Kh = t2;
  }
  tl(t2) {
    return this.Kh[t2].se;
  }
  sl(t2) {
    return this.Kh[t2];
  }
  il(t2, i2) {
    const n2 = this.hl(t2);
    if (null === n2 && 0 !== i2)
      switch (i2) {
        case -1:
          return this.ll(t2);
        case 1:
          return this.al(t2);
        default:
          throw new TypeError("Unknown search mode");
      }
    return n2;
  }
  ll(t2) {
    let i2 = this.ol(t2);
    return i2 > 0 && (i2 -= 1), i2 !== this.Kh.length && this.tl(i2) < t2 ? i2 : null;
  }
  al(t2) {
    const i2 = this._l(t2);
    return i2 !== this.Kh.length && t2 < this.tl(i2) ? i2 : null;
  }
  hl(t2) {
    const i2 = this.ol(t2);
    return i2 === this.Kh.length || t2 < this.Kh[i2].se ? null : i2;
  }
  ol(t2) {
    return Bt(this.Kh, t2, (t3, i2) => t3.se < i2);
  }
  _l(t2) {
    return It(this.Kh, t2, (t3, i2) => t3.se > i2);
  }
  ul(t2, i2, n2) {
    let s = null;
    for (let e3 = t2; e3 < i2; e3++) {
      const t3 = this.Kh[e3].Vt[n2];
      Number.isNaN(t3) || (null === s ? s = { cl: t3, dl: t3 } : (t3 < s.cl && (s.cl = t3), t3 > s.dl && (s.dl = t3)));
    }
    return s;
  }
  rl(t2, i2, n2) {
    if (this.Fi())
      return null;
    let s = null;
    const e3 = b(this.Qh()), r2 = b(this.Bn()), h2 = Math.max(t2, e3), l2 = Math.min(i2, r2), a2 = Math.ceil(h2 / Fi) * Fi, o3 = Math.max(a2, Math.floor(l2 / Fi) * Fi);
    {
      const t3 = this.ol(h2), e4 = this._l(Math.min(l2, a2, i2));
      s = ji(s, this.ul(t3, e4, n2));
    }
    let _2 = this.Zh.get(n2);
    void 0 === _2 && (_2 = /* @__PURE__ */ new Map(), this.Zh.set(n2, _2));
    for (let t3 = Math.max(a2 + 1, h2); t3 < o3; t3 += Fi) {
      const i3 = Math.floor(t3 / Fi);
      let e4 = _2.get(i3);
      if (void 0 === e4) {
        const t4 = this.ol(i3 * Fi), s2 = this._l((i3 + 1) * Fi - 1);
        e4 = this.ul(t4, s2, n2), _2.set(i3, e4);
      }
      s = ji(s, e4);
    }
    {
      const t3 = this.ol(o3), i3 = this._l(l2);
      s = ji(s, this.ul(t3, i3, n2));
    }
    return s;
  }
};
function ji(t2, i2) {
  if (null === t2)
    return i2;
  if (null === i2)
    return t2;
  return { cl: Math.min(t2.cl, i2.cl), dl: Math.max(t2.dl, i2.dl) };
}
var Hi = class {
  constructor(t2) {
    this.fl = t2;
  }
  K(t2, i2, n2) {
    this.fl.draw(t2);
  }
  G(t2, i2, n2) {
    var s, e3;
    null === (e3 = (s = this.fl).drawBackground) || void 0 === e3 || e3.call(s, t2);
  }
};
var $i = class {
  constructor(t2) {
    this.Qe = null, this.wn = t2;
  }
  xt() {
    var t2;
    const i2 = this.wn.renderer();
    if (null === i2)
      return null;
    if ((null === (t2 = this.Qe) || void 0 === t2 ? void 0 : t2.vl) === i2)
      return this.Qe.pl;
    const n2 = new Hi(i2);
    return this.Qe = { vl: i2, pl: n2 }, n2;
  }
  ml() {
    var t2, i2, n2;
    return null !== (n2 = null === (i2 = (t2 = this.wn).zOrder) || void 0 === i2 ? void 0 : i2.call(t2)) && void 0 !== n2 ? n2 : "normal";
  }
};
function Ui(t2) {
  var i2, n2, s, e3, r2;
  return { Jt: t2.text(), yi: t2.coordinate(), ki: null === (i2 = t2.fixedCoordinate) || void 0 === i2 ? void 0 : i2.call(t2), O: t2.textColor(), t: t2.backColor(), Tt: null === (s = null === (n2 = t2.visible) || void 0 === n2 ? void 0 : n2.call(t2)) || void 0 === s || s, ai: null === (r2 = null === (e3 = t2.tickVisible) || void 0 === e3 ? void 0 : e3.call(t2)) || void 0 === r2 || r2 };
}
var qi = class {
  constructor(t2, i2) {
    this.Ht = new ht(), this.bl = t2, this.wl = i2;
  }
  xt() {
    return this.Ht.it(Object.assign({ $i: this.wl.$i() }, Ui(this.bl))), this.Ht;
  }
};
var Yi = class extends st {
  constructor(t2, i2) {
    super(), this.bl = t2, this.Li = i2;
  }
  Ei(t2, i2, n2) {
    const s = Ui(this.bl);
    n2.t = s.t, t2.O = s.O;
    const e3 = 2 / 12 * this.Li.P();
    n2.gi = e3, n2.Mi = e3, n2.yi = s.yi, n2.ki = s.ki, t2.Jt = s.Jt, t2.Tt = s.Tt, t2.ai = s.ai;
  }
};
var Xi = class {
  constructor(t2, i2) {
    this.gl = null, this.Ml = null, this.xl = null, this.Sl = null, this.kl = null, this.yl = t2, this.Wr = i2;
  }
  Cl() {
    return this.yl;
  }
  On() {
    var t2, i2;
    null === (i2 = (t2 = this.yl).updateAllViews) || void 0 === i2 || i2.call(t2);
  }
  Pn() {
    var t2, i2, n2, s;
    const e3 = null !== (n2 = null === (i2 = (t2 = this.yl).paneViews) || void 0 === i2 ? void 0 : i2.call(t2)) && void 0 !== n2 ? n2 : [];
    if ((null === (s = this.gl) || void 0 === s ? void 0 : s.vl) === e3)
      return this.gl.pl;
    const r2 = e3.map((t3) => new $i(t3));
    return this.gl = { vl: e3, pl: r2 }, r2;
  }
  tn() {
    var t2, i2, n2, s;
    const e3 = null !== (n2 = null === (i2 = (t2 = this.yl).timeAxisViews) || void 0 === i2 ? void 0 : i2.call(t2)) && void 0 !== n2 ? n2 : [];
    if ((null === (s = this.Ml) || void 0 === s ? void 0 : s.vl) === e3)
      return this.Ml.pl;
    const r2 = this.Wr.qt().yt(), h2 = e3.map((t3) => new qi(t3, r2));
    return this.Ml = { vl: e3, pl: h2 }, h2;
  }
  Rn() {
    var t2, i2, n2, s;
    const e3 = null !== (n2 = null === (i2 = (t2 = this.yl).priceAxisViews) || void 0 === i2 ? void 0 : i2.call(t2)) && void 0 !== n2 ? n2 : [];
    if ((null === (s = this.xl) || void 0 === s ? void 0 : s.vl) === e3)
      return this.xl.pl;
    const r2 = this.Wr.At(), h2 = e3.map((t3) => new Yi(t3, r2));
    return this.xl = { vl: e3, pl: h2 }, h2;
  }
  Tl() {
    var t2, i2, n2, s;
    const e3 = null !== (n2 = null === (i2 = (t2 = this.yl).priceAxisPaneViews) || void 0 === i2 ? void 0 : i2.call(t2)) && void 0 !== n2 ? n2 : [];
    if ((null === (s = this.Sl) || void 0 === s ? void 0 : s.vl) === e3)
      return this.Sl.pl;
    const r2 = e3.map((t3) => new $i(t3));
    return this.Sl = { vl: e3, pl: r2 }, r2;
  }
  Pl() {
    var t2, i2, n2, s;
    const e3 = null !== (n2 = null === (i2 = (t2 = this.yl).timeAxisPaneViews) || void 0 === i2 ? void 0 : i2.call(t2)) && void 0 !== n2 ? n2 : [];
    if ((null === (s = this.kl) || void 0 === s ? void 0 : s.vl) === e3)
      return this.kl.pl;
    const r2 = e3.map((t3) => new $i(t3));
    return this.kl = { vl: e3, pl: r2 }, r2;
  }
  Rl(t2, i2) {
    var n2, s, e3;
    return null !== (e3 = null === (s = (n2 = this.yl).autoscaleInfo) || void 0 === s ? void 0 : s.call(n2, t2, i2)) && void 0 !== e3 ? e3 : null;
  }
  br(t2, i2) {
    var n2, s, e3;
    return null !== (e3 = null === (s = (n2 = this.yl).hitTest) || void 0 === s ? void 0 : s.call(n2, t2, i2)) && void 0 !== e3 ? e3 : null;
  }
};
function Ki(t2, i2, n2, s) {
  t2.forEach((t3) => {
    i2(t3).forEach((t4) => {
      t4.ml() === n2 && s.push(t4);
    });
  });
}
function Zi(t2) {
  return t2.Pn();
}
function Gi(t2) {
  return t2.Tl();
}
function Ji(t2) {
  return t2.Pl();
}
var Qi = class extends zi {
  constructor(t2, i2, n2, s, e3) {
    super(t2), this.Lt = new Wi(), this.Eh = new Pi(this), this.Dl = [], this.Ol = new ai(this), this.Al = null, this.Vl = null, this.Bl = [], this.Il = [], this.zl = null, this.El = [], this.cn = i2, this.Ll = n2;
    const r2 = new Ri(this);
    this.hn = [r2], this.Lh = new ri(r2, this, t2), "Area" !== n2 && "Line" !== n2 && "Baseline" !== n2 || (this.Al = new di(this)), this.Nl(), this.Fl(e3);
  }
  S() {
    null !== this.zl && clearTimeout(this.zl);
  }
  _h(t2) {
    return this.cn.priceLineColor || t2;
  }
  Yr(t2) {
    const i2 = { Xr: true }, n2 = this.At();
    if (this.qt().yt().Fi() || n2.Fi() || this.Lt.Fi())
      return i2;
    const s = this.qt().yt().Xs(), e3 = this.Pt();
    if (null === s || null === e3)
      return i2;
    let r2, h2;
    if (t2) {
      const t3 = this.Lt.Jh();
      if (null === t3)
        return i2;
      r2 = t3, h2 = t3.se;
    } else {
      const t3 = this.Lt.nl(s.di(), -1);
      if (null === t3)
        return i2;
      if (r2 = this.Lt.qh(t3.se), null === r2)
        return i2;
      h2 = t3.se;
    }
    const l2 = r2.Vt[3], a2 = this.$s().Hs(h2, { Vt: r2 }), o3 = n2.Ot(l2, e3.Vt);
    return { Xr: false, ct: l2, Jt: n2.Wi(l2, e3.Vt), mh: n2.Wl(l2), bh: n2.jl(l2, e3.Vt), O: a2.ue, yi: o3, se: h2 };
  }
  $s() {
    return null !== this.Vl || (this.Vl = new Li(this)), this.Vl;
  }
  W() {
    return this.cn;
  }
  Nh(t2) {
    const i2 = t2.priceScaleId;
    void 0 !== i2 && i2 !== this.cn.priceScaleId && this.qt().Hl(this, i2), D(this.cn, t2), void 0 !== t2.priceFormat && (this.Nl(), this.qt().$l()), this.qt().Ul(this), this.qt().ql(), this.wn.gt("options");
  }
  it(t2, i2) {
    this.Lt.it(t2), this.Yl(), this.wn.gt("data"), this.dn.gt("data"), null !== this.Al && (i2 && i2.Xl ? this.Al.Hr() : 0 === t2.length && this.Al.jr());
    const n2 = this.qt().cr(this);
    this.qt().Kl(n2), this.qt().Ul(this), this.qt().ql(), this.qt().Fh();
  }
  Zl(t2) {
    this.Bl = t2, this.Yl();
    const i2 = this.qt().cr(this);
    this.dn.gt("data"), this.qt().Kl(i2), this.qt().Ul(this), this.qt().ql(), this.qt().Fh();
  }
  Gl() {
    return this.Bl;
  }
  ah() {
    return this.Il;
  }
  Jl(t2) {
    const i2 = new Ii(this, t2);
    return this.Dl.push(i2), this.qt().Ul(this), i2;
  }
  Ql(t2) {
    const i2 = this.Dl.indexOf(t2);
    -1 !== i2 && this.Dl.splice(i2, 1), this.qt().Ul(this);
  }
  Xh() {
    return this.Ll;
  }
  Pt() {
    const t2 = this.ta();
    return null === t2 ? null : { Vt: t2.Vt[3], ia: t2.ut };
  }
  ta() {
    const t2 = this.qt().yt().Xs();
    if (null === t2)
      return null;
    const i2 = t2.Os();
    return this.Lt.nl(i2, 1);
  }
  In() {
    return this.Lt;
  }
  oh(t2) {
    const i2 = this.Lt.qh(t2);
    return null === i2 ? null : "Bar" === this.Ll || "Candlestick" === this.Ll || "Custom" === this.Ll ? { we: i2.Vt[0], ge: i2.Vt[1], Me: i2.Vt[2], xe: i2.Vt[3] } : i2.Vt[3];
  }
  na(t2) {
    const i2 = [];
    Ki(this.El, Zi, "top", i2);
    const n2 = this.Al;
    return null !== n2 && n2.Tt() ? (null === this.zl && n2.Ur() && (this.zl = setTimeout(() => {
      this.zl = null, this.qt().sa();
    }, 0)), n2.$r(), i2.push(n2), i2) : i2;
  }
  Pn() {
    const t2 = [];
    this.ea() || t2.push(this.Ol), t2.push(this.wn, this.Eh, this.dn);
    const i2 = this.Dl.map((t3) => t3.Wh());
    return t2.push(...i2), Ki(this.El, Zi, "normal", t2), t2;
  }
  ra() {
    return this.ha(Zi, "bottom");
  }
  la(t2) {
    return this.ha(Gi, t2);
  }
  aa(t2) {
    return this.ha(Ji, t2);
  }
  oa(t2, i2) {
    return this.El.map((n2) => n2.br(t2, i2)).filter((t3) => null !== t3);
  }
  Qi(t2) {
    return [this.Lh, ...this.Dl.map((t3) => t3.jh())];
  }
  Rn(t2, i2) {
    if (i2 !== this.Xi && !this.ea())
      return [];
    const n2 = [...this.hn];
    for (const t3 of this.Dl)
      n2.push(t3.Hh());
    return this.El.forEach((t3) => {
      n2.push(...t3.Rn());
    }), n2;
  }
  tn() {
    const t2 = [];
    return this.El.forEach((i2) => {
      t2.push(...i2.tn());
    }), t2;
  }
  Rl(t2, i2) {
    if (void 0 !== this.cn.autoscaleInfoProvider) {
      const n2 = this.cn.autoscaleInfoProvider(() => {
        const n3 = this._a(t2, i2);
        return null === n3 ? null : n3.Ph();
      });
      return Ai.Rh(n2);
    }
    return this._a(t2, i2);
  }
  ua() {
    return this.cn.priceFormat.minMove;
  }
  ca() {
    return this.da;
  }
  On() {
    var t2;
    this.wn.gt(), this.dn.gt();
    for (const t3 of this.hn)
      t3.gt();
    for (const t3 of this.Dl)
      t3.gt();
    this.Eh.gt(), this.Ol.gt(), null === (t2 = this.Al) || void 0 === t2 || t2.gt(), this.El.forEach((t3) => t3.On());
  }
  At() {
    return b(super.At());
  }
  Ct(t2) {
    if (!(("Line" === this.Ll || "Area" === this.Ll || "Baseline" === this.Ll) && this.cn.crosshairMarkerVisible))
      return null;
    const i2 = this.Lt.qh(t2);
    if (null === i2)
      return null;
    return { ct: i2.Vt[3], ot: this.fa(), Bt: this.va(), Dt: this.pa(), Rt: this.ma(t2) };
  }
  uh() {
    return this.cn.title;
  }
  Tt() {
    return this.cn.visible;
  }
  ba(t2) {
    this.El.push(new Xi(t2, this));
  }
  wa(t2) {
    this.El = this.El.filter((i2) => i2.Cl() !== t2);
  }
  ga() {
    if (this.wn instanceof Gt != false)
      return (t2) => this.wn.Fe(t2);
  }
  Ma() {
    if (this.wn instanceof Gt != false)
      return (t2) => this.wn.We(t2);
  }
  ea() {
    return !ut(this.At().xa());
  }
  _a(t2, i2) {
    if (!A(t2) || !A(i2) || this.Lt.Fi())
      return null;
    const n2 = "Line" === this.Ll || "Area" === this.Ll || "Baseline" === this.Ll || "Histogram" === this.Ll ? [3] : [2, 1], s = this.Lt.el(t2, i2, n2);
    let e3 = null !== s ? new Oi(s.cl, s.dl) : null;
    if ("Histogram" === this.Xh()) {
      const t3 = this.cn.base, i3 = new Oi(t3, t3);
      e3 = null !== e3 ? e3.ts(i3) : i3;
    }
    let r2 = this.dn.lh();
    return this.El.forEach((n3) => {
      const s2 = n3.Rl(t2, i2);
      if (null == s2 ? void 0 : s2.priceRange) {
        const t3 = new Oi(s2.priceRange.minValue, s2.priceRange.maxValue);
        e3 = null !== e3 ? e3.ts(t3) : t3;
      }
      var h2, l2, a2, o3;
      (null == s2 ? void 0 : s2.margins) && (h2 = r2, l2 = s2.margins, r2 = { above: Math.max(null !== (a2 = null == h2 ? void 0 : h2.above) && void 0 !== a2 ? a2 : 0, l2.above), below: Math.max(null !== (o3 = null == h2 ? void 0 : h2.below) && void 0 !== o3 ? o3 : 0, l2.below) });
    }), new Ai(e3, r2);
  }
  fa() {
    switch (this.Ll) {
      case "Line":
      case "Area":
      case "Baseline":
        return this.cn.crosshairMarkerRadius;
    }
    return 0;
  }
  va() {
    switch (this.Ll) {
      case "Line":
      case "Area":
      case "Baseline": {
        const t2 = this.cn.crosshairMarkerBorderColor;
        if (0 !== t2.length)
          return t2;
      }
    }
    return null;
  }
  pa() {
    switch (this.Ll) {
      case "Line":
      case "Area":
      case "Baseline":
        return this.cn.crosshairMarkerBorderWidth;
    }
    return 0;
  }
  ma(t2) {
    switch (this.Ll) {
      case "Line":
      case "Area":
      case "Baseline": {
        const t3 = this.cn.crosshairMarkerBackgroundColor;
        if (0 !== t3.length)
          return t3;
      }
    }
    return this.$s().Hs(t2).ue;
  }
  Nl() {
    switch (this.cn.priceFormat.type) {
      case "custom":
        this.da = { format: this.cn.priceFormat.formatter };
        break;
      case "volume":
        this.da = new mt(this.cn.priceFormat.precision);
        break;
      case "percent":
        this.da = new pt(this.cn.priceFormat.precision);
        break;
      default: {
        const t2 = Math.pow(10, this.cn.priceFormat.precision);
        this.da = new vt(t2, this.cn.priceFormat.minMove * t2);
      }
    }
    null !== this.Xi && this.Xi.Sa();
  }
  Yl() {
    const t2 = this.qt().yt();
    if (!t2.ka() || this.Lt.Fi())
      return void (this.Il = []);
    const i2 = b(this.Lt.Qh());
    this.Il = this.Bl.map((n2, s) => {
      const e3 = b(t2.ya(n2.time, true)), r2 = e3 < i2 ? 1 : -1, h2 = b(this.Lt.nl(e3, r2)).se;
      return Object.assign(Object.assign({}, n2), { time: h2, position: n2.position, shape: n2.shape, color: n2.color, id: n2.id, Jr: s, text: n2.text, size: n2.size, originalTime: n2.originalTime });
    });
  }
  Fl(t2) {
    switch (this.dn = new Ti(this, this.qt()), this.Ll) {
      case "Bar":
        this.wn = new $t(this, this.qt());
        break;
      case "Candlestick":
        this.wn = new Kt(this, this.qt());
        break;
      case "Line":
        this.wn = new ii(this, this.qt());
        break;
      case "Custom":
        this.wn = new Gt(this, this.qt(), m(t2));
        break;
      case "Area":
        this.wn = new Wt(this, this.qt());
        break;
      case "Baseline":
        this.wn = new Yt(this, this.qt());
        break;
      case "Histogram":
        this.wn = new ti(this, this.qt());
        break;
      default:
        throw Error("Unknown chart style assigned: " + this.Ll);
    }
  }
  ha(t2, i2) {
    const n2 = [];
    return Ki(this.El, t2, i2, n2), n2;
  }
};
var tn = class {
  constructor(t2) {
    this.cn = t2;
  }
  Ca(t2, i2, n2) {
    let s = t2;
    if (0 === this.cn.mode)
      return s;
    const e3 = n2.vn(), r2 = e3.Pt();
    if (null === r2)
      return s;
    const h2 = e3.Ot(t2, r2), l2 = n2.Ta().filter((t3) => t3 instanceof Qi).reduce((t3, s2) => {
      if (n2.dr(s2) || !s2.Tt())
        return t3;
      const e4 = s2.At(), r3 = s2.In();
      if (e4.Fi() || !r3.Kr(i2))
        return t3;
      const h3 = r3.qh(i2);
      if (null === h3)
        return t3;
      const l3 = w(s2.Pt());
      return t3.concat([e4.Ot(h3.Vt[3], l3.Vt)]);
    }, []);
    if (0 === l2.length)
      return s;
    l2.sort((t3, i3) => Math.abs(t3 - h2) - Math.abs(i3 - h2));
    const a2 = l2[0];
    return s = e3.pn(a2, r2), s;
  }
};
var nn = class extends Y {
  constructor() {
    super(...arguments), this.Lt = null;
  }
  it(t2) {
    this.Lt = t2;
  }
  Z({ context: t2, bitmapSize: i2, horizontalPixelRatio: n2, verticalPixelRatio: s }) {
    if (null === this.Lt)
      return;
    const e3 = Math.max(1, Math.floor(n2));
    t2.lineWidth = e3, function(t3, i3) {
      t3.save(), t3.lineWidth % 2 && t3.translate(0.5, 0.5), i3(), t3.restore();
    }(t2, () => {
      const r2 = b(this.Lt);
      if (r2.Pa) {
        t2.strokeStyle = r2.Ra, f(t2, r2.Da), t2.beginPath();
        for (const s2 of r2.Oa) {
          const r3 = Math.round(s2.Aa * n2);
          t2.moveTo(r3, -e3), t2.lineTo(r3, i2.height + e3);
        }
        t2.stroke();
      }
      if (r2.Va) {
        t2.strokeStyle = r2.Ba, f(t2, r2.Ia), t2.beginPath();
        for (const n3 of r2.za) {
          const r3 = Math.round(n3.Aa * s);
          t2.moveTo(-e3, r3), t2.lineTo(i2.width + e3, r3);
        }
        t2.stroke();
      }
    });
  }
};
var sn = class {
  constructor(t2) {
    this.Ht = new nn(), this.bt = true, this.nn = t2;
  }
  gt() {
    this.bt = true;
  }
  xt() {
    if (this.bt) {
      const t2 = this.nn.qt().W().grid, i2 = { Va: t2.horzLines.visible, Pa: t2.vertLines.visible, Ba: t2.horzLines.color, Ra: t2.vertLines.color, Ia: t2.horzLines.style, Da: t2.vertLines.style, za: this.nn.vn().Ea(), Oa: (this.nn.qt().yt().Ea() || []).map((t3) => ({ Aa: t3.coord })) };
      this.Ht.it(i2), this.bt = false;
    }
    return this.Ht;
  }
};
var en = class {
  constructor(t2) {
    this.wn = new sn(t2);
  }
  Wh() {
    return this.wn;
  }
};
var rn = { La: 4, Na: 1e-4 };
function hn(t2, i2) {
  const n2 = 100 * (t2 - i2) / i2;
  return i2 < 0 ? -n2 : n2;
}
function ln(t2, i2) {
  const n2 = hn(t2.Sh(), i2), s = hn(t2.kh(), i2);
  return new Oi(n2, s);
}
function an(t2, i2) {
  const n2 = 100 * (t2 - i2) / i2 + 100;
  return i2 < 0 ? -n2 : n2;
}
function on(t2, i2) {
  const n2 = an(t2.Sh(), i2), s = an(t2.kh(), i2);
  return new Oi(n2, s);
}
function _n(t2, i2) {
  const n2 = Math.abs(t2);
  if (n2 < 1e-15)
    return 0;
  const s = Math.log10(n2 + i2.Na) + i2.La;
  return t2 < 0 ? -s : s;
}
function un(t2, i2) {
  const n2 = Math.abs(t2);
  if (n2 < 1e-15)
    return 0;
  const s = Math.pow(10, n2 - i2.La) - i2.Na;
  return t2 < 0 ? -s : s;
}
function cn(t2, i2) {
  if (null === t2)
    return null;
  const n2 = _n(t2.Sh(), i2), s = _n(t2.kh(), i2);
  return new Oi(n2, s);
}
function dn(t2, i2) {
  if (null === t2)
    return null;
  const n2 = un(t2.Sh(), i2), s = un(t2.kh(), i2);
  return new Oi(n2, s);
}
function fn(t2) {
  if (null === t2)
    return rn;
  const i2 = Math.abs(t2.kh() - t2.Sh());
  if (i2 >= 1 || i2 < 1e-15)
    return rn;
  const n2 = Math.ceil(Math.abs(Math.log10(i2))), s = rn.La + n2;
  return { La: s, Na: 1 / Math.pow(10, s) };
}
var vn = class {
  constructor(t2, i2) {
    if (this.Fa = t2, this.Wa = i2, function(t3) {
      if (t3 < 0)
        return false;
      for (let i3 = t3; i3 > 1; i3 /= 10)
        if (i3 % 10 != 0)
          return false;
      return true;
    }(this.Fa))
      this.ja = [2, 2.5, 2];
    else {
      this.ja = [];
      for (let t3 = this.Fa; 1 !== t3; ) {
        if (t3 % 2 == 0)
          this.ja.push(2), t3 /= 2;
        else {
          if (t3 % 5 != 0)
            throw new Error("unexpected base");
          this.ja.push(2, 2.5), t3 /= 5;
        }
        if (this.ja.length > 100)
          throw new Error("something wrong with base");
      }
    }
  }
  Ha(t2, i2, n2) {
    const s = 0 === this.Fa ? 0 : 1 / this.Fa;
    let e3 = Math.pow(10, Math.max(0, Math.ceil(Math.log10(t2 - i2)))), r2 = 0, h2 = this.Wa[0];
    for (; ; ) {
      const t3 = Ct(e3, s, 1e-14) && e3 > s + 1e-14, i3 = Ct(e3, n2 * h2, 1e-14), l3 = Ct(e3, 1, 1e-14);
      if (!(t3 && i3 && l3))
        break;
      e3 /= h2, h2 = this.Wa[++r2 % this.Wa.length];
    }
    if (e3 <= s + 1e-14 && (e3 = s), e3 = Math.max(1, e3), this.ja.length > 0 && (l2 = e3, a2 = 1, o3 = 1e-14, Math.abs(l2 - a2) < o3))
      for (r2 = 0, h2 = this.ja[0]; Ct(e3, n2 * h2, 1e-14) && e3 > s + 1e-14; )
        e3 /= h2, h2 = this.ja[++r2 % this.ja.length];
    var l2, a2, o3;
    return e3;
  }
};
var pn = class {
  constructor(t2, i2, n2, s) {
    this.$a = [], this.Li = t2, this.Fa = i2, this.Ua = n2, this.qa = s;
  }
  Ha(t2, i2) {
    if (t2 < i2)
      throw new Error("high < low");
    const n2 = this.Li.zt(), s = (t2 - i2) * this.Ya() / n2, e3 = new vn(this.Fa, [2, 2.5, 2]), r2 = new vn(this.Fa, [2, 2, 2.5]), h2 = new vn(this.Fa, [2.5, 2, 2]), l2 = [];
    return l2.push(e3.Ha(t2, i2, s), r2.Ha(t2, i2, s), h2.Ha(t2, i2, s)), function(t3) {
      if (t3.length < 1)
        throw Error("array is empty");
      let i3 = t3[0];
      for (let n3 = 1; n3 < t3.length; ++n3)
        t3[n3] < i3 && (i3 = t3[n3]);
      return i3;
    }(l2);
  }
  Xa() {
    const t2 = this.Li, i2 = t2.Pt();
    if (null === i2)
      return void (this.$a = []);
    const n2 = t2.zt(), s = this.Ua(n2 - 1, i2), e3 = this.Ua(0, i2), r2 = this.Li.W().entireTextOnly ? this.Ka() / 2 : 0, h2 = r2, l2 = n2 - 1 - r2, a2 = Math.max(s, e3), o3 = Math.min(s, e3);
    if (a2 === o3)
      return void (this.$a = []);
    let _2 = this.Ha(a2, o3), u2 = a2 % _2;
    u2 += u2 < 0 ? _2 : 0;
    const c2 = a2 >= o3 ? 1 : -1;
    let d2 = null, f2 = 0;
    for (let n3 = a2 - u2; n3 > o3; n3 -= _2) {
      const s2 = this.qa(n3, i2, true);
      null !== d2 && Math.abs(s2 - d2) < this.Ya() || (s2 < h2 || s2 > l2 || (f2 < this.$a.length ? (this.$a[f2].Aa = s2, this.$a[f2].Za = t2.Ga(n3)) : this.$a.push({ Aa: s2, Za: t2.Ga(n3) }), f2++, d2 = s2, t2.Ja() && (_2 = this.Ha(n3 * c2, o3))));
    }
    this.$a.length = f2;
  }
  Ea() {
    return this.$a;
  }
  Ka() {
    return this.Li.P();
  }
  Ya() {
    return Math.ceil(2.5 * this.Ka());
  }
};
function mn(t2) {
  return t2.slice().sort((t3, i2) => b(t3.Zi()) - b(i2.Zi()));
}
var bn;
!function(t2) {
  t2[t2.Normal = 0] = "Normal", t2[t2.Logarithmic = 1] = "Logarithmic", t2[t2.Percentage = 2] = "Percentage", t2[t2.IndexedTo100 = 3] = "IndexedTo100";
}(bn || (bn = {}));
var wn = new pt();
var gn = new vt(100, 1);
var Mn = class {
  constructor(t2, i2, n2, s) {
    this.Qa = 0, this.io = null, this.Dh = null, this.no = null, this.so = { eo: false, ro: null }, this.ho = 0, this.lo = 0, this.ao = new R(), this.oo = new R(), this._o = [], this.uo = null, this.co = null, this.do = null, this.fo = null, this.da = gn, this.vo = fn(null), this.po = t2, this.cn = i2, this.mo = n2, this.bo = s, this.wo = new pn(this, 100, this.Mo.bind(this), this.xo.bind(this));
  }
  xa() {
    return this.po;
  }
  W() {
    return this.cn;
  }
  Nh(t2) {
    if (D(this.cn, t2), this.Sa(), void 0 !== t2.mode && this.So({ yr: t2.mode }), void 0 !== t2.scaleMargins) {
      const i2 = m(t2.scaleMargins.top), n2 = m(t2.scaleMargins.bottom);
      if (i2 < 0 || i2 > 1)
        throw new Error(`Invalid top margin - expect value between 0 and 1, given=${i2}`);
      if (n2 < 0 || n2 > 1 || i2 + n2 > 1)
        throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${n2}`);
      if (i2 + n2 > 1)
        throw new Error(`Invalid margins - sum of margins must be less than 1, given=${i2 + n2}`);
      this.ko(), this.co = null;
    }
  }
  yo() {
    return this.cn.autoScale;
  }
  Ja() {
    return 1 === this.cn.mode;
  }
  ph() {
    return 2 === this.cn.mode;
  }
  Co() {
    return 3 === this.cn.mode;
  }
  yr() {
    return { Wn: this.cn.autoScale, To: this.cn.invertScale, yr: this.cn.mode };
  }
  So(t2) {
    const i2 = this.yr();
    let n2 = null;
    void 0 !== t2.Wn && (this.cn.autoScale = t2.Wn), void 0 !== t2.yr && (this.cn.mode = t2.yr, 2 !== t2.yr && 3 !== t2.yr || (this.cn.autoScale = true), this.so.eo = false), 1 === i2.yr && t2.yr !== i2.yr && (!function(t3, i3) {
      if (null === t3)
        return false;
      const n3 = un(t3.Sh(), i3), s2 = un(t3.kh(), i3);
      return isFinite(n3) && isFinite(s2);
    }(this.Dh, this.vo) ? this.cn.autoScale = true : (n2 = dn(this.Dh, this.vo), null !== n2 && this.Po(n2))), 1 === t2.yr && t2.yr !== i2.yr && (n2 = cn(this.Dh, this.vo), null !== n2 && this.Po(n2));
    const s = i2.yr !== this.cn.mode;
    s && (2 === i2.yr || this.ph()) && this.Sa(), s && (3 === i2.yr || this.Co()) && this.Sa(), void 0 !== t2.To && i2.To !== t2.To && (this.cn.invertScale = t2.To, this.Ro()), this.oo.m(i2, this.yr());
  }
  Do() {
    return this.oo;
  }
  P() {
    return this.mo.fontSize;
  }
  zt() {
    return this.Qa;
  }
  Oo(t2) {
    this.Qa !== t2 && (this.Qa = t2, this.ko(), this.co = null);
  }
  Ao() {
    if (this.io)
      return this.io;
    const t2 = this.zt() - this.Vo() - this.Bo();
    return this.io = t2, t2;
  }
  Ah() {
    return this.Io(), this.Dh;
  }
  Po(t2, i2) {
    const n2 = this.Dh;
    (i2 || null === n2 && null !== t2 || null !== n2 && !n2.Mh(t2)) && (this.co = null, this.Dh = t2);
  }
  Fi() {
    return this.Io(), 0 === this.Qa || !this.Dh || this.Dh.Fi();
  }
  zo(t2) {
    return this.To() ? t2 : this.zt() - 1 - t2;
  }
  Ot(t2, i2) {
    return this.ph() ? t2 = hn(t2, i2) : this.Co() && (t2 = an(t2, i2)), this.xo(t2, i2);
  }
  Qs(t2, i2, n2) {
    this.Io();
    const s = this.Bo(), e3 = b(this.Ah()), r2 = e3.Sh(), h2 = e3.kh(), l2 = this.Ao() - 1, a2 = this.To(), o3 = l2 / (h2 - r2), _2 = void 0 === n2 ? 0 : n2.from, u2 = void 0 === n2 ? t2.length : n2.to, c2 = this.Eo();
    for (let n3 = _2; n3 < u2; n3++) {
      const e4 = t2[n3], h3 = e4.ct;
      if (isNaN(h3))
        continue;
      let l3 = h3;
      null !== c2 && (l3 = c2(e4.ct, i2));
      const _3 = s + o3 * (l3 - r2), u3 = a2 ? _3 : this.Qa - 1 - _3;
      e4.rt = u3;
    }
  }
  me(t2, i2, n2) {
    this.Io();
    const s = this.Bo(), e3 = b(this.Ah()), r2 = e3.Sh(), h2 = e3.kh(), l2 = this.Ao() - 1, a2 = this.To(), o3 = l2 / (h2 - r2), _2 = void 0 === n2 ? 0 : n2.from, u2 = void 0 === n2 ? t2.length : n2.to, c2 = this.Eo();
    for (let n3 = _2; n3 < u2; n3++) {
      const e4 = t2[n3];
      let h3 = e4.we, l3 = e4.ge, _3 = e4.Me, u3 = e4.xe;
      null !== c2 && (h3 = c2(e4.we, i2), l3 = c2(e4.ge, i2), _3 = c2(e4.Me, i2), u3 = c2(e4.xe, i2));
      let d2 = s + o3 * (h3 - r2), f2 = a2 ? d2 : this.Qa - 1 - d2;
      e4.ve = f2, d2 = s + o3 * (l3 - r2), f2 = a2 ? d2 : this.Qa - 1 - d2, e4.ce = f2, d2 = s + o3 * (_3 - r2), f2 = a2 ? d2 : this.Qa - 1 - d2, e4.de = f2, d2 = s + o3 * (u3 - r2), f2 = a2 ? d2 : this.Qa - 1 - d2, e4.pe = f2;
    }
  }
  pn(t2, i2) {
    const n2 = this.Mo(t2, i2);
    return this.Lo(n2, i2);
  }
  Lo(t2, i2) {
    let n2 = t2;
    return this.ph() ? n2 = function(t3, i3) {
      return i3 < 0 && (t3 = -t3), t3 / 100 * i3 + i3;
    }(n2, i2) : this.Co() && (n2 = function(t3, i3) {
      return t3 -= 100, i3 < 0 && (t3 = -t3), t3 / 100 * i3 + i3;
    }(n2, i2)), n2;
  }
  Ta() {
    return this._o;
  }
  No() {
    if (this.uo)
      return this.uo;
    let t2 = [];
    for (let i2 = 0; i2 < this._o.length; i2++) {
      const n2 = this._o[i2];
      null === n2.Zi() && n2.Gi(i2 + 1), t2.push(n2);
    }
    return t2 = mn(t2), this.uo = t2, this.uo;
  }
  Fo(t2) {
    -1 === this._o.indexOf(t2) && (this._o.push(t2), this.Sa(), this.Wo());
  }
  jo(t2) {
    const i2 = this._o.indexOf(t2);
    if (-1 === i2)
      throw new Error("source is not attached to scale");
    this._o.splice(i2, 1), 0 === this._o.length && (this.So({ Wn: true }), this.Po(null)), this.Sa(), this.Wo();
  }
  Pt() {
    let t2 = null;
    for (const i2 of this._o) {
      const n2 = i2.Pt();
      null !== n2 && ((null === t2 || n2.ia < t2.ia) && (t2 = n2));
    }
    return null === t2 ? null : t2.Vt;
  }
  To() {
    return this.cn.invertScale;
  }
  Ea() {
    const t2 = null === this.Pt();
    if (null !== this.co && (t2 || this.co.Ho === t2))
      return this.co.Ea;
    this.wo.Xa();
    const i2 = this.wo.Ea();
    return this.co = { Ea: i2, Ho: t2 }, this.ao.m(), i2;
  }
  $o() {
    return this.ao;
  }
  Uo(t2) {
    this.ph() || this.Co() || null === this.do && null === this.no && (this.Fi() || (this.do = this.Qa - t2, this.no = b(this.Ah()).xh()));
  }
  qo(t2) {
    if (this.ph() || this.Co())
      return;
    if (null === this.do)
      return;
    this.So({ Wn: false }), (t2 = this.Qa - t2) < 0 && (t2 = 0);
    let i2 = (this.do + 0.2 * (this.Qa - 1)) / (t2 + 0.2 * (this.Qa - 1));
    const n2 = b(this.no).xh();
    i2 = Math.max(i2, 0.1), n2.Ch(i2), this.Po(n2);
  }
  Yo() {
    this.ph() || this.Co() || (this.do = null, this.no = null);
  }
  Xo(t2) {
    this.yo() || null === this.fo && null === this.no && (this.Fi() || (this.fo = t2, this.no = b(this.Ah()).xh()));
  }
  Ko(t2) {
    if (this.yo())
      return;
    if (null === this.fo)
      return;
    const i2 = b(this.Ah()).yh() / (this.Ao() - 1);
    let n2 = t2 - this.fo;
    this.To() && (n2 *= -1);
    const s = n2 * i2, e3 = b(this.no).xh();
    e3.Th(s), this.Po(e3, true), this.co = null;
  }
  Zo() {
    this.yo() || null !== this.fo && (this.fo = null, this.no = null);
  }
  ca() {
    return this.da || this.Sa(), this.da;
  }
  Wi(t2, i2) {
    switch (this.cn.mode) {
      case 2:
        return this.Go(hn(t2, i2));
      case 3:
        return this.ca().format(an(t2, i2));
      default:
        return this.zh(t2);
    }
  }
  Ga(t2) {
    switch (this.cn.mode) {
      case 2:
        return this.Go(t2);
      case 3:
        return this.ca().format(t2);
      default:
        return this.zh(t2);
    }
  }
  Wl(t2) {
    return this.zh(t2, b(this.Jo()).ca());
  }
  jl(t2, i2) {
    return t2 = hn(t2, i2), this.Go(t2, wn);
  }
  Qo() {
    return this._o;
  }
  t_(t2) {
    this.so = { ro: t2, eo: false };
  }
  On() {
    this._o.forEach((t2) => t2.On());
  }
  Sa() {
    this.co = null;
    const t2 = this.Jo();
    let i2 = 100;
    null !== t2 && (i2 = Math.round(1 / t2.ua())), this.da = gn, this.ph() ? (this.da = wn, i2 = 100) : this.Co() ? (this.da = new vt(100, 1), i2 = 100) : null !== t2 && (this.da = t2.ca()), this.wo = new pn(this, i2, this.Mo.bind(this), this.xo.bind(this)), this.wo.Xa();
  }
  Wo() {
    this.uo = null;
  }
  Jo() {
    return this._o[0] || null;
  }
  Vo() {
    return this.To() ? this.cn.scaleMargins.bottom * this.zt() + this.lo : this.cn.scaleMargins.top * this.zt() + this.ho;
  }
  Bo() {
    return this.To() ? this.cn.scaleMargins.top * this.zt() + this.ho : this.cn.scaleMargins.bottom * this.zt() + this.lo;
  }
  Io() {
    this.so.eo || (this.so.eo = true, this.i_());
  }
  ko() {
    this.io = null;
  }
  xo(t2, i2) {
    if (this.Io(), this.Fi())
      return 0;
    t2 = this.Ja() && t2 ? _n(t2, this.vo) : t2;
    const n2 = b(this.Ah()), s = this.Bo() + (this.Ao() - 1) * (t2 - n2.Sh()) / n2.yh();
    return this.zo(s);
  }
  Mo(t2, i2) {
    if (this.Io(), this.Fi())
      return 0;
    const n2 = this.zo(t2), s = b(this.Ah()), e3 = s.Sh() + s.yh() * ((n2 - this.Bo()) / (this.Ao() - 1));
    return this.Ja() ? un(e3, this.vo) : e3;
  }
  Ro() {
    this.co = null, this.wo.Xa();
  }
  i_() {
    const t2 = this.so.ro;
    if (null === t2)
      return;
    let i2 = null;
    const n2 = this.Qo();
    let s = 0, e3 = 0;
    for (const r3 of n2) {
      if (!r3.Tt())
        continue;
      const n3 = r3.Pt();
      if (null === n3)
        continue;
      const h3 = r3.Rl(t2.Os(), t2.di());
      let l2 = h3 && h3.Ah();
      if (null !== l2) {
        switch (this.cn.mode) {
          case 1:
            l2 = cn(l2, this.vo);
            break;
          case 2:
            l2 = ln(l2, n3.Vt);
            break;
          case 3:
            l2 = on(l2, n3.Vt);
        }
        if (i2 = null === i2 ? l2 : i2.ts(b(l2)), null !== h3) {
          const t3 = h3.Vh();
          null !== t3 && (s = Math.max(s, t3.above), e3 = Math.max(s, t3.below));
        }
      }
    }
    if (s === this.ho && e3 === this.lo || (this.ho = s, this.lo = e3, this.co = null, this.ko()), null !== i2) {
      if (i2.Sh() === i2.kh()) {
        const t3 = this.Jo(), n3 = 5 * (null === t3 || this.ph() || this.Co() ? 1 : t3.ua());
        this.Ja() && (i2 = dn(i2, this.vo)), i2 = new Oi(i2.Sh() - n3, i2.kh() + n3), this.Ja() && (i2 = cn(i2, this.vo));
      }
      if (this.Ja()) {
        const t3 = dn(i2, this.vo), n3 = fn(t3);
        if (r2 = n3, h2 = this.vo, r2.La !== h2.La || r2.Na !== h2.Na) {
          const s2 = null !== this.no ? dn(this.no, this.vo) : null;
          this.vo = n3, i2 = cn(t3, n3), null !== s2 && (this.no = cn(s2, n3));
        }
      }
      this.Po(i2);
    } else
      null === this.Dh && (this.Po(new Oi(-0.5, 0.5)), this.vo = fn(null));
    var r2, h2;
    this.so.eo = true;
  }
  Eo() {
    return this.ph() ? hn : this.Co() ? an : this.Ja() ? (t2) => _n(t2, this.vo) : null;
  }
  n_(t2, i2, n2) {
    return void 0 === i2 ? (void 0 === n2 && (n2 = this.ca()), n2.format(t2)) : i2(t2);
  }
  zh(t2, i2) {
    return this.n_(t2, this.bo.priceFormatter, i2);
  }
  Go(t2, i2) {
    return this.n_(t2, this.bo.percentageFormatter, i2);
  }
};
var xn = class {
  constructor(t2, i2) {
    this._o = [], this.s_ = /* @__PURE__ */ new Map(), this.Qa = 0, this.e_ = 0, this.r_ = 1e3, this.uo = null, this.h_ = new R(), this.wl = t2, this.Ui = i2, this.l_ = new en(this);
    const n2 = i2.W();
    this.a_ = this.o_("left", n2.leftPriceScale), this.__ = this.o_("right", n2.rightPriceScale), this.a_.Do().l(this.u_.bind(this, this.a_), this), this.__.Do().l(this.u_.bind(this, this.__), this), this.c_(n2);
  }
  c_(t2) {
    if (t2.leftPriceScale && this.a_.Nh(t2.leftPriceScale), t2.rightPriceScale && this.__.Nh(t2.rightPriceScale), t2.localization && (this.a_.Sa(), this.__.Sa()), t2.overlayPriceScales) {
      const i2 = Array.from(this.s_.values());
      for (const n2 of i2) {
        const i3 = b(n2[0].At());
        i3.Nh(t2.overlayPriceScales), t2.localization && i3.Sa();
      }
    }
  }
  d_(t2) {
    switch (t2) {
      case "left":
        return this.a_;
      case "right":
        return this.__;
    }
    return this.s_.has(t2) ? m(this.s_.get(t2))[0].At() : null;
  }
  S() {
    this.qt().f_().p(this), this.a_.Do().p(this), this.__.Do().p(this), this._o.forEach((t2) => {
      t2.S && t2.S();
    }), this.h_.m();
  }
  v_() {
    return this.r_;
  }
  p_(t2) {
    this.r_ = t2;
  }
  qt() {
    return this.Ui;
  }
  $i() {
    return this.e_;
  }
  zt() {
    return this.Qa;
  }
  m_(t2) {
    this.e_ = t2, this.b_();
  }
  Oo(t2) {
    this.Qa = t2, this.a_.Oo(t2), this.__.Oo(t2), this._o.forEach((i2) => {
      if (this.dr(i2)) {
        const n2 = i2.At();
        null !== n2 && n2.Oo(t2);
      }
    }), this.b_();
  }
  Ta() {
    return this._o;
  }
  dr(t2) {
    const i2 = t2.At();
    return null === i2 || this.a_ !== i2 && this.__ !== i2;
  }
  Fo(t2, i2, n2) {
    const s = void 0 !== n2 ? n2 : this.g_().w_ + 1;
    this.M_(t2, i2, s);
  }
  jo(t2) {
    const i2 = this._o.indexOf(t2);
    p(-1 !== i2, "removeDataSource: invalid data source"), this._o.splice(i2, 1);
    const n2 = b(t2.At()).xa();
    if (this.s_.has(n2)) {
      const i3 = m(this.s_.get(n2)), s2 = i3.indexOf(t2);
      -1 !== s2 && (i3.splice(s2, 1), 0 === i3.length && this.s_.delete(n2));
    }
    const s = t2.At();
    s && s.Ta().indexOf(t2) >= 0 && s.jo(t2), null !== s && (s.Wo(), this.x_(s)), this.uo = null;
  }
  pr(t2) {
    return t2 === this.a_ ? "left" : t2 === this.__ ? "right" : "overlay";
  }
  S_() {
    return this.a_;
  }
  k_() {
    return this.__;
  }
  y_(t2, i2) {
    t2.Uo(i2);
  }
  C_(t2, i2) {
    t2.qo(i2), this.b_();
  }
  T_(t2) {
    t2.Yo();
  }
  P_(t2, i2) {
    t2.Xo(i2);
  }
  R_(t2, i2) {
    t2.Ko(i2), this.b_();
  }
  D_(t2) {
    t2.Zo();
  }
  b_() {
    this._o.forEach((t2) => {
      t2.On();
    });
  }
  vn() {
    let t2 = null;
    return this.Ui.W().rightPriceScale.visible && 0 !== this.__.Ta().length ? t2 = this.__ : this.Ui.W().leftPriceScale.visible && 0 !== this.a_.Ta().length ? t2 = this.a_ : 0 !== this._o.length && (t2 = this._o[0].At()), null === t2 && (t2 = this.__), t2;
  }
  vr() {
    let t2 = null;
    return this.Ui.W().rightPriceScale.visible ? t2 = this.__ : this.Ui.W().leftPriceScale.visible && (t2 = this.a_), t2;
  }
  x_(t2) {
    null !== t2 && t2.yo() && this.O_(t2);
  }
  A_(t2) {
    const i2 = this.wl.Xs();
    t2.So({ Wn: true }), null !== i2 && t2.t_(i2), this.b_();
  }
  V_() {
    this.O_(this.a_), this.O_(this.__);
  }
  B_() {
    this.x_(this.a_), this.x_(this.__), this._o.forEach((t2) => {
      this.dr(t2) && this.x_(t2.At());
    }), this.b_(), this.Ui.Fh();
  }
  No() {
    return null === this.uo && (this.uo = mn(this._o)), this.uo;
  }
  I_() {
    return this.h_;
  }
  z_() {
    return this.l_;
  }
  O_(t2) {
    const i2 = t2.Qo();
    if (i2 && i2.length > 0 && !this.wl.Fi()) {
      const i3 = this.wl.Xs();
      null !== i3 && t2.t_(i3);
    }
    t2.On();
  }
  g_() {
    const t2 = this.No();
    if (0 === t2.length)
      return { E_: 0, w_: 0 };
    let i2 = 0, n2 = 0;
    for (let s = 0; s < t2.length; s++) {
      const e3 = t2[s].Zi();
      null !== e3 && (e3 < i2 && (i2 = e3), e3 > n2 && (n2 = e3));
    }
    return { E_: i2, w_: n2 };
  }
  M_(t2, i2, n2) {
    let s = this.d_(i2);
    if (null === s && (s = this.o_(i2, this.Ui.W().overlayPriceScales)), this._o.push(t2), !ut(i2)) {
      const n3 = this.s_.get(i2) || [];
      n3.push(t2), this.s_.set(i2, n3);
    }
    s.Fo(t2), t2.Ji(s), t2.Gi(n2), this.x_(s), this.uo = null;
  }
  u_(t2, i2, n2) {
    i2.yr !== n2.yr && this.O_(t2);
  }
  o_(t2, i2) {
    const n2 = Object.assign({ visible: true, autoScale: true }, I(i2)), s = new Mn(t2, n2, this.Ui.W().layout, this.Ui.W().localization);
    return s.Oo(this.zt()), s;
  }
};
var Sn = class {
  constructor(t2, i2, n2 = 50) {
    this.Ke = 0, this.Ze = 1, this.Ge = 1, this.Qe = /* @__PURE__ */ new Map(), this.Je = /* @__PURE__ */ new Map(), this.L_ = t2, this.N_ = i2, this.tr = n2;
  }
  F_(t2) {
    const i2 = t2.time, n2 = this.N_.cacheKey(i2), s = this.Qe.get(n2);
    if (void 0 !== s)
      return s.W_;
    if (this.Ke === this.tr) {
      const t3 = this.Je.get(this.Ge);
      this.Je.delete(this.Ge), this.Qe.delete(m(t3)), this.Ge++, this.Ke--;
    }
    const e3 = this.L_(t2);
    return this.Qe.set(n2, { W_: e3, er: this.Ze }), this.Je.set(this.Ze, n2), this.Ke++, this.Ze++, e3;
  }
};
var kn = class {
  constructor(t2, i2) {
    p(t2 <= i2, "right should be >= left"), this.j_ = t2, this.H_ = i2;
  }
  Os() {
    return this.j_;
  }
  di() {
    return this.H_;
  }
  U_() {
    return this.H_ - this.j_ + 1;
  }
  Kr(t2) {
    return this.j_ <= t2 && t2 <= this.H_;
  }
  Mh(t2) {
    return this.j_ === t2.Os() && this.H_ === t2.di();
  }
};
function yn(t2, i2) {
  return null === t2 || null === i2 ? t2 === i2 : t2.Mh(i2);
}
var Cn = class {
  constructor() {
    this.q_ = /* @__PURE__ */ new Map(), this.Qe = null, this.Y_ = false;
  }
  X_(t2) {
    this.Y_ = t2, this.Qe = null;
  }
  K_(t2, i2) {
    this.Z_(i2), this.Qe = null;
    for (let n2 = i2; n2 < t2.length; ++n2) {
      const i3 = t2[n2];
      let s = this.q_.get(i3.timeWeight);
      void 0 === s && (s = [], this.q_.set(i3.timeWeight, s)), s.push({ index: n2, time: i3.time, weight: i3.timeWeight, originalTime: i3.originalTime });
    }
  }
  G_(t2, i2) {
    const n2 = Math.ceil(i2 / t2);
    return null !== this.Qe && this.Qe.J_ === n2 || (this.Qe = { Ea: this.Q_(n2), J_: n2 }), this.Qe.Ea;
  }
  Z_(t2) {
    if (0 === t2)
      return void this.q_.clear();
    const i2 = [];
    this.q_.forEach((n2, s) => {
      t2 <= n2[0].index ? i2.push(s) : n2.splice(Bt(n2, t2, (i3) => i3.index < t2), 1 / 0);
    });
    for (const t3 of i2)
      this.q_.delete(t3);
  }
  Q_(t2) {
    let i2 = [];
    for (const n2 of Array.from(this.q_.keys()).sort((t3, i3) => i3 - t3)) {
      if (!this.q_.get(n2))
        continue;
      const s = i2;
      i2 = [];
      const e3 = s.length;
      let r2 = 0;
      const h2 = m(this.q_.get(n2)), l2 = h2.length;
      let a2 = 1 / 0, o3 = -1 / 0;
      for (let n3 = 0; n3 < l2; n3++) {
        const l3 = h2[n3], _2 = l3.index;
        for (; r2 < e3; ) {
          const t3 = s[r2], n4 = t3.index;
          if (!(n4 < _2)) {
            a2 = n4;
            break;
          }
          r2++, i2.push(t3), o3 = n4, a2 = 1 / 0;
        }
        if (a2 - _2 >= t2 && _2 - o3 >= t2)
          i2.push(l3), o3 = _2;
        else if (this.Y_)
          return s;
      }
      for (; r2 < e3; r2++)
        i2.push(s[r2]);
    }
    return i2;
  }
};
var Tn = class {
  constructor(t2) {
    this.tu = t2;
  }
  iu() {
    return null === this.tu ? null : new kn(Math.floor(this.tu.Os()), Math.ceil(this.tu.di()));
  }
  nu() {
    return this.tu;
  }
  static su() {
    return new Tn(null);
  }
};
function Pn(t2, i2) {
  return t2.weight > i2.weight ? t2 : i2;
}
var Rn = class {
  constructor(t2, i2, n2, s) {
    this.e_ = 0, this.eu = null, this.ru = [], this.fo = null, this.do = null, this.hu = new Cn(), this.lu = /* @__PURE__ */ new Map(), this.au = Tn.su(), this.ou = true, this._u = new R(), this.uu = new R(), this.cu = new R(), this.du = null, this.fu = null, this.vu = [], this.cn = i2, this.bo = n2, this.pu = i2.rightOffset, this.mu = i2.barSpacing, this.Ui = t2, this.N_ = s, this.bu(), this.hu.X_(i2.uniformDistribution);
  }
  W() {
    return this.cn;
  }
  wu(t2) {
    D(this.bo, t2), this.gu(), this.bu();
  }
  Nh(t2, i2) {
    var n2;
    D(this.cn, t2), this.cn.fixLeftEdge && this.Mu(), this.cn.fixRightEdge && this.xu(), void 0 !== t2.barSpacing && this.Ui.Gn(t2.barSpacing), void 0 !== t2.rightOffset && this.Ui.Jn(t2.rightOffset), void 0 !== t2.minBarSpacing && this.Ui.Gn(null !== (n2 = t2.barSpacing) && void 0 !== n2 ? n2 : this.mu), this.gu(), this.bu(), this.cu.m();
  }
  mn(t2) {
    var i2, n2;
    return null !== (n2 = null === (i2 = this.ru[t2]) || void 0 === i2 ? void 0 : i2.time) && void 0 !== n2 ? n2 : null;
  }
  qi(t2) {
    var i2;
    return null !== (i2 = this.ru[t2]) && void 0 !== i2 ? i2 : null;
  }
  ya(t2, i2) {
    if (this.ru.length < 1)
      return null;
    if (this.N_.key(t2) > this.N_.key(this.ru[this.ru.length - 1].time))
      return i2 ? this.ru.length - 1 : null;
    const n2 = Bt(this.ru, this.N_.key(t2), (t3, i3) => this.N_.key(t3.time) < i3);
    return this.N_.key(t2) < this.N_.key(this.ru[n2].time) ? i2 ? n2 : null : n2;
  }
  Fi() {
    return 0 === this.e_ || 0 === this.ru.length || null === this.eu;
  }
  ka() {
    return this.ru.length > 0;
  }
  Xs() {
    return this.Su(), this.au.iu();
  }
  ku() {
    return this.Su(), this.au.nu();
  }
  yu() {
    const t2 = this.Xs();
    if (null === t2)
      return null;
    const i2 = { from: t2.Os(), to: t2.di() };
    return this.Cu(i2);
  }
  Cu(t2) {
    const i2 = Math.round(t2.from), n2 = Math.round(t2.to), s = b(this.Tu()), e3 = b(this.Pu());
    return { from: b(this.qi(Math.max(s, i2))), to: b(this.qi(Math.min(e3, n2))) };
  }
  Ru(t2) {
    return { from: b(this.ya(t2.from, true)), to: b(this.ya(t2.to, true)) };
  }
  $i() {
    return this.e_;
  }
  m_(t2) {
    if (!isFinite(t2) || t2 <= 0)
      return;
    if (this.e_ === t2)
      return;
    const i2 = this.ku(), n2 = this.e_;
    if (this.e_ = t2, this.ou = true, this.cn.lockVisibleTimeRangeOnResize && 0 !== n2) {
      const i3 = this.mu * t2 / n2;
      this.mu = i3;
    }
    if (this.cn.fixLeftEdge && null !== i2 && i2.Os() <= 0) {
      const i3 = n2 - t2;
      this.pu -= Math.round(i3 / this.mu) + 1, this.ou = true;
    }
    this.Du(), this.Ou();
  }
  Et(t2) {
    if (this.Fi() || !A(t2))
      return 0;
    const i2 = this.Au() + this.pu - t2;
    return this.e_ - (i2 + 0.5) * this.mu - 1;
  }
  Js(t2, i2) {
    const n2 = this.Au(), s = void 0 === i2 ? 0 : i2.from, e3 = void 0 === i2 ? t2.length : i2.to;
    for (let i3 = s; i3 < e3; i3++) {
      const s2 = t2[i3].ut, e4 = n2 + this.pu - s2, r2 = this.e_ - (e4 + 0.5) * this.mu - 1;
      t2[i3].et = r2;
    }
  }
  Vu(t2) {
    return Math.ceil(this.Bu(t2));
  }
  Jn(t2) {
    this.ou = true, this.pu = t2, this.Ou(), this.Ui.Iu(), this.Ui.Fh();
  }
  he() {
    return this.mu;
  }
  Gn(t2) {
    this.zu(t2), this.Ou(), this.Ui.Iu(), this.Ui.Fh();
  }
  Eu() {
    return this.pu;
  }
  Ea() {
    if (this.Fi())
      return null;
    if (null !== this.fu)
      return this.fu;
    const t2 = this.mu, i2 = 5 * (this.Ui.W().layout.fontSize + 4) / 8 * (this.cn.tickMarkMaxCharacterLength || 8), n2 = Math.round(i2 / t2), s = b(this.Xs()), e3 = Math.max(s.Os(), s.Os() - n2), r2 = Math.max(s.di(), s.di() - n2), h2 = this.hu.G_(t2, i2), l2 = this.Tu() + n2, a2 = this.Pu() - n2, o3 = this.Lu(), _2 = this.cn.fixLeftEdge || o3, u2 = this.cn.fixRightEdge || o3;
    let c2 = 0;
    for (const t3 of h2) {
      if (!(e3 <= t3.index && t3.index <= r2))
        continue;
      let n3;
      c2 < this.vu.length ? (n3 = this.vu[c2], n3.coord = this.Et(t3.index), n3.label = this.Nu(t3), n3.weight = t3.weight) : (n3 = { needAlignCoordinate: false, coord: this.Et(t3.index), label: this.Nu(t3), weight: t3.weight }, this.vu.push(n3)), this.mu > i2 / 2 && !o3 ? n3.needAlignCoordinate = false : n3.needAlignCoordinate = _2 && t3.index <= l2 || u2 && t3.index >= a2, c2++;
    }
    return this.vu.length = c2, this.fu = this.vu, this.vu;
  }
  Fu() {
    this.ou = true, this.Gn(this.cn.barSpacing), this.Jn(this.cn.rightOffset);
  }
  Wu(t2) {
    this.ou = true, this.eu = t2, this.Ou(), this.Mu();
  }
  ju(t2, i2) {
    const n2 = this.Bu(t2), s = this.he(), e3 = s + i2 * (s / 10);
    this.Gn(e3), this.cn.rightBarStaysOnScroll || this.Jn(this.Eu() + (n2 - this.Bu(t2)));
  }
  Uo(t2) {
    this.fo && this.Zo(), null === this.do && null === this.du && (this.Fi() || (this.do = t2, this.Hu()));
  }
  qo(t2) {
    if (null === this.du)
      return;
    const i2 = yt(this.e_ - t2, 0, this.e_), n2 = yt(this.e_ - b(this.do), 0, this.e_);
    0 !== i2 && 0 !== n2 && this.Gn(this.du.he * i2 / n2);
  }
  Yo() {
    null !== this.do && (this.do = null, this.$u());
  }
  Xo(t2) {
    null === this.fo && null === this.du && (this.Fi() || (this.fo = t2, this.Hu()));
  }
  Ko(t2) {
    if (null === this.fo)
      return;
    const i2 = (this.fo - t2) / this.he();
    this.pu = b(this.du).Eu + i2, this.ou = true, this.Ou();
  }
  Zo() {
    null !== this.fo && (this.fo = null, this.$u());
  }
  Uu() {
    this.qu(this.cn.rightOffset);
  }
  qu(t2, i2 = 400) {
    if (!isFinite(t2))
      throw new RangeError("offset is required and must be finite number");
    if (!isFinite(i2) || i2 <= 0)
      throw new RangeError("animationDuration (optional) must be finite positive number");
    const n2 = this.pu, s = performance.now();
    this.Ui.Xn({ Yu: (t3) => (t3 - s) / i2 >= 1, Xu: (e3) => {
      const r2 = (e3 - s) / i2;
      return r2 >= 1 ? t2 : n2 + (t2 - n2) * r2;
    } });
  }
  gt(t2, i2) {
    this.ou = true, this.ru = t2, this.hu.K_(t2, i2), this.Ou();
  }
  Ku() {
    return this._u;
  }
  Zu() {
    return this.uu;
  }
  Gu() {
    return this.cu;
  }
  Au() {
    return this.eu || 0;
  }
  Ju(t2) {
    const i2 = t2.U_();
    this.zu(this.e_ / i2), this.pu = t2.di() - this.Au(), this.Ou(), this.ou = true, this.Ui.Iu(), this.Ui.Fh();
  }
  Qu() {
    const t2 = this.Tu(), i2 = this.Pu();
    null !== t2 && null !== i2 && this.Ju(new kn(t2, i2 + this.cn.rightOffset));
  }
  tc(t2) {
    const i2 = new kn(t2.from, t2.to);
    this.Ju(i2);
  }
  Yi(t2) {
    return void 0 !== this.bo.timeFormatter ? this.bo.timeFormatter(t2.originalTime) : this.N_.formatHorzItem(t2.time);
  }
  Lu() {
    const { handleScroll: t2, handleScale: i2 } = this.Ui.W();
    return !(t2.horzTouchDrag || t2.mouseWheel || t2.pressedMouseMove || t2.vertTouchDrag || i2.axisDoubleClickReset.time || i2.axisPressedMouseMove.time || i2.mouseWheel || i2.pinch);
  }
  Tu() {
    return 0 === this.ru.length ? null : 0;
  }
  Pu() {
    return 0 === this.ru.length ? null : this.ru.length - 1;
  }
  ic(t2) {
    return (this.e_ - 1 - t2) / this.mu;
  }
  Bu(t2) {
    const i2 = this.ic(t2), n2 = this.Au() + this.pu - i2;
    return Math.round(1e6 * n2) / 1e6;
  }
  zu(t2) {
    const i2 = this.mu;
    this.mu = t2, this.Du(), i2 !== this.mu && (this.ou = true, this.nc());
  }
  Su() {
    if (!this.ou)
      return;
    if (this.ou = false, this.Fi())
      return void this.sc(Tn.su());
    const t2 = this.Au(), i2 = this.e_ / this.mu, n2 = this.pu + t2, s = new kn(n2 - i2 + 1, n2);
    this.sc(new Tn(s));
  }
  Du() {
    const t2 = this.ec();
    if (this.mu < t2 && (this.mu = t2, this.ou = true), 0 !== this.e_) {
      const t3 = 0.5 * this.e_;
      this.mu > t3 && (this.mu = t3, this.ou = true);
    }
  }
  ec() {
    return this.cn.fixLeftEdge && this.cn.fixRightEdge && 0 !== this.ru.length ? this.e_ / this.ru.length : this.cn.minBarSpacing;
  }
  Ou() {
    const t2 = this.rc();
    this.pu > t2 && (this.pu = t2, this.ou = true);
    const i2 = this.hc();
    null !== i2 && this.pu < i2 && (this.pu = i2, this.ou = true);
  }
  hc() {
    const t2 = this.Tu(), i2 = this.eu;
    if (null === t2 || null === i2)
      return null;
    return t2 - i2 - 1 + (this.cn.fixLeftEdge ? this.e_ / this.mu : Math.min(2, this.ru.length));
  }
  rc() {
    return this.cn.fixRightEdge ? 0 : this.e_ / this.mu - Math.min(2, this.ru.length);
  }
  Hu() {
    this.du = { he: this.he(), Eu: this.Eu() };
  }
  $u() {
    this.du = null;
  }
  Nu(t2) {
    let i2 = this.lu.get(t2.weight);
    return void 0 === i2 && (i2 = new Sn((t3) => this.lc(t3), this.N_), this.lu.set(t2.weight, i2)), i2.F_(t2);
  }
  lc(t2) {
    return this.N_.formatTickmark(t2, this.bo);
  }
  sc(t2) {
    const i2 = this.au;
    this.au = t2, yn(i2.iu(), this.au.iu()) || this._u.m(), yn(i2.nu(), this.au.nu()) || this.uu.m(), this.nc();
  }
  nc() {
    this.fu = null;
  }
  gu() {
    this.nc(), this.lu.clear();
  }
  bu() {
    this.N_.updateFormatter(this.bo);
  }
  Mu() {
    if (!this.cn.fixLeftEdge)
      return;
    const t2 = this.Tu();
    if (null === t2)
      return;
    const i2 = this.Xs();
    if (null === i2)
      return;
    const n2 = i2.Os() - t2;
    if (n2 < 0) {
      const t3 = this.pu - n2 - 1;
      this.Jn(t3);
    }
    this.Du();
  }
  xu() {
    this.Ou(), this.Du();
  }
};
var Dn = class extends j {
  constructor(t2) {
    super(), this.ac = /* @__PURE__ */ new Map(), this.Lt = t2;
  }
  Z(t2) {
  }
  J(t2) {
    if (!this.Lt.Tt)
      return;
    const { context: i2, mediaSize: n2 } = t2;
    let s = 0;
    for (const t3 of this.Lt.oc) {
      if (0 === t3.Jt.length)
        continue;
      i2.font = t3.R;
      const e4 = this._c(i2, t3.Jt);
      e4 > n2.width ? t3.ju = n2.width / e4 : t3.ju = 1, s += t3.uc * t3.ju;
    }
    let e3 = 0;
    switch (this.Lt.cc) {
      case "top":
        e3 = 0;
        break;
      case "center":
        e3 = Math.max((n2.height - s) / 2, 0);
        break;
      case "bottom":
        e3 = Math.max(n2.height - s, 0);
    }
    i2.fillStyle = this.Lt.O;
    for (const t3 of this.Lt.oc) {
      i2.save();
      let s2 = 0;
      switch (this.Lt.dc) {
        case "left":
          i2.textAlign = "left", s2 = t3.uc / 2;
          break;
        case "center":
          i2.textAlign = "center", s2 = n2.width / 2;
          break;
        case "right":
          i2.textAlign = "right", s2 = n2.width - 1 - t3.uc / 2;
      }
      i2.translate(s2, e3), i2.textBaseline = "top", i2.font = t3.R, i2.scale(t3.ju, t3.ju), i2.fillText(t3.Jt, 0, t3.fc), i2.restore(), e3 += t3.uc * t3.ju;
    }
  }
  _c(t2, i2) {
    const n2 = this.vc(t2.font);
    let s = n2.get(i2);
    return void 0 === s && (s = t2.measureText(i2).width, n2.set(i2, s)), s;
  }
  vc(t2) {
    let i2 = this.ac.get(t2);
    return void 0 === i2 && (i2 = /* @__PURE__ */ new Map(), this.ac.set(t2, i2)), i2;
  }
};
var On = class {
  constructor(t2) {
    this.bt = true, this.jt = { Tt: false, O: "", oc: [], cc: "center", dc: "center" }, this.Ht = new Dn(this.jt), this.$t = t2;
  }
  gt() {
    this.bt = true;
  }
  xt() {
    return this.bt && (this.St(), this.bt = false), this.Ht;
  }
  St() {
    const t2 = this.$t.W(), i2 = this.jt;
    i2.Tt = t2.visible, i2.Tt && (i2.O = t2.color, i2.dc = t2.horzAlign, i2.cc = t2.vertAlign, i2.oc = [{ Jt: t2.text, R: N(t2.fontSize, t2.fontFamily, t2.fontStyle), uc: 1.2 * t2.fontSize, fc: 0, ju: 0 }]);
  }
};
var An = class extends at {
  constructor(t2, i2) {
    super(), this.cn = i2, this.wn = new On(this);
  }
  Rn() {
    return [];
  }
  Pn() {
    return [this.wn];
  }
  W() {
    return this.cn;
  }
  On() {
    this.wn.gt();
  }
};
var Vn;
var Bn;
var In;
var zn;
var En;
!function(t2) {
  t2[t2.OnTouchEnd = 0] = "OnTouchEnd", t2[t2.OnNextTap = 1] = "OnNextTap";
}(Vn || (Vn = {}));
var Ln = class {
  constructor(t2, i2, n2) {
    this.mc = [], this.bc = [], this.e_ = 0, this.wc = null, this.gc = new R(), this.Mc = new R(), this.xc = null, this.Sc = t2, this.cn = i2, this.N_ = n2, this.kc = new F(this), this.wl = new Rn(this, i2.timeScale, this.cn.localization, n2), this.wt = new _t(this, i2.crosshair), this.yc = new tn(i2.crosshair), this.Cc = new An(this, i2.watermark), this.Tc(), this.mc[0].p_(2e3), this.Pc = this.Rc(0), this.Dc = this.Rc(1);
  }
  $l() {
    this.Oc(ct.es());
  }
  Fh() {
    this.Oc(ct.ss());
  }
  sa() {
    this.Oc(new ct(1));
  }
  Ul(t2) {
    const i2 = this.Ac(t2);
    this.Oc(i2);
  }
  Vc() {
    return this.wc;
  }
  Bc(t2) {
    const i2 = this.wc;
    this.wc = t2, null !== i2 && this.Ul(i2.Ic), null !== t2 && this.Ul(t2.Ic);
  }
  W() {
    return this.cn;
  }
  Nh(t2) {
    D(this.cn, t2), this.mc.forEach((i2) => i2.c_(t2)), void 0 !== t2.timeScale && this.wl.Nh(t2.timeScale), void 0 !== t2.localization && this.wl.wu(t2.localization), (t2.leftPriceScale || t2.rightPriceScale) && this.gc.m(), this.Pc = this.Rc(0), this.Dc = this.Rc(1), this.$l();
  }
  zc(t2, i2) {
    if ("left" === t2)
      return void this.Nh({ leftPriceScale: i2 });
    if ("right" === t2)
      return void this.Nh({ rightPriceScale: i2 });
    const n2 = this.Ec(t2);
    null !== n2 && (n2.At.Nh(i2), this.gc.m());
  }
  Ec(t2) {
    for (const i2 of this.mc) {
      const n2 = i2.d_(t2);
      if (null !== n2)
        return { Ut: i2, At: n2 };
    }
    return null;
  }
  yt() {
    return this.wl;
  }
  Lc() {
    return this.mc;
  }
  Nc() {
    return this.Cc;
  }
  Fc() {
    return this.wt;
  }
  Wc() {
    return this.Mc;
  }
  jc(t2, i2) {
    t2.Oo(i2), this.Iu();
  }
  m_(t2) {
    this.e_ = t2, this.wl.m_(this.e_), this.mc.forEach((i2) => i2.m_(t2)), this.Iu();
  }
  Tc(t2) {
    const i2 = new xn(this.wl, this);
    void 0 !== t2 ? this.mc.splice(t2, 0, i2) : this.mc.push(i2);
    const n2 = void 0 === t2 ? this.mc.length - 1 : t2, s = ct.es();
    return s.Nn(n2, { Fn: 0, Wn: true }), this.Oc(s), i2;
  }
  y_(t2, i2, n2) {
    t2.y_(i2, n2);
  }
  C_(t2, i2, n2) {
    t2.C_(i2, n2), this.ql(), this.Oc(this.Hc(t2, 2));
  }
  T_(t2, i2) {
    t2.T_(i2), this.Oc(this.Hc(t2, 2));
  }
  P_(t2, i2, n2) {
    i2.yo() || t2.P_(i2, n2);
  }
  R_(t2, i2, n2) {
    i2.yo() || (t2.R_(i2, n2), this.ql(), this.Oc(this.Hc(t2, 2)));
  }
  D_(t2, i2) {
    i2.yo() || (t2.D_(i2), this.Oc(this.Hc(t2, 2)));
  }
  A_(t2, i2) {
    t2.A_(i2), this.Oc(this.Hc(t2, 2));
  }
  $c(t2) {
    this.wl.Uo(t2);
  }
  Uc(t2, i2) {
    const n2 = this.yt();
    if (n2.Fi() || 0 === i2)
      return;
    const s = n2.$i();
    t2 = Math.max(1, Math.min(t2, s)), n2.ju(t2, i2), this.Iu();
  }
  qc(t2) {
    this.Yc(0), this.Xc(t2), this.Kc();
  }
  Zc(t2) {
    this.wl.qo(t2), this.Iu();
  }
  Gc() {
    this.wl.Yo(), this.Fh();
  }
  Yc(t2) {
    this.wl.Xo(t2);
  }
  Xc(t2) {
    this.wl.Ko(t2), this.Iu();
  }
  Kc() {
    this.wl.Zo(), this.Fh();
  }
  Mt() {
    return this.bc;
  }
  Jc(t2, i2, n2, s) {
    this.wt.gn(t2, i2);
    let e3 = NaN, r2 = this.wl.Vu(t2);
    const h2 = this.wl.Xs();
    null !== h2 && (r2 = Math.min(Math.max(h2.Os(), r2), h2.di()));
    const l2 = s.vn(), a2 = l2.Pt();
    null !== a2 && (e3 = l2.pn(i2, a2)), e3 = this.yc.Ca(e3, r2, s), this.wt.kn(r2, e3, s), this.sa(), this.Mc.m(this.wt.kt(), { x: t2, y: i2 }, n2);
  }
  Qc() {
    this.Fc().Cn(), this.sa(), this.Mc.m(null, null, null);
  }
  ql() {
    const t2 = this.wt.Ut();
    if (null !== t2) {
      const i2 = this.wt.xn(), n2 = this.wt.Sn();
      this.Jc(i2, n2, null, t2);
    }
    this.wt.On();
  }
  td(t2, i2, n2) {
    const s = this.wl.mn(0);
    void 0 !== i2 && void 0 !== n2 && this.wl.gt(i2, n2);
    const e3 = this.wl.mn(0), r2 = this.wl.Au(), h2 = this.wl.Xs();
    if (null !== h2 && null !== s && null !== e3) {
      const i3 = h2.Kr(r2), n3 = this.N_.key(s) > this.N_.key(e3), l2 = null !== t2 && t2 > r2 && !n3, a2 = i3 && this.wl.W().shiftVisibleRangeOnNewBar;
      if (l2 && !a2) {
        const i4 = t2 - r2;
        this.wl.Jn(this.wl.Eu() - i4);
      }
    }
    this.wl.Wu(t2);
  }
  Kl(t2) {
    null !== t2 && t2.B_();
  }
  cr(t2) {
    const i2 = this.mc.find((i3) => i3.No().includes(t2));
    return void 0 === i2 ? null : i2;
  }
  Iu() {
    this.Cc.On(), this.mc.forEach((t2) => t2.B_()), this.ql();
  }
  S() {
    this.mc.forEach((t2) => t2.S()), this.mc.length = 0, this.cn.localization.priceFormatter = void 0, this.cn.localization.percentageFormatter = void 0, this.cn.localization.timeFormatter = void 0;
  }
  nd() {
    return this.kc;
  }
  mr() {
    return this.kc.W();
  }
  f_() {
    return this.gc;
  }
  sd(t2, i2, n2) {
    const s = this.mc[0], e3 = this.ed(i2, t2, s, n2);
    return this.bc.push(e3), 1 === this.bc.length ? this.$l() : this.Fh(), e3;
  }
  rd(t2) {
    const i2 = this.cr(t2), n2 = this.bc.indexOf(t2);
    p(-1 !== n2, "Series not found"), this.bc.splice(n2, 1), b(i2).jo(t2), t2.S && t2.S();
  }
  Hl(t2, i2) {
    const n2 = b(this.cr(t2));
    n2.jo(t2);
    const s = this.Ec(i2);
    if (null === s) {
      const s2 = t2.Zi();
      n2.Fo(t2, i2, s2);
    } else {
      const e3 = s.Ut === n2 ? t2.Zi() : void 0;
      s.Ut.Fo(t2, i2, e3);
    }
  }
  Qu() {
    const t2 = ct.ss();
    t2.$n(), this.Oc(t2);
  }
  hd(t2) {
    const i2 = ct.ss();
    i2.Yn(t2), this.Oc(i2);
  }
  Zn() {
    const t2 = ct.ss();
    t2.Zn(), this.Oc(t2);
  }
  Gn(t2) {
    const i2 = ct.ss();
    i2.Gn(t2), this.Oc(i2);
  }
  Jn(t2) {
    const i2 = ct.ss();
    i2.Jn(t2), this.Oc(i2);
  }
  Xn(t2) {
    const i2 = ct.ss();
    i2.Xn(t2), this.Oc(i2);
  }
  Un() {
    const t2 = ct.ss();
    t2.Un(), this.Oc(t2);
  }
  ld() {
    return this.cn.rightPriceScale.visible ? "right" : "left";
  }
  ad() {
    return this.Dc;
  }
  q() {
    return this.Pc;
  }
  It(t2) {
    const i2 = this.Dc, n2 = this.Pc;
    if (i2 === n2)
      return i2;
    if (t2 = Math.max(0, Math.min(100, Math.round(100 * t2))), null === this.xc || this.xc.Ts !== n2 || this.xc.Ps !== i2)
      this.xc = { Ts: n2, Ps: i2, od: /* @__PURE__ */ new Map() };
    else {
      const i3 = this.xc.od.get(t2);
      if (void 0 !== i3)
        return i3;
    }
    const s = function(t3, i3, n3) {
      const [s2, e3, r2, h2] = T(t3), [l2, a2, o3, _2] = T(i3), u2 = [M(s2 + n3 * (l2 - s2)), M(e3 + n3 * (a2 - e3)), M(r2 + n3 * (o3 - r2)), x(h2 + n3 * (_2 - h2))];
      return `rgba(${u2[0]}, ${u2[1]}, ${u2[2]}, ${u2[3]})`;
    }(n2, i2, t2 / 100);
    return this.xc.od.set(t2, s), s;
  }
  Hc(t2, i2) {
    const n2 = new ct(i2);
    if (null !== t2) {
      const s = this.mc.indexOf(t2);
      n2.Nn(s, { Fn: i2 });
    }
    return n2;
  }
  Ac(t2, i2) {
    return void 0 === i2 && (i2 = 2), this.Hc(this.cr(t2), i2);
  }
  Oc(t2) {
    this.Sc && this.Sc(t2), this.mc.forEach((t3) => t3.z_().Wh().gt());
  }
  ed(t2, i2, n2, s) {
    const e3 = new Qi(this, t2, i2, n2, s), r2 = void 0 !== t2.priceScaleId ? t2.priceScaleId : this.ld();
    return n2.Fo(e3, r2), ut(r2) || e3.Nh(t2), e3;
  }
  Rc(t2) {
    const i2 = this.cn.layout;
    return "gradient" === i2.background.type ? 0 === t2 ? i2.background.topColor : i2.background.bottomColor : i2.background.color;
  }
};
function Nn(t2) {
  return !O(t2) && !V(t2);
}
function Fn(t2) {
  return O(t2);
}
!function(t2) {
  t2[t2.Disabled = 0] = "Disabled", t2[t2.Continuous = 1] = "Continuous", t2[t2.OnDataUpdate = 2] = "OnDataUpdate";
}(Bn || (Bn = {})), function(t2) {
  t2[t2.LastBar = 0] = "LastBar", t2[t2.LastVisible = 1] = "LastVisible";
}(In || (In = {})), function(t2) {
  t2.Solid = "solid", t2.VerticalGradient = "gradient";
}(zn || (zn = {})), function(t2) {
  t2[t2.Year = 0] = "Year", t2[t2.Month = 1] = "Month", t2[t2.DayOfMonth = 2] = "DayOfMonth", t2[t2.Time = 3] = "Time", t2[t2.TimeWithSeconds = 4] = "TimeWithSeconds";
}(En || (En = {}));
var Wn = (t2) => t2.getUTCFullYear();
function jn(t2, i2, n2) {
  return i2.replace(/yyyy/g, ((t3) => ft(Wn(t3), 4))(t2)).replace(/yy/g, ((t3) => ft(Wn(t3) % 100, 2))(t2)).replace(/MMMM/g, ((t3, i3) => new Date(t3.getUTCFullYear(), t3.getUTCMonth(), 1).toLocaleString(i3, { month: "long" }))(t2, n2)).replace(/MMM/g, ((t3, i3) => new Date(t3.getUTCFullYear(), t3.getUTCMonth(), 1).toLocaleString(i3, { month: "short" }))(t2, n2)).replace(/MM/g, ((t3) => ft(((t4) => t4.getUTCMonth() + 1)(t3), 2))(t2)).replace(/dd/g, ((t3) => ft(((t4) => t4.getUTCDate())(t3), 2))(t2));
}
var Hn = class {
  constructor(t2 = "yyyy-MM-dd", i2 = "default") {
    this._d = t2, this.ud = i2;
  }
  F_(t2) {
    return jn(t2, this._d, this.ud);
  }
};
var $n = class {
  constructor(t2) {
    this.dd = t2 || "%h:%m:%s";
  }
  F_(t2) {
    return this.dd.replace("%h", ft(t2.getUTCHours(), 2)).replace("%m", ft(t2.getUTCMinutes(), 2)).replace("%s", ft(t2.getUTCSeconds(), 2));
  }
};
var Un = { fd: "yyyy-MM-dd", vd: "%h:%m:%s", pd: " ", md: "default" };
var qn = class {
  constructor(t2 = {}) {
    const i2 = Object.assign(Object.assign({}, Un), t2);
    this.bd = new Hn(i2.fd, i2.md), this.wd = new $n(i2.vd), this.gd = i2.pd;
  }
  F_(t2) {
    return `${this.bd.F_(t2)}${this.gd}${this.wd.F_(t2)}`;
  }
};
function Yn(t2) {
  return 60 * t2 * 60 * 1e3;
}
function Xn(t2) {
  return 60 * t2 * 1e3;
}
var Kn = [{ Md: (Zn = 1, 1e3 * Zn), xd: 10 }, { Md: Xn(1), xd: 20 }, { Md: Xn(5), xd: 21 }, { Md: Xn(30), xd: 22 }, { Md: Yn(1), xd: 30 }, { Md: Yn(3), xd: 31 }, { Md: Yn(6), xd: 32 }, { Md: Yn(12), xd: 33 }];
var Zn;
function Gn(t2, i2) {
  if (t2.getUTCFullYear() !== i2.getUTCFullYear())
    return 70;
  if (t2.getUTCMonth() !== i2.getUTCMonth())
    return 60;
  if (t2.getUTCDate() !== i2.getUTCDate())
    return 50;
  for (let n2 = Kn.length - 1; n2 >= 0; --n2)
    if (Math.floor(i2.getTime() / Kn[n2].Md) !== Math.floor(t2.getTime() / Kn[n2].Md))
      return Kn[n2].xd;
  return 0;
}
function Jn(t2) {
  let i2 = t2;
  if (V(t2) && (i2 = ts(t2)), !Nn(i2))
    throw new Error("time must be of type BusinessDay");
  const n2 = new Date(Date.UTC(i2.year, i2.month - 1, i2.day, 0, 0, 0, 0));
  return { Sd: Math.round(n2.getTime() / 1e3), kd: i2 };
}
function Qn(t2) {
  if (!Fn(t2))
    throw new Error("time must be of type isUTCTimestamp");
  return { Sd: t2 };
}
function ts(t2) {
  const i2 = new Date(t2);
  if (isNaN(i2.getTime()))
    throw new Error(`Invalid date string=${t2}, expected format=yyyy-mm-dd`);
  return { day: i2.getUTCDate(), month: i2.getUTCMonth() + 1, year: i2.getUTCFullYear() };
}
function is(t2) {
  V(t2.time) && (t2.time = ts(t2.time));
}
var ns = class {
  options() {
    return this.cn;
  }
  setOptions(t2) {
    this.cn = t2, this.updateFormatter(t2.localization);
  }
  preprocessData(t2) {
    Array.isArray(t2) ? function(t3) {
      t3.forEach(is);
    }(t2) : is(t2);
  }
  createConverterToInternalObj(t2) {
    return b(function(t3) {
      return 0 === t3.length ? null : Nn(t3[0].time) || V(t3[0].time) ? Jn : Qn;
    }(t2));
  }
  key(t2) {
    return "object" == typeof t2 && "Sd" in t2 ? t2.Sd : this.key(this.convertHorzItemToInternal(t2));
  }
  cacheKey(t2) {
    const i2 = t2;
    return void 0 === i2.kd ? new Date(1e3 * i2.Sd).getTime() : new Date(Date.UTC(i2.kd.year, i2.kd.month - 1, i2.kd.day)).getTime();
  }
  convertHorzItemToInternal(t2) {
    return Fn(i2 = t2) ? Qn(i2) : Nn(i2) ? Jn(i2) : Jn(ts(i2));
    var i2;
  }
  updateFormatter(t2) {
    if (!this.cn)
      return;
    const i2 = t2.dateFormat;
    this.cn.timeScale.timeVisible ? this.yd = new qn({ fd: i2, vd: this.cn.timeScale.secondsVisible ? "%h:%m:%s" : "%h:%m", pd: "   ", md: t2.locale }) : this.yd = new Hn(i2, t2.locale);
  }
  formatHorzItem(t2) {
    const i2 = t2;
    return this.yd.F_(new Date(1e3 * i2.Sd));
  }
  formatTickmark(t2, i2) {
    const n2 = function(t3, i3, n3) {
      switch (t3) {
        case 0:
        case 10:
          return i3 ? n3 ? 4 : 3 : 2;
        case 20:
        case 21:
        case 22:
        case 30:
        case 31:
        case 32:
        case 33:
          return i3 ? 3 : 2;
        case 50:
          return 2;
        case 60:
          return 1;
        case 70:
          return 0;
      }
    }(t2.weight, this.cn.timeScale.timeVisible, this.cn.timeScale.secondsVisible), s = this.cn.timeScale;
    if (void 0 !== s.tickMarkFormatter) {
      const e3 = s.tickMarkFormatter(t2.originalTime, n2, i2.locale);
      if (null !== e3)
        return e3;
    }
    return function(t3, i3, n3) {
      const s2 = {};
      switch (i3) {
        case 0:
          s2.year = "numeric";
          break;
        case 1:
          s2.month = "short";
          break;
        case 2:
          s2.day = "numeric";
          break;
        case 3:
          s2.hour12 = false, s2.hour = "2-digit", s2.minute = "2-digit";
          break;
        case 4:
          s2.hour12 = false, s2.hour = "2-digit", s2.minute = "2-digit", s2.second = "2-digit";
      }
      const e3 = void 0 === t3.kd ? new Date(1e3 * t3.Sd) : new Date(Date.UTC(t3.kd.year, t3.kd.month - 1, t3.kd.day));
      return new Date(e3.getUTCFullYear(), e3.getUTCMonth(), e3.getUTCDate(), e3.getUTCHours(), e3.getUTCMinutes(), e3.getUTCSeconds(), e3.getUTCMilliseconds()).toLocaleString(n3, s2);
    }(t2.time, n2, i2.locale);
  }
  maxTickMarkWeight(t2) {
    let i2 = t2.reduce(Pn, t2[0]).weight;
    return i2 > 30 && i2 < 50 && (i2 = 30), i2;
  }
  fillWeightsForPoints(t2, i2) {
    !function(t3, i3 = 0) {
      if (0 === t3.length)
        return;
      let n2 = 0 === i3 ? null : t3[i3 - 1].time.Sd, s = null !== n2 ? new Date(1e3 * n2) : null, e3 = 0;
      for (let r2 = i3; r2 < t3.length; ++r2) {
        const i4 = t3[r2], h2 = new Date(1e3 * i4.time.Sd);
        null !== s && (i4.timeWeight = Gn(h2, s)), e3 += i4.time.Sd - (n2 || i4.time.Sd), n2 = i4.time.Sd, s = h2;
      }
      if (0 === i3 && t3.length > 1) {
        const i4 = Math.ceil(e3 / (t3.length - 1)), n3 = new Date(1e3 * (t3[0].time.Sd - i4));
        t3[0].timeWeight = Gn(new Date(1e3 * t3[0].time.Sd), n3);
      }
    }(t2, i2);
  }
  static Cd(t2) {
    return D({ localization: { dateFormat: "dd MMM 'yy" } }, null != t2 ? t2 : {});
  }
};
var ss = "undefined" != typeof window;
function es() {
  return !!ss && window.navigator.userAgent.toLowerCase().indexOf("firefox") > -1;
}
function rs() {
  return !!ss && /iPhone|iPad|iPod/.test(window.navigator.platform);
}
function hs(t2) {
  return t2 + t2 % 2;
}
function ls(t2, i2) {
  return t2.Td - i2.Td;
}
function as(t2, i2, n2) {
  const s = (t2.Td - i2.Td) / (t2.ut - i2.ut);
  return Math.sign(s) * Math.min(Math.abs(s), n2);
}
var os = class {
  constructor(t2, i2, n2, s) {
    this.Pd = null, this.Rd = null, this.Dd = null, this.Od = null, this.Ad = null, this.Vd = 0, this.Bd = 0, this.Id = t2, this.zd = i2, this.Ed = n2, this.rs = s;
  }
  Ld(t2, i2) {
    if (null !== this.Pd) {
      if (this.Pd.ut === i2)
        return void (this.Pd.Td = t2);
      if (Math.abs(this.Pd.Td - t2) < this.rs)
        return;
    }
    this.Od = this.Dd, this.Dd = this.Rd, this.Rd = this.Pd, this.Pd = { ut: i2, Td: t2 };
  }
  Dr(t2, i2) {
    if (null === this.Pd || null === this.Rd)
      return;
    if (i2 - this.Pd.ut > 50)
      return;
    let n2 = 0;
    const s = as(this.Pd, this.Rd, this.zd), e3 = ls(this.Pd, this.Rd), r2 = [s], h2 = [e3];
    if (n2 += e3, null !== this.Dd) {
      const t3 = as(this.Rd, this.Dd, this.zd);
      if (Math.sign(t3) === Math.sign(s)) {
        const i3 = ls(this.Rd, this.Dd);
        if (r2.push(t3), h2.push(i3), n2 += i3, null !== this.Od) {
          const t4 = as(this.Dd, this.Od, this.zd);
          if (Math.sign(t4) === Math.sign(s)) {
            const i4 = ls(this.Dd, this.Od);
            r2.push(t4), h2.push(i4), n2 += i4;
          }
        }
      }
    }
    let l2 = 0;
    for (let t3 = 0; t3 < r2.length; ++t3)
      l2 += h2[t3] / n2 * r2[t3];
    Math.abs(l2) < this.Id || (this.Ad = { Td: t2, ut: i2 }, this.Bd = l2, this.Vd = function(t3, i3) {
      const n3 = Math.log(i3);
      return Math.log(1 * n3 / -t3) / n3;
    }(Math.abs(l2), this.Ed));
  }
  Xu(t2) {
    const i2 = b(this.Ad), n2 = t2 - i2.ut;
    return i2.Td + this.Bd * (Math.pow(this.Ed, n2) - 1) / Math.log(this.Ed);
  }
  Yu(t2) {
    return null === this.Ad || this.Nd(t2) === this.Vd;
  }
  Nd(t2) {
    const i2 = t2 - b(this.Ad).ut;
    return Math.min(i2, this.Vd);
  }
};
function _s(t2, n2) {
  const s = b(t2.ownerDocument).createElement("canvas");
  t2.appendChild(s);
  const e3 = bindTo(s, { type: "device-pixel-content-box", options: { allowResizeObserver: false }, transform: (t3, i2) => ({ width: Math.max(t3.width, i2.width), height: Math.max(t3.height, i2.height) }) });
  return e3.resizeCanvasElement(n2), e3;
}
function us(t2, i2, n2, s) {
  t2.G && t2.G(i2, n2, s);
}
function cs(t2, i2, n2, s) {
  t2.K(i2, n2, s);
}
function ds(t2, i2, n2, s) {
  const e3 = t2(n2, s);
  for (const t3 of e3) {
    const n3 = t3.xt();
    null !== n3 && i2(n3);
  }
}
function fs(t2) {
  ss && void 0 !== window.chrome && t2.addEventListener("mousedown", (t3) => {
    if (1 === t3.button)
      return t3.preventDefault(), false;
  });
}
var vs = class {
  constructor(t2, i2, n2) {
    this.Fd = 0, this.Wd = null, this.jd = { et: Number.NEGATIVE_INFINITY, rt: Number.POSITIVE_INFINITY }, this.Hd = 0, this.$d = null, this.Ud = { et: Number.NEGATIVE_INFINITY, rt: Number.POSITIVE_INFINITY }, this.qd = null, this.Yd = false, this.Xd = null, this.Kd = null, this.Zd = false, this.Gd = false, this.Jd = false, this.Qd = null, this.tf = null, this.if = null, this.nf = null, this.sf = null, this.ef = null, this.rf = null, this.hf = 0, this.lf = false, this.af = false, this._f = false, this.uf = 0, this.cf = null, this.df = !rs(), this.ff = (t3) => {
      this.vf(t3);
    }, this.pf = (t3) => {
      if (this.mf(t3)) {
        const i3 = this.bf(t3);
        if (++this.Hd, this.$d && this.Hd > 1) {
          const { wf: n3 } = this.gf(bs(t3), this.Ud);
          n3 < 30 && !this.Jd && this.Mf(i3, this.Sf.xf), this.kf();
        }
      } else {
        const i3 = this.bf(t3);
        if (++this.Fd, this.Wd && this.Fd > 1) {
          const { wf: n3 } = this.gf(bs(t3), this.jd);
          n3 < 5 && !this.Gd && this.yf(i3, this.Sf.Cf), this.Tf();
        }
      }
    }, this.Pf = t2, this.Sf = i2, this.cn = n2, this.Rf();
  }
  S() {
    null !== this.Qd && (this.Qd(), this.Qd = null), null !== this.tf && (this.tf(), this.tf = null), null !== this.nf && (this.nf(), this.nf = null), null !== this.sf && (this.sf(), this.sf = null), null !== this.ef && (this.ef(), this.ef = null), null !== this.if && (this.if(), this.if = null), this.Df(), this.Tf();
  }
  Of(t2) {
    this.nf && this.nf();
    const i2 = this.Af.bind(this);
    if (this.nf = () => {
      this.Pf.removeEventListener("mousemove", i2);
    }, this.Pf.addEventListener("mousemove", i2), this.mf(t2))
      return;
    const n2 = this.bf(t2);
    this.yf(n2, this.Sf.Vf), this.df = true;
  }
  Tf() {
    null !== this.Wd && clearTimeout(this.Wd), this.Fd = 0, this.Wd = null, this.jd = { et: Number.NEGATIVE_INFINITY, rt: Number.POSITIVE_INFINITY };
  }
  kf() {
    null !== this.$d && clearTimeout(this.$d), this.Hd = 0, this.$d = null, this.Ud = { et: Number.NEGATIVE_INFINITY, rt: Number.POSITIVE_INFINITY };
  }
  Af(t2) {
    if (this._f || null !== this.Kd)
      return;
    if (this.mf(t2))
      return;
    const i2 = this.bf(t2);
    this.yf(i2, this.Sf.Bf), this.df = true;
  }
  If(t2) {
    const i2 = gs(t2.changedTouches, b(this.cf));
    if (null === i2)
      return;
    if (this.uf = ws(t2), null !== this.rf)
      return;
    if (this.af)
      return;
    this.lf = true;
    const n2 = this.gf(bs(i2), b(this.Kd)), { zf: s, Ef: e3, wf: r2 } = n2;
    if (this.Zd || !(r2 < 5)) {
      if (!this.Zd) {
        const t3 = 0.5 * s, i3 = e3 >= t3 && !this.cn.Lf(), n3 = t3 > e3 && !this.cn.Nf();
        i3 || n3 || (this.af = true), this.Zd = true, this.Jd = true, this.Df(), this.kf();
      }
      if (!this.af) {
        const n3 = this.bf(t2, i2);
        this.Mf(n3, this.Sf.Ff), ms(t2);
      }
    }
  }
  Wf(t2) {
    if (0 !== t2.button)
      return;
    const i2 = this.gf(bs(t2), b(this.Xd)), { wf: n2 } = i2;
    if (n2 >= 5 && (this.Gd = true, this.Tf()), this.Gd) {
      const i3 = this.bf(t2);
      this.yf(i3, this.Sf.jf);
    }
  }
  gf(t2, i2) {
    const n2 = Math.abs(i2.et - t2.et), s = Math.abs(i2.rt - t2.rt);
    return { zf: n2, Ef: s, wf: n2 + s };
  }
  Hf(t2) {
    let i2 = gs(t2.changedTouches, b(this.cf));
    if (null === i2 && 0 === t2.touches.length && (i2 = t2.changedTouches[0]), null === i2)
      return;
    this.cf = null, this.uf = ws(t2), this.Df(), this.Kd = null, this.ef && (this.ef(), this.ef = null);
    const n2 = this.bf(t2, i2);
    if (this.Mf(n2, this.Sf.$f), ++this.Hd, this.$d && this.Hd > 1) {
      const { wf: t3 } = this.gf(bs(i2), this.Ud);
      t3 < 30 && !this.Jd && this.Mf(n2, this.Sf.xf), this.kf();
    } else
      this.Jd || (this.Mf(n2, this.Sf.Uf), this.Sf.Uf && ms(t2));
    0 === this.Hd && ms(t2), 0 === t2.touches.length && this.Yd && (this.Yd = false, ms(t2));
  }
  vf(t2) {
    if (0 !== t2.button)
      return;
    const i2 = this.bf(t2);
    if (this.Xd = null, this._f = false, this.sf && (this.sf(), this.sf = null), es()) {
      this.Pf.ownerDocument.documentElement.removeEventListener("mouseleave", this.ff);
    }
    if (!this.mf(t2))
      if (this.yf(i2, this.Sf.qf), ++this.Fd, this.Wd && this.Fd > 1) {
        const { wf: n2 } = this.gf(bs(t2), this.jd);
        n2 < 5 && !this.Gd && this.yf(i2, this.Sf.Cf), this.Tf();
      } else
        this.Gd || this.yf(i2, this.Sf.Yf);
  }
  Df() {
    null !== this.qd && (clearTimeout(this.qd), this.qd = null);
  }
  Xf(t2) {
    if (null !== this.cf)
      return;
    const i2 = t2.changedTouches[0];
    this.cf = i2.identifier, this.uf = ws(t2);
    const n2 = this.Pf.ownerDocument.documentElement;
    this.Jd = false, this.Zd = false, this.af = false, this.Kd = bs(i2), this.ef && (this.ef(), this.ef = null);
    {
      const i3 = this.If.bind(this), s2 = this.Hf.bind(this);
      this.ef = () => {
        n2.removeEventListener("touchmove", i3), n2.removeEventListener("touchend", s2);
      }, n2.addEventListener("touchmove", i3, { passive: false }), n2.addEventListener("touchend", s2, { passive: false }), this.Df(), this.qd = setTimeout(this.Kf.bind(this, t2), 240);
    }
    const s = this.bf(t2, i2);
    this.Mf(s, this.Sf.Zf), this.$d || (this.Hd = 0, this.$d = setTimeout(this.kf.bind(this), 500), this.Ud = bs(i2));
  }
  Gf(t2) {
    if (0 !== t2.button)
      return;
    const i2 = this.Pf.ownerDocument.documentElement;
    es() && i2.addEventListener("mouseleave", this.ff), this.Gd = false, this.Xd = bs(t2), this.sf && (this.sf(), this.sf = null);
    {
      const t3 = this.Wf.bind(this), n3 = this.vf.bind(this);
      this.sf = () => {
        i2.removeEventListener("mousemove", t3), i2.removeEventListener("mouseup", n3);
      }, i2.addEventListener("mousemove", t3), i2.addEventListener("mouseup", n3);
    }
    if (this._f = true, this.mf(t2))
      return;
    const n2 = this.bf(t2);
    this.yf(n2, this.Sf.Jf), this.Wd || (this.Fd = 0, this.Wd = setTimeout(this.Tf.bind(this), 500), this.jd = bs(t2));
  }
  Rf() {
    this.Pf.addEventListener("mouseenter", this.Of.bind(this)), this.Pf.addEventListener("touchcancel", this.Df.bind(this));
    {
      const t2 = this.Pf.ownerDocument, i2 = (t3) => {
        this.Sf.Qf && (t3.composed && this.Pf.contains(t3.composedPath()[0]) || t3.target && this.Pf.contains(t3.target) || this.Sf.Qf());
      };
      this.tf = () => {
        t2.removeEventListener("touchstart", i2);
      }, this.Qd = () => {
        t2.removeEventListener("mousedown", i2);
      }, t2.addEventListener("mousedown", i2), t2.addEventListener("touchstart", i2, { passive: true });
    }
    rs() && (this.if = () => {
      this.Pf.removeEventListener("dblclick", this.pf);
    }, this.Pf.addEventListener("dblclick", this.pf)), this.Pf.addEventListener("mouseleave", this.tv.bind(this)), this.Pf.addEventListener("touchstart", this.Xf.bind(this), { passive: true }), fs(this.Pf), this.Pf.addEventListener("mousedown", this.Gf.bind(this)), this.iv(), this.Pf.addEventListener("touchmove", () => {
    }, { passive: false });
  }
  iv() {
    void 0 === this.Sf.nv && void 0 === this.Sf.sv && void 0 === this.Sf.ev || (this.Pf.addEventListener("touchstart", (t2) => this.rv(t2.touches), { passive: true }), this.Pf.addEventListener("touchmove", (t2) => {
      if (2 === t2.touches.length && null !== this.rf && void 0 !== this.Sf.sv) {
        const i2 = ps(t2.touches[0], t2.touches[1]) / this.hf;
        this.Sf.sv(this.rf, i2), ms(t2);
      }
    }, { passive: false }), this.Pf.addEventListener("touchend", (t2) => {
      this.rv(t2.touches);
    }));
  }
  rv(t2) {
    1 === t2.length && (this.lf = false), 2 !== t2.length || this.lf || this.Yd ? this.hv() : this.lv(t2);
  }
  lv(t2) {
    const i2 = this.Pf.getBoundingClientRect() || { left: 0, top: 0 };
    this.rf = { et: (t2[0].clientX - i2.left + (t2[1].clientX - i2.left)) / 2, rt: (t2[0].clientY - i2.top + (t2[1].clientY - i2.top)) / 2 }, this.hf = ps(t2[0], t2[1]), void 0 !== this.Sf.nv && this.Sf.nv(), this.Df();
  }
  hv() {
    null !== this.rf && (this.rf = null, void 0 !== this.Sf.ev && this.Sf.ev());
  }
  tv(t2) {
    if (this.nf && this.nf(), this.mf(t2))
      return;
    if (!this.df)
      return;
    const i2 = this.bf(t2);
    this.yf(i2, this.Sf.av), this.df = !rs();
  }
  Kf(t2) {
    const i2 = gs(t2.touches, b(this.cf));
    if (null === i2)
      return;
    const n2 = this.bf(t2, i2);
    this.Mf(n2, this.Sf.ov), this.Jd = true, this.Yd = true;
  }
  mf(t2) {
    return t2.sourceCapabilities && void 0 !== t2.sourceCapabilities.firesTouchEvents ? t2.sourceCapabilities.firesTouchEvents : ws(t2) < this.uf + 500;
  }
  Mf(t2, i2) {
    i2 && i2.call(this.Sf, t2);
  }
  yf(t2, i2) {
    i2 && i2.call(this.Sf, t2);
  }
  bf(t2, i2) {
    const n2 = i2 || t2, s = this.Pf.getBoundingClientRect() || { left: 0, top: 0 };
    return { clientX: n2.clientX, clientY: n2.clientY, pageX: n2.pageX, pageY: n2.pageY, screenX: n2.screenX, screenY: n2.screenY, localX: n2.clientX - s.left, localY: n2.clientY - s.top, ctrlKey: t2.ctrlKey, altKey: t2.altKey, shiftKey: t2.shiftKey, metaKey: t2.metaKey, _v: !t2.type.startsWith("mouse") && "contextmenu" !== t2.type && "click" !== t2.type, uv: t2.type, cv: n2.target, dv: t2.view, fv: () => {
      "touchstart" !== t2.type && ms(t2);
    } };
  }
};
function ps(t2, i2) {
  const n2 = t2.clientX - i2.clientX, s = t2.clientY - i2.clientY;
  return Math.sqrt(n2 * n2 + s * s);
}
function ms(t2) {
  t2.cancelable && t2.preventDefault();
}
function bs(t2) {
  return { et: t2.pageX, rt: t2.pageY };
}
function ws(t2) {
  return t2.timeStamp || performance.now();
}
function gs(t2, i2) {
  for (let n2 = 0; n2 < t2.length; ++n2)
    if (t2[n2].identifier === i2)
      return t2[n2];
  return null;
}
function Ms(t2) {
  return { Ic: t2.Ic, vv: { wr: t2.pv.externalId }, mv: t2.pv.cursorStyle };
}
function xs(t2, i2, n2) {
  for (const s of t2) {
    const t3 = s.xt();
    if (null !== t3 && t3.br) {
      const e3 = t3.br(i2, n2);
      if (null !== e3)
        return { dv: s, vv: e3 };
    }
  }
  return null;
}
function Ss(t2, i2) {
  return (n2) => {
    var s, e3, r2, h2;
    return (null !== (e3 = null === (s = n2.At()) || void 0 === s ? void 0 : s.xa()) && void 0 !== e3 ? e3 : "") !== i2 ? [] : null !== (h2 = null === (r2 = n2.la) || void 0 === r2 ? void 0 : r2.call(n2, t2)) && void 0 !== h2 ? h2 : [];
  };
}
var ks = class {
  constructor(i2, n2, s, e3) {
    this.Li = null, this.bv = null, this.wv = false, this.gv = new si(200), this.Gr = null, this.Mv = 0, this.xv = false, this.Sv = () => {
      this.xv || this.nn.kv().qt().Fh();
    }, this.yv = () => {
      this.xv || this.nn.kv().qt().Fh();
    }, this.nn = i2, this.cn = n2, this.mo = n2.layout, this.kc = s, this.Cv = "left" === e3, this.Tv = Ss("normal", e3), this.Pv = Ss("top", e3), this.Rv = Ss("bottom", e3), this.Dv = document.createElement("div"), this.Dv.style.height = "100%", this.Dv.style.overflow = "hidden", this.Dv.style.width = "25px", this.Dv.style.left = "0", this.Dv.style.position = "relative", this.Ov = _s(this.Dv, size({ width: 16, height: 16 })), this.Ov.subscribeSuggestedBitmapSizeChanged(this.Sv);
    const r2 = this.Ov.canvasElement;
    r2.style.position = "absolute", r2.style.zIndex = "1", r2.style.left = "0", r2.style.top = "0", this.Av = _s(this.Dv, size({ width: 16, height: 16 })), this.Av.subscribeSuggestedBitmapSizeChanged(this.yv);
    const h2 = this.Av.canvasElement;
    h2.style.position = "absolute", h2.style.zIndex = "2", h2.style.left = "0", h2.style.top = "0";
    const l2 = { Jf: this.Vv.bind(this), Zf: this.Vv.bind(this), jf: this.Bv.bind(this), Ff: this.Bv.bind(this), Qf: this.Iv.bind(this), qf: this.zv.bind(this), $f: this.zv.bind(this), Cf: this.Ev.bind(this), xf: this.Ev.bind(this), Vf: this.Lv.bind(this), av: this.Nv.bind(this) };
    this.Fv = new vs(this.Av.canvasElement, l2, { Lf: () => false, Nf: () => true });
  }
  S() {
    this.Fv.S(), this.Av.unsubscribeSuggestedBitmapSizeChanged(this.yv), this.Av.dispose(), this.Ov.unsubscribeSuggestedBitmapSizeChanged(this.Sv), this.Ov.dispose(), null !== this.Li && this.Li.$o().p(this), this.Li = null;
  }
  Wv() {
    return this.Dv;
  }
  P() {
    return this.mo.fontSize;
  }
  jv() {
    const t2 = this.kc.W();
    return this.Gr !== t2.R && (this.gv.ir(), this.Gr = t2.R), t2;
  }
  Hv() {
    if (null === this.Li)
      return 0;
    let t2 = 0;
    const i2 = this.jv(), n2 = b(this.Ov.canvasElement.getContext("2d"));
    n2.save();
    const s = this.Li.Ea();
    n2.font = this.$v(), s.length > 0 && (t2 = Math.max(this.gv.Si(n2, s[0].Za), this.gv.Si(n2, s[s.length - 1].Za)));
    const e3 = this.Uv();
    for (let i3 = e3.length; i3--; ) {
      const s2 = this.gv.Si(n2, e3[i3].Jt());
      s2 > t2 && (t2 = s2);
    }
    const r2 = this.Li.Pt();
    if (null !== r2 && null !== this.bv) {
      const i3 = this.Li.pn(1, r2), s2 = this.Li.pn(this.bv.height - 2, r2);
      t2 = Math.max(t2, this.gv.Si(n2, this.Li.Wi(Math.floor(Math.min(i3, s2)) + 0.11111111111111, r2)), this.gv.Si(n2, this.Li.Wi(Math.ceil(Math.max(i3, s2)) - 0.11111111111111, r2)));
    }
    n2.restore();
    const h2 = t2 || 34;
    return hs(Math.ceil(i2.C + i2.T + i2.B + i2.I + 5 + h2));
  }
  qv(t2) {
    null !== this.bv && equalSizes(this.bv, t2) || (this.bv = t2, this.xv = true, this.Ov.resizeCanvasElement(t2), this.Av.resizeCanvasElement(t2), this.xv = false, this.Dv.style.width = `${t2.width}px`, this.Dv.style.height = `${t2.height}px`);
  }
  Yv() {
    return b(this.bv).width;
  }
  Ji(t2) {
    this.Li !== t2 && (null !== this.Li && this.Li.$o().p(this), this.Li = t2, t2.$o().l(this.ao.bind(this), this));
  }
  At() {
    return this.Li;
  }
  ir() {
    const t2 = this.nn.Xv();
    this.nn.kv().qt().A_(t2, b(this.At()));
  }
  Kv(t2) {
    if (null === this.bv)
      return;
    if (1 !== t2) {
      this.Zv(), this.Ov.applySuggestedBitmapSize();
      const t3 = tryCreateCanvasRenderingTarget2D(this.Ov);
      null !== t3 && (t3.useBitmapCoordinateSpace((t4) => {
        this.Gv(t4), this.Be(t4);
      }), this.nn.Jv(t3, this.Rv), this.Qv(t3), this.nn.Jv(t3, this.Tv), this.tp(t3));
    }
    this.Av.applySuggestedBitmapSize();
    const i2 = tryCreateCanvasRenderingTarget2D(this.Av);
    null !== i2 && (i2.useBitmapCoordinateSpace(({ context: t3, bitmapSize: i3 }) => {
      t3.clearRect(0, 0, i3.width, i3.height);
    }), this.ip(i2), this.nn.Jv(i2, this.Pv));
  }
  np() {
    return this.Ov.bitmapSize;
  }
  sp(t2, i2, n2) {
    const s = this.np();
    s.width > 0 && s.height > 0 && t2.drawImage(this.Ov.canvasElement, i2, n2);
  }
  gt() {
    var t2;
    null === (t2 = this.Li) || void 0 === t2 || t2.Ea();
  }
  Vv(t2) {
    if (null === this.Li || this.Li.Fi() || !this.cn.handleScale.axisPressedMouseMove.price)
      return;
    const i2 = this.nn.kv().qt(), n2 = this.nn.Xv();
    this.wv = true, i2.y_(n2, this.Li, t2.localY);
  }
  Bv(t2) {
    if (null === this.Li || !this.cn.handleScale.axisPressedMouseMove.price)
      return;
    const i2 = this.nn.kv().qt(), n2 = this.nn.Xv(), s = this.Li;
    i2.C_(n2, s, t2.localY);
  }
  Iv() {
    if (null === this.Li || !this.cn.handleScale.axisPressedMouseMove.price)
      return;
    const t2 = this.nn.kv().qt(), i2 = this.nn.Xv(), n2 = this.Li;
    this.wv && (this.wv = false, t2.T_(i2, n2));
  }
  zv(t2) {
    if (null === this.Li || !this.cn.handleScale.axisPressedMouseMove.price)
      return;
    const i2 = this.nn.kv().qt(), n2 = this.nn.Xv();
    this.wv = false, i2.T_(n2, this.Li);
  }
  Ev(t2) {
    this.cn.handleScale.axisDoubleClickReset.price && this.ir();
  }
  Lv(t2) {
    if (null === this.Li)
      return;
    !this.nn.kv().qt().W().handleScale.axisPressedMouseMove.price || this.Li.ph() || this.Li.Co() || this.ep(1);
  }
  Nv(t2) {
    this.ep(0);
  }
  Uv() {
    const t2 = [], i2 = null === this.Li ? void 0 : this.Li;
    return ((n2) => {
      for (let s = 0; s < n2.length; ++s) {
        const e3 = n2[s].Rn(this.nn.Xv(), i2);
        for (let i3 = 0; i3 < e3.length; i3++)
          t2.push(e3[i3]);
      }
    })(this.nn.Xv().No()), t2;
  }
  Gv({ context: t2, bitmapSize: i2 }) {
    const { width: n2, height: s } = i2, e3 = this.nn.Xv().qt(), r2 = e3.q(), h2 = e3.ad();
    r2 === h2 ? G(t2, 0, 0, n2, s, r2) : it(t2, 0, 0, n2, s, r2, h2);
  }
  Be({ context: t2, bitmapSize: i2, horizontalPixelRatio: n2 }) {
    if (null === this.bv || null === this.Li || !this.Li.W().borderVisible)
      return;
    t2.fillStyle = this.Li.W().borderColor;
    const s = Math.max(1, Math.floor(this.jv().C * n2));
    let e3;
    e3 = this.Cv ? i2.width - s : 0, t2.fillRect(e3, 0, s, i2.height);
  }
  Qv(t2) {
    if (null === this.bv || null === this.Li)
      return;
    const i2 = this.Li.Ea(), n2 = this.Li.W(), s = this.jv(), e3 = this.Cv ? this.bv.width - s.T : 0;
    n2.borderVisible && n2.ticksVisible && t2.useBitmapCoordinateSpace(({ context: t3, horizontalPixelRatio: r2, verticalPixelRatio: h2 }) => {
      t3.fillStyle = n2.borderColor;
      const l2 = Math.max(1, Math.floor(h2)), a2 = Math.floor(0.5 * h2), o3 = Math.round(s.T * r2);
      t3.beginPath();
      for (const n3 of i2)
        t3.rect(Math.floor(e3 * r2), Math.round(n3.Aa * h2) - a2, o3, l2);
      t3.fill();
    }), t2.useMediaCoordinateSpace(({ context: t3 }) => {
      var r2;
      t3.font = this.$v(), t3.fillStyle = null !== (r2 = n2.textColor) && void 0 !== r2 ? r2 : this.mo.textColor, t3.textAlign = this.Cv ? "right" : "left", t3.textBaseline = "middle";
      const h2 = this.Cv ? Math.round(e3 - s.B) : Math.round(e3 + s.T + s.B), l2 = i2.map((i3) => this.gv.xi(t3, i3.Za));
      for (let n3 = i2.length; n3--; ) {
        const s2 = i2[n3];
        t3.fillText(s2.Za, h2, s2.Aa + l2[n3]);
      }
    });
  }
  Zv() {
    if (null === this.bv || null === this.Li)
      return;
    let t2 = this.bv.height / 2;
    const i2 = [], n2 = this.Li.No().slice(), s = this.nn.Xv(), e3 = this.jv();
    this.Li === s.vr() && this.nn.Xv().No().forEach((t3) => {
      s.dr(t3) && n2.push(t3);
    });
    const r2 = this.Li.Ta()[0], h2 = this.Li;
    n2.forEach((n3) => {
      const e4 = n3.Rn(s, h2);
      e4.forEach((t3) => {
        t3.Vi(null), t3.Bi() && i2.push(t3);
      }), r2 === n3 && e4.length > 0 && (t2 = e4[0].yi());
    }), i2.forEach((t3) => t3.Vi(t3.yi()));
    this.Li.W().alignLabels && this.rp(i2, e3, t2);
  }
  rp(t2, i2, n2) {
    if (null === this.bv)
      return;
    const s = t2.filter((t3) => t3.yi() <= n2), e3 = t2.filter((t3) => t3.yi() > n2);
    s.sort((t3, i3) => i3.yi() - t3.yi()), s.length && e3.length && e3.push(s[0]), e3.sort((t3, i3) => t3.yi() - i3.yi());
    for (const n3 of t2) {
      const t3 = Math.floor(n3.zt(i2) / 2), s2 = n3.yi();
      s2 > -t3 && s2 < t3 && n3.Vi(t3), s2 > this.bv.height - t3 && s2 < this.bv.height + t3 && n3.Vi(this.bv.height - t3);
    }
    for (let t3 = 1; t3 < s.length; t3++) {
      const n3 = s[t3], e4 = s[t3 - 1], r2 = e4.zt(i2, false), h2 = n3.yi(), l2 = e4.Ai();
      h2 > l2 - r2 && n3.Vi(l2 - r2);
    }
    for (let t3 = 1; t3 < e3.length; t3++) {
      const n3 = e3[t3], s2 = e3[t3 - 1], r2 = s2.zt(i2, true), h2 = n3.yi(), l2 = s2.Ai();
      h2 < l2 + r2 && n3.Vi(l2 + r2);
    }
  }
  tp(t2) {
    if (null === this.bv)
      return;
    const i2 = this.Uv(), n2 = this.jv(), s = this.Cv ? "right" : "left";
    i2.forEach((i3) => {
      if (i3.Ii()) {
        i3.xt(b(this.Li)).K(t2, n2, this.gv, s);
      }
    });
  }
  ip(t2) {
    if (null === this.bv || null === this.Li)
      return;
    const i2 = this.nn.kv().qt(), n2 = [], s = this.nn.Xv(), e3 = i2.Fc().Rn(s, this.Li);
    e3.length && n2.push(e3);
    const r2 = this.jv(), h2 = this.Cv ? "right" : "left";
    n2.forEach((i3) => {
      i3.forEach((i4) => {
        i4.xt(b(this.Li)).K(t2, r2, this.gv, h2);
      });
    });
  }
  ep(t2) {
    this.Dv.style.cursor = 1 === t2 ? "ns-resize" : "default";
  }
  ao() {
    const t2 = this.Hv();
    this.Mv < t2 && this.nn.kv().qt().$l(), this.Mv = t2;
  }
  $v() {
    return N(this.mo.fontSize, this.mo.fontFamily);
  }
};
function ys(t2, i2) {
  var n2, s;
  return null !== (s = null === (n2 = t2.ra) || void 0 === n2 ? void 0 : n2.call(t2, i2)) && void 0 !== s ? s : [];
}
function Cs(t2, i2) {
  var n2, s;
  return null !== (s = null === (n2 = t2.Pn) || void 0 === n2 ? void 0 : n2.call(t2, i2)) && void 0 !== s ? s : [];
}
function Ts(t2, i2) {
  var n2, s;
  return null !== (s = null === (n2 = t2.Qi) || void 0 === n2 ? void 0 : n2.call(t2, i2)) && void 0 !== s ? s : [];
}
function Ps(t2, i2) {
  var n2, s;
  return null !== (s = null === (n2 = t2.na) || void 0 === n2 ? void 0 : n2.call(t2, i2)) && void 0 !== s ? s : [];
}
var Rs = class {
  constructor(i2, n2) {
    this.bv = size({ width: 0, height: 0 }), this.hp = null, this.lp = null, this.ap = null, this.op = false, this._p = new R(), this.up = new R(), this.cp = 0, this.dp = false, this.fp = null, this.vp = false, this.pp = null, this.mp = null, this.xv = false, this.Sv = () => {
      this.xv || null === this.bp || this.Ui().Fh();
    }, this.yv = () => {
      this.xv || null === this.bp || this.Ui().Fh();
    }, this.wp = i2, this.bp = n2, this.bp.I_().l(this.gp.bind(this), this, true), this.Mp = document.createElement("td"), this.Mp.style.padding = "0", this.Mp.style.position = "relative";
    const s = document.createElement("div");
    s.style.width = "100%", s.style.height = "100%", s.style.position = "relative", s.style.overflow = "hidden", this.xp = document.createElement("td"), this.xp.style.padding = "0", this.Sp = document.createElement("td"), this.Sp.style.padding = "0", this.Mp.appendChild(s), this.Ov = _s(s, size({ width: 16, height: 16 })), this.Ov.subscribeSuggestedBitmapSizeChanged(this.Sv);
    const e3 = this.Ov.canvasElement;
    e3.style.position = "absolute", e3.style.zIndex = "1", e3.style.left = "0", e3.style.top = "0", this.Av = _s(s, size({ width: 16, height: 16 })), this.Av.subscribeSuggestedBitmapSizeChanged(this.yv);
    const r2 = this.Av.canvasElement;
    r2.style.position = "absolute", r2.style.zIndex = "2", r2.style.left = "0", r2.style.top = "0", this.kp = document.createElement("tr"), this.kp.appendChild(this.xp), this.kp.appendChild(this.Mp), this.kp.appendChild(this.Sp), this.yp(), this.Fv = new vs(this.Av.canvasElement, this, { Lf: () => null === this.fp && !this.wp.W().handleScroll.vertTouchDrag, Nf: () => null === this.fp && !this.wp.W().handleScroll.horzTouchDrag });
  }
  S() {
    null !== this.hp && this.hp.S(), null !== this.lp && this.lp.S(), this.Av.unsubscribeSuggestedBitmapSizeChanged(this.yv), this.Av.dispose(), this.Ov.unsubscribeSuggestedBitmapSizeChanged(this.Sv), this.Ov.dispose(), null !== this.bp && this.bp.I_().p(this), this.Fv.S();
  }
  Xv() {
    return b(this.bp);
  }
  Cp(t2) {
    null !== this.bp && this.bp.I_().p(this), this.bp = t2, null !== this.bp && this.bp.I_().l(Rs.prototype.gp.bind(this), this, true), this.yp();
  }
  kv() {
    return this.wp;
  }
  Wv() {
    return this.kp;
  }
  yp() {
    if (null !== this.bp && (this.Tp(), 0 !== this.Ui().Mt().length)) {
      if (null !== this.hp) {
        const t2 = this.bp.S_();
        this.hp.Ji(b(t2));
      }
      if (null !== this.lp) {
        const t2 = this.bp.k_();
        this.lp.Ji(b(t2));
      }
    }
  }
  Pp() {
    null !== this.hp && this.hp.gt(), null !== this.lp && this.lp.gt();
  }
  v_() {
    return null !== this.bp ? this.bp.v_() : 0;
  }
  p_(t2) {
    this.bp && this.bp.p_(t2);
  }
  Vf(t2) {
    if (!this.bp)
      return;
    this.Rp();
    const i2 = t2.localX, n2 = t2.localY;
    this.Dp(i2, n2, t2);
  }
  Jf(t2) {
    this.Rp(), this.Op(), this.Dp(t2.localX, t2.localY, t2);
  }
  Bf(t2) {
    var i2;
    if (!this.bp)
      return;
    this.Rp();
    const n2 = t2.localX, s = t2.localY;
    this.Dp(n2, s, t2);
    const e3 = this.br(n2, s);
    this.wp.Ap(null !== (i2 = null == e3 ? void 0 : e3.mv) && void 0 !== i2 ? i2 : null), this.Ui().Bc(e3 && { Ic: e3.Ic, vv: e3.vv });
  }
  Yf(t2) {
    null !== this.bp && (this.Rp(), this.Vp(t2));
  }
  Cf(t2) {
    null !== this.bp && this.Bp(this.up, t2);
  }
  xf(t2) {
    this.Cf(t2);
  }
  jf(t2) {
    this.Rp(), this.Ip(t2), this.Dp(t2.localX, t2.localY, t2);
  }
  qf(t2) {
    null !== this.bp && (this.Rp(), this.dp = false, this.zp(t2));
  }
  Uf(t2) {
    null !== this.bp && this.Vp(t2);
  }
  ov(t2) {
    if (this.dp = true, null === this.fp) {
      const i2 = { x: t2.localX, y: t2.localY };
      this.Ep(i2, i2, t2);
    }
  }
  av(t2) {
    null !== this.bp && (this.Rp(), this.bp.qt().Bc(null), this.Lp());
  }
  Np() {
    return this._p;
  }
  Fp() {
    return this.up;
  }
  nv() {
    this.cp = 1, this.Ui().Un();
  }
  sv(t2, i2) {
    if (!this.wp.W().handleScale.pinch)
      return;
    const n2 = 5 * (i2 - this.cp);
    this.cp = i2, this.Ui().Uc(t2.et, n2);
  }
  Zf(t2) {
    if (this.dp = false, this.vp = null !== this.fp, this.Op(), null !== this.fp) {
      const i2 = this.Ui().Fc();
      this.pp = { x: i2.Kt(), y: i2.Zt() }, this.fp = { x: t2.localX, y: t2.localY };
    }
  }
  Ff(t2) {
    if (null === this.bp)
      return;
    const i2 = t2.localX, n2 = t2.localY;
    if (null === this.fp)
      this.Ip(t2);
    else {
      this.vp = false;
      const s = b(this.pp), e3 = s.x + (i2 - this.fp.x), r2 = s.y + (n2 - this.fp.y);
      this.Dp(e3, r2, t2);
    }
  }
  $f(t2) {
    0 === this.kv().W().trackingMode.exitMode && (this.vp = true), this.Wp(), this.zp(t2);
  }
  br(t2, i2) {
    const n2 = this.bp;
    return null === n2 ? null : function(t3, i3, n3) {
      const s = t3.No(), e3 = function(t4, i4, n4) {
        var s2, e4;
        let r2, h2;
        for (const o3 of t4) {
          const t5 = null !== (e4 = null === (s2 = o3.oa) || void 0 === s2 ? void 0 : s2.call(o3, i4, n4)) && void 0 !== e4 ? e4 : [];
          for (const i5 of t5)
            l2 = i5.zOrder, (!(a2 = null == r2 ? void 0 : r2.zOrder) || "top" === l2 && "top" !== a2 || "normal" === l2 && "bottom" === a2) && (r2 = i5, h2 = o3);
        }
        var l2, a2;
        return r2 && h2 ? { pv: r2, Ic: h2 } : null;
      }(s, i3, n3);
      if ("top" === (null == e3 ? void 0 : e3.pv.zOrder))
        return Ms(e3);
      for (const r2 of s) {
        if (e3 && e3.Ic === r2 && "bottom" !== e3.pv.zOrder && !e3.pv.isBackground)
          return Ms(e3);
        const s2 = xs(r2.Pn(t3), i3, n3);
        if (null !== s2)
          return { Ic: r2, dv: s2.dv, vv: s2.vv };
        if (e3 && e3.Ic === r2 && "bottom" !== e3.pv.zOrder && e3.pv.isBackground)
          return Ms(e3);
      }
      return (null == e3 ? void 0 : e3.pv) ? Ms(e3) : null;
    }(n2, t2, i2);
  }
  jp(i2, n2) {
    b("left" === n2 ? this.hp : this.lp).qv(size({ width: i2, height: this.bv.height }));
  }
  Hp() {
    return this.bv;
  }
  qv(t2) {
    equalSizes(this.bv, t2) || (this.bv = t2, this.xv = true, this.Ov.resizeCanvasElement(t2), this.Av.resizeCanvasElement(t2), this.xv = false, this.Mp.style.width = t2.width + "px", this.Mp.style.height = t2.height + "px");
  }
  $p() {
    const t2 = b(this.bp);
    t2.x_(t2.S_()), t2.x_(t2.k_());
    for (const i2 of t2.Ta())
      if (t2.dr(i2)) {
        const n2 = i2.At();
        null !== n2 && t2.x_(n2), i2.On();
      }
  }
  np() {
    return this.Ov.bitmapSize;
  }
  sp(t2, i2, n2) {
    const s = this.np();
    s.width > 0 && s.height > 0 && t2.drawImage(this.Ov.canvasElement, i2, n2);
  }
  Kv(t2) {
    if (0 === t2)
      return;
    if (null === this.bp)
      return;
    if (t2 > 1 && this.$p(), null !== this.hp && this.hp.Kv(t2), null !== this.lp && this.lp.Kv(t2), 1 !== t2) {
      this.Ov.applySuggestedBitmapSize();
      const t3 = tryCreateCanvasRenderingTarget2D(this.Ov);
      null !== t3 && (t3.useBitmapCoordinateSpace((t4) => {
        this.Gv(t4);
      }), this.bp && (this.Up(t3, ys), this.qp(t3), this.Yp(t3), this.Up(t3, Cs), this.Up(t3, Ts)));
    }
    this.Av.applySuggestedBitmapSize();
    const i2 = tryCreateCanvasRenderingTarget2D(this.Av);
    null !== i2 && (i2.useBitmapCoordinateSpace(({ context: t3, bitmapSize: i3 }) => {
      t3.clearRect(0, 0, i3.width, i3.height);
    }), this.Xp(i2), this.Up(i2, Ps));
  }
  Kp() {
    return this.hp;
  }
  Zp() {
    return this.lp;
  }
  Jv(t2, i2) {
    this.Up(t2, i2);
  }
  gp() {
    null !== this.bp && this.bp.I_().p(this), this.bp = null;
  }
  Vp(t2) {
    this.Bp(this._p, t2);
  }
  Bp(t2, i2) {
    const n2 = i2.localX, s = i2.localY;
    t2.M() && t2.m(this.Ui().yt().Vu(n2), { x: n2, y: s }, i2);
  }
  Gv({ context: t2, bitmapSize: i2 }) {
    const { width: n2, height: s } = i2, e3 = this.Ui(), r2 = e3.q(), h2 = e3.ad();
    r2 === h2 ? G(t2, 0, 0, n2, s, h2) : it(t2, 0, 0, n2, s, r2, h2);
  }
  qp(t2) {
    const i2 = b(this.bp).z_().Wh().xt();
    null !== i2 && i2.K(t2, false);
  }
  Yp(t2) {
    const i2 = this.Ui().Nc();
    this.Gp(t2, Cs, us, i2), this.Gp(t2, Cs, cs, i2);
  }
  Xp(t2) {
    this.Gp(t2, Cs, cs, this.Ui().Fc());
  }
  Up(t2, i2) {
    const n2 = b(this.bp).No();
    for (const s of n2)
      this.Gp(t2, i2, us, s);
    for (const s of n2)
      this.Gp(t2, i2, cs, s);
  }
  Gp(t2, i2, n2, s) {
    const e3 = b(this.bp), r2 = e3.qt().Vc(), h2 = null !== r2 && r2.Ic === s, l2 = null !== r2 && h2 && void 0 !== r2.vv ? r2.vv.gr : void 0;
    ds(i2, (i3) => n2(i3, t2, h2, l2), s, e3);
  }
  Tp() {
    if (null === this.bp)
      return;
    const t2 = this.wp, i2 = this.bp.S_().W().visible, n2 = this.bp.k_().W().visible;
    i2 || null === this.hp || (this.xp.removeChild(this.hp.Wv()), this.hp.S(), this.hp = null), n2 || null === this.lp || (this.Sp.removeChild(this.lp.Wv()), this.lp.S(), this.lp = null);
    const s = t2.qt().nd();
    i2 && null === this.hp && (this.hp = new ks(this, t2.W(), s, "left"), this.xp.appendChild(this.hp.Wv())), n2 && null === this.lp && (this.lp = new ks(this, t2.W(), s, "right"), this.Sp.appendChild(this.lp.Wv()));
  }
  Jp(t2) {
    return t2._v && this.dp || null !== this.fp;
  }
  Qp(t2) {
    return Math.max(0, Math.min(t2, this.bv.width - 1));
  }
  tm(t2) {
    return Math.max(0, Math.min(t2, this.bv.height - 1));
  }
  Dp(t2, i2, n2) {
    this.Ui().Jc(this.Qp(t2), this.tm(i2), n2, b(this.bp));
  }
  Lp() {
    this.Ui().Qc();
  }
  Wp() {
    this.vp && (this.fp = null, this.Lp());
  }
  Ep(t2, i2, n2) {
    this.fp = t2, this.vp = false, this.Dp(i2.x, i2.y, n2);
    const s = this.Ui().Fc();
    this.pp = { x: s.Kt(), y: s.Zt() };
  }
  Ui() {
    return this.wp.qt();
  }
  zp(t2) {
    if (!this.op)
      return;
    const i2 = this.Ui(), n2 = this.Xv();
    if (i2.D_(n2, n2.vn()), this.ap = null, this.op = false, i2.Kc(), null !== this.mp) {
      const t3 = performance.now(), n3 = i2.yt();
      this.mp.Dr(n3.Eu(), t3), this.mp.Yu(t3) || i2.Xn(this.mp);
    }
  }
  Rp() {
    this.fp = null;
  }
  Op() {
    if (!this.bp)
      return;
    if (this.Ui().Un(), document.activeElement !== document.body && document.activeElement !== document.documentElement)
      b(document.activeElement).blur();
    else {
      const t2 = document.getSelection();
      null !== t2 && t2.removeAllRanges();
    }
    !this.bp.vn().Fi() && this.Ui().yt().Fi();
  }
  Ip(t2) {
    if (null === this.bp)
      return;
    const i2 = this.Ui(), n2 = i2.yt();
    if (n2.Fi())
      return;
    const s = this.wp.W(), e3 = s.handleScroll, r2 = s.kineticScroll;
    if ((!e3.pressedMouseMove || t2._v) && (!e3.horzTouchDrag && !e3.vertTouchDrag || !t2._v))
      return;
    const h2 = this.bp.vn(), l2 = performance.now();
    if (null !== this.ap || this.Jp(t2) || (this.ap = { x: t2.clientX, y: t2.clientY, Sd: l2, im: t2.localX, nm: t2.localY }), null !== this.ap && !this.op && (this.ap.x !== t2.clientX || this.ap.y !== t2.clientY)) {
      if (t2._v && r2.touch || !t2._v && r2.mouse) {
        const t3 = n2.he();
        this.mp = new os(0.2 / t3, 7 / t3, 0.997, 15 / t3), this.mp.Ld(n2.Eu(), this.ap.Sd);
      } else
        this.mp = null;
      h2.Fi() || i2.P_(this.bp, h2, t2.localY), i2.Yc(t2.localX), this.op = true;
    }
    this.op && (h2.Fi() || i2.R_(this.bp, h2, t2.localY), i2.Xc(t2.localX), null !== this.mp && this.mp.Ld(n2.Eu(), l2));
  }
};
var Ds = class {
  constructor(i2, n2, s, e3, r2) {
    this.bt = true, this.bv = size({ width: 0, height: 0 }), this.Sv = () => this.Kv(3), this.Cv = "left" === i2, this.kc = s.nd, this.cn = n2, this.sm = e3, this.rm = r2, this.Dv = document.createElement("div"), this.Dv.style.width = "25px", this.Dv.style.height = "100%", this.Dv.style.overflow = "hidden", this.Ov = _s(this.Dv, size({ width: 16, height: 16 })), this.Ov.subscribeSuggestedBitmapSizeChanged(this.Sv);
  }
  S() {
    this.Ov.unsubscribeSuggestedBitmapSizeChanged(this.Sv), this.Ov.dispose();
  }
  Wv() {
    return this.Dv;
  }
  Hp() {
    return this.bv;
  }
  qv(t2) {
    equalSizes(this.bv, t2) || (this.bv = t2, this.Ov.resizeCanvasElement(t2), this.Dv.style.width = `${t2.width}px`, this.Dv.style.height = `${t2.height}px`, this.bt = true);
  }
  Kv(t2) {
    if (t2 < 3 && !this.bt)
      return;
    if (0 === this.bv.width || 0 === this.bv.height)
      return;
    this.bt = false, this.Ov.applySuggestedBitmapSize();
    const i2 = tryCreateCanvasRenderingTarget2D(this.Ov);
    null !== i2 && i2.useBitmapCoordinateSpace((t3) => {
      this.Gv(t3), this.Be(t3);
    });
  }
  np() {
    return this.Ov.bitmapSize;
  }
  sp(t2, i2, n2) {
    const s = this.np();
    s.width > 0 && s.height > 0 && t2.drawImage(this.Ov.canvasElement, i2, n2);
  }
  Be({ context: t2, bitmapSize: i2, horizontalPixelRatio: n2, verticalPixelRatio: s }) {
    if (!this.sm())
      return;
    t2.fillStyle = this.cn.timeScale.borderColor;
    const e3 = Math.floor(this.kc.W().C * n2), r2 = Math.floor(this.kc.W().C * s), h2 = this.Cv ? i2.width - e3 : 0;
    t2.fillRect(h2, 0, e3, r2);
  }
  Gv({ context: t2, bitmapSize: i2 }) {
    G(t2, 0, 0, i2.width, i2.height, this.rm());
  }
};
function Os(t2) {
  return (i2) => {
    var n2, s;
    return null !== (s = null === (n2 = i2.aa) || void 0 === n2 ? void 0 : n2.call(i2, t2)) && void 0 !== s ? s : [];
  };
}
var As = Os("normal");
var Vs = Os("top");
var Bs = Os("bottom");
var Is = class {
  constructor(i2, n2) {
    this.hm = null, this.lm = null, this.k = null, this.am = false, this.bv = size({ width: 0, height: 0 }), this.om = new R(), this.gv = new si(5), this.xv = false, this.Sv = () => {
      this.xv || this.wp.qt().Fh();
    }, this.yv = () => {
      this.xv || this.wp.qt().Fh();
    }, this.wp = i2, this.N_ = n2, this.cn = i2.W().layout, this._m = document.createElement("tr"), this.um = document.createElement("td"), this.um.style.padding = "0", this.dm = document.createElement("td"), this.dm.style.padding = "0", this.Dv = document.createElement("td"), this.Dv.style.height = "25px", this.Dv.style.padding = "0", this.fm = document.createElement("div"), this.fm.style.width = "100%", this.fm.style.height = "100%", this.fm.style.position = "relative", this.fm.style.overflow = "hidden", this.Dv.appendChild(this.fm), this.Ov = _s(this.fm, size({ width: 16, height: 16 })), this.Ov.subscribeSuggestedBitmapSizeChanged(this.Sv);
    const s = this.Ov.canvasElement;
    s.style.position = "absolute", s.style.zIndex = "1", s.style.left = "0", s.style.top = "0", this.Av = _s(this.fm, size({ width: 16, height: 16 })), this.Av.subscribeSuggestedBitmapSizeChanged(this.yv);
    const e3 = this.Av.canvasElement;
    e3.style.position = "absolute", e3.style.zIndex = "2", e3.style.left = "0", e3.style.top = "0", this._m.appendChild(this.um), this._m.appendChild(this.Dv), this._m.appendChild(this.dm), this.vm(), this.wp.qt().f_().l(this.vm.bind(this), this), this.Fv = new vs(this.Av.canvasElement, this, { Lf: () => true, Nf: () => false });
  }
  S() {
    this.Fv.S(), null !== this.hm && this.hm.S(), null !== this.lm && this.lm.S(), this.Av.unsubscribeSuggestedBitmapSizeChanged(this.yv), this.Av.dispose(), this.Ov.unsubscribeSuggestedBitmapSizeChanged(this.Sv), this.Ov.dispose();
  }
  Wv() {
    return this._m;
  }
  pm() {
    return this.hm;
  }
  bm() {
    return this.lm;
  }
  Jf(t2) {
    if (this.am)
      return;
    this.am = true;
    const i2 = this.wp.qt();
    !i2.yt().Fi() && this.wp.W().handleScale.axisPressedMouseMove.time && i2.$c(t2.localX);
  }
  Zf(t2) {
    this.Jf(t2);
  }
  Qf() {
    const t2 = this.wp.qt();
    !t2.yt().Fi() && this.am && (this.am = false, this.wp.W().handleScale.axisPressedMouseMove.time && t2.Gc());
  }
  jf(t2) {
    const i2 = this.wp.qt();
    !i2.yt().Fi() && this.wp.W().handleScale.axisPressedMouseMove.time && i2.Zc(t2.localX);
  }
  Ff(t2) {
    this.jf(t2);
  }
  qf() {
    this.am = false;
    const t2 = this.wp.qt();
    t2.yt().Fi() && !this.wp.W().handleScale.axisPressedMouseMove.time || t2.Gc();
  }
  $f() {
    this.qf();
  }
  Cf() {
    this.wp.W().handleScale.axisDoubleClickReset.time && this.wp.qt().Zn();
  }
  xf() {
    this.Cf();
  }
  Vf() {
    this.wp.qt().W().handleScale.axisPressedMouseMove.time && this.ep(1);
  }
  av() {
    this.ep(0);
  }
  Hp() {
    return this.bv;
  }
  wm() {
    return this.om;
  }
  gm(i2, s, e3) {
    equalSizes(this.bv, i2) || (this.bv = i2, this.xv = true, this.Ov.resizeCanvasElement(i2), this.Av.resizeCanvasElement(i2), this.xv = false, this.Dv.style.width = `${i2.width}px`, this.Dv.style.height = `${i2.height}px`, this.om.m(i2)), null !== this.hm && this.hm.qv(size({ width: s, height: i2.height })), null !== this.lm && this.lm.qv(size({ width: e3, height: i2.height }));
  }
  Mm() {
    const t2 = this.xm();
    return Math.ceil(t2.C + t2.T + t2.P + t2.L + t2.V + t2.Sm);
  }
  gt() {
    this.wp.qt().yt().Ea();
  }
  np() {
    return this.Ov.bitmapSize;
  }
  sp(t2, i2, n2) {
    const s = this.np();
    s.width > 0 && s.height > 0 && t2.drawImage(this.Ov.canvasElement, i2, n2);
  }
  Kv(t2) {
    if (0 === t2)
      return;
    if (1 !== t2) {
      this.Ov.applySuggestedBitmapSize();
      const i3 = tryCreateCanvasRenderingTarget2D(this.Ov);
      null !== i3 && (i3.useBitmapCoordinateSpace((t3) => {
        this.Gv(t3), this.Be(t3), this.km(i3, Bs);
      }), this.Qv(i3), this.km(i3, As)), null !== this.hm && this.hm.Kv(t2), null !== this.lm && this.lm.Kv(t2);
    }
    this.Av.applySuggestedBitmapSize();
    const i2 = tryCreateCanvasRenderingTarget2D(this.Av);
    null !== i2 && (i2.useBitmapCoordinateSpace(({ context: t3, bitmapSize: i3 }) => {
      t3.clearRect(0, 0, i3.width, i3.height);
    }), this.ym([...this.wp.qt().Mt(), this.wp.qt().Fc()], i2), this.km(i2, Vs));
  }
  km(t2, i2) {
    const n2 = this.wp.qt().Mt();
    for (const s of n2)
      ds(i2, (i3) => us(i3, t2, false, void 0), s, void 0);
    for (const s of n2)
      ds(i2, (i3) => cs(i3, t2, false, void 0), s, void 0);
  }
  Gv({ context: t2, bitmapSize: i2 }) {
    G(t2, 0, 0, i2.width, i2.height, this.wp.qt().ad());
  }
  Be({ context: t2, bitmapSize: i2, verticalPixelRatio: n2 }) {
    if (this.wp.W().timeScale.borderVisible) {
      t2.fillStyle = this.Cm();
      const s = Math.max(1, Math.floor(this.xm().C * n2));
      t2.fillRect(0, 0, i2.width, s);
    }
  }
  Qv(t2) {
    const i2 = this.wp.qt().yt(), n2 = i2.Ea();
    if (!n2 || 0 === n2.length)
      return;
    const s = this.N_.maxTickMarkWeight(n2), e3 = this.xm(), r2 = i2.W();
    r2.borderVisible && r2.ticksVisible && t2.useBitmapCoordinateSpace(({ context: t3, horizontalPixelRatio: i3, verticalPixelRatio: s2 }) => {
      t3.strokeStyle = this.Cm(), t3.fillStyle = this.Cm();
      const r3 = Math.max(1, Math.floor(i3)), h2 = Math.floor(0.5 * i3);
      t3.beginPath();
      const l2 = Math.round(e3.T * s2);
      for (let s3 = n2.length; s3--; ) {
        const e4 = Math.round(n2[s3].coord * i3);
        t3.rect(e4 - h2, 0, r3, l2);
      }
      t3.fill();
    }), t2.useMediaCoordinateSpace(({ context: t3 }) => {
      const i3 = e3.C + e3.T + e3.L + e3.P / 2;
      t3.textAlign = "center", t3.textBaseline = "middle", t3.fillStyle = this.$(), t3.font = this.$v();
      for (const e4 of n2)
        if (e4.weight < s) {
          const n3 = e4.needAlignCoordinate ? this.Tm(t3, e4.coord, e4.label) : e4.coord;
          t3.fillText(e4.label, n3, i3);
        }
      t3.font = this.Pm();
      for (const e4 of n2)
        if (e4.weight >= s) {
          const n3 = e4.needAlignCoordinate ? this.Tm(t3, e4.coord, e4.label) : e4.coord;
          t3.fillText(e4.label, n3, i3);
        }
    });
  }
  Tm(t2, i2, n2) {
    const s = this.gv.Si(t2, n2), e3 = s / 2, r2 = Math.floor(i2 - e3) + 0.5;
    return r2 < 0 ? i2 += Math.abs(0 - r2) : r2 + s > this.bv.width && (i2 -= Math.abs(this.bv.width - (r2 + s))), i2;
  }
  ym(t2, i2) {
    const n2 = this.xm();
    for (const s of t2)
      for (const t3 of s.tn())
        t3.xt().K(i2, n2);
  }
  Cm() {
    return this.wp.W().timeScale.borderColor;
  }
  $() {
    return this.cn.textColor;
  }
  j() {
    return this.cn.fontSize;
  }
  $v() {
    return N(this.j(), this.cn.fontFamily);
  }
  Pm() {
    return N(this.j(), this.cn.fontFamily, "bold");
  }
  xm() {
    null === this.k && (this.k = { C: 1, N: NaN, L: NaN, V: NaN, Hi: NaN, T: 5, P: NaN, R: "", ji: new si(), Sm: 0 });
    const t2 = this.k, i2 = this.$v();
    if (t2.R !== i2) {
      const n2 = this.j();
      t2.P = n2, t2.R = i2, t2.L = 3 * n2 / 12, t2.V = 3 * n2 / 12, t2.Hi = 9 * n2 / 12, t2.N = 0, t2.Sm = 4 * n2 / 12, t2.ji.ir();
    }
    return this.k;
  }
  ep(t2) {
    this.Dv.style.cursor = 1 === t2 ? "ew-resize" : "default";
  }
  vm() {
    const t2 = this.wp.qt(), i2 = t2.W();
    i2.leftPriceScale.visible || null === this.hm || (this.um.removeChild(this.hm.Wv()), this.hm.S(), this.hm = null), i2.rightPriceScale.visible || null === this.lm || (this.dm.removeChild(this.lm.Wv()), this.lm.S(), this.lm = null);
    const n2 = { nd: this.wp.qt().nd() }, s = () => i2.leftPriceScale.borderVisible && t2.yt().W().borderVisible, e3 = () => t2.ad();
    i2.leftPriceScale.visible && null === this.hm && (this.hm = new Ds("left", i2, n2, s, e3), this.um.appendChild(this.hm.Wv())), i2.rightPriceScale.visible && null === this.lm && (this.lm = new Ds("right", i2, n2, s, e3), this.dm.appendChild(this.lm.Wv()));
  }
};
var zs = !!ss && !!navigator.userAgentData && navigator.userAgentData.brands.some((t2) => t2.brand.includes("Chromium")) && !!ss && ((null === (Es = null === navigator || void 0 === navigator ? void 0 : navigator.userAgentData) || void 0 === Es ? void 0 : Es.platform) ? "Windows" === navigator.userAgentData.platform : navigator.userAgent.toLowerCase().indexOf("win") >= 0);
var Es;
var Ls = class {
  constructor(t2, i2, n2) {
    var s;
    this.Rm = [], this.Dm = 0, this.Qa = 0, this.e_ = 0, this.Om = 0, this.Am = 0, this.Vm = null, this.Bm = false, this._p = new R(), this.up = new R(), this.Mc = new R(), this.Im = null, this.zm = null, this.Em = t2, this.cn = i2, this.N_ = n2, this._m = document.createElement("div"), this._m.classList.add("tv-lightweight-charts"), this._m.style.overflow = "hidden", this._m.style.direction = "ltr", this._m.style.width = "100%", this._m.style.height = "100%", (s = this._m).style.userSelect = "none", s.style.webkitUserSelect = "none", s.style.msUserSelect = "none", s.style.MozUserSelect = "none", s.style.webkitTapHighlightColor = "transparent", this.Lm = document.createElement("table"), this.Lm.setAttribute("cellspacing", "0"), this._m.appendChild(this.Lm), this.Nm = this.Fm.bind(this), Ns(this.cn) && this.Wm(true), this.Ui = new Ln(this.Sc.bind(this), this.cn, n2), this.qt().Wc().l(this.jm.bind(this), this), this.Hm = new Is(this, this.N_), this.Lm.appendChild(this.Hm.Wv());
    const e3 = i2.autoSize && this.$m();
    let r2 = this.cn.width, h2 = this.cn.height;
    if (e3 || 0 === r2 || 0 === h2) {
      const i3 = t2.getBoundingClientRect();
      r2 = r2 || i3.width, h2 = h2 || i3.height;
    }
    this.Um(r2, h2), this.qm(), t2.appendChild(this._m), this.Ym(), this.Ui.yt().Gu().l(this.Ui.$l.bind(this.Ui), this), this.Ui.f_().l(this.Ui.$l.bind(this.Ui), this);
  }
  qt() {
    return this.Ui;
  }
  W() {
    return this.cn;
  }
  Xm() {
    return this.Rm;
  }
  Km() {
    return this.Hm;
  }
  S() {
    this.Wm(false), 0 !== this.Dm && window.cancelAnimationFrame(this.Dm), this.Ui.Wc().p(this), this.Ui.yt().Gu().p(this), this.Ui.f_().p(this), this.Ui.S();
    for (const t2 of this.Rm)
      this.Lm.removeChild(t2.Wv()), t2.Np().p(this), t2.Fp().p(this), t2.S();
    this.Rm = [], b(this.Hm).S(), null !== this._m.parentElement && this._m.parentElement.removeChild(this._m), this.Mc.S(), this._p.S(), this.up.S(), this.Zm();
  }
  Um(i2, n2, s = false) {
    if (this.Qa === n2 && this.e_ === i2)
      return;
    const e3 = function(i3) {
      const n3 = Math.floor(i3.width), s2 = Math.floor(i3.height);
      return size({ width: n3 - n3 % 2, height: s2 - s2 % 2 });
    }(size({ width: i2, height: n2 }));
    this.Qa = e3.height, this.e_ = e3.width;
    const r2 = this.Qa + "px", h2 = this.e_ + "px";
    b(this._m).style.height = r2, b(this._m).style.width = h2, this.Lm.style.height = r2, this.Lm.style.width = h2, s ? this.Gm(ct.es(), performance.now()) : this.Ui.$l();
  }
  Kv(t2) {
    void 0 === t2 && (t2 = ct.es());
    for (let i2 = 0; i2 < this.Rm.length; i2++)
      this.Rm[i2].Kv(t2.Hn(i2).Fn);
    this.cn.timeScale.visible && this.Hm.Kv(t2.jn());
  }
  Nh(t2) {
    const i2 = Ns(this.cn);
    this.Ui.Nh(t2);
    const n2 = Ns(this.cn);
    n2 !== i2 && this.Wm(n2), this.Ym(), this.Jm(t2);
  }
  Np() {
    return this._p;
  }
  Fp() {
    return this.up;
  }
  Wc() {
    return this.Mc;
  }
  Qm() {
    null !== this.Vm && (this.Gm(this.Vm, performance.now()), this.Vm = null);
    const t2 = this.tb(null), i2 = document.createElement("canvas");
    i2.width = t2.width, i2.height = t2.height;
    const n2 = b(i2.getContext("2d"));
    return this.tb(n2), i2;
  }
  ib(t2) {
    if ("left" === t2 && !this.nb())
      return 0;
    if ("right" === t2 && !this.sb())
      return 0;
    if (0 === this.Rm.length)
      return 0;
    return b("left" === t2 ? this.Rm[0].Kp() : this.Rm[0].Zp()).Yv();
  }
  eb() {
    return this.cn.autoSize && null !== this.Im;
  }
  rb() {
    return this._m;
  }
  Ap(t2) {
    this.zm = t2, this.zm ? this.rb().style.setProperty("cursor", t2) : this.rb().style.removeProperty("cursor");
  }
  hb() {
    return this.zm;
  }
  lb() {
    return m(this.Rm[0]).Hp();
  }
  Jm(t2) {
    (void 0 !== t2.autoSize || !this.Im || void 0 === t2.width && void 0 === t2.height) && (t2.autoSize && !this.Im && this.$m(), false === t2.autoSize && null !== this.Im && this.Zm(), t2.autoSize || void 0 === t2.width && void 0 === t2.height || this.Um(t2.width || this.e_, t2.height || this.Qa));
  }
  tb(i2) {
    let n2 = 0, s = 0;
    const e3 = this.Rm[0], r2 = (t2, n3) => {
      let s2 = 0;
      for (let e4 = 0; e4 < this.Rm.length; e4++) {
        const r3 = this.Rm[e4], h3 = b("left" === t2 ? r3.Kp() : r3.Zp()), l2 = h3.np();
        null !== i2 && h3.sp(i2, n3, s2), s2 += l2.height;
      }
    };
    if (this.nb()) {
      r2("left", 0);
      n2 += b(e3.Kp()).np().width;
    }
    for (let t2 = 0; t2 < this.Rm.length; t2++) {
      const e4 = this.Rm[t2], r3 = e4.np();
      null !== i2 && e4.sp(i2, n2, s), s += r3.height;
    }
    if (n2 += e3.np().width, this.sb()) {
      r2("right", n2);
      n2 += b(e3.Zp()).np().width;
    }
    const h2 = (t2, n3, s2) => {
      b("left" === t2 ? this.Hm.pm() : this.Hm.bm()).sp(b(i2), n3, s2);
    };
    if (this.cn.timeScale.visible) {
      const t2 = this.Hm.np();
      if (null !== i2) {
        let n3 = 0;
        this.nb() && (h2("left", n3, s), n3 = b(e3.Kp()).np().width), this.Hm.sp(i2, n3, s), n3 += t2.width, this.sb() && h2("right", n3, s);
      }
      s += t2.height;
    }
    return size({ width: n2, height: s });
  }
  ab() {
    let i2 = 0, n2 = 0, s = 0;
    for (const t2 of this.Rm)
      this.nb() && (n2 = Math.max(n2, b(t2.Kp()).Hv(), this.cn.leftPriceScale.minimumWidth)), this.sb() && (s = Math.max(s, b(t2.Zp()).Hv(), this.cn.rightPriceScale.minimumWidth)), i2 += t2.v_();
    n2 = hs(n2), s = hs(s);
    const e3 = this.e_, r2 = this.Qa, h2 = Math.max(e3 - n2 - s, 0), l2 = this.cn.timeScale.visible;
    let a2 = l2 ? Math.max(this.Hm.Mm(), this.cn.timeScale.minimumHeight) : 0;
    var o3;
    a2 = (o3 = a2) + o3 % 2;
    const _2 = 0 + a2, u2 = r2 < _2 ? 0 : r2 - _2, c2 = u2 / i2;
    let d2 = 0;
    for (let i3 = 0; i3 < this.Rm.length; ++i3) {
      const e4 = this.Rm[i3];
      e4.Cp(this.Ui.Lc()[i3]);
      let r3 = 0, l3 = 0;
      l3 = i3 === this.Rm.length - 1 ? u2 - d2 : Math.round(e4.v_() * c2), r3 = Math.max(l3, 2), d2 += r3, e4.qv(size({ width: h2, height: r3 })), this.nb() && e4.jp(n2, "left"), this.sb() && e4.jp(s, "right"), e4.Xv() && this.Ui.jc(e4.Xv(), r3);
    }
    this.Hm.gm(size({ width: l2 ? h2 : 0, height: a2 }), l2 ? n2 : 0, l2 ? s : 0), this.Ui.m_(h2), this.Om !== n2 && (this.Om = n2), this.Am !== s && (this.Am = s);
  }
  Wm(t2) {
    t2 ? this._m.addEventListener("wheel", this.Nm, { passive: false }) : this._m.removeEventListener("wheel", this.Nm);
  }
  ob(t2) {
    switch (t2.deltaMode) {
      case t2.DOM_DELTA_PAGE:
        return 120;
      case t2.DOM_DELTA_LINE:
        return 32;
    }
    return zs ? 1 / window.devicePixelRatio : 1;
  }
  Fm(t2) {
    if (!(0 !== t2.deltaX && this.cn.handleScroll.mouseWheel || 0 !== t2.deltaY && this.cn.handleScale.mouseWheel))
      return;
    const i2 = this.ob(t2), n2 = i2 * t2.deltaX / 100, s = -i2 * t2.deltaY / 100;
    if (t2.cancelable && t2.preventDefault(), 0 !== s && this.cn.handleScale.mouseWheel) {
      const i3 = Math.sign(s) * Math.min(1, Math.abs(s)), n3 = t2.clientX - this._m.getBoundingClientRect().left;
      this.qt().Uc(n3, i3);
    }
    0 !== n2 && this.cn.handleScroll.mouseWheel && this.qt().qc(-80 * n2);
  }
  Gm(t2, i2) {
    var n2;
    const s = t2.jn();
    3 === s && this._b(), 3 !== s && 2 !== s || (this.ub(t2), this.cb(t2, i2), this.Hm.gt(), this.Rm.forEach((t3) => {
      t3.Pp();
    }), 3 === (null === (n2 = this.Vm) || void 0 === n2 ? void 0 : n2.jn()) && (this.Vm.ts(t2), this._b(), this.ub(this.Vm), this.cb(this.Vm, i2), t2 = this.Vm, this.Vm = null)), this.Kv(t2);
  }
  cb(t2, i2) {
    for (const n2 of t2.Qn())
      this.ns(n2, i2);
  }
  ub(t2) {
    const i2 = this.Ui.Lc();
    for (let n2 = 0; n2 < i2.length; n2++)
      t2.Hn(n2).Wn && i2[n2].V_();
  }
  ns(t2, i2) {
    const n2 = this.Ui.yt();
    switch (t2.qn) {
      case 0:
        n2.Qu();
        break;
      case 1:
        n2.tc(t2.Vt);
        break;
      case 2:
        n2.Gn(t2.Vt);
        break;
      case 3:
        n2.Jn(t2.Vt);
        break;
      case 4:
        n2.Fu();
        break;
      case 5:
        t2.Vt.Yu(i2) || n2.Jn(t2.Vt.Xu(i2));
    }
  }
  Sc(t2) {
    null !== this.Vm ? this.Vm.ts(t2) : this.Vm = t2, this.Bm || (this.Bm = true, this.Dm = window.requestAnimationFrame((t3) => {
      if (this.Bm = false, this.Dm = 0, null !== this.Vm) {
        const i2 = this.Vm;
        this.Vm = null, this.Gm(i2, t3);
        for (const n2 of i2.Qn())
          if (5 === n2.qn && !n2.Vt.Yu(t3)) {
            this.qt().Xn(n2.Vt);
            break;
          }
      }
    }));
  }
  _b() {
    this.qm();
  }
  qm() {
    const t2 = this.Ui.Lc(), i2 = t2.length, n2 = this.Rm.length;
    for (let t3 = i2; t3 < n2; t3++) {
      const t4 = m(this.Rm.pop());
      this.Lm.removeChild(t4.Wv()), t4.Np().p(this), t4.Fp().p(this), t4.S();
    }
    for (let s = n2; s < i2; s++) {
      const i3 = new Rs(this, t2[s]);
      i3.Np().l(this.fb.bind(this), this), i3.Fp().l(this.vb.bind(this), this), this.Rm.push(i3), this.Lm.insertBefore(i3.Wv(), this.Hm.Wv());
    }
    for (let n3 = 0; n3 < i2; n3++) {
      const i3 = t2[n3], s = this.Rm[n3];
      s.Xv() !== i3 ? s.Cp(i3) : s.yp();
    }
    this.Ym(), this.ab();
  }
  pb(t2, i2, n2) {
    var s;
    const e3 = /* @__PURE__ */ new Map();
    if (null !== t2) {
      this.Ui.Mt().forEach((i3) => {
        const n3 = i3.In().nl(t2);
        null !== n3 && e3.set(i3, n3);
      });
    }
    let r2;
    if (null !== t2) {
      const i3 = null === (s = this.Ui.yt().qi(t2)) || void 0 === s ? void 0 : s.originalTime;
      void 0 !== i3 && (r2 = i3);
    }
    const h2 = this.qt().Vc(), l2 = null !== h2 && h2.Ic instanceof Qi ? h2.Ic : void 0, a2 = null !== h2 && void 0 !== h2.vv ? h2.vv.wr : void 0;
    return { mb: r2, se: null != t2 ? t2 : void 0, bb: null != i2 ? i2 : void 0, wb: l2, gb: e3, Mb: a2, xb: null != n2 ? n2 : void 0 };
  }
  fb(t2, i2, n2) {
    this._p.m(() => this.pb(t2, i2, n2));
  }
  vb(t2, i2, n2) {
    this.up.m(() => this.pb(t2, i2, n2));
  }
  jm(t2, i2, n2) {
    this.Mc.m(() => this.pb(t2, i2, n2));
  }
  Ym() {
    const t2 = this.cn.timeScale.visible ? "" : "none";
    this.Hm.Wv().style.display = t2;
  }
  nb() {
    return this.Rm[0].Xv().S_().W().visible;
  }
  sb() {
    return this.Rm[0].Xv().k_().W().visible;
  }
  $m() {
    return "ResizeObserver" in window && (this.Im = new ResizeObserver((t2) => {
      const i2 = t2.find((t3) => t3.target === this.Em);
      i2 && this.Um(i2.contentRect.width, i2.contentRect.height);
    }), this.Im.observe(this.Em, { box: "border-box" }), true);
  }
  Zm() {
    null !== this.Im && this.Im.disconnect(), this.Im = null;
  }
};
function Ns(t2) {
  return Boolean(t2.handleScroll.mouseWheel || t2.handleScale.mouseWheel);
}
function Fs(t2, i2) {
  var n2 = {};
  for (var s in t2)
    Object.prototype.hasOwnProperty.call(t2, s) && i2.indexOf(s) < 0 && (n2[s] = t2[s]);
  if (null != t2 && "function" == typeof Object.getOwnPropertySymbols) {
    var e3 = 0;
    for (s = Object.getOwnPropertySymbols(t2); e3 < s.length; e3++)
      i2.indexOf(s[e3]) < 0 && Object.prototype.propertyIsEnumerable.call(t2, s[e3]) && (n2[s[e3]] = t2[s[e3]]);
  }
  return n2;
}
function Ws(t2, i2, n2, s) {
  const e3 = n2.value, r2 = { se: i2, ut: t2, Vt: [e3, e3, e3, e3], mb: s };
  return void 0 !== n2.color && (r2.O = n2.color), r2;
}
function js(t2, i2, n2, s) {
  const e3 = n2.value, r2 = { se: i2, ut: t2, Vt: [e3, e3, e3, e3], mb: s };
  return void 0 !== n2.lineColor && (r2._t = n2.lineColor), void 0 !== n2.topColor && (r2.Ts = n2.topColor), void 0 !== n2.bottomColor && (r2.Ps = n2.bottomColor), r2;
}
function Hs(t2, i2, n2, s) {
  const e3 = n2.value, r2 = { se: i2, ut: t2, Vt: [e3, e3, e3, e3], mb: s };
  return void 0 !== n2.topLineColor && (r2.Pe = n2.topLineColor), void 0 !== n2.bottomLineColor && (r2.Re = n2.bottomLineColor), void 0 !== n2.topFillColor1 && (r2.Se = n2.topFillColor1), void 0 !== n2.topFillColor2 && (r2.ke = n2.topFillColor2), void 0 !== n2.bottomFillColor1 && (r2.ye = n2.bottomFillColor1), void 0 !== n2.bottomFillColor2 && (r2.Ce = n2.bottomFillColor2), r2;
}
function $s(t2, i2, n2, s) {
  const e3 = { se: i2, ut: t2, Vt: [n2.open, n2.high, n2.low, n2.close], mb: s };
  return void 0 !== n2.color && (e3.O = n2.color), e3;
}
function Us(t2, i2, n2, s) {
  const e3 = { se: i2, ut: t2, Vt: [n2.open, n2.high, n2.low, n2.close], mb: s };
  return void 0 !== n2.color && (e3.O = n2.color), void 0 !== n2.borderColor && (e3.Bt = n2.borderColor), void 0 !== n2.wickColor && (e3.$h = n2.wickColor), e3;
}
function qs(t2, i2, n2, s, e3) {
  const r2 = m(e3)(n2), h2 = Math.max(...r2), l2 = Math.min(...r2), a2 = r2[r2.length - 1], o3 = [a2, h2, l2, a2], _2 = n2, { time: u2, color: c2 } = _2;
  return { se: i2, ut: t2, Vt: o3, mb: s, He: Fs(_2, ["time", "color"]), O: c2 };
}
function Ys(t2) {
  return void 0 !== t2.Vt;
}
function Xs(t2, i2) {
  return void 0 !== i2.customValues && (t2.Sb = i2.customValues), t2;
}
function Ks(t2) {
  return (i2, n2, s, e3, r2, h2) => function(t3, i3) {
    return i3 ? i3(t3) : void 0 === (n3 = t3).open && void 0 === n3.value;
    var n3;
  }(s, h2) ? Xs({ ut: i2, se: n2, mb: e3 }, s) : Xs(t2(i2, n2, s, e3, r2), s);
}
function Zs(t2) {
  return { Candlestick: Ks(Us), Bar: Ks($s), Area: Ks(js), Baseline: Ks(Hs), Histogram: Ks(Ws), Line: Ks(Ws), Custom: Ks(qs) }[t2];
}
function Gs(t2) {
  return { se: 0, kb: /* @__PURE__ */ new Map(), ia: t2 };
}
function Js(t2, i2) {
  if (void 0 !== t2 && 0 !== t2.length)
    return { yb: i2.key(t2[0].ut), Cb: i2.key(t2[t2.length - 1].ut) };
}
function Qs(t2) {
  let i2;
  return t2.forEach((t3) => {
    void 0 === i2 && (i2 = t3.mb);
  }), m(i2);
}
var te = class {
  constructor(t2) {
    this.Tb = /* @__PURE__ */ new Map(), this.Pb = /* @__PURE__ */ new Map(), this.Rb = /* @__PURE__ */ new Map(), this.Db = [], this.N_ = t2;
  }
  S() {
    this.Tb.clear(), this.Pb.clear(), this.Rb.clear(), this.Db = [];
  }
  Ob(t2, i2) {
    let n2 = 0 !== this.Tb.size, s = false;
    const e3 = this.Pb.get(t2);
    if (void 0 !== e3)
      if (1 === this.Pb.size)
        n2 = false, s = true, this.Tb.clear();
      else
        for (const i3 of this.Db)
          i3.pointData.kb.delete(t2) && (s = true);
    let r2 = [];
    if (0 !== i2.length) {
      const n3 = i2.map((t3) => t3.time), e4 = this.N_.createConverterToInternalObj(i2), h3 = Zs(t2.Xh()), l2 = t2.ga(), a2 = t2.Ma();
      r2 = i2.map((i3, r3) => {
        const o3 = e4(i3.time), _2 = this.N_.key(o3);
        let u2 = this.Tb.get(_2);
        void 0 === u2 && (u2 = Gs(o3), this.Tb.set(_2, u2), s = true);
        const c2 = h3(o3, u2.se, i3, n3[r3], l2, a2);
        return u2.kb.set(t2, c2), c2;
      });
    }
    n2 && this.Ab(), this.Vb(t2, r2);
    let h2 = -1;
    if (s) {
      const t3 = [];
      this.Tb.forEach((i3) => {
        t3.push({ timeWeight: 0, time: i3.ia, pointData: i3, originalTime: Qs(i3.kb) });
      }), t3.sort((t4, i3) => this.N_.key(t4.time) - this.N_.key(i3.time)), h2 = this.Bb(t3);
    }
    return this.Ib(t2, h2, function(t3, i3, n3) {
      const s2 = Js(t3, n3), e4 = Js(i3, n3);
      if (void 0 !== s2 && void 0 !== e4)
        return { Xl: s2.Cb >= e4.Cb && s2.yb >= e4.yb };
    }(this.Pb.get(t2), e3, this.N_));
  }
  rd(t2) {
    return this.Ob(t2, []);
  }
  zb(t2, i2) {
    const n2 = i2;
    !function(t3) {
      void 0 === t3.mb && (t3.mb = t3.time);
    }(n2), this.N_.preprocessData(i2);
    const s = this.N_.createConverterToInternalObj([i2])(i2.time), e3 = this.Rb.get(t2);
    if (void 0 !== e3 && this.N_.key(s) < this.N_.key(e3))
      throw new Error(`Cannot update oldest data, last time=${e3}, new time=${s}`);
    let r2 = this.Tb.get(this.N_.key(s));
    const h2 = void 0 === r2;
    void 0 === r2 && (r2 = Gs(s), this.Tb.set(this.N_.key(s), r2));
    const l2 = Zs(t2.Xh()), a2 = t2.ga(), o3 = t2.Ma(), _2 = l2(s, r2.se, i2, n2.mb, a2, o3);
    r2.kb.set(t2, _2), this.Eb(t2, _2);
    const u2 = { Xl: Ys(_2) };
    if (!h2)
      return this.Ib(t2, -1, u2);
    const c2 = { timeWeight: 0, time: r2.ia, pointData: r2, originalTime: Qs(r2.kb) }, d2 = Bt(this.Db, this.N_.key(c2.time), (t3, i3) => this.N_.key(t3.time) < i3);
    this.Db.splice(d2, 0, c2);
    for (let t3 = d2; t3 < this.Db.length; ++t3)
      ie(this.Db[t3].pointData, t3);
    return this.N_.fillWeightsForPoints(this.Db, d2), this.Ib(t2, d2, u2);
  }
  Eb(t2, i2) {
    let n2 = this.Pb.get(t2);
    void 0 === n2 && (n2 = [], this.Pb.set(t2, n2));
    const s = 0 !== n2.length ? n2[n2.length - 1] : null;
    null === s || this.N_.key(i2.ut) > this.N_.key(s.ut) ? Ys(i2) && n2.push(i2) : Ys(i2) ? n2[n2.length - 1] = i2 : n2.splice(-1, 1), this.Rb.set(t2, i2.ut);
  }
  Vb(t2, i2) {
    0 !== i2.length ? (this.Pb.set(t2, i2.filter(Ys)), this.Rb.set(t2, i2[i2.length - 1].ut)) : (this.Pb.delete(t2), this.Rb.delete(t2));
  }
  Ab() {
    for (const t2 of this.Db)
      0 === t2.pointData.kb.size && this.Tb.delete(this.N_.key(t2.time));
  }
  Bb(t2) {
    let i2 = -1;
    for (let n2 = 0; n2 < this.Db.length && n2 < t2.length; ++n2) {
      const s = this.Db[n2], e3 = t2[n2];
      if (this.N_.key(s.time) !== this.N_.key(e3.time)) {
        i2 = n2;
        break;
      }
      e3.timeWeight = s.timeWeight, ie(e3.pointData, n2);
    }
    if (-1 === i2 && this.Db.length !== t2.length && (i2 = Math.min(this.Db.length, t2.length)), -1 === i2)
      return -1;
    for (let n2 = i2; n2 < t2.length; ++n2)
      ie(t2[n2].pointData, n2);
    return this.N_.fillWeightsForPoints(t2, i2), this.Db = t2, i2;
  }
  Lb() {
    if (0 === this.Pb.size)
      return null;
    let t2 = 0;
    return this.Pb.forEach((i2) => {
      0 !== i2.length && (t2 = Math.max(t2, i2[i2.length - 1].se));
    }), t2;
  }
  Ib(t2, i2, n2) {
    const s = { Nb: /* @__PURE__ */ new Map(), yt: { Au: this.Lb() } };
    if (-1 !== i2)
      this.Pb.forEach((i3, e3) => {
        s.Nb.set(e3, { He: i3, Fb: e3 === t2 ? n2 : void 0 });
      }), this.Pb.has(t2) || s.Nb.set(t2, { He: [], Fb: n2 }), s.yt.Wb = this.Db, s.yt.jb = i2;
    else {
      const i3 = this.Pb.get(t2);
      s.Nb.set(t2, { He: i3 || [], Fb: n2 });
    }
    return s;
  }
};
function ie(t2, i2) {
  t2.se = i2, t2.kb.forEach((t3) => {
    t3.se = i2;
  });
}
function ne(t2) {
  const i2 = { value: t2.Vt[3], time: t2.mb };
  return void 0 !== t2.Sb && (i2.customValues = t2.Sb), i2;
}
function se(t2) {
  const i2 = ne(t2);
  return void 0 !== t2.O && (i2.color = t2.O), i2;
}
function ee(t2) {
  const i2 = ne(t2);
  return void 0 !== t2._t && (i2.lineColor = t2._t), void 0 !== t2.Ts && (i2.topColor = t2.Ts), void 0 !== t2.Ps && (i2.bottomColor = t2.Ps), i2;
}
function re(t2) {
  const i2 = ne(t2);
  return void 0 !== t2.Pe && (i2.topLineColor = t2.Pe), void 0 !== t2.Re && (i2.bottomLineColor = t2.Re), void 0 !== t2.Se && (i2.topFillColor1 = t2.Se), void 0 !== t2.ke && (i2.topFillColor2 = t2.ke), void 0 !== t2.ye && (i2.bottomFillColor1 = t2.ye), void 0 !== t2.Ce && (i2.bottomFillColor2 = t2.Ce), i2;
}
function he(t2) {
  const i2 = { open: t2.Vt[0], high: t2.Vt[1], low: t2.Vt[2], close: t2.Vt[3], time: t2.mb };
  return void 0 !== t2.Sb && (i2.customValues = t2.Sb), i2;
}
function le(t2) {
  const i2 = he(t2);
  return void 0 !== t2.O && (i2.color = t2.O), i2;
}
function ae(t2) {
  const i2 = he(t2), { O: n2, Bt: s, $h: e3 } = t2;
  return void 0 !== n2 && (i2.color = n2), void 0 !== s && (i2.borderColor = s), void 0 !== e3 && (i2.wickColor = e3), i2;
}
function oe(t2) {
  return { Area: ee, Line: se, Baseline: re, Histogram: se, Bar: le, Candlestick: ae, Custom: _e }[t2];
}
function _e(t2) {
  const i2 = t2.mb;
  return Object.assign(Object.assign({}, t2.He), { time: i2 });
}
var ue = { vertLine: { color: "#9598A1", width: 1, style: 3, visible: true, labelVisible: true, labelBackgroundColor: "#131722" }, horzLine: { color: "#9598A1", width: 1, style: 3, visible: true, labelVisible: true, labelBackgroundColor: "#131722" }, mode: 1 };
var ce = { vertLines: { color: "#D6DCDE", style: 0, visible: true }, horzLines: { color: "#D6DCDE", style: 0, visible: true } };
var de = { background: { type: "solid", color: "#FFFFFF" }, textColor: "#191919", fontSize: 12, fontFamily: L };
var fe = { autoScale: true, mode: 0, invertScale: false, alignLabels: true, borderVisible: true, borderColor: "#2B2B43", entireTextOnly: false, visible: false, ticksVisible: false, scaleMargins: { bottom: 0.1, top: 0.2 }, minimumWidth: 0 };
var ve = { rightOffset: 0, barSpacing: 6, minBarSpacing: 0.5, fixLeftEdge: false, fixRightEdge: false, lockVisibleTimeRangeOnResize: false, rightBarStaysOnScroll: false, borderVisible: true, borderColor: "#2B2B43", visible: true, timeVisible: false, secondsVisible: true, shiftVisibleRangeOnNewBar: true, ticksVisible: false, uniformDistribution: false, minimumHeight: 0 };
var pe = { color: "rgba(0, 0, 0, 0)", visible: false, fontSize: 48, fontFamily: L, fontStyle: "", text: "", horzAlign: "center", vertAlign: "center" };
function me() {
  return { width: 0, height: 0, autoSize: false, layout: de, crosshair: ue, grid: ce, overlayPriceScales: Object.assign({}, fe), leftPriceScale: Object.assign(Object.assign({}, fe), { visible: false }), rightPriceScale: Object.assign(Object.assign({}, fe), { visible: true }), timeScale: ve, watermark: pe, localization: { locale: ss ? navigator.language : "", dateFormat: "dd MMM 'yy" }, handleScroll: { mouseWheel: true, pressedMouseMove: true, horzTouchDrag: true, vertTouchDrag: true }, handleScale: { axisPressedMouseMove: { time: true, price: true }, axisDoubleClickReset: { time: true, price: true }, mouseWheel: true, pinch: true }, kineticScroll: { mouse: false, touch: true }, trackingMode: { exitMode: 1 } };
}
var be = class {
  constructor(t2, i2) {
    this.Hb = t2, this.$b = i2;
  }
  applyOptions(t2) {
    this.Hb.qt().zc(this.$b, t2);
  }
  options() {
    return this.Li().W();
  }
  width() {
    return ut(this.$b) ? this.Hb.ib(this.$b) : 0;
  }
  Li() {
    return b(this.Hb.qt().Ec(this.$b)).At;
  }
};
function we(t2, i2, n2) {
  const s = Fs(t2, ["time", "originalTime"]), e3 = Object.assign({ time: i2 }, s);
  return void 0 !== n2 && (e3.originalTime = n2), e3;
}
var ge = { color: "#FF0000", price: 0, lineStyle: 2, lineWidth: 1, lineVisible: true, axisLabelVisible: true, title: "", axisLabelColor: "", axisLabelTextColor: "" };
var Me = class {
  constructor(t2) {
    this.Bh = t2;
  }
  applyOptions(t2) {
    this.Bh.Nh(t2);
  }
  options() {
    return this.Bh.W();
  }
  Ub() {
    return this.Bh;
  }
};
var xe = class {
  constructor(t2, i2, n2, s, e3) {
    this.qb = new R(), this.Es = t2, this.Yb = i2, this.Xb = n2, this.N_ = e3, this.Kb = s;
  }
  S() {
    this.qb.S();
  }
  priceFormatter() {
    return this.Es.ca();
  }
  priceToCoordinate(t2) {
    const i2 = this.Es.Pt();
    return null === i2 ? null : this.Es.At().Ot(t2, i2.Vt);
  }
  coordinateToPrice(t2) {
    const i2 = this.Es.Pt();
    return null === i2 ? null : this.Es.At().pn(t2, i2.Vt);
  }
  barsInLogicalRange(t2) {
    if (null === t2)
      return null;
    const i2 = new Tn(new kn(t2.from, t2.to)).iu(), n2 = this.Es.In();
    if (n2.Fi())
      return null;
    const s = n2.nl(i2.Os(), 1), e3 = n2.nl(i2.di(), -1), r2 = b(n2.Qh()), h2 = b(n2.Bn());
    if (null !== s && null !== e3 && s.se > e3.se)
      return { barsBefore: t2.from - r2, barsAfter: h2 - t2.to };
    const l2 = { barsBefore: null === s || s.se === r2 ? t2.from - r2 : s.se - r2, barsAfter: null === e3 || e3.se === h2 ? h2 - t2.to : h2 - e3.se };
    return null !== s && null !== e3 && (l2.from = s.mb, l2.to = e3.mb), l2;
  }
  setData(t2) {
    this.N_, this.Es.Xh(), this.Yb.Zb(this.Es, t2), this.Gb("full");
  }
  update(t2) {
    this.Es.Xh(), this.Yb.Jb(this.Es, t2), this.Gb("update");
  }
  dataByIndex(t2, i2) {
    const n2 = this.Es.In().nl(t2, i2);
    if (null === n2)
      return null;
    return oe(this.seriesType())(n2);
  }
  data() {
    const t2 = oe(this.seriesType());
    return this.Es.In().ie().map((i2) => t2(i2));
  }
  subscribeDataChanged(t2) {
    this.qb.l(t2);
  }
  unsubscribeDataChanged(t2) {
    this.qb.v(t2);
  }
  setMarkers(t2) {
    this.N_;
    const i2 = t2.map((t3) => we(t3, this.N_.convertHorzItemToInternal(t3.time), t3.time));
    this.Es.Zl(i2);
  }
  markers() {
    return this.Es.Gl().map((t2) => we(t2, t2.originalTime, void 0));
  }
  applyOptions(t2) {
    this.Es.Nh(t2);
  }
  options() {
    return I(this.Es.W());
  }
  priceScale() {
    return this.Xb.priceScale(this.Es.At().xa());
  }
  createPriceLine(t2) {
    const i2 = D(I(ge), t2), n2 = this.Es.Jl(i2);
    return new Me(n2);
  }
  removePriceLine(t2) {
    this.Es.Ql(t2.Ub());
  }
  seriesType() {
    return this.Es.Xh();
  }
  attachPrimitive(t2) {
    this.Es.ba(t2), t2.attached && t2.attached({ chart: this.Kb, series: this, requestUpdate: () => this.Es.qt().$l() });
  }
  detachPrimitive(t2) {
    this.Es.wa(t2), t2.detached && t2.detached();
  }
  Gb(t2) {
    this.qb.M() && this.qb.m(t2);
  }
};
var Se = class {
  constructor(t2, i2, n2) {
    this.Qb = new R(), this.uu = new R(), this.om = new R(), this.Ui = t2, this.wl = t2.yt(), this.Hm = i2, this.wl.Ku().l(this.tw.bind(this)), this.wl.Zu().l(this.iw.bind(this)), this.Hm.wm().l(this.nw.bind(this)), this.N_ = n2;
  }
  S() {
    this.wl.Ku().p(this), this.wl.Zu().p(this), this.Hm.wm().p(this), this.Qb.S(), this.uu.S(), this.om.S();
  }
  scrollPosition() {
    return this.wl.Eu();
  }
  scrollToPosition(t2, i2) {
    i2 ? this.wl.qu(t2, 1e3) : this.Ui.Jn(t2);
  }
  scrollToRealTime() {
    this.wl.Uu();
  }
  getVisibleRange() {
    const t2 = this.wl.yu();
    return null === t2 ? null : { from: t2.from.originalTime, to: t2.to.originalTime };
  }
  setVisibleRange(t2) {
    const i2 = { from: this.N_.convertHorzItemToInternal(t2.from), to: this.N_.convertHorzItemToInternal(t2.to) }, n2 = this.wl.Ru(i2);
    this.Ui.hd(n2);
  }
  getVisibleLogicalRange() {
    const t2 = this.wl.ku();
    return null === t2 ? null : { from: t2.Os(), to: t2.di() };
  }
  setVisibleLogicalRange(t2) {
    p(t2.from <= t2.to, "The from index cannot be after the to index."), this.Ui.hd(t2);
  }
  resetTimeScale() {
    this.Ui.Zn();
  }
  fitContent() {
    this.Ui.Qu();
  }
  logicalToCoordinate(t2) {
    const i2 = this.Ui.yt();
    return i2.Fi() ? null : i2.Et(t2);
  }
  coordinateToLogical(t2) {
    return this.wl.Fi() ? null : this.wl.Vu(t2);
  }
  timeToCoordinate(t2) {
    const i2 = this.N_.convertHorzItemToInternal(t2), n2 = this.wl.ya(i2, false);
    return null === n2 ? null : this.wl.Et(n2);
  }
  coordinateToTime(t2) {
    const i2 = this.Ui.yt(), n2 = i2.Vu(t2), s = i2.qi(n2);
    return null === s ? null : s.originalTime;
  }
  width() {
    return this.Hm.Hp().width;
  }
  height() {
    return this.Hm.Hp().height;
  }
  subscribeVisibleTimeRangeChange(t2) {
    this.Qb.l(t2);
  }
  unsubscribeVisibleTimeRangeChange(t2) {
    this.Qb.v(t2);
  }
  subscribeVisibleLogicalRangeChange(t2) {
    this.uu.l(t2);
  }
  unsubscribeVisibleLogicalRangeChange(t2) {
    this.uu.v(t2);
  }
  subscribeSizeChange(t2) {
    this.om.l(t2);
  }
  unsubscribeSizeChange(t2) {
    this.om.v(t2);
  }
  applyOptions(t2) {
    this.wl.Nh(t2);
  }
  options() {
    return Object.assign(Object.assign({}, I(this.wl.W())), { barSpacing: this.wl.he() });
  }
  tw() {
    this.Qb.M() && this.Qb.m(this.getVisibleRange());
  }
  iw() {
    this.uu.M() && this.uu.m(this.getVisibleLogicalRange());
  }
  nw(t2) {
    this.om.m(t2.width, t2.height);
  }
};
function ke(t2) {
  if (void 0 === t2 || "custom" === t2.type)
    return;
  const i2 = t2;
  void 0 !== i2.minMove && void 0 === i2.precision && (i2.precision = function(t3) {
    if (t3 >= 1)
      return 0;
    let i3 = 0;
    for (; i3 < 8; i3++) {
      const n2 = Math.round(t3);
      if (Math.abs(n2 - t3) < 1e-8)
        return i3;
      t3 *= 10;
    }
    return i3;
  }(i2.minMove));
}
function ye(t2) {
  return function(t3) {
    if (B(t3.handleScale)) {
      const i3 = t3.handleScale;
      t3.handleScale = { axisDoubleClickReset: { time: i3, price: i3 }, axisPressedMouseMove: { time: i3, price: i3 }, mouseWheel: i3, pinch: i3 };
    } else if (void 0 !== t3.handleScale) {
      const { axisPressedMouseMove: i3, axisDoubleClickReset: n2 } = t3.handleScale;
      B(i3) && (t3.handleScale.axisPressedMouseMove = { time: i3, price: i3 }), B(n2) && (t3.handleScale.axisDoubleClickReset = { time: n2, price: n2 });
    }
    const i2 = t3.handleScroll;
    B(i2) && (t3.handleScroll = { horzTouchDrag: i2, vertTouchDrag: i2, mouseWheel: i2, pressedMouseMove: i2 });
  }(t2), t2;
}
var Ce = class {
  constructor(t2, i2, n2) {
    this.sw = /* @__PURE__ */ new Map(), this.ew = /* @__PURE__ */ new Map(), this.rw = new R(), this.hw = new R(), this.lw = new R(), this.aw = new te(i2);
    const s = void 0 === n2 ? I(me()) : D(I(me()), ye(n2));
    this.N_ = i2, this.Hb = new Ls(t2, s, i2), this.Hb.Np().l((t3) => {
      this.rw.M() && this.rw.m(this.ow(t3()));
    }, this), this.Hb.Fp().l((t3) => {
      this.hw.M() && this.hw.m(this.ow(t3()));
    }, this), this.Hb.Wc().l((t3) => {
      this.lw.M() && this.lw.m(this.ow(t3()));
    }, this);
    const e3 = this.Hb.qt();
    this._w = new Se(e3, this.Hb.Km(), this.N_);
  }
  remove() {
    this.Hb.Np().p(this), this.Hb.Fp().p(this), this.Hb.Wc().p(this), this._w.S(), this.Hb.S(), this.sw.clear(), this.ew.clear(), this.rw.S(), this.hw.S(), this.lw.S(), this.aw.S();
  }
  resize(t2, i2, n2) {
    this.autoSizeActive() || this.Hb.Um(t2, i2, n2);
  }
  addCustomSeries(t2, i2) {
    const n2 = w(t2), s = Object.assign(Object.assign({}, _), n2.defaultOptions());
    return this.uw("Custom", s, i2, n2);
  }
  addAreaSeries(t2) {
    return this.uw("Area", l, t2);
  }
  addBaselineSeries(t2) {
    return this.uw("Baseline", a, t2);
  }
  addBarSeries(t2) {
    return this.uw("Bar", r, t2);
  }
  addCandlestickSeries(t2 = {}) {
    return function(t3) {
      void 0 !== t3.borderColor && (t3.borderUpColor = t3.borderColor, t3.borderDownColor = t3.borderColor), void 0 !== t3.wickColor && (t3.wickUpColor = t3.wickColor, t3.wickDownColor = t3.wickColor);
    }(t2), this.uw("Candlestick", e, t2);
  }
  addHistogramSeries(t2) {
    return this.uw("Histogram", o, t2);
  }
  addLineSeries(t2) {
    return this.uw("Line", h, t2);
  }
  removeSeries(t2) {
    const i2 = m(this.sw.get(t2)), n2 = this.aw.rd(i2);
    this.Hb.qt().rd(i2), this.cw(n2), this.sw.delete(t2), this.ew.delete(i2);
  }
  Zb(t2, i2) {
    this.cw(this.aw.Ob(t2, i2));
  }
  Jb(t2, i2) {
    this.cw(this.aw.zb(t2, i2));
  }
  subscribeClick(t2) {
    this.rw.l(t2);
  }
  unsubscribeClick(t2) {
    this.rw.v(t2);
  }
  subscribeCrosshairMove(t2) {
    this.lw.l(t2);
  }
  unsubscribeCrosshairMove(t2) {
    this.lw.v(t2);
  }
  subscribeDblClick(t2) {
    this.hw.l(t2);
  }
  unsubscribeDblClick(t2) {
    this.hw.v(t2);
  }
  priceScale(t2) {
    return new be(this.Hb, t2);
  }
  timeScale() {
    return this._w;
  }
  applyOptions(t2) {
    this.Hb.Nh(ye(t2));
  }
  options() {
    return this.Hb.W();
  }
  takeScreenshot() {
    return this.Hb.Qm();
  }
  autoSizeActive() {
    return this.Hb.eb();
  }
  chartElement() {
    return this.Hb.rb();
  }
  paneSize() {
    const t2 = this.Hb.lb();
    return { height: t2.height, width: t2.width };
  }
  uw(t2, i2, n2 = {}, s) {
    ke(n2.priceFormat);
    const e3 = D(I(u), I(i2), n2), r2 = this.Hb.qt().sd(t2, e3, s), h2 = new xe(r2, this, this, this, this.N_);
    return this.sw.set(h2, r2), this.ew.set(r2, h2), h2;
  }
  cw(t2) {
    const i2 = this.Hb.qt();
    i2.td(t2.yt.Au, t2.yt.Wb, t2.yt.jb), t2.Nb.forEach((t3, i3) => i3.it(t3.He, t3.Fb)), i2.Iu();
  }
  dw(t2) {
    return m(this.ew.get(t2));
  }
  ow(t2) {
    const i2 = /* @__PURE__ */ new Map();
    t2.gb.forEach((t3, n3) => {
      const s = n3.Xh(), e3 = oe(s)(t3);
      if ("Custom" !== s)
        p(function(t4) {
          return void 0 !== t4.open || void 0 !== t4.value;
        }(e3));
      else {
        const t4 = n3.Ma();
        p(!t4 || false === t4(e3));
      }
      i2.set(this.dw(n3), e3);
    });
    const n2 = void 0 === t2.wb ? void 0 : this.dw(t2.wb);
    return { time: t2.mb, logical: t2.se, point: t2.bb, hoveredSeries: n2, hoveredObjectId: t2.Mb, seriesData: i2, sourceEvent: t2.xb };
  }
};
function Te(t2, i2, n2) {
  let s;
  if (V(t2)) {
    const i3 = document.getElementById(t2);
    p(null !== i3, `Cannot find element in DOM with id=${t2}`), s = i3;
  } else
    s = t2;
  const e3 = new Ce(s, i2, n2);
  return i2.setOptions(e3.options()), e3;
}
function Pe(t2, i2) {
  return Te(t2, new ns(), ns.Cd(i2));
}
var Re = Object.assign(Object.assign({}, u), _);

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/k-line/k-line-chart.tsx
var import_react5 = __toESM(require_react());
import "/Users/xiaoyu/Desktop/xiangmu/newbit-web/node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/k-line/index.css";

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/k-line/k-line-render/index.tsx
var import_react4 = __toESM(require_react());
var import_classnames = __toESM(require_classnames());

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/k-line/order-pop/index.tsx
var import_react = __toESM(require_react());
function OrderModal(props) {
  var _a, _b, _c, _d, _e2, _f;
  const { curMarkers, ordersKlineData, showOrderDetail, createChart, locale } = props;
  const orderPopRef = (0, import_react.useRef)(null);
  return import_react.default.createElement(
    "div",
    {
      ref: orderPopRef,
      style: {
        position: "absolute",
        top: curMarkers == null ? void 0 : curMarkers.y,
        left: curMarkers == null ? void 0 : curMarkers.x,
        zIndex: 4,
        background: createChart.bgColor,
        padding: "12px",
        boxShadow: "0px 4px 10px rgba(0, 0, 0, 0.1)",
        borderRadius: "4px",
        transform: "translate(-50%, -200%)"
      }
    },
    ((_a = curMarkers == null ? void 0 : curMarkers.buyData) == null ? void 0 : _a.length) ? import_react.default.createElement("div", { className: "text-xs", style: { color: createChart.textColor, whiteSpace: "nowrap" } }, import_react.default.createElement("span", null, `${timeLocaleLanguageMap[locale][`\u6210\u4EA4`]} ${(_b = curMarkers == null ? void 0 : curMarkers.buyData) == null ? void 0 : _b.length} ${timeLocaleLanguageMap[locale][`\u7B14`]}`), import_react.default.createElement("span", { className: "ml-2" }, `${timeLocaleLanguageMap[locale][`\u5747\u4EF7`]} ${curMarkers == null ? void 0 : curMarkers.buyDetail.avg}`), import_react.default.createElement(
      "span",
      {
        style: {
          color: createChart.upColor
        },
        className: "ml-2"
      },
      timeLocaleLanguageMap[locale][`\u4E70\u5165`]
    ), import_react.default.createElement("span", { className: "ml-2" }, curMarkers == null ? void 0 : curMarkers.buyDetail.count, import_react.default.createElement("span", { className: "ml-1" }, (_c = ordersKlineData == null ? void 0 : ordersKlineData[0]) == null ? void 0 : _c.sellCoinShortName)), import_react.default.createElement(
      "span",
      {
        style: {
          color: createChart.brandColor
        },
        className: "ml-2 cursor-pointer",
        onClick: (e3) => {
          showOrderDetail("buy", e3);
        }
      },
      `${timeLocaleLanguageMap[locale][`\u67E5\u770B\u660E\u7EC6`]} >`
    )) : null,
    ((_d = curMarkers == null ? void 0 : curMarkers.sellData) == null ? void 0 : _d.length) ? import_react.default.createElement("div", { className: "text-xs mt-2", style: { color: createChart.textColor, whiteSpace: "nowrap" } }, import_react.default.createElement("span", null, `${timeLocaleLanguageMap[locale][`\u6210\u4EA4`]} ${(_e2 = curMarkers == null ? void 0 : curMarkers.sellData) == null ? void 0 : _e2.length} ${timeLocaleLanguageMap[locale][`\u7B14`]}`), import_react.default.createElement("span", { className: "ml-2" }, `${timeLocaleLanguageMap[locale][`\u5747\u4EF7`]} ${curMarkers == null ? void 0 : curMarkers.sellDetail.avg}`), import_react.default.createElement(
      "span",
      {
        style: {
          color: createChart.downColor
        },
        className: "ml-2"
      },
      timeLocaleLanguageMap[locale][`\u5356\u51FA`]
    ), import_react.default.createElement("span", { className: "ml-2" }, curMarkers == null ? void 0 : curMarkers.sellDetail.count, import_react.default.createElement("span", { className: "ml-1" }, (_f = ordersKlineData == null ? void 0 : ordersKlineData[0]) == null ? void 0 : _f.sellCoinShortName)), import_react.default.createElement(
      "span",
      {
        style: {
          color: createChart.brandColor
        },
        className: "ml-2 cursor-pointer",
        onClick: (e3) => {
          showOrderDetail("sell", e3);
        }
      },
      `${timeLocaleLanguageMap[locale][`\u67E5\u770B\u660E\u7EC6`]} >`
    )) : null,
    import_react.default.createElement(
      "div",
      {
        style: {
          position: "absolute",
          width: "8px",
          height: "8px",
          background: createChart.bgColor,
          left: "calc(50% - 4px)",
          bottom: "-4px",
          transform: "rotate(45deg)"
        }
      }
    )
  );
}
var order_pop_default = OrderModal;

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/k-line/order-modal/index.tsx
var import_react2 = __toESM(require_react());
function OrderPop(props) {
  const { modalVisible, setModalVisible, tableData, locale } = props;
  const columns = [
    {
      title: timeLocaleLanguageMap[locale][`\u65F6\u95F4`],
      dataIndex: "time",
      key: "time"
    },
    {
      title: timeLocaleLanguageMap[locale][`\u6570\u91CF`],
      dataIndex: "count",
      key: "count"
    },
    {
      title: timeLocaleLanguageMap[locale][`\u4EF7\u683C`],
      dataIndex: "price",
      key: "price"
    },
    {
      title: timeLocaleLanguageMap[locale][`\u624B\u7EED\u8D39`],
      dataIndex: "fees",
      key: "fees"
    }
  ];
  return import_react2.default.createElement(
    Modal_default,
    {
      title: timeLocaleLanguageMap[locale][`\u8BA2\u5355\u8BE6\u60C5`],
      visible: modalVisible,
      footer: null,
      className: "chart-order-pop",
      onOk: () => setModalVisible(false),
      onCancel: () => setModalVisible(false)
    },
    import_react2.default.createElement(
      Table_default,
      {
        rowKey: (record) => record.id,
        className: "chart-order-table",
        border: false,
        pagination: false,
        columns,
        data: tableData
      }
    )
  );
}
var order_modal_default = OrderPop;

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/k-line/k-line-render/index.tsx
import "/Users/xiaoyu/Desktop/xiangmu/newbit-web/node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/k-line/index.css";

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/k-line/k-line-render/set-chart.tsx
var import_react3 = __toESM(require_react());
import "/Users/xiaoyu/Desktop/xiangmu/newbit-web/node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/k-line/index.css";
function SetChart(props) {
  const {
    mainIndicator,
    subIndicator,
    chartSettingIcon,
    allChartRef,
    updateMainIndicator,
    updateSubIndicator,
    modalRef,
    type
  } = props;
  const hideMainChart = (value) => {
    var _a, _b, _c, _d, _e2, _f, _g, _h, _i2, _j, _k, _l, _m, _n2, _o, _p;
    switch (value) {
      case "ma":
        (_a = allChartRef.smaLineRef) == null ? void 0 : _a.forEach((item) => {
          item.applyOptions({
            visible: mainIndicator.ma.hide
          });
        });
        updateMainIndicator({
          ...mainIndicator,
          ma: {
            ...mainIndicator.ma,
            hide: !mainIndicator.ma.hide
          }
        });
        break;
      case "boll":
        (_b = allChartRef.bollRef) == null ? void 0 : _b.mid.applyOptions({
          visible: mainIndicator.boll.hide
        });
        (_c = allChartRef.bollRef) == null ? void 0 : _c.upper.applyOptions({
          visible: mainIndicator.boll.hide
        });
        (_d = allChartRef.bollRef) == null ? void 0 : _d.lower.applyOptions({
          visible: mainIndicator.boll.hide
        });
        updateMainIndicator({
          ...mainIndicator,
          boll: {
            ...mainIndicator.boll,
            hide: !mainIndicator.boll.hide
          }
        });
        break;
      case "vol":
        (_f = allChartRef.volumeSeriesRef) == null ? void 0 : _f.applyOptions({
          visible: (_e2 = subIndicator.vol) == null ? void 0 : _e2.hide
        });
        updateSubIndicator({
          ...subIndicator,
          vol: {
            ...subIndicator.vol,
            hide: !((_g = subIndicator.vol) == null ? void 0 : _g.hide)
          }
        });
        break;
      case "macd":
        (_h = allChartRef.difRef) == null ? void 0 : _h.applyOptions({
          visible: subIndicator.macd.hide
        });
        (_i2 = allChartRef.deaRef) == null ? void 0 : _i2.applyOptions({
          visible: subIndicator.macd.hide
        });
        (_j = allChartRef.macdVolumeSeriesRef) == null ? void 0 : _j.applyOptions({
          visible: subIndicator.macd.hide
        });
        updateSubIndicator({
          ...subIndicator,
          macd: {
            ...subIndicator.macd,
            hide: !subIndicator.macd.hide
          }
        });
        break;
      case "kdj":
        (_k = allChartRef.kdjRef) == null ? void 0 : _k.k.applyOptions({
          visible: subIndicator.kdj.hide
        });
        (_l = allChartRef.kdjRef) == null ? void 0 : _l.d.applyOptions({
          visible: subIndicator.kdj.hide
        });
        (_m = allChartRef.kdjRef) == null ? void 0 : _m.j.applyOptions({
          visible: subIndicator.kdj.hide
        });
        updateSubIndicator({
          ...subIndicator,
          kdj: {
            ...subIndicator.kdj,
            hide: !subIndicator.kdj.hide
          }
        });
        break;
      case "rsi":
        (_n2 = allChartRef.rsiRef) == null ? void 0 : _n2.forEach((item) => {
          item.applyOptions({
            visible: subIndicator.rsi.hide
          });
        });
        updateSubIndicator({
          ...subIndicator,
          rsi: {
            ...subIndicator.rsi,
            hide: !subIndicator.rsi.hide
          }
        });
        break;
      case "wr":
        (_o = allChartRef.wrRef) == null ? void 0 : _o.forEach((item) => {
          item.applyOptions({
            visible: subIndicator.wr.hide
          });
        });
        updateSubIndicator({
          ...subIndicator,
          wr: {
            ...subIndicator.wr,
            hide: !subIndicator.wr.hide
          }
        });
        break;
      default:
        (_p = allChartRef.smaLineRef) == null ? void 0 : _p.forEach((item) => {
          item.applyOptions({
            visible: !mainIndicator.ma.hide
          });
        });
        updateMainIndicator({
          ...mainIndicator,
          ma: {
            ...mainIndicator.ma,
            hide: !mainIndicator.ma.hide
          }
        });
        break;
    }
  };
  const openSetChartModal = () => {
    modalRef == null ? void 0 : modalRef.openChartSettingModal();
  };
  const deleteMainChart = (value) => {
    var _a;
    switch (value) {
      case "ma":
        updateMainIndicator({
          ...mainIndicator,
          ma: {
            ...mainIndicator.ma,
            select: false
          }
        });
        break;
      case "boll":
        updateMainIndicator({
          ...mainIndicator,
          boll: {
            ...mainIndicator.boll,
            select: false
          }
        });
        break;
      case "vol":
        updateSubIndicator({
          ...subIndicator,
          vol: {
            ...subIndicator.vol,
            select: false
          }
        });
        break;
      case "macd":
        updateSubIndicator({
          ...subIndicator,
          macd: {
            ...subIndicator.macd,
            select: false
          }
        });
        break;
      case "kdj":
        updateSubIndicator({
          ...subIndicator,
          kdj: {
            ...subIndicator.kdj,
            select: false
          }
        });
        break;
      case "rsi":
        updateSubIndicator({
          ...subIndicator,
          rsi: {
            ...subIndicator.rsi,
            select: false
          }
        });
        break;
      case "wr":
        updateSubIndicator({
          ...subIndicator,
          wr: {
            ...subIndicator.wr,
            select: false
          }
        });
        break;
      default:
        (_a = allChartRef.smaLineRef) == null ? void 0 : _a.forEach((item) => {
          item.applyOptions({
            visible: !mainIndicator.ma.hide
          });
        });
        updateMainIndicator({
          ...mainIndicator,
          ma: {
            ...mainIndicator.ma,
            hide: !mainIndicator.ma.hide
          }
        });
        break;
    }
  };
  return import_react3.default.createElement(import_react3.default.Fragment, null, import_react3.default.createElement("div", { key: "hidden", onClick: () => hideMainChart(type), className: "chart-hidden chart-set-icon-wrap common-ml-5" }, import_react3.default.createElement("span", { className: "not-hidden-hover" }, chartSettingIcon.hidden), import_react3.default.createElement("span", { className: "have-hidden-hover" }, chartSettingIcon.hiddenHover)), import_react3.default.createElement("div", { key: "setting", onClick: openSetChartModal, className: "chart-set chart-set-icon-wrap common-ml-5" }, import_react3.default.createElement("span", { className: "not-set-hover" }, chartSettingIcon.setting), import_react3.default.createElement("span", { className: "have-set-hover" }, chartSettingIcon.settingHover)), import_react3.default.createElement(
    "div",
    {
      key: "delete",
      onClick: () => deleteMainChart(type),
      className: "chart-delete chart-set-icon-wrap common-ml-5"
    },
    import_react3.default.createElement("span", { className: "not-delete-hover" }, chartSettingIcon.delete),
    import_react3.default.createElement("span", { className: "have-delete-hover" }, chartSettingIcon.deleteHover)
  ));
}
var set_chart_default = SetChart;

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/k-line/helper/index.ts
var tradeDirection = {
  call: "call",
  put: "put",
  overCall: "over_call",
  overPut: "over_put"
};
var tradeStatus = {
  processing: "processing",
  revoke: "revoke",
  complete: "complete",
  fail: "fail"
};
var subscribeClickChange = (param, markersRef, setPopVisible, props, priceOffset, setCurMarkers) => {
  var _a;
  if (!param.point || !param.hoveredMarkerId || !((_a = markersRef.current) == null ? void 0 : _a.length)) {
    setPopVisible(false);
    return;
  }
  const findTime = markersRef.current.filter((item) => {
    return Number(item.id) === Number(param.hoveredMarkerId);
  });
  const buyData = [];
  const sellData = [];
  markersRef.current.forEach((item) => {
    var _a2;
    if (item.time === ((_a2 = findTime == null ? void 0 : findTime[0]) == null ? void 0 : _a2.time)) {
      if (item.color === props.createChart.upColor) {
        buyData.push(item);
      } else {
        sellData.push(item);
      }
    }
  });
  const _curMarkers = {
    x: param.point.x,
    y: param.point.y,
    buyData,
    sellData,
    buyDetail: {
      total: buyData == null ? void 0 : buyData.length,
      avg: Number(
        (((buyData == null ? void 0 : buyData.reduce((init, item) => {
          return init + item.price;
        }, 0)) || 0) / ((buyData == null ? void 0 : buyData.length) || 1)).toFixed(priceOffset)
      ),
      count: buyData == null ? void 0 : buyData.reduce((init, item) => {
        return init + item.count;
      }, 0)
    },
    sellDetail: {
      total: sellData == null ? void 0 : sellData.length,
      avg: Number(
        (((sellData == null ? void 0 : sellData.reduce((init, item) => {
          return init + item.price;
        }, 0)) || 0) / ((sellData == null ? void 0 : sellData.length) || 1)).toFixed(priceOffset)
      ),
      count: sellData == null ? void 0 : sellData.reduce((init, item) => {
        return init + item.count;
      }, 0)
    }
  };
  setCurMarkers(_curMarkers);
  if ((buyData == null ? void 0 : buyData.length) || (sellData == null ? void 0 : sellData.length)) {
    setPopVisible(true);
  }
};
var calChartIndicatorPositon = (subIndicator) => {
  var _a, _b, _c, _d, _e2, _f;
  let selectNum = 0;
  let chartScaleMargins = {
    top: 0.12,
    bottom: 0.01
  };
  let volScaleMargins = {
    top: 0,
    bottom: 0
  };
  let macdScaleMargins = {
    top: 0,
    bottom: 0
  };
  let kdjScaleMargins = {
    top: 0,
    bottom: 0
  };
  let rsiScaleMargins = {
    top: 0,
    bottom: 0
  };
  let wrScaleMargins = {
    top: 0,
    bottom: 0
  };
  for (let i2 in subIndicator) {
    if ((_a = subIndicator[i2]) == null ? void 0 : _a.select) {
      selectNum += 1;
    }
  }
  if (selectNum) {
    chartScaleMargins = {
      top: 0.12,
      bottom: 0.01 + selectNum * 0.16 + 0.02
    };
    if ((_b = subIndicator.vol) == null ? void 0 : _b.select) {
      volScaleMargins = {
        top: 1 - (chartScaleMargins.bottom - 0.02) + 0.06,
        bottom: chartScaleMargins.bottom - 0.02 - 0.16
      };
    } else {
      volScaleMargins = chartScaleMargins;
    }
    if ((_c = subIndicator.macd) == null ? void 0 : _c.select) {
      macdScaleMargins = {
        top: 1 - volScaleMargins.bottom + 0.06,
        bottom: volScaleMargins.bottom - 0.16
      };
    } else {
      macdScaleMargins = volScaleMargins;
    }
    if ((_d = subIndicator.kdj) == null ? void 0 : _d.select) {
      kdjScaleMargins = {
        top: 1 - macdScaleMargins.bottom + 0.06,
        bottom: macdScaleMargins.bottom - 0.16
      };
    } else {
      kdjScaleMargins = macdScaleMargins;
    }
    if ((_e2 = subIndicator.rsi) == null ? void 0 : _e2.select) {
      rsiScaleMargins = {
        top: 1 - kdjScaleMargins.bottom + 0.06,
        bottom: kdjScaleMargins.bottom - 0.16
      };
    } else {
      rsiScaleMargins = kdjScaleMargins;
    }
    if ((_f = subIndicator.wr) == null ? void 0 : _f.select) {
      wrScaleMargins = {
        top: 1 - rsiScaleMargins.bottom + 0.06,
        bottom: rsiScaleMargins.bottom - 0.16
      };
    } else {
      wrScaleMargins = rsiScaleMargins;
    }
  }
  return {
    chartScaleMargins,
    volScaleMargins,
    macdScaleMargins,
    kdjScaleMargins,
    rsiScaleMargins,
    wrScaleMargins
  };
};
var calHeightAndLowPoint = (visibleTimeRange, curTimeRef, propsDataRef, timeLineRef, candlestickSeriesRef, chartRef, setCurMaxAndMinPoint, createChart, priceOffset) => {
  var _a, _b, _c, _d, _e2, _f, _g, _h, _i2, _j, _k, _l;
  if (!visibleTimeRange.from || !visibleTimeRange.to) {
    return;
  }
  const { from, to } = visibleTimeRange;
  const maxAndMinPoint = {
    min: {
      time: 0,
      value: 0,
      x: 0,
      y: 0
    },
    max: {
      time: 0,
      value: 0,
      x: 0,
      y: 0
    }
  };
  const curRef = curTimeRef.current.unit === "time" || curTimeRef.current.unit === "s" ? timeLineRef.current : candlestickSeriesRef.current;
  if (curTimeRef.current.unit === "time" || curTimeRef.current.unit === "s") {
    (_a = propsDataRef.current) == null ? void 0 : _a.forEach((item) => {
      if (from === item.time) {
        maxAndMinPoint.max.value = item.close;
        maxAndMinPoint.max.time = item.time;
        maxAndMinPoint.min.value = item.close;
        maxAndMinPoint.min.time = item.time;
      } else if (from < item.time && item.time <= to) {
        if (item.close > maxAndMinPoint.max.value) {
          maxAndMinPoint.max.value = item.close;
          maxAndMinPoint.max.time = item.time;
        }
        if (item.close < maxAndMinPoint.min.value) {
          maxAndMinPoint.min.value = item.close;
          maxAndMinPoint.min.time = item.time;
        }
      }
    });
  } else {
    (_b = propsDataRef.current) == null ? void 0 : _b.forEach((item) => {
      if (from === item.time) {
        maxAndMinPoint.max.value = item.high;
        maxAndMinPoint.max.time = item.time;
        maxAndMinPoint.min.value = item.low;
        maxAndMinPoint.min.time = item.time;
      } else if (from < item.time && item.time <= to) {
        if (item.high > maxAndMinPoint.max.value) {
          maxAndMinPoint.max.value = item.high;
          maxAndMinPoint.max.time = item.time;
        }
        if (item.low < maxAndMinPoint.min.value) {
          maxAndMinPoint.min.value = item.low;
          maxAndMinPoint.min.time = item.time;
        }
      }
    });
  }
  maxAndMinPoint.max.y = curRef == null ? void 0 : curRef.priceToCoordinate(maxAndMinPoint.max.value);
  maxAndMinPoint.min.y = curRef == null ? void 0 : curRef.priceToCoordinate(maxAndMinPoint.min.value);
  maxAndMinPoint.max.x = (_c = chartRef.current) == null ? void 0 : _c.timeScale().timeToCoordinate(maxAndMinPoint.max.time);
  maxAndMinPoint.min.x = (_d = chartRef.current) == null ? void 0 : _d.timeScale().timeToCoordinate(maxAndMinPoint.min.time);
  maxAndMinPoint.min.value = Number(maxAndMinPoint.min.value).toFixed(priceOffset);
  maxAndMinPoint.max.value = Number(maxAndMinPoint.max.value).toFixed(priceOffset);
  const isMac = ((_f = (_e2 = navigator == null ? void 0 : navigator.userAgent) == null ? void 0 : _e2.toLowerCase()) == null ? void 0 : _f.indexOf("mac")) !== -1;
  const calcMin = isMac ? ((((_g = maxAndMinPoint.min.value) == null ? void 0 : _g.toString().length) || 0) + 2) * 2 : ((((_h = maxAndMinPoint.min.value) == null ? void 0 : _h.toString().length) || 0) + 2) * 2 - 2;
  const calcMax = isMac ? ((((_i2 = maxAndMinPoint.max.value) == null ? void 0 : _i2.toString().length) || 0) + 2) * 2 : ((((_j = maxAndMinPoint.max.value) == null ? void 0 : _j.toString().length) || 0) + 2) * 2 - 2;
  let minBlank = "";
  let maxBlank = "";
  for (let i2 = 0; i2 < calcMin; i2 += 1) {
    minBlank += " ";
  }
  for (let i2 = 0; i2 < calcMax; i2 += 1) {
    maxBlank += " ";
  }
  let markers = [
    {
      time: maxAndMinPoint.min.time,
      position: "belowBar",
      color: createChart.textColor01,
      shape: "arrowUp",
      text: maxAndMinPoint.min.x < 80 ? `${minBlank}\u4E00 ${maxAndMinPoint.min.value}` : `${maxAndMinPoint.min.value} \u4E00${minBlank}`,
      id: 1,
      size: 0
    }
  ];
  if (maxAndMinPoint.max.value !== maxAndMinPoint.min.value) {
    markers = [
      {
        time: maxAndMinPoint.min.time,
        position: "belowBar",
        color: createChart.textColor01,
        shape: "arrowUp",
        text: maxAndMinPoint.min.x < 80 ? `${minBlank}\u4E00 ${maxAndMinPoint.min.value}` : `${maxAndMinPoint.min.value} \u4E00${minBlank}`,
        id: 1,
        size: 0
      },
      {
        time: maxAndMinPoint.max.time,
        position: "aboveBar",
        color: createChart.textColor01,
        shape: "arrowUp",
        text: maxAndMinPoint.max.x < 80 ? `${maxBlank}\u4E00 ${maxAndMinPoint.max.value}` : `${maxAndMinPoint.max.value} \u4E00${maxBlank}`,
        id: 2,
        size: 0
      }
    ];
  }
  const oldData = ((_k = curRef == null ? void 0 : curRef.markers()) == null ? void 0 : _k.filter((item) => {
    var _a2, _b2;
    return ((_a2 = item.id) == null ? void 0 : _a2.toString()) !== "1" && ((_b2 = item.id) == null ? void 0 : _b2.toString()) !== "2";
  })) || [];
  curRef == null ? void 0 : curRef.setMarkers(
    (_l = oldData.concat(markers)) == null ? void 0 : _l.sort((a2, b2) => {
      return a2.time - b2.time;
    })
  );
};
var calQuickBuyAndSellPoint = (visibleTimeRange, curTimeRef, propsDataRef, timeLineRef, candlestickSeriesRef, chartRef, setCurBuyAndSellPoint, createChart, priceOffset) => {
  var _a, _b, _c, _d;
  if (!visibleTimeRange.from || !visibleTimeRange.to) {
    return;
  }
  const { from, to } = visibleTimeRange;
  const maxAndMinPoint = {
    min: {
      time: 0,
      value: 0,
      x: 0,
      y: 0
    },
    max: {
      time: 0,
      value: 0,
      x: 0,
      y: 0
    }
  };
  const curRef = curTimeRef.current.unit === "time" || curTimeRef.current.unit === "s" ? timeLineRef.current : candlestickSeriesRef.current;
  if (curTimeRef.current.unit === "time" || curTimeRef.current.unit === "s") {
    (_a = propsDataRef.current) == null ? void 0 : _a.forEach((item) => {
      maxAndMinPoint.max.value = item.close;
      maxAndMinPoint.max.time = item.time;
      maxAndMinPoint.min.value = item.close;
      maxAndMinPoint.min.time = item.time;
    });
  } else {
    (_b = propsDataRef.current) == null ? void 0 : _b.forEach((item) => {
      maxAndMinPoint.max.value = item.high;
      maxAndMinPoint.max.time = item.time;
      maxAndMinPoint.min.value = item.low;
      maxAndMinPoint.min.time = item.time;
    });
  }
  if (maxAndMinPoint.max.time > to) {
    setCurBuyAndSellPoint({
      min: {
        time: 0,
        value: 0,
        x: 0,
        y: 0
      },
      max: {
        time: 0,
        value: 0,
        x: 0,
        y: 0
      }
    });
    return;
  }
  maxAndMinPoint.max.y = curRef == null ? void 0 : curRef.priceToCoordinate(maxAndMinPoint.max.value);
  maxAndMinPoint.min.y = curRef == null ? void 0 : curRef.priceToCoordinate(maxAndMinPoint.min.value);
  maxAndMinPoint.max.x = (_c = chartRef.current) == null ? void 0 : _c.timeScale().timeToCoordinate(maxAndMinPoint.max.time);
  maxAndMinPoint.min.x = (_d = chartRef.current) == null ? void 0 : _d.timeScale().timeToCoordinate(maxAndMinPoint.min.time);
  maxAndMinPoint.min.value = Number(maxAndMinPoint.min.value).toFixed(priceOffset);
  maxAndMinPoint.max.value = Number(maxAndMinPoint.max.value).toFixed(priceOffset);
  setCurBuyAndSellPoint(maxAndMinPoint);
};
var getMarkers = (ordersKlineData, propsDataRef, createChart) => {
  var _a, _b, _c, _d, _e2, _f, _g, _h, _i2, _j, _k, _l, _m, _n2, _o, _p, _q, _r, _s2, _t2, _u, _v, _w, _x, _y, _z, _A, _B, _C, _D, _E, _F, _G, _H, _I;
  let markers = [];
  for (let i2 = 0; i2 < (ordersKlineData == null ? void 0 : ordersKlineData.length); i2 += 1) {
    for (let j2 = 0; j2 < ((_b = ((_a = ordersKlineData[i2]) == null ? void 0 : _a.transactionLogs) || []) == null ? void 0 : _b.length); j2 += 1) {
      for (let k2 = 0; k2 < ((_c = propsDataRef.current) == null ? void 0 : _c.length); k2 += 1) {
        if (ordersKlineData[i2].side === 1) {
          if (Number((_f = (_e2 = (_d = ordersKlineData[i2]) == null ? void 0 : _d.transactionLogs) == null ? void 0 : _e2[j2]) == null ? void 0 : _f.createdByTime) === propsDataRef.current[k2].time || Number((_h = (_g = ordersKlineData[i2]) == null ? void 0 : _g.transactionLogs) == null ? void 0 : _h[j2].createdByTime) > propsDataRef.current[k2].time && Number((_j = (_i2 = ordersKlineData[i2]) == null ? void 0 : _i2.transactionLogs) == null ? void 0 : _j[j2].createdByTime) < ((_k = propsDataRef.current[k2 + 1]) == null ? void 0 : _k.time)) {
            markers.push({
              time: (_l = propsDataRef.current[k2]) == null ? void 0 : _l.time,
              position: "belowBar",
              color: createChart.upColor,
              shape: "arrowUp",
              text: "B",
              id: k2,
              price: (_n2 = (_m = ordersKlineData[i2]) == null ? void 0 : _m.transactionLogs) == null ? void 0 : _n2[j2].price,
              count: (_p = (_o = ordersKlineData[i2]) == null ? void 0 : _o.transactionLogs) == null ? void 0 : _p[j2].count,
              fees: (_r = (_q = ordersKlineData[i2]) == null ? void 0 : _q.transactionLogs) == null ? void 0 : _r[j2].fees
            });
            break;
          }
        } else {
          if (Number((_u = (_t2 = (_s2 = ordersKlineData[i2]) == null ? void 0 : _s2.transactionLogs) == null ? void 0 : _t2[j2]) == null ? void 0 : _u.createdByTime) === ((_v = propsDataRef.current[k2]) == null ? void 0 : _v.time) || Number((_x = (_w = ordersKlineData[i2]) == null ? void 0 : _w.transactionLogs) == null ? void 0 : _x[j2].createdByTime) > ((_y = propsDataRef.current[k2]) == null ? void 0 : _y.time) && Number((_A = (_z = ordersKlineData[i2]) == null ? void 0 : _z.transactionLogs) == null ? void 0 : _A[j2].createdByTime) < ((_B = propsDataRef.current[k2 + 1]) == null ? void 0 : _B.time)) {
            markers.push({
              time: (_C = propsDataRef.current[k2]) == null ? void 0 : _C.time,
              position: "aboveBar",
              color: createChart.downColor,
              shape: "arrowDown",
              text: "S",
              id: k2,
              price: (_E = (_D = ordersKlineData[i2]) == null ? void 0 : _D.transactionLogs) == null ? void 0 : _E[j2].price,
              count: (_G = (_F = ordersKlineData[i2]) == null ? void 0 : _F.transactionLogs) == null ? void 0 : _G[j2].count,
              fees: (_I = (_H = ordersKlineData[i2]) == null ? void 0 : _H.transactionLogs) == null ? void 0 : _I[j2].fees
            });
            break;
          }
        }
      }
    }
  }
  let temp = {};
  markers == null ? void 0 : markers.forEach((item) => {
    if (!temp[item.time]) {
      temp[item.time] = 0;
    } else {
      temp[item.time] += 1;
    }
  });
  markers = markers == null ? void 0 : markers.map((item) => {
    if (temp[item.time]) {
      return {
        ...item,
        color: createChart.brandColor,
        shape: "circle",
        text: "T"
      };
    }
    return item;
  });
  return markers;
};
var getBuyMarkers = (ordersData, propsDataRef, createChart) => {
  var _a;
  let markers = [];
  const tempObj = {};
  ordersData == null ? void 0 : ordersData.forEach((item) => {
    if (!tempObj[`${item.ts}${item.sideInd}`]) {
      tempObj[`${item.ts}${item.sideInd}`] = {
        ...item
      };
    } else {
      tempObj[`${item.ts}${item.sideInd}`] = {
        ...tempObj[`${item.ts}${item.sideInd}`],
        amount: Number(item.amount) + Number(tempObj[`${item.ts}${item.sideInd}`].amount)
      };
    }
  });
  (_a = Object.keys(tempObj)) == null ? void 0 : _a.forEach((item) => {
    if (tempObj[item].sideInd === tradeDirection.call) {
      markers.push({
        time: tempObj[item].ts,
        position: "aboveBar",
        statusCd: tempObj[item].statusCd,
        realizedProfit: Number(tempObj[item].realizedProfit),
        color: tempObj[item].statusCd === tradeStatus.processing ? "#FFFFFF" : Number(tempObj[item].realizedProfit) > 0 ? createChart.upColor : createChart.textColor02,
        bgColor: tempObj[item].statusCd === tradeStatus.processing ? createChart.upColor : Number(tempObj[item].realizedProfit) > 0 ? createChart.upSpecialColor02 : createChart.cardBgColor02,
        shape: "arrowNormalUp",
        text: "",
        id: `${tempObj[item].ts}${tempObj[item].sideInd}`,
        sideInd: tempObj[item].sideInd,
        size: 1,
        price: tempObj[item].amount,
        count: tempObj[item].currency,
        fees: 0
      });
    } else if (tempObj[item].sideInd === tradeDirection.put) {
      markers.push({
        time: tempObj[item].ts,
        position: "belowBar",
        statusCd: tempObj[item].statusCd,
        realizedProfit: Number(tempObj[item].realizedProfit),
        color: tempObj[item].statusCd === tradeStatus.processing ? "#FFFFFF" : Number(tempObj[item].realizedProfit) > 0 ? createChart.downColor : createChart.textColor02,
        bgColor: tempObj[item].statusCd === tradeStatus.processing ? createChart.downColor : Number(tempObj[item].realizedProfit) > 0 ? createChart.downSpecialColor02 : createChart.cardBgColor02,
        shape: "arrowNormalDown",
        text: "",
        id: `${tempObj[item].ts}${tempObj[item].sideInd}`,
        sideInd: tempObj[item].sideInd,
        size: 1,
        price: tempObj[item].amount,
        count: tempObj[item].currency,
        fees: 0
      });
    } else if (tempObj[item].sideInd === tradeDirection.overCall) {
      markers.push({
        time: tempObj[item].ts,
        position: "aboveBar",
        statusCd: tempObj[item].statusCd,
        realizedProfit: Number(tempObj[item].realizedProfit),
        color: tempObj[item].statusCd === tradeStatus.processing ? "#FFFFFF" : Number(tempObj[item].realizedProfit) > 0 ? createChart.upColor : createChart.textColor02,
        bgColor: tempObj[item].statusCd === tradeStatus.processing ? createChart.upColor : Number(tempObj[item].realizedProfit) > 0 ? createChart.upSpecialColor02 : createChart.cardBgColor02,
        shape: "arrowOptionUp",
        text: "",
        id: `${tempObj[item].ts}${tempObj[item].sideInd}`,
        sideInd: tempObj[item].sideInd,
        size: 1,
        price: tempObj[item].amount,
        count: tempObj[item].currency,
        fees: 0
      });
    } else if (tempObj[item].sideInd === tradeDirection.overPut) {
      markers.push({
        time: tempObj[item].ts,
        position: "belowBar",
        statusCd: tempObj[item].statusCd,
        realizedProfit: Number(tempObj[item].realizedProfit),
        color: tempObj[item].statusCd === tradeStatus.processing ? "#FFFFFF" : Number(tempObj[item].realizedProfit) > 0 ? createChart.downColor : createChart.textColor02,
        bgColor: tempObj[item].statusCd === tradeStatus.processing ? createChart.downColor : Number(tempObj[item].realizedProfit) > 0 ? createChart.downSpecialColor02 : createChart.cardBgColor02,
        shape: "arrowOptionDown",
        text: "",
        id: `${tempObj[item].ts}${tempObj[item].sideInd}`,
        sideInd: tempObj[item].sideInd,
        size: 1,
        price: tempObj[item].amount,
        count: tempObj[item].currency,
        fees: 0
      });
    }
  });
  return markers;
};

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/k-line/k-line-render/index.tsx
function KLineRender(props) {
  var _a, _b, _c, _d, _e2, _f, _g, _h;
  const {
    mainIndicator,
    subIndicator,
    ordersKlineData,
    expand,
    expandClick,
    mainK,
    maIndicator,
    bollK,
    macdScaleMargins,
    subK,
    kdjScaleMargins,
    kdjK,
    rsiScaleMargins,
    rsiK,
    wrScaleMargins,
    containerRef,
    curMaxAndMinPoint,
    curBuyAndSellPoint,
    wrK,
    modalVisible,
    setModalVisible,
    tableData,
    popVisible,
    curMarkers,
    showOrderDetail,
    volume,
    volScaleMargins,
    coinInfo,
    createChart,
    priceOffset,
    chartSettingIcon,
    allChartRef,
    updateMainIndicator,
    updateSubIndicator,
    modalRef,
    optionBuyCallback,
    optionSellCallback,
    optionIcon,
    optionActiveTab,
    countDownComponent,
    tradeRestSecond,
    curTime,
    tradeStatusOverList,
    optionAnimation
  } = props;
  const maxElementRef = (0, import_react4.useRef)(null);
  const minElementRef = (0, import_react4.useRef)(null);
  const [audioStatus, setAudioStatus] = (0, import_react4.useState)("wait" /* wait */);
  const mainKList = [
    {
      name: timeLocaleLanguageMap[props.locale]["\u5F00"],
      value: "open"
    },
    {
      name: timeLocaleLanguageMap[props.locale]["\u9AD8"],
      value: "high"
    },
    {
      name: timeLocaleLanguageMap[props.locale]["\u4F4E"],
      value: "low"
    },
    {
      name: timeLocaleLanguageMap[props.locale]["\u6536"],
      value: "close"
    },
    {
      name: timeLocaleLanguageMap[props.locale]["\u6DA8\u8DCC\u5E45"],
      value: "chg"
    },
    {
      name: timeLocaleLanguageMap[props.locale]["\u632F\u5E45"],
      value: "amp"
    }
  ];
  const getHeight = (scaleMargins) => {
    var _a2;
    if ((_a2 = containerRef.current) == null ? void 0 : _a2.clientHeight) {
      return (containerRef.current.clientHeight - 26) * scaleMargins - 18;
    }
  };
  return import_react4.default.createElement("div", { className: "rel-chart" }, import_react4.default.createElement("div", { className: "k-data" }, import_react4.default.createElement("div", { className: "k-line-ind-wrap h-4 text-text_color_03 common-text" }, import_react4.default.createElement(
    "div",
    {
      className: "mr-2 expand-icon-wrap",
      style: {
        transform: !expand.mainK ? "rotate(-90deg)" : "unset"
      },
      onClick: () => {
        expandClick("mainK");
      }
    },
    props.expandIcon
  ), expand.mainK ? [
    import_react4.default.createElement("span", { key: "time", className: "leading-4" }, mainK == null ? void 0 : mainK.time),
    mainKList.map((item) => {
      var _a2;
      return import_react4.default.createElement("span", { key: item.value, className: "common-ml-5 leading-4" }, item.name, ":", import_react4.default.createElement(
        "span",
        {
          className: (0, import_classnames.default)("common-ml-5", {
            "text-buy_up_color": mainK == null ? void 0 : mainK.isUp,
            "text-sell_down_color": !(mainK == null ? void 0 : mainK.isUp)
          })
        },
        item.value === "open" || item.value === "high" || item.value === "low" || item.value === "close" ? (_a2 = Number(mainK == null ? void 0 : mainK[item.value])) == null ? void 0 : _a2.toFixed(priceOffset) : mainK == null ? void 0 : mainK[item.value]
      ));
    }),
    (mainK == null ? void 0 : mainK.buy) ? import_react4.default.createElement("span", { className: "common-ml-5 leading-4" }, timeLocaleLanguageMap[props.locale]["\u4E70\u6DA8"], ":", import_react4.default.createElement(
      "span",
      {
        className: (0, import_classnames.default)("common-ml-5", {
          "text-buy_up_color": mainK == null ? void 0 : mainK.isUp,
          "text-sell_down_color": !(mainK == null ? void 0 : mainK.isUp)
        })
      },
      mainK == null ? void 0 : mainK.buy
    )) : null,
    (mainK == null ? void 0 : mainK.sell) ? import_react4.default.createElement("span", { className: "common-ml-5 leading-4" }, timeLocaleLanguageMap[props.locale]["\u4E70\u8DCC"], ":", import_react4.default.createElement(
      "span",
      {
        className: (0, import_classnames.default)("common-ml-5", {
          "text-buy_up_color": mainK == null ? void 0 : mainK.isUp,
          "text-sell_down_color": !(mainK == null ? void 0 : mainK.isUp)
        })
      },
      mainK == null ? void 0 : mainK.sell
    )) : null,
    (mainK == null ? void 0 : mainK.overBuy) ? import_react4.default.createElement("span", { className: "common-ml-5 leading-4" }, timeLocaleLanguageMap[props.locale]["\u4E70\u8D85\u6DA8"], ":", import_react4.default.createElement(
      "span",
      {
        className: (0, import_classnames.default)("common-ml-5", {
          "text-buy_up_color": mainK == null ? void 0 : mainK.isUp,
          "text-sell_down_color": !(mainK == null ? void 0 : mainK.isUp)
        })
      },
      mainK == null ? void 0 : mainK.overBuy
    )) : null,
    (mainK == null ? void 0 : mainK.overSell) ? import_react4.default.createElement("span", { className: "common-ml-5 leading-4" }, timeLocaleLanguageMap[props.locale]["\u4E70\u8D85\u8DCC"], ":", import_react4.default.createElement(
      "span",
      {
        className: (0, import_classnames.default)("common-ml-5", {
          "text-buy_up_color": mainK == null ? void 0 : mainK.isUp,
          "text-sell_down_color": !(mainK == null ? void 0 : mainK.isUp)
        })
      },
      mainK == null ? void 0 : mainK.overSell
    )) : null,
    (mainK == null ? void 0 : mainK.priceSpread) && curTime.unit === "s" ? import_react4.default.createElement("span", { className: "common-ml-5 leading-4" }, timeLocaleLanguageMap[props.locale]["\u4EF7\u5DEE"], ":", import_react4.default.createElement(
      "span",
      {
        className: (0, import_classnames.default)("common-ml-5", {
          "text-buy_up_color": mainK == null ? void 0 : mainK.isUp,
          "text-sell_down_color": !(mainK == null ? void 0 : mainK.isUp)
        })
      },
      mainK == null ? void 0 : mainK.priceSpread
    )) : null
  ] : null)), import_react4.default.createElement("div", { className: "ma" }, mainIndicator.ma.select ? import_react4.default.createElement("div", { className: "flex text-text_color_03 k-line-ind-wrap common-text" }, import_react4.default.createElement(
    "div",
    {
      className: "mr-2 expand-icon-wrap",
      style: {
        transform: !expand.ma ? "rotate(-90deg)" : "unset"
      },
      onClick: () => {
        expandClick("ma");
      }
    },
    props.expandIcon
  ), expand.ma ? mainIndicator.ma.cur.map((item, index) => {
    var _a2;
    if (item.select) {
      return import_react4.default.createElement("span", { key: item.strip, className: "ma-child" }, `MA(${item.strip}):`, import_react4.default.createElement("span", { className: "common-ml-5", style: { color: item.color } }, (_a2 = maIndicator == null ? void 0 : maIndicator[index]) == null ? void 0 : _a2.toFixed(priceOffset)));
    }
    return null;
  }) : null, import_react4.default.createElement(
    set_chart_default,
    {
      mainIndicator,
      subIndicator,
      chartSettingIcon,
      allChartRef,
      updateMainIndicator,
      updateSubIndicator,
      modalRef,
      type: "ma"
    }
  )) : null, mainIndicator.boll.select ? import_react4.default.createElement("div", { className: "text-text_color_03 k-line-ind-wrap flex" }, import_react4.default.createElement(
    "div",
    {
      className: "mr-2 expand-icon-wrap",
      style: {
        transform: !expand.boll ? "rotate(-90deg)" : "unset"
      },
      onClick: () => {
        expandClick("boll");
      }
    },
    props.expandIcon
  ), expand.boll ? import_react4.default.createElement("span", { className: "ma-child" }, `BOLL(${mainIndicator.boll.cur.mid.value}, ${mainIndicator.boll.cur.std.value}):`, (_a = mainIndicator.boll.curLine) == null ? void 0 : _a.map((item, index) => {
    var _a2;
    if (item.select) {
      return [
        import_react4.default.createElement("span", { key: `${item.color}1`, className: "common-ml-5" }, bollKList[index].name),
        import_react4.default.createElement("span", { key: `${item.color}2`, className: "common-ml-5", style: { color: item.color } }, bollK[(_a2 = bollKList[index]) == null ? void 0 : _a2.value])
      ];
    }
    return null;
  })) : null, import_react4.default.createElement(
    set_chart_default,
    {
      mainIndicator,
      subIndicator,
      chartSettingIcon,
      allChartRef,
      updateMainIndicator,
      updateSubIndicator,
      modalRef,
      type: "boll"
    }
  )) : null), ((_b = subIndicator.vol) == null ? void 0 : _b.select) ? import_react4.default.createElement(
    "div",
    {
      className: "common-sub-ind text-text_color_03",
      style: {
        top: getHeight(volScaleMargins.top)
      }
    },
    import_react4.default.createElement(
      "div",
      {
        className: "mr-2 expand-icon-wrap",
        style: {
          transform: !expand.vol ? "rotate(-90deg)" : "unset"
        },
        onClick: () => {
          expandClick("vol");
        }
      },
      props.expandIcon
    ),
    expand.vol ? [
      import_react4.default.createElement("span", { key: 1 }, import_react4.default.createElement("span", null, "Vol(", coinInfo.baseSymbolName, ")"), import_react4.default.createElement(
        "span",
        {
          className: "common-ml-5",
          style: { color: volume.dir === "rise" ? createChart.upColor : createChart.downColor }
        },
        volume.vol
      )),
      import_react4.default.createElement("span", { key: 2, className: "common-ml-5" }, import_react4.default.createElement("span", null, "Vol(", coinInfo.quoteSymbolName, ")"), import_react4.default.createElement(
        "span",
        {
          style: { color: volume.dir === "rise" ? createChart.upColor : createChart.downColor },
          className: "common-ml-5"
        },
        volume.quoteVolume
      ))
    ] : null,
    import_react4.default.createElement(
      set_chart_default,
      {
        mainIndicator,
        subIndicator,
        chartSettingIcon,
        allChartRef,
        updateMainIndicator,
        updateSubIndicator,
        modalRef,
        type: "vol"
      }
    )
  ) : null, subIndicator.macd.select ? import_react4.default.createElement(
    "div",
    {
      className: "common-sub-ind text-text_color_03",
      style: {
        top: getHeight(macdScaleMargins.top)
      }
    },
    import_react4.default.createElement(
      "div",
      {
        className: "mr-2 expand-icon-wrap",
        style: {
          transform: !expand.macd ? "rotate(-90deg)" : "unset"
        },
        onClick: () => {
          expandClick("macd");
        }
      },
      props.expandIcon
    ),
    expand.macd ? [
      import_react4.default.createElement("span", { key: "macd" }, `MACD(${subIndicator.macd.cur.fast.value}, ${subIndicator.macd.cur.slow.value}, ${subIndicator.macd.cur.signal.value})`),
      (_c = subIndicator.macd.curLine) == null ? void 0 : _c.map((item, index) => {
        var _a2;
        return import_react4.default.createElement("span", { key: item.color, className: "common-ml-5", style: { color: item.color } }, Number(subK == null ? void 0 : subK[(_a2 = macdKList[index]) == null ? void 0 : _a2.value]).toFixed(priceOffset));
      })
    ] : null,
    import_react4.default.createElement(
      set_chart_default,
      {
        mainIndicator,
        subIndicator,
        chartSettingIcon,
        allChartRef,
        updateMainIndicator,
        updateSubIndicator,
        modalRef,
        type: "macd"
      }
    )
  ) : null, subIndicator.kdj.select ? import_react4.default.createElement(
    "div",
    {
      style: {
        top: getHeight(kdjScaleMargins.top)
      },
      className: "common-sub-ind text-text_color_03"
    },
    import_react4.default.createElement(
      "div",
      {
        className: "mr-2 expand-icon-wrap",
        style: {
          transform: !expand.kdj ? "rotate(-90deg)" : "unset"
        },
        onClick: () => {
          expandClick("kdj");
        }
      },
      props.expandIcon
    ),
    expand.kdj ? import_react4.default.createElement("span", { className: "ma-child" }, `KDJ(${subIndicator.kdj.cur.k.value}, ${subIndicator.kdj.cur.d.value}, ${subIndicator.kdj.cur.j.value}):`, (_d = subIndicator.kdj.curLine) == null ? void 0 : _d.map((item, index) => {
      var _a2;
      return [
        import_react4.default.createElement("span", { key: `${item.color}1`, className: "common-ml-5" }, kdjKList[index].name),
        import_react4.default.createElement("span", { key: `${item.color}2`, className: "common-ml-5", style: { color: item.color } }, kdjK == null ? void 0 : kdjK[(_a2 = kdjKList[index]) == null ? void 0 : _a2.value])
      ];
    })) : null,
    import_react4.default.createElement(
      set_chart_default,
      {
        mainIndicator,
        subIndicator,
        chartSettingIcon,
        allChartRef,
        updateMainIndicator,
        updateSubIndicator,
        modalRef,
        type: "kdj"
      }
    )
  ) : null, subIndicator.rsi.select ? import_react4.default.createElement(
    "div",
    {
      style: {
        top: getHeight(rsiScaleMargins.top)
      },
      className: "common-sub-ind text-text_color_03"
    },
    import_react4.default.createElement(
      "div",
      {
        className: "mr-2 expand-icon-wrap",
        style: {
          transform: !expand.rsi ? "rotate(-90deg)" : "unset"
        },
        onClick: () => {
          expandClick("rsi");
        }
      },
      props.expandIcon
    ),
    expand.rsi ? subIndicator.rsi.cur.map((item, index) => {
      if (item.select) {
        return import_react4.default.createElement("span", { key: index, className: "ma-child" }, `RSI(${item.value})`, import_react4.default.createElement("span", { className: "common-ml-5", style: { color: item.color } }, rsiK == null ? void 0 : rsiK[Object.keys(rsiK)[index]]));
      }
      return null;
    }) : null,
    import_react4.default.createElement(
      set_chart_default,
      {
        mainIndicator,
        subIndicator,
        chartSettingIcon,
        allChartRef,
        updateMainIndicator,
        updateSubIndicator,
        modalRef,
        type: "rsi"
      }
    )
  ) : null, subIndicator.wr.select ? import_react4.default.createElement(
    "div",
    {
      style: {
        top: getHeight(wrScaleMargins.top)
      },
      className: "common-sub-ind text-text_color_03"
    },
    import_react4.default.createElement(
      "div",
      {
        className: "mr-2 expand-icon-wrap",
        style: {
          transform: !expand.wr ? "rotate(-90deg)" : "unset"
        },
        onClick: () => {
          expandClick("wr");
        }
      },
      props.expandIcon
    ),
    expand.wr ? subIndicator.wr.cur.map((item, index) => {
      if (item.select) {
        return import_react4.default.createElement("span", { key: index, className: "ma-child" }, `Wm %R(${item.value})`, import_react4.default.createElement("span", { className: "common-ml-5", style: { color: item.color } }, wrK == null ? void 0 : wrK[index]));
      }
      return null;
    }) : null,
    import_react4.default.createElement(
      set_chart_default,
      {
        mainIndicator,
        subIndicator,
        chartSettingIcon,
        allChartRef,
        updateMainIndicator,
        updateSubIndicator,
        modalRef,
        type: "wr"
      }
    )
  ) : null, import_react4.default.createElement("div", { className: "chart", id: "chart", ref: containerRef }, (tradeStatusOverList == null ? void 0 : tradeStatusOverList.length) ? tradeStatusOverList[0].loading ? import_react4.default.createElement(
    "div",
    {
      className: "chart-max-or-min-price",
      style: {
        top: tradeStatusOverList[0].sideInd === tradeDirection.call || tradeStatusOverList[0].sideInd === tradeDirection.overCall ? tradeStatusOverList[0].y - 35 : tradeStatusOverList[0].y,
        left: tradeStatusOverList[0].x - 17 || 0,
        color: createChart.textColor01
      }
    },
    import_react4.default.createElement("div", { style: { width: "34px", height: "34px", background: createChart.bgColor } }, optionAnimation.loading)
  ) : import_react4.default.createElement(
    "div",
    {
      className: "chart-max-or-min-price",
      style: {
        top: tradeStatusOverList[0].sideInd === tradeDirection.call || tradeStatusOverList[0].sideInd === tradeDirection.overCall ? tradeStatusOverList[0].y - 35 : tradeStatusOverList[0].y,
        left: tradeStatusOverList[0].x - 17 || 0,
        color: createChart.textColor01
      }
    },
    tradeStatusOverList[0].realizedProfit > 0 ? import_react4.default.createElement(
      "audio",
      {
        src: "https://bitcastle-frontend-static.s3.ap-southeast-1.amazonaws.com/audio/win.mp3",
        autoPlay: true,
        onEnded: () => {
          setAudioStatus("wait" /* wait */);
        }
      }
    ) : import_react4.default.createElement(
      "audio",
      {
        src: "https://bitcastle-frontend-static.s3.ap-southeast-1.amazonaws.com/audio/lose.mp3",
        autoPlay: true,
        onEnded: () => {
          setAudioStatus("wait" /* wait */);
        }
      }
    ),
    tradeStatusOverList[0].realizedProfit > 0 ? null : import_react4.default.createElement("div", { style: { width: "34px", height: "34px", background: createChart.bgColor } }, optionAnimation[tradeStatusOverList[0].sideInd])
  ) : null, !((_e2 = tradeStatusOverList[0]) == null ? void 0 : _e2.loading) && ((_f = tradeStatusOverList[0]) == null ? void 0 : _f.realizedProfit) > 0 ? import_react4.default.createElement(
    "div",
    {
      className: "chart-max-or-min-price",
      style: {
        top: (((_g = containerRef.current) == null ? void 0 : _g.clientHeight) || tradeStatusOverList[0].y) / 2 - 200,
        left: (((_h = containerRef.current) == null ? void 0 : _h.clientWidth) || tradeStatusOverList[0].x) / 2 - 400,
        color: createChart.textColor01,
        width: "800px",
        height: "400px"
      }
    },
    optionAnimation.win
  ) : null, curTime.unit === "s" && curBuyAndSellPoint.max.time ? import_react4.default.createElement(
    "div",
    {
      className: "chart-max-or-min-price",
      style: {
        top: curBuyAndSellPoint.max.y - 34 - 12 || 0,
        left: curBuyAndSellPoint.max.x || 0,
        color: createChart.textColor01
      }
    },
    tradeRestSecond ? countDownComponent("call" /* call */) : import_react4.default.createElement(
      "div",
      {
        onClick: () => {
          optionBuyCallback();
        }
      },
      optionActiveTab === 1 ? optionIcon.up : optionIcon.overUp
    )
  ) : null, curTime.unit === "s" && curBuyAndSellPoint.max.time ? import_react4.default.createElement(
    "div",
    {
      className: "chart-max-or-min-price",
      style: {
        top: curBuyAndSellPoint.max.y + 12 || 0,
        left: curBuyAndSellPoint.max.x || 0,
        color: createChart.textColor01
      }
    },
    tradeRestSecond ? countDownComponent("put" /* put */) : import_react4.default.createElement(
      "div",
      {
        onClick: () => {
          optionSellCallback();
        }
      },
      optionActiveTab === 1 ? optionIcon.down : optionIcon.overDown
    )
  ) : null), import_react4.default.createElement(
    order_modal_default,
    {
      locale: props.locale,
      modalVisible,
      setModalVisible,
      tableData
    }
  ), popVisible ? import_react4.default.createElement(
    order_pop_default,
    {
      ordersKlineData,
      curMarkers,
      showOrderDetail,
      createChart,
      locale: props.locale
    }
  ) : null);
}
var k_line_render_default = KLineRender;

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/k-line/k-line-chart.tsx
function KLineChart(props, ref) {
  var _a;
  const {
    mainIndicator,
    subIndicator,
    ordersKlineData,
    getMoreKlineData,
    offset,
    updateMarketChangesTime,
    colors,
    chartSettingIcon,
    ordersData,
    optionBuyCallback,
    optionSellCallback,
    optionIcon,
    optionActiveTab,
    countDownComponent,
    tradeRestSecond,
    optionAnimation
  } = props;
  const { priceOffset, amountOffset } = offset;
  const chartPriceLineProperty = {
    crosshairMarkerVisible: false,
    baseLineVisible: false,
    priceLineVisible: false,
    lastValueVisible: false,
    lineType: 2
  };
  const mainIndicatorRef = (0, import_react5.useRef)();
  const subIndicatorRef = (0, import_react5.useRef)();
  const isHoverChart = (0, import_react5.useRef)(false);
  const chartRef = (0, import_react5.useRef)();
  const candlestickSeriesRef = (0, import_react5.useRef)();
  const macdVolumeSeriesRef = (0, import_react5.useRef)();
  const volumeSeriesRef = (0, import_react5.useRef)();
  const smaLineRef = (0, import_react5.useRef)();
  const timeLineRef = (0, import_react5.useRef)();
  const [popVisible, setPopVisible] = (0, import_react5.useState)(false);
  const [modalVisible, setModalVisible] = (0, import_react5.useState)(false);
  const propsDataRef = (0, import_react5.useRef)(props.data);
  const curTimeRef = (0, import_react5.useRef)(props.curTime);
  const colorsRef = (0, import_react5.useRef)(1 /* greenUpRedDown */);
  (0, import_react5.useEffect)(() => {
    curTimeRef.current = props.curTime;
    mainIndicatorRef.current = props.mainIndicator;
    subIndicatorRef.current = props.subIndicator;
    colorsRef.current = colors;
  }, [props.data, props.curTime, props.mainIndicator, props.subIndicator, colors]);
  const markersRef = (0, import_react5.useRef)();
  const buyMarkersRef = (0, import_react5.useRef)();
  const ordersDataRef = (0, import_react5.useRef)();
  const deaRef = (0, import_react5.useRef)();
  const difRef = (0, import_react5.useRef)();
  const containerRef = (0, import_react5.useRef)(null);
  const outOfTimeValue = (0, import_react5.useRef)();
  const [heightChange, setHeightChange] = (0, import_react5.useState)(0);
  const [tradeStatusOverList, setTradeStatusOverList] = (0, import_react5.useState)([]);
  ordersDataRef.current = ordersData;
  const bollRef = (0, import_react5.useRef)();
  const kdjRef = (0, import_react5.useRef)();
  const [curMaxAndMinPoint, setCurMaxAndMinPoint] = (0, import_react5.useState)({
    min: {
      time: 0,
      value: 0,
      x: 0,
      y: 0
    },
    max: {
      time: 0,
      value: 0,
      x: 0,
      y: 0
    }
  });
  const [curBuyAndSellPoint, setCurBuyAndSellPoint] = (0, import_react5.useState)({
    min: {
      time: 0,
      value: 0,
      x: 0,
      y: 0
    },
    max: {
      time: 0,
      value: 0,
      x: 0,
      y: 0
    }
  });
  const rsiRef = (0, import_react5.useRef)();
  const wrRef = (0, import_react5.useRef)();
  const [tableData, setTableData] = (0, import_react5.useState)([]);
  const [curMarkers, setCurMarkers] = (0, import_react5.useState)();
  const [maIndicator, setMaIndicator] = (0, import_react5.useState)();
  const [visibleTimeRange, setVisibleTimeRange] = (0, import_react5.useState)({
    from: 0,
    to: 0
  });
  const [mainK, setMainK] = (0, import_react5.useState)();
  const [subK, setSubK] = (0, import_react5.useState)();
  const [volume, setVolume] = (0, import_react5.useState)({
    vol: 0,
    quoteVolume: 0,
    dir: "rise"
  });
  const [bollK, setBollK] = (0, import_react5.useState)({
    mid: 0,
    upper: 0,
    lower: 0
  });
  const [kdjK, setKdjK] = (0, import_react5.useState)();
  const [rsiK, setRsiK] = (0, import_react5.useState)();
  const [wrK, setWrK] = (0, import_react5.useState)();
  const { chartScaleMargins, volScaleMargins, macdScaleMargins, kdjScaleMargins, rsiScaleMargins, wrScaleMargins } = calChartIndicatorPositon(subIndicator);
  const gridColor = props.theme === ThemeEnum.light ? "rgba(0,0,0,0.02)" : "rgba(255,255,255,0.02)";
  (0, import_react5.useEffect)(() => {
    if (chartRef.current) {
      chartRef.current.applyOptions({
        timeScale: {
          barSpacing: 10,
          minBarSpacing: 1,
          tickMarkFormatter: (item) => {
            return showFormatTime(item, props.curTime.unit);
          }
        }
      });
    }
  }, [props.curTime.unit, props.curTime.value]);
  const chartPropertySetting = {
    layout: props.chartLayoutOptions,
    localization: {
      timeFormatter: (item) => {
        if (props.curTime.unit === TimeSharingType.Second) {
          return (0, import_dayjs.default)(item).format("YYYY/MM/DD HH:mm:ss");
        }
        return (0, import_dayjs.default)(item).format("YYYY/MM/DD HH:mm");
      },
      priceFormatter: (item) => {
        return `${item.toFixed(priceOffset)}`;
      }
    },
    crosshair: {
      mode: ot.Normal
    },
    timeScale: {
      barSpacing: 6,
      minBarSpacing: 1,
      tickMarkFormatter: (item) => {
        return showFormatTime(item, props.curTime.unit);
      },
      borderColor: gridColor,
      lockVisibleTimeRangeOnResize: true
    },
    rightPriceScale: {
      scaleMargins: chartScaleMargins,
      visible: true,
      alignLabels: true,
      autoScale: true,
      borderColor: gridColor
    }
  };
  (0, import_react5.useEffect)(() => {
    requestAnimationFrame(() => {
      calHeightAndLowPoint(
        visibleTimeRange,
        curTimeRef,
        propsDataRef,
        timeLineRef,
        candlestickSeriesRef,
        chartRef,
        setCurMaxAndMinPoint,
        props.createChart,
        priceOffset
      );
      calQuickBuyAndSellPoint(
        visibleTimeRange,
        curTimeRef,
        propsDataRef,
        timeLineRef,
        candlestickSeriesRef,
        chartRef,
        setCurBuyAndSellPoint,
        props.createChart,
        priceOffset
      );
    });
  }, [visibleTimeRange, subIndicator, props.getDataAndUpdateChart]);
  (0, import_react5.useEffect)(() => {
    var _a2, _b, _c, _d, _e2, _f;
    (_c = chartRef.current) == null ? void 0 : _c.applyOptions({
      width: (_a2 = containerRef.current) == null ? void 0 : _a2.clientWidth,
      height: (_b = containerRef.current) == null ? void 0 : _b.clientHeight,
      rightPriceScale: {
        ...chartPropertySetting.rightPriceScale,
        scaleMargins: chartScaleMargins
      }
    });
    if ((_e2 = (_d = chartRef.current) == null ? void 0 : _d.timeScale().getVisibleRange()) == null ? void 0 : _e2.from) {
      setVisibleTimeRange((_f = chartRef.current) == null ? void 0 : _f.timeScale().getVisibleRange());
    }
  }, [(_a = containerRef.current) == null ? void 0 : _a.clientHeight]);
  (0, import_react5.useEffect)(() => {
    chartRef.current = Pe(document.getElementById("chart"), chartPropertySetting);
    chartRef.current.applyOptions({
      handleScale: {
        axisPressedMouseMove: {
          time: true,
          price: false
        },
        pinch: true
      }
    });
    chartRef.current.timeScale().fitContent();
    const subscribeTimeChange = (newVisibleTimeRange) => {
      var _a2, _b, _c;
      if ((_b = (_a2 = chartRef.current) == null ? void 0 : _a2.timeScale().getVisibleRange()) == null ? void 0 : _b.from) {
        setVisibleTimeRange((_c = chartRef.current) == null ? void 0 : _c.timeScale().getVisibleRange());
      }
      setPopVisible(false);
    };
    chartRef.current.timeScale().subscribeVisibleTimeRangeChange(subscribeTimeChange);
    const sizeChange = () => {
      var _a2, _b, _c, _d, _e2;
      buyMarkersRef.current = getBuyMarkers(ordersData, propsDataRef, props.createChart) || [];
      const oldData = ((_b = (_a2 = timeLineRef.current) == null ? void 0 : _a2.markers()) == null ? void 0 : _b.filter((item) => {
        var _a3, _b2;
        return ((_a3 = item.id) == null ? void 0 : _a3.toString()) === "1" || ((_b2 = item.id) == null ? void 0 : _b2.toString()) === "2";
      })) || [];
      (_e2 = timeLineRef.current) == null ? void 0 : _e2.setMarkers(
        (_d = (_c = oldData.concat(buyMarkersRef.current)) == null ? void 0 : _c.sort) == null ? void 0 : _d.call(_c, (a2, b2) => {
          return Number(a2.time) - Number(b2.time);
        })
      );
    };
    let timer;
    function onVisibleLogicalRangeChanged(newVisibleLogicalRange) {
      var _a2, _b, _c;
      if ((_b = (_a2 = chartRef.current) == null ? void 0 : _a2.timeScale().getVisibleRange()) == null ? void 0 : _b.from) {
        setVisibleTimeRange((_c = chartRef.current) == null ? void 0 : _c.timeScale().getVisibleRange());
      }
      timer = setTimeout(() => {
        var _a3, _b2, _c2, _d;
        let logicalRange = (_b2 = (_a3 = chartRef.current) == null ? void 0 : _a3.timeScale()) == null ? void 0 : _b2.getVisibleLogicalRange();
        if (logicalRange !== null) {
          const curRef = curTimeRef.current.unit === "time" || curTimeRef.current.unit === "s" ? timeLineRef.current : candlestickSeriesRef.current;
          const barsInfo = curRef == null ? void 0 : curRef.barsInLogicalRange(logicalRange);
          if (barsInfo !== null && (barsInfo == null ? void 0 : barsInfo.barsBefore) < 10) {
            getMoreKlineData({ time: (_d = (_c2 = propsDataRef.current) == null ? void 0 : _c2[0]) == null ? void 0 : _d.time });
            clearTimeout(timer);
          }
        }
      }, 500);
    }
    chartRef.current.timeScale().subscribeVisibleLogicalRangeChange(onVisibleLogicalRangeChanged);
    chartRef.current.subscribeClick((param) => {
      subscribeClickChange(param, markersRef, setPopVisible, props, priceOffset, setCurMarkers);
    });
    const subscribeMoveChange = (param) => {
      var _a2, _b, _c, _d, _e2, _f, _g, _h, _i2, _j, _k, _l, _m, _n2, _o, _p, _q, _r, _s2, _t2, _u, _v, _w, _x, _y, _z, _A, _B, _C, _D, _E, _F, _G, _H, _I, _J, _K, _L;
      const time = param.time;
      if (time) {
        isHoverChart.current = true;
        const volumeSeriesData = volumeSeriesRef.current ? param.seriesData.get(volumeSeriesRef.current) : void 0;
        const macdVolumeSeriesData = macdVolumeSeriesRef.current ? param.seriesData.get(macdVolumeSeriesRef.current) : void 0;
        let chartData = candlestickSeriesRef.current ? param.seriesData.get(candlestickSeriesRef.current) : null;
        if (!chartData) {
          chartData = (_a2 = propsDataRef.current.filter((item) => {
            return item.time === time;
          })) == null ? void 0 : _a2[0];
        }
        const smaLineArr = [];
        (_b = smaLineRef.current) == null ? void 0 : _b.forEach((item) => {
          var _a3;
          smaLineArr.push((_a3 = param.seriesData.get(item)) == null ? void 0 : _a3.value);
        });
        const dif = difRef.current ? param.seriesData.get(difRef.current) : void 0;
        const dea = deaRef.current ? param.seriesData.get(deaRef.current) : void 0;
        setMaIndicator(smaLineArr);
        const buyAmount = (_c = ordersDataRef.current) == null ? void 0 : _c.filter((item) => {
          return item.ts.toString() === time.toString();
        });
        const tempObj = {};
        buyAmount == null ? void 0 : buyAmount.forEach((item) => {
          if (!tempObj[`${item.sideInd}`]) {
            tempObj[`${item.sideInd}`] = {
              ...item
            };
          } else {
            tempObj[`${item.sideInd}`] = {
              ...tempObj[`${item.sideInd}`],
              amount: Number(item.amount) + Number(tempObj[`${item.sideInd}`].amount)
            };
          }
        });
        setMainK({
          time: (0, import_dayjs.default)(time).format("YYYY/MM/DD HH:mm"),
          open: chartData == null ? void 0 : chartData.open,
          close: chartData == null ? void 0 : chartData.close,
          high: chartData == null ? void 0 : chartData.high,
          low: chartData == null ? void 0 : chartData.low,
          isUp: checkIsUp(chartData),
          chg: calcChg(chartData, priceOffset),
          amp: calcAmp(chartData, priceOffset),
          buy: ((_d = tempObj[tradeDirection.call]) == null ? void 0 : _d.amount) ? `${(_e2 = tempObj[tradeDirection.call]) == null ? void 0 : _e2.amount} ${(_f = tempObj[tradeDirection.call]) == null ? void 0 : _f.currency}` : "",
          sell: ((_g = tempObj[tradeDirection.put]) == null ? void 0 : _g.amount) ? `${(_h = tempObj[tradeDirection.put]) == null ? void 0 : _h.amount} ${(_i2 = tempObj[tradeDirection.put]) == null ? void 0 : _i2.currency}` : "",
          overBuy: ((_j = tempObj[tradeDirection.overCall]) == null ? void 0 : _j.amount) ? `${(_k = tempObj[tradeDirection.overCall]) == null ? void 0 : _k.amount} ${(_l = tempObj[tradeDirection.overCall]) == null ? void 0 : _l.currency}` : "",
          overSell: ((_m = tempObj[tradeDirection.overPut]) == null ? void 0 : _m.amount) ? `${(_n2 = tempObj[tradeDirection.overPut]) == null ? void 0 : _n2.amount} ${(_o = tempObj[tradeDirection.overPut]) == null ? void 0 : _o.currency}` : "",
          priceSpread: ((_p = tempObj[tradeDirection.overCall]) == null ? void 0 : _p.amplitude) || ((_q = tempObj[tradeDirection.overPut]) == null ? void 0 : _q.amplitude)
        });
        setSubK({
          macd: macdVolumeSeriesData == null ? void 0 : macdVolumeSeriesData.value,
          dea: dea == null ? void 0 : dea.value,
          dif: dif == null ? void 0 : dif.value
        });
        setVolume({
          vol: volumeSeriesData == null ? void 0 : volumeSeriesData.value,
          quoteVolume: (_s2 = (_r = propsDataRef.current.filter((item) => {
            return item.time === time;
          })) == null ? void 0 : _r[0]) == null ? void 0 : _s2.quoteVolume,
          dir: (chartData == null ? void 0 : chartData.close) > (chartData == null ? void 0 : chartData.open) ? "rise" : "fall"
        });
        setBollK({
          mid: (_u = param.seriesData.get((_t2 = bollRef.current) == null ? void 0 : _t2.mid)) == null ? void 0 : _u.value,
          upper: (_w = param.seriesData.get((_v = bollRef.current) == null ? void 0 : _v.upper)) == null ? void 0 : _w.value,
          lower: (_y = param.seriesData.get((_x = bollRef.current) == null ? void 0 : _x.lower)) == null ? void 0 : _y.value
        });
        setKdjK({
          k: (_A = param.seriesData.get((_z = kdjRef.current) == null ? void 0 : _z.k)) == null ? void 0 : _A.value,
          d: (_C = param.seriesData.get((_B = kdjRef.current) == null ? void 0 : _B.d)) == null ? void 0 : _C.value,
          j: (_E = param.seriesData.get((_D = kdjRef.current) == null ? void 0 : _D.j)) == null ? void 0 : _E.value
        });
        setRsiK({
          r: (_G = param.seriesData.get((_F = rsiRef.current) == null ? void 0 : _F[0])) == null ? void 0 : _G.value,
          s: (_I = param.seriesData.get((_H = rsiRef.current) == null ? void 0 : _H[1])) == null ? void 0 : _I.value,
          i: (_K = param.seriesData.get((_J = rsiRef.current) == null ? void 0 : _J[2])) == null ? void 0 : _K.value
        });
        const wrLineArr = [];
        (_L = wrRef.current) == null ? void 0 : _L.forEach((item) => {
          var _a3;
          wrLineArr.push((_a3 = param.seriesData.get(item)) == null ? void 0 : _a3.value);
        });
        setWrK(wrLineArr);
      } else {
        isHoverChart.current = false;
        if (outOfTimeValue.current) {
          setMaIndicator(outOfTimeValue.current._ma);
          setMainK(outOfTimeValue.current._mainK);
          setSubK(outOfTimeValue.current._subK);
          setBollK(outOfTimeValue.current._boll);
          setKdjK(outOfTimeValue.current._kdjK);
          setRsiK(outOfTimeValue.current._rsiK);
          setWrK(outOfTimeValue.current._wrK);
          setVolume(outOfTimeValue.current._volK);
        }
      }
    };
    chartRef.current.subscribeCrosshairMove(subscribeMoveChange);
    return () => {
      var _a2, _b, _c, _d;
      (_a2 = chartRef.current) == null ? void 0 : _a2.timeScale().unsubscribeVisibleTimeRangeChange(subscribeTimeChange);
      (_b = chartRef.current) == null ? void 0 : _b.unsubscribeClick((param) => {
        subscribeClickChange(param, markersRef, setPopVisible, props, priceOffset, setCurMarkers);
      });
      (_c = chartRef.current) == null ? void 0 : _c.unsubscribeCrosshairMove(subscribeMoveChange);
      (_d = chartRef.current) == null ? void 0 : _d.timeScale().unsubscribeVisibleLogicalRangeChange(onVisibleLogicalRangeChanged);
    };
  }, []);
  const getColorOfSetting = (close, open) => {
    if (colorsRef.current === 1 /* greenUpRedDown */) {
      return close > open ? "rgba(80, 177, 108, 0.5)" : "rgba(233, 90, 92, 0.5)";
    } else {
      return close > open ? "rgba(233, 90, 92, 0.5)" : "rgba(80, 177, 108, 0.5)";
    }
  };
  (0, import_react5.useImperativeHandle)(ref, () => ({
    scrollToTime(marketChangesTime) {
      var _a2, _b;
      if (chartRef.current && ((_a2 = propsDataRef.current) == null ? void 0 : _a2.length)) {
        const timeToCoordinate = (_b = chartRef.current) == null ? void 0 : _b.timeScale().timeToCoordinate(marketChangesTime);
        setTimeout(() => {
          var _a3;
          (_a3 = chartRef.current) == null ? void 0 : _a3.timeScale().setVisibleRange({
            from: curTimeRef.current.unit === "m" ? marketChangesTime - 1e3 * 60 * 120 : marketChangesTime - 1e3 * 60 * 60 * 120,
            to: curTimeRef.current.unit === "m" ? marketChangesTime + 1e3 * 60 : marketChangesTime + 1e3 * 60 * 60
          });
        });
        updateMarketChangesTime(0);
      }
    },
    updateCandlestickData(data, curRefData) {
      var _a2, _b, _c, _d;
      propsDataRef.current = curRefData || [];
      (_a2 = candlestickSeriesRef.current) == null ? void 0 : _a2.update(data);
      const temp = {
        ...data,
        time: (0, import_dayjs.default)(data.time).format("YYYY/MM/DD HH:mm"),
        isUp: checkIsUp(data),
        chg: calcChg(data, priceOffset),
        amp: calcAmp(data, priceOffset)
      };
      if (!isHoverChart.current) {
        setMainK(temp);
      }
      outOfTimeValue.current._mainK = temp;
      if ((_c = (_b = chartRef.current) == null ? void 0 : _b.timeScale().getVisibleRange()) == null ? void 0 : _c.from) {
        setVisibleTimeRange((_d = chartRef.current) == null ? void 0 : _d.timeScale().getVisibleRange());
      }
    },
    updateTimeData(data, curRefData) {
      var _a2, _b, _c, _d;
      propsDataRef.current = curRefData || [];
      (_a2 = timeLineRef.current) == null ? void 0 : _a2.update(data);
      const temp = {
        ...data,
        time: (0, import_dayjs.default)(data.time).format("YYYY/MM/DD HH:mm"),
        isUp: checkIsUp(data),
        chg: calcChg(data, priceOffset),
        amp: calcAmp(data, priceOffset)
      };
      if (!isHoverChart.current) {
        setMainK(temp);
      }
      outOfTimeValue.current._mainK = temp;
      if ((_c = (_b = chartRef.current) == null ? void 0 : _b.timeScale().getVisibleRange()) == null ? void 0 : _c.from) {
        setVisibleTimeRange((_d = chartRef.current) == null ? void 0 : _d.timeScale().getVisibleRange());
      }
    },
    updateVolumeData(data) {
      var _a2, _b, _c;
      if ((_b = (_a2 = subIndicatorRef.current) == null ? void 0 : _a2.vol) == null ? void 0 : _b.select) {
        (_c = volumeSeriesRef.current) == null ? void 0 : _c.update({
          ...data,
          color: getColorOfSetting(data.close, data.open)
        });
        const temp = {
          ...data,
          vol: data.value
        };
        if (!isHoverChart.current) {
          setVolume(temp);
        }
        outOfTimeValue.current._volK = temp;
      }
    },
    updateMaData() {
      var _a2, _b;
      if ((_a2 = mainIndicatorRef.current) == null ? void 0 : _a2.ma.select) {
        let _ma = [];
        (_b = mainIndicatorRef.current) == null ? void 0 : _b.ma.cur.forEach((item, index) => {
          var _a3, _b2, _c, _d;
          if (item.select) {
            const { strip, type } = item;
            let smaData = calculateSMA(propsDataRef.current, Number(strip), type, priceOffset);
            _ma.push((_a3 = smaData[smaData.length - 1]) == null ? void 0 : _a3.value);
            ((_b2 = smaData[smaData.length - 1]) == null ? void 0 : _b2.time) && ((_d = (_c = smaLineRef.current) == null ? void 0 : _c[index]) == null ? void 0 : _d.update(smaData[smaData.length - 1]));
          }
        });
        if (!isHoverChart.current) {
          setMaIndicator(_ma);
        }
        outOfTimeValue.current._ma = _ma;
      }
    },
    updateMacdData(data) {
      var _a2, _b, _c, _d, _e2, _f, _g, _h;
      if ((_a2 = subIndicatorRef.current) == null ? void 0 : _a2.macd.select) {
        let _subK = {
          dea: void 0,
          dif: void 0,
          macd: void 0
        };
        const fast = ((_b = subIndicatorRef.current) == null ? void 0 : _b.macd.cur.fast).value;
        const slow = ((_c = subIndicatorRef.current) == null ? void 0 : _c.macd.cur.slow).value;
        const signal = ((_d = subIndicatorRef.current) == null ? void 0 : _d.macd.cur.signal).value;
        const newData = calculateMACD(propsDataRef.current, Number(fast), Number(slow), Number(signal), priceOffset);
        _subK.dif = (_e2 = newData[newData.length - 1]) == null ? void 0 : _e2.dif;
        _subK.dea = (_f = newData[newData.length - 1]) == null ? void 0 : _f.dea;
        _subK.macd = (_g = newData[newData.length - 1]) == null ? void 0 : _g.value;
        const difData = newData.map((item) => {
          return {
            time: item.time,
            value: item.dif
          };
        }) || [];
        const deaData = newData.map((item) => {
          return {
            time: item.time,
            value: item.dea
          };
        }) || [];
        const macdData = newData.map((item) => {
          return {
            time: item == null ? void 0 : item.time,
            value: item == null ? void 0 : item.value,
            color: getColorOfSetting(item == null ? void 0 : item.value, 0)
          };
        }) || [];
        const nameList = [difRef.current, deaRef.current, macdVolumeSeriesRef.current];
        const dataList = [difData[difData.length - 1], deaData[deaData.length - 1], macdData[macdData.length - 1]];
        (_h = subIndicator.macd.curLine) == null ? void 0 : _h.forEach((item, index) => {
          var _a3;
          if (item.select) {
            (_a3 = nameList[index]) == null ? void 0 : _a3.update(dataList[index]);
          }
        });
        if (!isHoverChart.current) {
          setSubK(_subK);
        }
        outOfTimeValue.current._subK = _subK;
      }
    },
    updateBollData() {
      var _a2, _b, _c, _d, _e2;
      if ((_a2 = mainIndicatorRef.current) == null ? void 0 : _a2.boll.select) {
        let _boll = {
          mid: 0,
          upper: 0,
          lower: 0
        };
        const result = calBoll(
          propsDataRef.current,
          [
            Number(((_b = mainIndicatorRef.current) == null ? void 0 : _b.boll.cur.mid).value),
            Number(((_c = mainIndicatorRef.current) == null ? void 0 : _c.boll.cur.std).value)
          ],
          priceOffset
        );
        (_e2 = (_d = mainIndicatorRef.current) == null ? void 0 : _d.boll.curLine) == null ? void 0 : _e2.forEach((item, index) => {
          var _a3;
          if (item.select) {
            const _index = Object.keys(_boll)[index];
            _boll[_index] = result[result.length - 1][_index];
            const value = result.map((_item) => {
              return {
                value: _item[_index],
                time: _item.time
              };
            }) || [];
            (_a3 = bollRef.current) == null ? void 0 : _a3[_index].update(value[value.length - 1]);
          }
        });
        if (!isHoverChart.current) {
          setBollK(_boll);
        }
        outOfTimeValue.current._boll = _boll;
      }
    },
    updateKdjData() {
      var _a2, _b, _c, _d, _e2, _f;
      if ((_a2 = subIndicatorRef.current) == null ? void 0 : _a2.kdj.select) {
        let _kdjK = {
          k: 0,
          d: 0,
          j: 0
        };
        const result = calKdj(
          propsDataRef.current,
          [
            Number(((_b = subIndicatorRef.current) == null ? void 0 : _b.kdj.cur.k).value),
            Number(((_c = subIndicatorRef.current) == null ? void 0 : _c.kdj.cur.d).value),
            Number(((_d = subIndicatorRef.current) == null ? void 0 : _d.kdj.cur.j).value)
          ],
          priceOffset
        );
        (_f = (_e2 = subIndicatorRef.current) == null ? void 0 : _e2.kdj.curLine) == null ? void 0 : _f.forEach((item, index) => {
          var _a3, _b2;
          const _index = Object.keys(_kdjK)[index];
          if (item.select) {
            _kdjK[_index] = (_a3 = result[result.length - 1]) == null ? void 0 : _a3[_index];
            const value = result.map((_item) => {
              return {
                value: _item[_index],
                time: _item.time
              };
            }) || [];
            (_b2 = kdjRef.current) == null ? void 0 : _b2[_index].update(value[value.length - 1]);
          }
        });
        if (!isHoverChart.current) {
          setKdjK(_kdjK);
        }
        outOfTimeValue.current._kdjK = _kdjK;
      }
    },
    updateRsiData() {
      var _a2, _b, _c, _d, _e2, _f, _g, _h;
      if ((_a2 = subIndicatorRef.current) == null ? void 0 : _a2.rsi.select) {
        let _rsiK = {
          r: 0,
          s: 0,
          i: 0
        };
        const result = calRsi(
          propsDataRef.current,
          [
            Number((_b = subIndicatorRef.current) == null ? void 0 : _b.rsi.cur[0].value),
            Number((_c = subIndicatorRef.current) == null ? void 0 : _c.rsi.cur[1].value),
            Number((_d = subIndicatorRef.current) == null ? void 0 : _d.rsi.cur[2].value)
          ],
          priceOffset
        );
        _rsiK.r = (_e2 = result[result.length - 1]) == null ? void 0 : _e2.r;
        _rsiK.s = (_f = result[result.length - 1]) == null ? void 0 : _f.s;
        _rsiK.i = (_g = result[result.length - 1]) == null ? void 0 : _g.i;
        (_h = subIndicatorRef.current) == null ? void 0 : _h.rsi.cur.forEach((_item, index) => {
          var _a3, _b2;
          if (_item.select) {
            const value = result.map((item) => {
              return {
                value: item[Object.keys(_rsiK)[index]],
                time: item.time
              };
            }) || [];
            (_b2 = (_a3 = rsiRef.current) == null ? void 0 : _a3[index]) == null ? void 0 : _b2.update(value[value.length - 1]);
          }
        });
        if (!isHoverChart.current) {
          setRsiK(_rsiK);
        }
        outOfTimeValue.current._rsiK = _rsiK;
      }
    },
    updateWrData() {
      var _a2, _b;
      if ((_a2 = subIndicatorRef.current) == null ? void 0 : _a2.wr.select) {
        let _wrK = [];
        (_b = subIndicatorRef.current) == null ? void 0 : _b.wr.cur.forEach((_item, index) => {
          var _a3, _b2, _c, _d;
          if (_item.select) {
            const result = calWr(
              propsDataRef.current,
              [Number((_a3 = subIndicatorRef.current) == null ? void 0 : _a3.wr.cur[index].value)],
              [
                { key: "wr1", title: "wr1" },
                { key: "wr2", title: "wr2" }
              ],
              priceOffset
            );
            _wrK.push((_b2 = result[result.length - 1]) == null ? void 0 : _b2.wr1);
            const value = result.map((item) => {
              return {
                value: item.wr1,
                time: item.time
              };
            }) || [];
            (_d = (_c = wrRef.current) == null ? void 0 : _c[index]) == null ? void 0 : _d.update(value[value.length - 1]);
          }
        });
        if (!isHoverChart.current) {
          setWrK(_wrK);
        }
        outOfTimeValue.current._wrK = _wrK;
      }
    }
  }));
  (0, import_react5.useEffect)(() => {
    const handleResize = () => {
      var _a2, _b, _c, _d, _e2, _f;
      (_c = chartRef.current) == null ? void 0 : _c.applyOptions({
        width: (_a2 = containerRef.current) == null ? void 0 : _a2.clientWidth,
        height: (_b = containerRef.current) == null ? void 0 : _b.clientHeight,
        rightPriceScale: {
          ...chartPropertySetting.rightPriceScale,
          scaleMargins: chartScaleMargins
        }
      });
      setHeightChange(new Date().valueOf());
      if ((_e2 = (_d = chartRef.current) == null ? void 0 : _d.timeScale().getVisibleRange()) == null ? void 0 : _e2.from) {
        setVisibleTimeRange((_f = chartRef.current) == null ? void 0 : _f.timeScale().getVisibleRange());
      }
    };
    window.addEventListener("resize", handleResize);
    return () => {
      window.removeEventListener("resize", handleResize);
    };
  }, []);
  (0, import_react5.useEffect)(() => {
    var _a2;
    (_a2 = chartRef.current) == null ? void 0 : _a2.applyOptions({
      ...chartPropertySetting,
      layout: {
        ...props.chartLayoutOptions
      },
      grid: {
        vertLines: {
          color: gridColor
        },
        horzLines: {
          color: gridColor
        }
      },
      rightPriceScale: {
        ...chartPropertySetting.rightPriceScale,
        scaleMargins: chartScaleMargins
      }
    });
  }, [props.chartLayoutOptions.background, props.chartLayoutOptions.textColor]);
  (0, import_react5.useEffect)(() => {
    var _a2, _b, _c, _d, _e2, _f, _g, _h, _i2, _j, _k, _l, _m, _n2, _o, _p, _q, _r, _s2, _t2, _u, _v, _w, _x, _y, _z, _A, _B, _C, _D, _E, _F, _G, _H, _I, _J, _K, _L, _M, _N, _O, _P, _Q, _R, _S, _T, _U, _V, _W, _X, _Y, _Z, __, _$, _aa, _ba, _ca, _da, _ea, _fa;
    let _ma = [];
    let _mainK = {
      ...propsDataRef.current[propsDataRef.current.length - 1],
      time: (0, import_dayjs.default)((_a2 = propsDataRef.current[propsDataRef.current.length - 1]) == null ? void 0 : _a2.time).format("YYYY/MM/DD HH:mm"),
      isUp: checkIsUp(propsDataRef.current[propsDataRef.current.length - 1]),
      chg: calcChg(propsDataRef.current[propsDataRef.current.length - 1], priceOffset),
      amp: calcAmp(propsDataRef.current[propsDataRef.current.length - 1], priceOffset)
    };
    let _subK = {
      dea: void 0,
      dif: void 0,
      macd: void 0
    };
    let _volK = {
      vol: (_b = propsDataRef.current[propsDataRef.current.length - 1]) == null ? void 0 : _b.volume,
      quoteVolume: (_c = propsDataRef.current[propsDataRef.current.length - 1]) == null ? void 0 : _c.quoteVolume,
      dir: ((_d = propsDataRef.current[propsDataRef.current.length - 1]) == null ? void 0 : _d.close) > ((_e2 = propsDataRef.current[propsDataRef.current.length - 1]) == null ? void 0 : _e2.open) ? "rise" : "fall"
    };
    let _boll = {
      mid: 0,
      upper: 0,
      lower: 0
    };
    let _kdjK = {
      k: 0,
      d: 0,
      j: 0
    };
    let _rsiK = {
      r: 0,
      s: 0,
      i: 0
    };
    let _wrK = [];
    if (chartRef.current) {
      if (!candlestickSeriesRef.current) {
        candlestickSeriesRef.current = chartRef.current.addCandlestickSeries({
          upColor: ((_f = props == null ? void 0 : props.createChart) == null ? void 0 : _f.upColor) || "#26a69a",
          downColor: ((_g = props == null ? void 0 : props.createChart) == null ? void 0 : _g.downColor) || "#ef5350",
          borderVisible: false,
          wickUpColor: ((_h = props == null ? void 0 : props.createChart) == null ? void 0 : _h.upColor) || "#26a69a",
          wickDownColor: ((_i2 = props == null ? void 0 : props.createChart) == null ? void 0 : _i2.downColor) || "#ef5350",
          ...chartPriceLineProperty,
          lastValueVisible: true,
          priceFormat: {
            minMove: 1 / 10 ** priceOffset
          }
        });
      }
      (_j = smaLineRef.current) == null ? void 0 : _j.forEach((item) => {
        item.setData([]);
      });
      (_k = timeLineRef.current) == null ? void 0 : _k.setData([]);
      (_l = bollRef.current) == null ? void 0 : _l.lower.setData([]);
      (_m = bollRef.current) == null ? void 0 : _m.mid.setData([]);
      (_n2 = bollRef.current) == null ? void 0 : _n2.upper.setData([]);
      (_o = difRef.current) == null ? void 0 : _o.setData([]);
      (_p = deaRef.current) == null ? void 0 : _p.setData([]);
      (_q = volumeSeriesRef.current) == null ? void 0 : _q.setData([]);
      (_r = macdVolumeSeriesRef.current) == null ? void 0 : _r.setData([]);
      (_s2 = kdjRef.current) == null ? void 0 : _s2.k.setData([]);
      (_t2 = kdjRef.current) == null ? void 0 : _t2.d.setData([]);
      (_u = kdjRef.current) == null ? void 0 : _u.j.setData([]);
      (_v = rsiRef.current) == null ? void 0 : _v.forEach((item) => {
        item.setData([]);
      });
      (_w = wrRef.current) == null ? void 0 : _w.forEach((item) => {
        item.setData([]);
      });
      markersRef.current = getMarkers(ordersKlineData, propsDataRef, props.createChart);
      buyMarkersRef.current = getBuyMarkers(ordersData, propsDataRef, props.createChart);
      if (props.curTime.unit === "time" || props.curTime.unit === "s") {
        if (!timeLineRef.current) {
          timeLineRef.current = (_x = chartRef.current) == null ? void 0 : _x.addLineSeries({
            color: props.createChart.brandColor,
            lineWidth: 1,
            lineStyle: d.Solid,
            ...chartPriceLineProperty,
            lastValueVisible: true
          });
        }
        timeLineRef.current.setData(
          propsDataRef.current.map((item) => {
            return {
              ...item,
              value: item.close
            };
          })
        );
        candlestickSeriesRef.current.setData([]);
        ((_y = markersRef.current) == null ? void 0 : _y.length) && timeLineRef.current.setMarkers(markersRef.current);
        const oldData = ((_A = (_z = timeLineRef.current) == null ? void 0 : _z.markers()) == null ? void 0 : _A.filter((item) => {
          var _a3, _b2;
          return ((_a3 = item.id) == null ? void 0 : _a3.toString()) === "1" || ((_b2 = item.id) == null ? void 0 : _b2.toString()) === "2";
        })) || [];
        const preData = ((_C = (_B = timeLineRef.current) == null ? void 0 : _B.markers()) == null ? void 0 : _C.filter((item) => {
          var _a3, _b2;
          return ((_a3 = item.id) == null ? void 0 : _a3.toString()) !== "1" && ((_b2 = item.id) == null ? void 0 : _b2.toString()) !== "2";
        })) || [];
        const newList = [];
        preData == null ? void 0 : preData.forEach((item) => {
          var _a3;
          (_a3 = buyMarkersRef.current) == null ? void 0 : _a3.forEach((_item) => {
            var _a4, _b2, _c2, _d2, _e3;
            if (item.id === _item.id && item.statusCd === tradeStatus.processing && _item.statusCd === tradeStatus.complete) {
              const val = (_c2 = (_b2 = (_a4 = propsDataRef.current) == null ? void 0 : _a4.filter((childItem) => {
                return childItem.time === _item.time;
              })) == null ? void 0 : _b2[0]) == null ? void 0 : _c2.close;
              if (val) {
                const y2 = (_d2 = timeLineRef.current) == null ? void 0 : _d2.priceToCoordinate(val);
                const x2 = (_e3 = chartRef.current) == null ? void 0 : _e3.timeScale().timeToCoordinate(_item.time);
                if (x2 && y2) {
                  newList.push({
                    ..._item,
                    x: x2,
                    y: y2
                  });
                }
              }
            }
          });
        });
        if (newList == null ? void 0 : newList.length) {
          setTradeStatusOverList(
            newList.map((item) => {
              return {
                ...item,
                loading: true
              };
            })
          );
          (_G = timeLineRef.current) == null ? void 0 : _G.setMarkers(
            (_F = (_E = oldData.concat(
              ((_D = buyMarkersRef.current) == null ? void 0 : _D.filter((item) => {
                return item.id !== newList[0].id;
              })) || []
            )) == null ? void 0 : _E.sort) == null ? void 0 : _F.call(_E, (a2, b2) => {
              return Number(a2.time) - Number(b2.time);
            })
          );
          setTimeout(() => {
            setTradeStatusOverList(newList);
            setTimeout(() => {
              var _a3, _b2, _c2;
              setTradeStatusOverList([]);
              (_c2 = timeLineRef.current) == null ? void 0 : _c2.setMarkers(
                (_b2 = (_a3 = oldData.concat(buyMarkersRef.current)) == null ? void 0 : _a3.sort) == null ? void 0 : _b2.call(_a3, (a2, b2) => {
                  return Number(a2.time) - Number(b2.time);
                })
              );
            }, 1e3);
          }, 500);
        } else {
          timeLineRef.current.setMarkers(
            (_I = (_H = oldData.concat(buyMarkersRef.current)) == null ? void 0 : _H.sort) == null ? void 0 : _I.call(_H, (a2, b2) => {
              return Number(a2.time) - Number(b2.time);
            })
          );
        }
      } else {
        candlestickSeriesRef.current.setData(propsDataRef.current);
        ((_J = markersRef.current) == null ? void 0 : _J.length) && candlestickSeriesRef.current.setMarkers(markersRef.current);
        const oldData = ((_L = (_K = candlestickSeriesRef.current) == null ? void 0 : _K.markers()) == null ? void 0 : _L.filter((item) => {
          var _a3, _b2;
          return ((_a3 = item.id) == null ? void 0 : _a3.toString()) === "1" || ((_b2 = item.id) == null ? void 0 : _b2.toString()) === "2";
        })) || [];
        candlestickSeriesRef.current.setMarkers(
          (_N = (_M = oldData.concat(buyMarkersRef.current)) == null ? void 0 : _M.sort) == null ? void 0 : _N.call(_M, (a2, b2) => {
            return Number(a2.time) - Number(b2.time);
          })
        );
      }
      if (mainIndicator.boll.select) {
        if (!bollRef.current) {
          bollRef.current = {
            mid: (_O = chartRef.current) == null ? void 0 : _O.addLineSeries({
              color: mainIndicator.ma.cur[0].color,
              lineWidth: 1,
              lineStyle: d.Solid,
              ...chartPriceLineProperty
            }),
            upper: (_P = chartRef.current) == null ? void 0 : _P.addLineSeries({
              color: mainIndicator.ma.cur[1].color,
              lineWidth: 1,
              lineStyle: d.Solid,
              ...chartPriceLineProperty
            }),
            lower: (_Q = chartRef.current) == null ? void 0 : _Q.addLineSeries({
              color: mainIndicator.ma.cur[2].color,
              lineWidth: 1,
              lineStyle: d.Solid,
              ...chartPriceLineProperty
            })
          };
        }
        const result = calBoll(
          propsDataRef.current,
          [
            Number(mainIndicator.boll.cur.mid.value),
            Number(mainIndicator.boll.cur.std.value)
          ],
          priceOffset
        );
        (_R = mainIndicator.boll.curLine) == null ? void 0 : _R.forEach((item, index) => {
          var _a3;
          if (item.select) {
            const _index = Object.keys(_boll)[index];
            _boll[_index] = result[result.length - 1][_index];
            (_a3 = bollRef.current) == null ? void 0 : _a3[_index].setData(
              result.map((_item) => {
                return {
                  value: _item[_index],
                  time: _item.time
                };
              })
            );
          }
        });
      }
      if (mainIndicator.ma.select) {
        if (!smaLineRef.current) {
          const smaLineList = [];
          mainIndicator.ma.cur.forEach((item) => {
            var _a3;
            const value = (_a3 = chartRef.current) == null ? void 0 : _a3.addLineSeries({
              color: item.color,
              lineWidth: 1,
              lineStyle: d.Solid,
              ...chartPriceLineProperty
            });
            smaLineList.push(value);
          });
          smaLineRef.current = smaLineList;
        }
        mainIndicator.ma.cur.forEach((item, index) => {
          var _a3, _b2, _c2;
          if (item.select) {
            const { strip, type } = item;
            let smaData = calculateSMA(propsDataRef.current, Number(strip), type, priceOffset);
            _ma.push((_a3 = smaData[smaData.length - 1]) == null ? void 0 : _a3.value);
            (_c2 = (_b2 = smaLineRef.current) == null ? void 0 : _b2[index]) == null ? void 0 : _c2.setData(smaData);
          }
        });
      }
      if ((_S = subIndicator.vol) == null ? void 0 : _S.select) {
        if (!volumeSeriesRef.current) {
          volumeSeriesRef.current = (_T = chartRef.current) == null ? void 0 : _T.addHistogramSeries({
            color: props.createChart.upColor,
            priceFormat: {
              type: "price"
            },
            priceScaleId: "vol",
            ...chartPriceLineProperty
          });
        }
        volumeSeriesRef.current.setData(
          propsDataRef.current.map((item) => {
            return {
              time: item.time,
              value: item.volume,
              color: getColorOfSetting(item.close, item.open)
            };
          })
        );
      }
      if (subIndicator.macd.select) {
        const fast = subIndicator.macd.cur.fast.value;
        const slow = subIndicator.macd.cur.slow.value;
        const signal = subIndicator.macd.cur.signal.value;
        const newData = calculateMACD(propsDataRef.current, Number(fast), Number(slow), Number(signal), priceOffset);
        _subK.dif = (_U = newData[newData.length - 1]) == null ? void 0 : _U.dif;
        _subK.dea = (_V = newData[newData.length - 1]) == null ? void 0 : _V.dea;
        _subK.macd = (_W = newData[newData.length - 1]) == null ? void 0 : _W.value;
        const difData = newData.map((item) => {
          return {
            time: item.time,
            value: item.dif
          };
        });
        const deaData = newData.map((item) => {
          return {
            time: item.time,
            value: item.dea
          };
        });
        const macdData = newData.map((item) => {
          return {
            time: item == null ? void 0 : item.time,
            value: item == null ? void 0 : item.value,
            color: getColorOfSetting(item == null ? void 0 : item.value, 0)
          };
        });
        const subLineConfig = {
          color: props.createChart.brandColor,
          lineWidth: 1,
          lineStyle: d.Solid,
          priceScaleId: "volume",
          scaleMargins: macdScaleMargins,
          ...chartPriceLineProperty
        };
        if (!difRef.current) {
          difRef.current = (_X = chartRef.current) == null ? void 0 : _X.addLineSeries({
            ...subLineConfig,
            color: "#9660c4"
          });
        }
        if (!deaRef.current) {
          deaRef.current = (_Y = chartRef.current) == null ? void 0 : _Y.addLineSeries({
            ...subLineConfig,
            color: "#84aad5"
          });
        }
        if (!macdVolumeSeriesRef.current) {
          macdVolumeSeriesRef.current = (_Z = chartRef.current) == null ? void 0 : _Z.addHistogramSeries({
            color: props.createChart.upColor,
            priceFormat: {
              type: "price"
            },
            priceScaleId: "volume",
            ...chartPriceLineProperty
          });
        }
        const nameList = [difRef.current, deaRef.current, macdVolumeSeriesRef.current];
        const dataList = [difData, deaData, macdData];
        (__ = subIndicator.macd.curLine) == null ? void 0 : __.forEach((item, index) => {
          if (item.select) {
            nameList[index].setData(dataList[index]);
          }
        });
      }
      if (subIndicator.kdj.select) {
        if (!kdjRef.current) {
          kdjRef.current = {
            k: (_$ = chartRef.current) == null ? void 0 : _$.addLineSeries({
              color: mainIndicator.ma.cur[0].color,
              lineWidth: 1,
              lineStyle: d.Solid,
              priceScaleId: "kdj",
              ...chartPriceLineProperty
            }),
            d: (_aa = chartRef.current) == null ? void 0 : _aa.addLineSeries({
              color: mainIndicator.ma.cur[1].color,
              lineWidth: 1,
              lineStyle: d.Solid,
              priceScaleId: "kdj",
              ...chartPriceLineProperty
            }),
            j: (_ba = chartRef.current) == null ? void 0 : _ba.addLineSeries({
              color: mainIndicator.ma.cur[2].color,
              lineWidth: 1,
              lineStyle: d.Solid,
              priceScaleId: "kdj",
              ...chartPriceLineProperty
            })
          };
        }
        const result = calKdj(
          propsDataRef.current,
          [
            Number(subIndicator.kdj.cur.k.value),
            Number(subIndicator.kdj.cur.d.value),
            Number(subIndicator.kdj.cur.j.value)
          ],
          priceOffset
        );
        (_ca = subIndicator.kdj.curLine) == null ? void 0 : _ca.forEach((item, index) => {
          var _a3, _b2;
          const _index = Object.keys(_kdjK)[index];
          if (item.select) {
            _kdjK[_index] = (_a3 = result[result.length - 1]) == null ? void 0 : _a3[_index];
            (_b2 = kdjRef.current) == null ? void 0 : _b2[_index].setData(
              result.map((_item) => {
                return {
                  value: _item[_index],
                  time: _item.time
                };
              })
            );
          }
        });
      }
      if (subIndicator.rsi.select) {
        if (!rsiRef.current) {
          const rsiList = [];
          subIndicator.rsi.cur.forEach((item) => {
            var _a3;
            rsiList.push(
              (_a3 = chartRef.current) == null ? void 0 : _a3.addLineSeries({
                color: item.color,
                lineWidth: 1,
                lineStyle: d.Solid,
                priceScaleId: "rsi",
                ...chartPriceLineProperty
              })
            );
          });
          rsiRef.current = rsiList;
        }
        const result = calRsi(
          propsDataRef.current,
          [
            Number(subIndicator.rsi.cur[0].value),
            Number(subIndicator.rsi.cur[1].value),
            Number(subIndicator.rsi.cur[2].value)
          ],
          priceOffset
        );
        _rsiK.r = (_da = result[result.length - 1]) == null ? void 0 : _da.r;
        _rsiK.s = (_ea = result[result.length - 1]) == null ? void 0 : _ea.s;
        _rsiK.i = (_fa = result[result.length - 1]) == null ? void 0 : _fa.i;
        subIndicator.rsi.cur.forEach((_item, index) => {
          var _a3, _b2;
          if (_item.select) {
            (_b2 = (_a3 = rsiRef.current) == null ? void 0 : _a3[index]) == null ? void 0 : _b2.setData(
              result.map((item) => {
                return {
                  value: item[Object.keys(_rsiK)[index]],
                  time: item.time
                };
              })
            );
          }
        });
      }
      if (subIndicator.wr.select) {
        if (!wrRef.current) {
          const wrList = [];
          subIndicator.wr.cur.forEach((item) => {
            var _a3;
            wrList.push(
              (_a3 = chartRef.current) == null ? void 0 : _a3.addLineSeries({
                color: item.color,
                lineWidth: 1,
                lineStyle: d.Solid,
                priceScaleId: "wr",
                ...chartPriceLineProperty
              })
            );
          });
          wrRef.current = wrList;
        }
        subIndicator.wr.cur.forEach((_item, index) => {
          var _a3, _b2, _c2;
          const result = calWr(
            propsDataRef.current,
            [Number(subIndicator.wr.cur[index].value)],
            [
              { key: "wr1", title: "wr1" },
              { key: "wr2", title: "wr2" }
            ],
            priceOffset
          );
          _wrK.push((_a3 = result[result.length - 1]) == null ? void 0 : _a3.wr1);
          if (_item.select) {
            (_c2 = (_b2 = wrRef.current) == null ? void 0 : _b2[index]) == null ? void 0 : _c2.setData(
              result.map((item) => {
                return {
                  value: item.wr1,
                  time: item.time
                };
              })
            );
          }
        });
      }
      setMaIndicator(_ma);
      setMainK(_mainK);
      setSubK(_subK);
      setBollK(_boll);
      setKdjK(_kdjK);
      setRsiK(_rsiK);
      setWrK(_wrK);
      setVolume(_volK);
      outOfTimeValue.current = {
        _ma,
        _mainK,
        _subK,
        _boll,
        _kdjK,
        _rsiK,
        _wrK,
        _volK
      };
    }
  }, [mainIndicator, subIndicator, chartRef.current, ordersKlineData, ordersData, props.getDataAndUpdateChart, colors]);
  (0, import_react5.useEffect)(() => {
    var _a2, _b, _c, _d;
    if (candlestickSeriesRef.current) {
      candlestickSeriesRef.current.applyOptions({
        upColor: ((_a2 = props == null ? void 0 : props.createChart) == null ? void 0 : _a2.upColor) || "#26a69a",
        downColor: ((_b = props == null ? void 0 : props.createChart) == null ? void 0 : _b.downColor) || "#ef5350",
        wickUpColor: ((_c = props == null ? void 0 : props.createChart) == null ? void 0 : _c.upColor) || "#26a69a",
        wickDownColor: ((_d = props == null ? void 0 : props.createChart) == null ? void 0 : _d.downColor) || "#ef5350"
      });
      candlestickSeriesRef.current.priceScale().applyOptions({
        scaleMargins: chartScaleMargins
      });
    }
    if (timeLineRef.current) {
      timeLineRef.current.priceScale().applyOptions({
        scaleMargins: chartScaleMargins
      });
    }
    if (smaLineRef.current) {
      smaLineRef.current.forEach((item) => {
        item.priceScale().applyOptions({
          scaleMargins: chartScaleMargins
        });
      });
    }
    if (difRef.current) {
      difRef.current.priceScale().applyOptions({
        scaleMargins: macdScaleMargins
      });
    }
    if (deaRef.current) {
      deaRef.current.priceScale().applyOptions({
        scaleMargins: macdScaleMargins
      });
    }
    if (macdVolumeSeriesRef.current) {
      macdVolumeSeriesRef.current.priceScale().applyOptions({
        scaleMargins: macdScaleMargins
      });
    }
    if (volumeSeriesRef.current) {
      volumeSeriesRef.current.priceScale().applyOptions({
        scaleMargins: volScaleMargins
      });
    }
    if (bollRef.current) {
      bollRef.current.mid.priceScale().applyOptions({
        scaleMargins: chartScaleMargins
      });
      bollRef.current.upper.priceScale().applyOptions({
        scaleMargins: chartScaleMargins
      });
      bollRef.current.lower.priceScale().applyOptions({
        scaleMargins: chartScaleMargins
      });
    }
    if (kdjRef.current) {
      kdjRef.current.k.priceScale().applyOptions({
        scaleMargins: kdjScaleMargins
      });
      kdjRef.current.d.priceScale().applyOptions({
        scaleMargins: kdjScaleMargins
      });
      kdjRef.current.j.priceScale().applyOptions({
        scaleMargins: kdjScaleMargins
      });
    }
    if (rsiRef.current) {
      rsiRef.current.forEach((item) => {
        item.priceScale().applyOptions({
          scaleMargins: rsiScaleMargins
        });
      });
    }
    if (wrRef.current) {
      wrRef.current.forEach((item) => {
        item.priceScale().applyOptions({
          scaleMargins: wrScaleMargins
        });
      });
    }
  }, [heightChange, subIndicator, colors]);
  const [expand, setExpand] = (0, import_react5.useState)({
    mainK: true,
    vol: true,
    ma: true,
    boll: true,
    macd: true,
    kdj: true,
    rsi: true,
    wr: true
  });
  const expandClick = (key) => {
    setExpand({
      ...expand,
      [key]: !expand[key]
    });
  };
  const showOrderDetail = (type, e3) => {
    e3.stopPropagation();
    if (type === "buy") {
      setTableData(curMarkers == null ? void 0 : curMarkers.buyData);
    } else {
      setTableData(curMarkers == null ? void 0 : curMarkers.sellData);
    }
    setModalVisible(true);
  };
  return import_react5.default.createElement(
    k_line_render_default,
    {
      curTime: props.curTime,
      mainIndicator,
      subIndicator,
      createChart: props.createChart,
      locale: props.locale,
      ordersKlineData,
      expandIcon: props.expandIcon,
      expand,
      expandClick,
      mainK,
      maIndicator,
      bollK,
      macdScaleMargins,
      subK,
      volume,
      kdjScaleMargins,
      kdjK,
      rsiScaleMargins,
      rsiK,
      wrScaleMargins,
      containerRef,
      curMaxAndMinPoint,
      curBuyAndSellPoint,
      wrK,
      modalVisible,
      setModalVisible,
      tableData,
      popVisible,
      curMarkers,
      showOrderDetail,
      volScaleMargins,
      coinInfo: props.coinInfo,
      priceOffset,
      chartSettingIcon,
      allChartRef: {
        candlestickSeriesRef: candlestickSeriesRef.current,
        timeLineRef: timeLineRef.current,
        smaLineRef: smaLineRef.current,
        difRef: difRef.current,
        deaRef: deaRef.current,
        macdVolumeSeriesRef: macdVolumeSeriesRef.current,
        volumeSeriesRef: volumeSeriesRef.current,
        bollRef: bollRef.current,
        kdjRef: kdjRef.current,
        rsiRef: rsiRef.current,
        wrRef: wrRef.current
      },
      updateMainIndicator: props.updateMainIndicator,
      updateSubIndicator: props.updateSubIndicator,
      modalRef: props.modalRef,
      optionBuyCallback,
      optionSellCallback,
      optionIcon,
      optionActiveTab,
      countDownComponent,
      tradeRestSecond,
      tradeStatusOverList,
      optionAnimation
    }
  );
}
var k_line_chart_default = (0, import_react5.forwardRef)(KLineChart);

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/k-line/tradingview.tsx
var import_react6 = __toESM(require_react());

// node_modules/.pnpm/@nbit+tradingview@1.1.0-beta.3/node_modules/@nbit/tradingview/lib/charting_library.esm.js
function e2(t2, i2) {
  const n2 = Object.assign({}, t2);
  for (const o3 in i2)
    "object" != typeof t2[o3] || null === t2[o3] || Array.isArray(t2[o3]) ? void 0 !== i2[o3] && (n2[o3] = i2[o3]) : n2[o3] = e2(t2[o3], i2[o3]);
  return n2;
}
var t = { mobile: { disabled_features: ["left_toolbar", "header_widget", "timeframes_toolbar", "edit_buttons_in_legend", "context_menus", "control_bar", "border_around_the_chart"], enabled_features: [] } };
var i = { width: 800, height: 500, interval: "1D", timezone: "Etc/UTC", container: "", library_path: "", locale: "en", widgetbar: { details: false, watchlist: false, watchlist_settings: { default_symbols: [] } }, overrides: { "mainSeriesProperties.showCountdown": false }, studies_overrides: {}, trading_customization: { position: {}, order: {} }, brokerConfig: { configFlags: {} }, fullscreen: false, autosize: false, disabled_features: [], enabled_features: [], debug: false, logo: {}, time_frames: [{ text: "5y", resolution: "1W" }, { text: "1y", resolution: "1W" }, { text: "6m", resolution: "120" }, { text: "3m", resolution: "60" }, { text: "1m", resolution: "30" }, { text: "5d", resolution: "5" }, { text: "1d", resolution: "1" }], client_id: "0", user_id: "0", charts_storage_api_version: "1.0", favorites: { intervals: [], chartTypes: [] } };
function n() {
  return "CL v20.033 (internal id 9df149da @ 2021-11-17T10:20:51.511Z)";
}
var o2 = class {
  constructor(n2) {
    if (this._id = `tradingview_${(1048576 * (1 + Math.random()) | 0).toString(16).substring(1)}`, this._ready = false, this._readyHandlers = [], this._onWindowResize = this._autoResizeChart.bind(this), !n2.datafeed)
      throw new Error("Datafeed is not defined");
    if (this._options = e2(i, n2), n2.preset) {
      const e3 = t[n2.preset];
      e3 ? (void 0 !== this._options.disabled_features ? this._options.disabled_features = this._options.disabled_features.concat(e3.disabled_features) : this._options.disabled_features = e3.disabled_features, void 0 !== this._options.enabled_features ? this._options.enabled_features = this._options.enabled_features.concat(e3.enabled_features) : this._options.enabled_features = e3.enabled_features) : console.warn("Unknown preset: `" + n2.preset + "`");
    }
    "Dark" === this._options.theme && void 0 === this._options.loading_screen && (this._options.loading_screen = { backgroundColor: "#131722" }), this._create();
  }
  onChartReady(e3) {
    this._ready ? e3.call(this) : this._readyHandlers.push(e3);
  }
  headerReady() {
    return this._innerWindowLoaded.then(() => this._innerWindow().headerReady());
  }
  onGrayedObjectClicked(e3) {
    this._innerAPI().onGrayedObjectClicked(e3);
  }
  onShortcut(e3, t2) {
    this._innerWindow().createShortcutAction(e3, t2);
  }
  subscribe(e3, t2) {
    this._innerAPI().subscribe(e3, t2);
  }
  unsubscribe(e3, t2) {
    this._innerAPI().unsubscribe(e3, t2);
  }
  chart(e3) {
    return this._innerAPI().chart(e3);
  }
  getLanguage() {
    return this._options.locale;
  }
  setSymbol(e3, t2, i2) {
    this._innerAPI().changeSymbol(e3, t2, i2);
  }
  remove() {
    window.removeEventListener("resize", this._onWindowResize), this._readyHandlers.splice(0, this._readyHandlers.length), delete window[this._id], this._iFrame.parentNode && this._iFrame.parentNode.removeChild(this._iFrame);
  }
  closePopupsAndDialogs() {
    this._innerAPI().closePopupsAndDialogs();
  }
  selectLineTool(e3) {
    this._innerAPI().selectLineTool(e3);
  }
  selectedLineTool() {
    return this._innerAPI().selectedLineTool();
  }
  save(e3) {
    this._innerAPI().saveChart(e3);
  }
  load(e3, t2) {
    this._innerAPI().loadChart({ json: e3, extendedData: t2 });
  }
  getSavedCharts(e3) {
    this._innerAPI().getSavedCharts(e3);
  }
  loadChartFromServer(e3) {
    this._innerAPI().loadChartFromServer(e3);
  }
  saveChartToServer(e3, t2, i2) {
    this._innerAPI().saveChartToServer(e3, t2, i2);
  }
  removeChartFromServer(e3, t2) {
    this._innerAPI().removeChartFromServer(e3, t2);
  }
  onContextMenu(e3) {
    this._innerAPI().onContextMenu(e3);
  }
  createButton(e3) {
    return this._innerWindow().createButton(e3);
  }
  showNoticeDialog(e3) {
    this._innerAPI().showNoticeDialog(e3);
  }
  showConfirmDialog(e3) {
    this._innerAPI().showConfirmDialog(e3);
  }
  showLoadChartDialog() {
    this._innerAPI().showLoadChartDialog();
  }
  showSaveAsChartDialog() {
    this._innerAPI().showSaveAsChartDialog();
  }
  symbolInterval() {
    return this._innerAPI().getSymbolInterval();
  }
  mainSeriesPriceFormatter() {
    return this._innerAPI().mainSeriesPriceFormatter();
  }
  getIntervals() {
    return this._innerAPI().getIntervals();
  }
  getStudiesList() {
    return this._innerAPI().getStudiesList();
  }
  addCustomCSSFile(e3) {
    this._innerWindow().addCustomCSSFile(e3);
  }
  applyOverrides(t2) {
    this._options = e2(this._options, { overrides: t2 }), this._innerWindow().applyOverrides(t2);
  }
  applyStudiesOverrides(e3) {
    this._innerWindow().applyStudiesOverrides(e3);
  }
  watchList() {
    return this._innerAPI().watchlist();
  }
  activeChart() {
    return this._innerAPI().activeChart();
  }
  chartsCount() {
    return this._innerAPI().chartsCount();
  }
  layout() {
    return this._innerAPI().layout();
  }
  setLayout(e3) {
    this._innerAPI().setLayout(e3);
  }
  layoutName() {
    return this._innerAPI().layoutName();
  }
  changeTheme(e3, t2) {
    this._innerWindow().changeTheme(e3, t2);
  }
  getTheme() {
    return this._innerWindow().getTheme();
  }
  takeScreenshot() {
    this._innerAPI().takeScreenshot();
  }
  lockAllDrawingTools() {
    return this._innerAPI().lockAllDrawingTools();
  }
  hideAllDrawingTools() {
    return this._innerAPI().hideAllDrawingTools();
  }
  drawOnAllCharts(e3) {
    this._innerAPI().drawOnAllCharts(e3);
  }
  magnetEnabled() {
    return this._innerAPI().magnetEnabled();
  }
  magnetMode() {
    return this._innerAPI().magnetMode();
  }
  undoRedoState() {
    return this._innerAPI().undoRedoState();
  }
  setIntervalLinkingEnabled(e3) {
    this._innerAPI().setIntervalLinkingEnabled(e3);
  }
  setTimeFrame(e3) {
    this._innerAPI().setTimeFrame(e3);
  }
  symbolSync() {
    return this._innerAPI().symbolSync();
  }
  intervalSync() {
    return this._innerAPI().intervalSync();
  }
  crosshairSync() {
    return this._innerAPI().crosshairSync();
  }
  timeSync() {
    return this._innerAPI().timeSync();
  }
  getAllFeatures() {
    return this._innerWindow().getAllFeatures();
  }
  clearUndoHistory() {
    return this._innerAPI().clearUndoHistory();
  }
  undo() {
    return this._innerAPI().undo();
  }
  redo() {
    return this._innerAPI().redo();
  }
  startFullscreen() {
    this._innerAPI().startFullscreen();
  }
  exitFullscreen() {
    this._innerAPI().exitFullscreen();
  }
  takeClientScreenshot(e3) {
    return this._innerAPI().takeClientScreenshot(e3);
  }
  _innerAPI() {
    return this._innerWindow().tradingViewApi;
  }
  _innerWindow() {
    return this._iFrame.contentWindow;
  }
  _autoResizeChart() {
    this._options.fullscreen && (this._iFrame.style.height = window.innerHeight + "px");
  }
  _create() {
    const e3 = this._render();
    this._options.container_id && console.warn("`container_id` is now deprecated. Please use `container` instead to either still pass a string or an `HTMLElement`.");
    const t2 = this._options.container_id || this._options.container, i2 = "string" == typeof t2 ? document.getElementById(t2) : t2;
    if (null === i2)
      throw new Error(`There is no such element - #${this._options.container}`);
    i2.innerHTML = e3, this._iFrame = i2.querySelector(`#${this._id}`);
    const n2 = this._iFrame;
    (this._options.autosize || this._options.fullscreen) && (n2.style.width = "100%", this._options.fullscreen || (n2.style.height = "100%")), window.addEventListener("resize", this._onWindowResize), this._onWindowResize(), this._innerWindowLoaded = new Promise((e4) => {
      const t3 = () => {
        n2.removeEventListener("load", t3, false), e4();
      };
      n2.addEventListener("load", t3, false);
    }), this._innerWindowLoaded.then(() => {
      this._innerWindow().widgetReady(() => {
        this._ready = true;
        for (const t3 of this._readyHandlers)
          try {
            t3.call(this);
          } catch (e4) {
            console.error(e4);
          }
        this._innerWindow().initializationFinished();
      });
    });
  }
  _render() {
    const e3 = window;
    if (e3[this._id] = { datafeed: this._options.datafeed, customFormatters: this._options.custom_formatters || this._options.customFormatters, brokerFactory: this._options.broker_factory || this._options.brokerFactory, overrides: this._options.overrides, studiesOverrides: this._options.studies_overrides, tradingCustomization: this._options.trading_customization, disabledFeatures: this._options.disabled_features, enabledFeatures: this._options.enabled_features, brokerConfig: this._options.broker_config || this._options.brokerConfig, restConfig: this._options.restConfig, favorites: this._options.favorites, logo: this._options.logo, numeric_formatting: this._options.numeric_formatting, rss_news_feed: this._options.rss_news_feed, newsProvider: this._options.news_provider, loadLastChart: this._options.load_last_chart, saveLoadAdapter: this._options.save_load_adapter, loading_screen: this._options.loading_screen, settingsAdapter: this._options.settings_adapter, getCustomIndicators: this._options.custom_indicators_getter, additionalSymbolInfoFields: this._options.additional_symbol_info_fields, headerWidgetButtonsMode: this._options.header_widget_buttons_mode }, this._options.saved_data)
      e3[this._id].chartContent = { json: this._options.saved_data }, this._options.saved_data_meta_info && (e3[this._id].chartContentExtendedData = this._options.saved_data_meta_info);
    else if (!this._options.load_last_chart && !this._options.symbol)
      throw new Error("Symbol is not defined: either 'symbol' or 'load_last_chart' option must be set");
    const t2 = (this._options.library_path || "") + `${encodeURIComponent(this._options.locale)}-tv-chart.9df149da.html#symbol=` + encodeURIComponent(this._options.symbol || "") + "&interval=" + encodeURIComponent(this._options.interval) + (this._options.timeframe ? "&timeframe=" + encodeURIComponent(this._options.timeframe) : "") + (this._options.toolbar_bg ? "&toolbarbg=" + encodeURIComponent(this._options.toolbar_bg.replace("#", "")) : "") + (this._options.studies_access ? "&studiesAccess=" + encodeURIComponent(JSON.stringify(this._options.studies_access)) : "") + "&widgetbar=" + encodeURIComponent(JSON.stringify(this._options.widgetbar)) + (this._options.drawings_access ? "&drawingsAccess=" + encodeURIComponent(JSON.stringify(this._options.drawings_access)) : "") + "&timeFrames=" + encodeURIComponent(JSON.stringify(this._options.time_frames)) + "&locale=" + encodeURIComponent(this._options.locale) + "&uid=" + encodeURIComponent(this._id) + "&clientId=" + encodeURIComponent(String(this._options.client_id)) + "&userId=" + encodeURIComponent(String(this._options.user_id)) + (this._options.charts_storage_url ? "&chartsStorageUrl=" + encodeURIComponent(this._options.charts_storage_url) : "") + (this._options.charts_storage_api_version ? "&chartsStorageVer=" + encodeURIComponent(this._options.charts_storage_api_version) : "") + (this._options.custom_css_url ? "&customCSS=" + encodeURIComponent(this._options.custom_css_url) : "") + (this._options.auto_save_delay ? "&autoSaveDelay=" + encodeURIComponent(String(this._options.auto_save_delay)) : "") + "&debug=" + encodeURIComponent(String(this._options.debug)) + (this._options.snapshot_url ? "&snapshotUrl=" + encodeURIComponent(this._options.snapshot_url) : "") + (this._options.timezone ? "&timezone=" + encodeURIComponent(this._options.timezone) : "") + (this._options.study_count_limit ? "&studyCountLimit=" + encodeURIComponent(String(this._options.study_count_limit)) : "") + (this._options.symbol_search_request_delay ? "&ssreqdelay=" + encodeURIComponent(String(this._options.symbol_search_request_delay)) : "") + (this._options.compare_symbols ? "&compareSymbols=" + encodeURIComponent(JSON.stringify(this._options.compare_symbols)) : "") + (this._options.theme ? "&theme=" + encodeURIComponent(String(this._options.theme)) : "") + (this._options.header_widget_buttons_mode ? "&header_widget_buttons_mode=" + encodeURIComponent(String(this._options.header_widget_buttons_mode)) : "") + (this._options.time_scale ? "&time_scale=" + encodeURIComponent(JSON.stringify(this._options.time_scale)) : "");
    return '<iframe id="' + this._id + '" name="' + this._id + '"  src="' + t2 + '"' + (this._options.autosize || this._options.fullscreen ? "" : ' width="' + this._options.width + '" height="' + this._options.height + '"') + ' title="Financial Chart" frameborder="0" allowTransparency="true" scrolling="no" allowfullscreen style="display:block;"></iframe>';
  }
};
window.TradingView = window.TradingView || {}, window.TradingView.version = n;

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/k-line/coin-datafeed.ts
var baseMarketStore;
var getKlineHistory;
var datafeedsFun = function(store, method) {
  baseMarketStore = store;
  getKlineHistory = method;
};
var Datafeeds = {
  UDFCompatibleDatafeed: datafeedsFun
};
Datafeeds.UDFCompatibleDatafeed = datafeedsFun;
function getDecimal() {
  let decimal = 2;
  let currentObject = baseMarketStore.getState().currentCoin;
  if (currentObject && currentObject.digit && currentObject.digit.indexOf("#") !== -1) {
    let digit = currentObject.digit.split("#");
    decimal = Number(digit[0]);
  }
  let str = "1";
  if (decimal > 0) {
    for (let i2 = 1; i2 <= decimal; i2 += 1) {
      str += "0";
    }
  }
  return parseInt(str);
}
function defaultConfig() {
  return {
    supports_search: false,
    supports_group_request: false,
    supports_marks: false,
    supports_timescale_marks: false,
    supports_time: true,
    exchanges: [
      {
        value: "",
        name: "All Exchanges",
        desc: ""
      },
      {
        value: "NasdaqNM",
        name: "NasdaqNM",
        desc: "NasdaqNM"
      },
      {
        value: "NYSE",
        name: "NYSE",
        desc: "NYSE"
      },
      {
        value: "NCM",
        name: "NCM",
        desc: "NCM"
      },
      {
        value: "NGM",
        name: "NGM",
        desc: "NGM"
      }
    ],
    symbols_types: [
      {
        name: "All types",
        value: ""
      },
      {
        name: "Stock",
        value: ""
      },
      {
        name: "Index",
        value: ""
      }
    ],
    supported_resolutions: [
      "1",
      "3",
      "5",
      "15",
      "30",
      "60",
      "120",
      "240",
      "360",
      "480",
      "720",
      "1440",
      "4320",
      "10080",
      "43200",
      "129600",
      "259200",
      "518400"
    ]
  };
}
Datafeeds.UDFCompatibleDatafeed.prototype.onReady = function(callback) {
  setTimeout(function() {
    callback(defaultConfig());
  }, 0);
};
Datafeeds.UDFCompatibleDatafeed.prototype.resolveSymbol = function(symbolName, onSymbolResolvedCallback, onResolveErrorCallback) {
  setTimeout(function() {
    onSymbolResolvedCallback({
      "name": symbolName,
      "exchange-traded": "",
      "exchange-listed": "",
      "timezone": "Asia/Shanghai",
      "minmov": 1,
      "minmov2": 0,
      "pointvalue": 1,
      "session": "24x7",
      "has_intraday": true,
      "has_no_volume": true,
      "type": "bitcoin",
      "supported_resolutions": [
        "1",
        "3",
        "5",
        "15",
        "30",
        "60",
        "120",
        "240",
        "360",
        "480",
        "720",
        "1440",
        "4320",
        "10080",
        "43200",
        "129600",
        "259200",
        "518400"
      ],
      "has_weekly_and_monthly": true,
      "has_daily": true,
      "pricescale": getDecimal(),
      "ticker": symbolName,
      "exchange": "",
      "data_status": "streaming"
    });
  }, 0);
};
Datafeeds.UDFCompatibleDatafeed.prototype.getBars = function(symbolInfo, resolution, periodParams, onHistoryCallback, onErrorCallback) {
  const { countBack, firstDataRequest, to } = periodParams;
  if (to < 0) {
    return onHistoryCallback([], { noData: true });
  }
  let symbol = "BTCUSDT";
  if (baseMarketStore.getState().currentCoin.tradeId) {
    symbol = baseMarketStore.getState().currentCoin.symbolName;
  }
  let time = "1m";
  switch (resolution) {
    case "1":
    case "3":
    case "5":
    case "15":
    case "30":
      time = `${resolution}m`;
      break;
    case "60":
      time = `${1}h`;
      break;
    case "120":
      time = `${2}h`;
      break;
    case "240":
      time = `${4}h`;
      break;
    case "360":
      time = `${6}h`;
      break;
    case "480":
      time = `${8}h`;
      break;
    case "720":
      time = `${12}h`;
      break;
    case "1440":
      time = `${1}d`;
      break;
    case "4320":
      time = `${3}d`;
      break;
    case "10080":
      time = `${1}w`;
      break;
    case "43200":
      time = `${1}M`;
      break;
    case "129600":
      time = `${3}M`;
      break;
    case "259200":
      time = `${6}M`;
      break;
    case "518400":
      time = `${1}y`;
      break;
    default:
      time = `${resolution}m`;
  }
  let params = {
    symbol,
    interval: time,
    limit: String(24 * 60),
    endTime: firstDataRequest ? void 0 : to * 1e3
  };
  getKlineHistory(params).then((res) => {
    var _a, _b;
    if (res.isOk) {
      const klineData = [];
      if ((_b = (_a = res.data) == null ? void 0 : _a.list) == null ? void 0 : _b.length) {
        res.data.list.forEach((item) => {
          const barValue = {
            time: Number(item[6]),
            open: Number(item[0]),
            high: Number(item[1]) < Number(item[0]) ? Number(item[0]) : Number(item[1]),
            low: Number(item[2]) > Number(item[3]) ? Number(item[3]) : Number(item[2]),
            close: Number(item[3]),
            volume: Number(item[4]),
            quoteVolume: Number(item[5])
          };
          klineData.push(barValue);
        });
        const _klineData = sortMarketChartData(klineData) || [];
        let meta = {
          noData: !(klineData.length > 0)
        };
        if (_klineData == null ? void 0 : _klineData.length) {
          onHistoryCallback(_klineData);
        }
        if (firstDataRequest) {
          baseMarketStore.getState().updateCoinHistoryKline({
            r: time,
            t: new Date().getTime()
          });
        }
      } else {
        onHistoryCallback([], { noData: true });
      }
    }
  }).catch((err) => {
    console.log("tradingview error", err);
    onHistoryCallback([], { noData: true });
  });
};
Datafeeds.UDFCompatibleDatafeed.prototype.subscribeBars = function(symbolInfo, resolution, onRealtimeCallback, listenerGUID, onResetCacheNeededCallback) {
  baseMarketStore.getState().updateKlineCallback(onRealtimeCallback);
};
Datafeeds.UDFCompatibleDatafeed.prototype.unsubscribeBars = function(listenerGUID) {
  baseMarketStore.getState().updateKlineCallback(null);
};
Datafeeds.UDFCompatibleDatafeed.prototype.getServerTime = function(callback) {
  let timestamp = new Date().getTime();
  callback(timestamp);
};
var coin_datafeed_default = Datafeeds;

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/k-line/tradingview.tsx
import "/Users/xiaoyu/Desktop/xiangmu/newbit-web/node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/k-line/index.css";
function Tradingview(props, ref) {
  const { resolution, colors } = props;
  const currentCoinPair = getCurrentQuoteShowCoin(props.currentCoin.sellSymbol, props.currentCoin.buySymbol);
  const [widget, setWidget] = (0, import_react6.useState)(null);
  const widgetRef = (0, import_react6.useRef)(widget);
  const entityIdRef = (0, import_react6.useRef)();
  const kLineCallback = (data) => {
    if (data == null ? void 0 : data.length) {
      props.klineCallback({
        ...data[0],
        time: Number(data[0].time),
        open: Number(data[0].open),
        close: Number(data[0].close),
        volume: Number(data[0].volume),
        quoteVolume: Number(data[0].quoteVolume),
        high: data[0].high < data[0].open ? data[0].open : data[0].high,
        low: data[0].low > data[0].close ? data[0].close : data[0].low
      });
    }
  };
  const subs = {
    biz: props.type === KLineChartType.Quote ? "spot" : "perpetual",
    type: props.type === KLineChartType.Quote ? "kline" : "perpetual_kline",
    base: props.currentCoin.baseSymbolName,
    quote: props.currentCoin.quoteSymbolName,
    contractCode: props.currentCoin.symbolWassName
  };
  (0, import_react6.useEffect)(() => {
    props.ws.unsubscribe({
      subs,
      callback: kLineCallback
    });
  }, [props.currentCoin.symbolName]);
  (0, import_react6.useEffect)(() => {
    if (props.coinHistoryKline.r && props.klineCallback && props.currentChart === "tradingview") {
      props.ws.subscribe({
        subs,
        callback: kLineCallback,
        throttleType: WSThrottleTypeEnum.cover,
        throttleTime: 500
      });
    }
    return () => {
      props.ws.unsubscribe({
        subs,
        callback: kLineCallback
      });
    };
  }, [props.coinHistoryKline, props.klineCallback, props.currentChart]);
  let styleColor = props.createChart.bgColor;
  let wgColor = props.createChart.bgColor;
  let upColor = props.createChart.upColor;
  let downColor = props.createChart.downColor;
  let textColor = props.createChart.textColor;
  (0, import_react6.useEffect)(() => {
    var _a, _b;
    const _widget = new o2({
      width: "100%",
      height: "100%",
      symbol: currentCoinPair,
      interval: tradingviewTimeMap[`${props.curTime.value}${props.curTime.unit}`],
      container: "tv_chart_container",
      datafeed: new coin_datafeed_default.UDFCompatibleDatafeed(props.baseMarketStore, props.getKlineHistory),
      library_path: `${location.origin}/charting_library/`,
      locale: LanguageMapToChartMap[props.locale] || "en",
      disabled_features: [
        "header_widget",
        "display_market_status",
        "pane_context_menu",
        "timeframes_toolbar",
        "go_to_date",
        "header_indicators",
        "header_settings",
        "use_localstorage_for_settings",
        "volume_force_overlay"
      ],
      enabled_features: ["study_templates"],
      charts_storage_api_version: "1.1",
      client_id: "tradingview.com",
      user_id: "public_id",
      theme: ThemeChartMap[props.theme] || "Light",
      custom_css_url: "./css/style.css",
      time_scale: {
        min_bar_spacing: 5
      },
      timezone: "Asia/Shanghai",
      loading_screen: { backgroundColor: styleColor, foregroundColor: styleColor },
      overrides: {
        "paneProperties.background": styleColor,
        "paneProperties.backgroundGradientStartColor": styleColor,
        "paneProperties.backgroundGradientEndColor": styleColor,
        "mainSeriesProperties.style": 1,
        "mainSeriesProperties.candleStyle.upColor": upColor,
        "mainSeriesProperties.candleStyle.downColor": downColor,
        "mainSeriesProperties.candleStyle.drawWick": true,
        "mainSeriesProperties.candleStyle.drawBorder": true,
        "mainSeriesProperties.candleStyle.borderUpColor": upColor,
        "mainSeriesProperties.candleStyle.borderDownColor": downColor,
        "mainSeriesProperties.candleStyle.wickUpColor": upColor,
        "mainSeriesProperties.candleStyle.wickDownColor": downColor,
        "paneProperties.bottomMargin": 5
      },
      studies_overrides: {
        "volume.volume.color.1": props.createChart.upColor,
        "volume.volume.color.0": props.createChart.downColor,
        "volume.volume.transparency": 50
      },
      time_frames: []
    });
    setWidget(_widget);
    widgetRef.current = _widget;
    (_b = (_a = widgetRef.current).onChartReady) == null ? void 0 : _b.call(_a, () => {
      widgetRef.current.chart().createStudy("Moving Average", false, false, [5, "close", 0], { "plot.color.0": "#7F4E86" });
      widgetRef.current.chart().createStudy("Moving Average", false, false, [10, "close", 0], { "plot.color.0": "#ECC581" });
      widgetRef.current.chart().createStudy("Moving Average", false, false, [20, "close", 0], { "plot.color.0": "#D057E4" });
      widgetRef.current.chart().createStudy("Moving Average", false, false, [60, "close", 0], { "plot.color.0": "#6F92EE" });
      entityIdRef.current = widgetRef.current.chart().createStudy("Volume", false, false);
    });
  }, []);
  const applyOverrides = () => {
    widgetRef.current.applyOverrides({
      "paneProperties.background": styleColor,
      "paneProperties.backgroundGradientStartColor": styleColor,
      "paneProperties.backgroundGradientEndColor": styleColor,
      "mainSeriesProperties.style": 1,
      "mainSeriesProperties.candleStyle.upColor": upColor,
      "mainSeriesProperties.candleStyle.downColor": downColor,
      "mainSeriesProperties.candleStyle.drawWick": true,
      "mainSeriesProperties.candleStyle.drawBorder": true,
      "mainSeriesProperties.candleStyle.borderUpColor": upColor,
      "mainSeriesProperties.candleStyle.borderDownColor": downColor,
      "mainSeriesProperties.candleStyle.wickUpColor": upColor,
      "mainSeriesProperties.candleStyle.wickDownColor": downColor,
      "paneProperties.bottomMargin": 5
    });
  };
  (0, import_react6.useEffect)(() => {
    var _a, _b;
    if (widgetRef.current) {
      (_b = (_a = widgetRef.current).onChartReady) == null ? void 0 : _b.call(_a, () => {
        if (props.curTime.unit === "time") {
          widgetRef.current.applyOverrides({
            "mainSeriesProperties.style": 2,
            "mainSeriesProperties.lineStyle.color": upColor
          });
        } else {
          widgetRef.current.applyOverrides({
            "mainSeriesProperties.style": 1
          });
        }
      });
    }
  }, [props.curTime]);
  (0, import_react6.useEffect)(() => {
    var _a, _b;
    let timer;
    if (widgetRef.current) {
      (_b = (_a = widgetRef.current).onChartReady) == null ? void 0 : _b.call(_a, () => {
        widgetRef.current.changeTheme(ThemeChartMap[props.theme]);
        timer = setTimeout(() => {
          applyOverrides();
        });
      });
    }
    return () => {
      clearTimeout(timer);
    };
  }, [props.theme, colors]);
  (0, import_react6.useEffect)(() => {
    var _a, _b;
    (_b = (_a = widgetRef.current) == null ? void 0 : _a.onChartReady) == null ? void 0 : _b.call(_a, () => {
      entityIdRef.current.then((res) => {
        widgetRef.current.activeChart().removeEntity(res);
        entityIdRef.current = widgetRef.current.chart().createStudy("Volume", false, false);
        widgetRef.current.applyStudiesOverrides({
          "volume.volume.color.1": props.createChart.upColor,
          "volume.volume.color.0": props.createChart.downColor,
          "volume.volume.transparency": 50
        });
      });
    });
  }, [colors]);
  (0, import_react6.useEffect)(() => {
    var _a, _b;
    let timer;
    if (widgetRef.current && resolution && currentCoinPair) {
      (_b = (_a = widgetRef.current).onChartReady) == null ? void 0 : _b.call(_a, () => {
        widgetRef.current.setSymbol(currentCoinPair, resolution, () => null);
        timer = setTimeout(() => {
          applyOverrides();
        });
      });
    }
    return () => {
      clearTimeout(timer);
    };
  }, [resolution]);
  (0, import_react6.useImperativeHandle)(ref, () => ({
    chartProperties: () => {
      var _a, _b;
      if (widgetRef.current) {
        (_b = (_a = widgetRef.current).onChartReady) == null ? void 0 : _b.call(_a, () => {
          var _a2, _b2, _c, _d;
          (_d = (_c = (_b2 = (_a2 = widgetRef.current).chart) == null ? void 0 : _b2.call(_a2)) == null ? void 0 : _c.executeActionById) == null ? void 0 : _d.call(_c, "chartProperties");
          return true;
        });
      }
      return false;
    },
    insertIndicator: () => {
      var _a, _b;
      if (widgetRef.current) {
        (_b = (_a = widgetRef.current).onChartReady) == null ? void 0 : _b.call(_a, () => {
          var _a2, _b2, _c, _d;
          (_d = (_c = (_b2 = (_a2 = widgetRef.current).chart) == null ? void 0 : _b2.call(_a2)) == null ? void 0 : _c.executeActionById) == null ? void 0 : _d.call(_c, "insertIndicator");
          return true;
        });
      }
      return false;
    }
  }));
  return import_react6.default.createElement("div", { style: { background: styleColor }, className: "rel-chart", id: "tv_chart_container" });
}
var tradingview_default = (0, import_react6.forwardRef)(Tradingview);

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/series/index.tsx
var import_react8 = __toESM(require_react());
import "/Users/xiaoyu/Desktop/xiangmu/newbit-web/node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/series/index.css";

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/series/series-chart.tsx
var import_dayjs2 = __toESM(require_dayjs_min());
var import_react7 = __toESM(require_react());
function SeriesChart(props) {
  const lineRef = (0, import_react7.useRef)(null);
  const chartRef = (0, import_react7.useRef)(null);
  const chartLineRef = (0, import_react7.useRef)();
  const { priceOffset, colors } = props;
  (0, import_react7.useEffect)(() => {
    if (chartRef.current) {
      chartRef.current.setData(props.data);
    }
  }, [props.data]);
  const colorRef = (0, import_react7.useRef)(props.createChart);
  (0, import_react7.useEffect)(() => {
    colorRef.current = props.createChart;
  }, [props.createChart]);
  const chartPriceLineProperty = {
    crosshairMarkerVisible: false,
    baseLineVisible: false,
    priceLineVisible: false,
    lastValueVisible: false
  };
  const gridColor = props.theme === ThemeEnum.light ? "rgba(0,0,0,0.02)" : "rgba(255,255,255,0.02)";
  const chartPropertySetting = {
    layout: props.chartLayoutOptions,
    localization: {
      timeFormatter: (item) => {
        return (0, import_dayjs2.default)(item).format("YYYY/MM/DD HH:mm");
      },
      priceFormatter: (item) => {
        return `${item.toFixed(3)}%`;
      }
    },
    crosshair: {
      mode: ot.Normal
    },
    timeScale: {
      barSpacing: 40,
      tickMarkFormatter: (time) => {
        return (0, import_dayjs2.default)(time).format("MM-DD");
      },
      borderColor: gridColor,
      lockVisibleTimeRangeOnResize: true
    },
    rightPriceScale: {
      borderColor: gridColor,
      autoScale: true
    },
    grid: {
      vertLines: {
        color: gridColor
      },
      horzLines: {
        color: gridColor
      }
    }
  };
  (0, import_react7.useEffect)(() => {
    var _a;
    (_a = chartLineRef.current) == null ? void 0 : _a.applyOptions({
      ...chartPropertySetting,
      layout: {
        ...props.chartLayoutOptions
      },
      grid: {
        vertLines: {
          color: gridColor
        },
        horzLines: {
          color: gridColor
        }
      },
      rightPriceScale: {
        ...chartPropertySetting.rightPriceScale
      }
    });
  }, [props.chartLayoutOptions.background, props.chartLayoutOptions.textColor]);
  const floatTooltip = (0, import_react7.useRef)(null);
  (0, import_react7.useEffect)(() => {
    if (floatTooltip.current) {
      floatTooltip.current.style.background = props.createChart.cardBgColor;
      floatTooltip.current.style.color = props.createChart.textColor01;
    }
  }, [props.createChart.cardBgColor, props.createChart.textColor]);
  (0, import_react7.useEffect)(() => {
    var _a, _b;
    chartLineRef.current = Pe(document.getElementById("chart"), chartPropertySetting);
    chartRef.current = chartLineRef.current.addLineSeries({
      color: (_a = props == null ? void 0 : props.createChart) == null ? void 0 : _a.brandColor,
      lineWidth: 1,
      lineStyle: d.Solid,
      lineType: 2,
      ...chartPriceLineProperty
    });
    chartRef.current.setData(props.data);
    chartLineRef.current.timeScale().fitContent();
    let toolTipWidth = 100;
    let toolTipHeight = 40;
    let toolTipMargin = 15;
    let toolTip = document.createElement("div");
    floatTooltip.current = toolTip;
    toolTip.className = "series-floating-tooltip";
    toolTip.style.color = colorRef.current.textColor01;
    toolTip.style.background = colorRef.current.cardBgColor03;
    (_b = document.getElementById("chart")) == null ? void 0 : _b.appendChild(toolTip);
    chartLineRef.current.subscribeCrosshairMove(function(param) {
      var _a2, _b2;
      if (!param.time || param.point.x < 0 || param.point.x > lineRef.current.clientWidth || param.point.y < 0 || param.point.y > lineRef.current.clientHeight) {
        toolTip.style.display = "none";
        return;
      }
      let dateStr = (0, import_dayjs2.default)(param.time).format("MM-DD HH:MM");
      toolTip.style.display = "block";
      let price = (_b2 = (_a2 = param.seriesData) == null ? void 0 : _a2.get(chartRef.current)) == null ? void 0 : _b2.value;
      toolTip.innerHTML = `<div>${dateStr}</div>${'<div style="marginTop: 4px">'}${price}%</div>`;
      let y2 = param.point.y;
      let left = param.point.x + toolTipMargin;
      if (left > lineRef.current.clientWidth - toolTipWidth) {
        left = param.point.x - toolTipMargin - toolTipWidth;
      }
      let top = 20;
      toolTip.style.left = `${left}px`;
      toolTip.style.top = `${top}px`;
    });
  }, []);
  return import_react7.default.createElement("div", { ref: lineRef, className: "chart", id: "chart" });
}
SeriesChart.displayName = "Series";
var series_chart_default = SeriesChart;

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/series/index.tsx
function Series(props) {
  const {
    bgColor,
    textColor,
    textColor01,
    brandColor,
    upColor,
    downColor,
    upLightColor,
    downLightColor,
    cardBgColor,
    cardBgColor03
  } = getTheme();
  const [chartLayoutOptions, setChartLayoutOptions] = (0, import_react8.useState)({
    background: {
      color: bgColor
    },
    textColor
  });
  const { priceOffset } = props.offset;
  (0, import_react8.useEffect)(() => {
    const _bgColor = getTheme().bgColor;
    const _textColor = getTheme().textColor;
    setChartLayoutOptions({
      background: {
        color: _bgColor
      },
      textColor: _textColor
    });
  }, [props.theme]);
  return import_react8.default.createElement("div", { className: "series-chart-wrap" }, import_react8.default.createElement("div", { className: "chart-wrap" }, import_react8.default.createElement(
    series_chart_default,
    {
      chartLayoutOptions,
      data: props.seriesData,
      theme: props.theme,
      priceOffset,
      colors: props.colors,
      createChart: {
        brandColor,
        upColor,
        downColor,
        upLightColor,
        downLightColor,
        bgColor,
        textColor,
        cardBgColor,
        textColor01,
        cardBgColor03
      }
    }
  )));
}
var series_default = (0, import_react8.memo)(Series);

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/dept/index.tsx
var import_react11 = __toESM(require_react());
import "/Users/xiaoyu/Desktop/xiangmu/newbit-web/node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/dept/index.css";

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/dept/dept-chart.tsx
var import_react9 = __toESM(require_react());
function DeptChart(props) {
  const deptRef = (0, import_react9.useRef)(null);
  const chartRef = (0, import_react9.useRef)(null);
  (0, import_react9.useEffect)(() => {
    var _a, _b;
    const chart = Pe(document.getElementById("chart"), {
      layout: props.chartLayoutOptions,
      timeScale: {
        visible: false
      },
      rightPriceScale: {
        visible: false
      },
      crosshair: {
        horzLine: {
          visible: false,
          labelVisible: false
        },
        vertLine: {
          visible: false,
          labelVisible: false
        }
      },
      grid: {
        vertLines: {
          visible: false
        },
        horzLines: {
          visible: false
        }
      }
    });
    const front = ((_a = props.data[props.data.length - 1]) == null ? void 0 : _a.value) || 0;
    const end = ((_b = props.data[props.data.length - 2]) == null ? void 0 : _b.value) || 0;
    const isUp = front - end > 0;
    chartRef.current = chart.addAreaSeries({
      lineColor: isUp ? props.createChart.upColor : props.createChart.downColor,
      topColor: isUp ? props.createChart.upColor : props.createChart.downColor,
      bottomColor: isUp ? props.createChart.upLightColor : props.createChart.downLightColor,
      crosshairMarkerVisible: false,
      priceLineVisible: false
    });
    chartRef.current.setData(props.data);
    chart.timeScale().fitContent();
  }, []);
  return import_react9.default.createElement("div", { ref: deptRef, className: "chart", id: "chart" });
}
DeptChart.displayName = "deptChart";
var dept_chart_default = DeptChart;

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/dept/dept-real-chart.tsx
var import_react10 = __toESM(require_react());
function DeptRealChart(props) {
  var _a;
  const { priceOffset, colors } = props;
  const leftDeptRef = (0, import_react10.useRef)(null);
  const centerDeptRef = (0, import_react10.useRef)(null);
  const rightDeptRef = (0, import_react10.useRef)(null);
  const deptRef = (0, import_react10.useRef)(null);
  const chartRef = (0, import_react10.useRef)(null);
  const floatTooltip = (0, import_react10.useRef)(null);
  const gridColor = props.theme === ThemeEnum.light ? "rgba(0,0,0,0.02)" : "rgba(255,255,255,0.02)";
  const leftDataRef = (0, import_react10.useRef)([]);
  const rightDataRef = (0, import_react10.useRef)([]);
  const [centerVerLine, setCenterVerLine] = (0, import_react10.useState)({
    x: 0
  });
  const colorRef = (0, import_react10.useRef)(props.createChart);
  (0, import_react10.useEffect)(() => {
    colorRef.current = props.createChart;
  }, [props.createChart]);
  const chartPriceLineProperty = {
    crosshairMarkerVisible: false,
    baseLineVisible: false,
    priceLineVisible: false,
    lastValueVisible: false
  };
  const chartPropertySetting = {
    layout: props.chartLayoutOptions,
    localization: {
      timeFormatter: (item) => {
        return item;
      }
    },
    timeScale: {
      borderColor: gridColor,
      barSpacing: 6,
      tickMarkFormatter: (time) => {
        return time.toFixed(priceOffset);
      }
    },
    rightPriceScale: {
      borderColor: gridColor
    }
  };
  (0, import_react10.useEffect)(() => {
    var _a2;
    (_a2 = chartRef.current) == null ? void 0 : _a2.applyOptions({
      layout: props.chartLayoutOptions,
      grid: {
        vertLines: {
          color: gridColor
        },
        horzLines: {
          color: gridColor
        }
      }
    });
  }, [props.chartLayoutOptions.background, props.chartLayoutOptions.textColor]);
  (0, import_react10.useEffect)(() => {
    if (floatTooltip.current) {
      floatTooltip.current.style.background = props.createChart.cardBgColor03;
      floatTooltip.current.style.color = props.createChart.textColor01;
    }
  }, [props.createChart.cardBgColor03, props.createChart.textColor01]);
  const setVerLineChart = () => {
    var _a2, _b;
    if (!((_a2 = leftDataRef.current) == null ? void 0 : _a2.length) && !((_b = rightDataRef.current) == null ? void 0 : _b.length)) {
      return;
    }
    requestAnimationFrame(() => {
      var _a3, _b2, _c, _d;
      const verPoint = {
        x: 0
      };
      const leftX = ((_b2 = chartRef.current) == null ? void 0 : _b2.timeScale().timeToCoordinate((_a3 = leftDataRef.current[leftDataRef.current.length - 1]) == null ? void 0 : _a3.time)) || 0;
      const rightX = ((_d = chartRef.current) == null ? void 0 : _d.timeScale().timeToCoordinate((_c = rightDataRef.current[0]) == null ? void 0 : _c.time)) || 0;
      verPoint.x = leftX + (rightX - leftX) / 2;
      setCenterVerLine(verPoint);
    });
  };
  const dealData = (data) => {
    var _a2, _b, _c;
    const leftData = [];
    const rightData = [];
    data.forEach((item) => {
      if (item.direction === "buy" /* Buy */) {
        leftData.push(item);
      }
      if (item.direction === "sell" /* Sell */) {
        rightData.push(item);
      }
    });
    (_a2 = leftDeptRef.current) == null ? void 0 : _a2.setData(leftData);
    (_b = rightDeptRef.current) == null ? void 0 : _b.setData(rightData);
    leftDataRef.current = leftData;
    rightDataRef.current = rightData;
    setVerLineChart();
    (_c = chartRef.current) == null ? void 0 : _c.timeScale().fitContent();
  };
  (0, import_react10.useEffect)(() => {
    var _a2;
    if (!((_a2 = props.data) == null ? void 0 : _a2.length) || !leftDeptRef.current || !rightDeptRef.current || !chartRef.current) {
      return;
    }
    dealData(props.data);
  }, [props.data]);
  (0, import_react10.useEffect)(() => {
    var _a2;
    chartRef.current = Pe(document.getElementById("chart"), chartPropertySetting);
    leftDeptRef.current = chartRef.current.addAreaSeries({
      lineColor: props.createChart.upColor,
      topColor: "rgba(80, 177, 108, 0.35)",
      bottomColor: "rgba(80, 177, 108, 0.05)",
      lineWidth: 1,
      ...chartPriceLineProperty
    });
    centerDeptRef.current = chartRef.current.addLineSeries({
      color: "#ff0000",
      lineWidth: 1,
      lineStyle: d.Solid,
      lineType: 2,
      ...chartPriceLineProperty
    });
    rightDeptRef.current = chartRef.current.addAreaSeries({
      lineColor: props.createChart.downColor,
      topColor: "rgba(233, 90, 92, 0.35)",
      bottomColor: "rgba(233, 90, 92, 0.05)",
      lineWidth: 1,
      ...chartPriceLineProperty
    });
    let toolTipWidth = 100;
    let toolTipHeight = 80;
    let toolTipMargin = 15;
    let toolTip = document.createElement("div");
    floatTooltip.current = toolTip;
    toolTip.className = `dept-floating-tooltip`;
    toolTip.style.color = colorRef.current.textColor01;
    toolTip.style.background = colorRef.current.cardBgColor03;
    (_a2 = document.getElementById("chart")) == null ? void 0 : _a2.appendChild(toolTip);
    const subscribeTimeChange = (newVisibleTimeRange) => {
      var _a3, _b;
      if ((_b = (_a3 = chartRef.current) == null ? void 0 : _a3.timeScale().getVisibleRange()) == null ? void 0 : _b.from) {
        setVerLineChart();
      }
    };
    chartRef.current.timeScale().subscribeVisibleTimeRangeChange(subscribeTimeChange);
    chartRef.current.subscribeCrosshairMove(function(param) {
      var _a3, _b, _c, _d, _e2, _f, _g, _h, _i2, _j, _k, _l, _m;
      if (!param.time || param.point.x < 0 || param.point.x > (((_a3 = deptRef == null ? void 0 : deptRef.current) == null ? void 0 : _a3.clientWidth) || 0) || param.point.y < 0 || param.point.y > (((_b = deptRef == null ? void 0 : deptRef.current) == null ? void 0 : _b.clientHeight) || 0)) {
        toolTip.style.display = "none";
        return;
      }
      let dateStr = param.time;
      toolTip.style.display = "block";
      toolTip.style.color = colorRef.current.textColor01;
      let leftCount = (_d = (_c = param.seriesData) == null ? void 0 : _c.get(leftDeptRef.current)) == null ? void 0 : _d.value;
      let rightCount = (_f = (_e2 = param.seriesData) == null ? void 0 : _e2.get(rightDeptRef.current)) == null ? void 0 : _f.value;
      let chgTemp = 0;
      let chg = `${chgTemp.toFixed(priceOffset || 2)}%`;
      let dir = dateStr >= ((_h = (_g = rightDataRef.current) == null ? void 0 : _g[0]) == null ? void 0 : _h.value) ? "sell" /* Sell */ : "buy" /* Buy */;
      let symbol = dateStr >= ((_j = (_i2 = rightDataRef.current) == null ? void 0 : _i2[0]) == null ? void 0 : _j.value) ? "+" : "-";
      const newData = (_k = leftDataRef.current) == null ? void 0 : _k.concat(rightDataRef.current || []);
      newData == null ? void 0 : newData.forEach((item) => {
        symbol = item.direction === "buy" /* Buy */ ? "-" : "+";
        if (item.time === dateStr) {
          chg = `${symbol}${item.chg.toFixed(priceOffset || 2)}%`;
          dir = item.direction;
        }
      });
      toolTip.innerHTML = `<div style="display: flex; justify-content: space-between; min-width: 120px;"><span>\u4EF7\u5DEE\u5E45\u5EA6</span><span style="color: ${dir === "buy" /* Buy */ ? colorRef.current.upColor : colorRef.current.downColor}">${chg}</span></div><div style="display: flex; justify-content: space-between; min-width: 120px; margin-top: 16px; color: ${colorRef.current.textColor01}"><span>\u59D4\u6258\u4EF7\u683C</span><span>${dateStr}</span></div><div style="display: flex; justify-content: space-between; min-width: 120px; margin-top: 16px; color: ${colorRef.current.textColor01}"><span>\u7D2F\u8BA1\u6302\u5355</span><span>${leftCount || rightCount}</span></div>`;
      let y2 = param.point.y;
      let left = param.point.x + toolTipMargin;
      if (left > (((_l = deptRef == null ? void 0 : deptRef.current) == null ? void 0 : _l.clientWidth) || 0) - toolTipWidth) {
        left = param.point.x - toolTipMargin - toolTipWidth;
      }
      let top = y2 + toolTipMargin;
      if (top > (((_m = deptRef == null ? void 0 : deptRef.current) == null ? void 0 : _m.clientHeight) || 0) - toolTipHeight) {
        top = y2 - toolTipHeight - toolTipMargin;
      }
      toolTip.style.left = `${left}px`;
      toolTip.style.top = `${top}px`;
    });
  }, []);
  (0, import_react10.useEffect)(() => {
    const handleResize = () => {
      var _a2, _b, _c;
      (_c = chartRef.current) == null ? void 0 : _c.applyOptions({
        width: (_a2 = deptRef.current) == null ? void 0 : _a2.clientWidth,
        height: (_b = deptRef.current) == null ? void 0 : _b.clientHeight
      });
    };
    window.addEventListener("resize", handleResize);
    return () => {
      window.removeEventListener("resize", handleResize);
    };
  }, []);
  (0, import_react10.useEffect)(() => {
    if (leftDeptRef.current && rightDeptRef.current) {
      if (colors === 1 /* greenUpRedDown */) {
        leftDeptRef.current.applyOptions({
          lineColor: props.createChart.upColor,
          topColor: "rgba(80, 177, 108, 0.35)",
          bottomColor: "rgba(80, 177, 108, 0.05)"
        });
        rightDeptRef.current.applyOptions({
          lineColor: props.createChart.downColor,
          topColor: "rgba(233, 90, 92, 0.35)",
          bottomColor: "rgba(233, 90, 92, 0.05)"
        });
      } else {
        leftDeptRef.current.applyOptions({
          lineColor: props.createChart.upColor,
          topColor: "rgba(233, 90, 92, 0.35)",
          bottomColor: "rgba(233, 90, 92, 0.05)"
        });
        rightDeptRef.current.applyOptions({
          lineColor: props.createChart.downColor,
          topColor: "rgba(80, 177, 108, 0.35)",
          bottomColor: "rgba(80, 177, 108, 0.05)"
        });
      }
    }
  }, [colors]);
  return import_react10.default.createElement("div", { ref: deptRef, className: "chart", id: "chart" }, import_react10.default.createElement(
    "div",
    {
      className: "center-ver-line",
      style: {
        width: "1px",
        height: (((_a = deptRef.current) == null ? void 0 : _a.clientHeight) || 0) - 26,
        top: 0,
        left: centerVerLine.x,
        background: props.chartLayoutOptions.textColor,
        opacity: 0.5
      }
    }
  ));
}
DeptRealChart.displayName = "deptChart";
var dept_real_chart_default = DeptRealChart;

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/components/dept/index.tsx
function Dept(props) {
  const {
    bgColor,
    textColor,
    textColor01,
    cardBgColor03,
    brandColor,
    upColor,
    downColor,
    upLightColor,
    downLightColor,
    cardBgColor
  } = getTheme();
  const [chartLayoutOptions, setChartLayoutOptions] = (0, import_react11.useState)({
    background: {
      color: bgColor
    },
    textColor
  });
  (0, import_react11.useEffect)(() => {
    const _bgColor = getTheme().bgColor;
    const _textColor = getTheme().textColor;
    setChartLayoutOptions({
      background: {
        color: _bgColor
      },
      textColor: _textColor
    });
  }, [props.theme]);
  const { priceOffset } = props.offset;
  const { colors, xCoordinateData } = props;
  return import_react11.default.createElement("div", { className: "dept-chart-wrap" }, import_react11.default.createElement("div", { className: "dept-chart" }, props.type === DeptChartSpecieEnum.Dept ? import_react11.default.createElement(
    dept_chart_default,
    {
      chartLayoutOptions,
      data: props.deptData,
      createChart: { brandColor, upColor, downColor, upLightColor, downLightColor }
    }
  ) : import_react11.default.createElement(
    dept_real_chart_default,
    {
      chartLayoutOptions,
      data: props.deptData,
      theme: props.theme,
      priceOffset,
      createChart: {
        brandColor,
        upColor,
        downColor,
        upLightColor,
        downLightColor,
        bgColor,
        textColor,
        cardBgColor,
        textColor01,
        cardBgColor03
      },
      colors
    }
  )));
}
var dept_default = (0, import_react11.memo)(Dept);

// node_modules/.pnpm/@nbit+chart-web@1.0.0-beta.109/node_modules/@nbit/chart-web/src/index.ts
var src_default = series_default;
export {
  dept_default as Dept,
  k_line_chart_default as KLineChart,
  series_default as Series,
  tradingview_default as TradingView,
  src_default as default
};
/*!
 * @license
 * TradingView Lightweight Charts™ v0.0.11-dev+202310111213
 * Copyright (c) 2023 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
//# sourceMappingURL=@nbit_chart-web.js.map
