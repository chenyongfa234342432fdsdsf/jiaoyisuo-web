"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.setLoaders = exports.loadBuild = void 0;
const utils_1 = require("../../utils");
const loadBuild_1 = require("@brillout/vite-plugin-import-build/loadBuild");
const buildGetters = (globalThis.__vite_plugin_ssr__buildGetters = globalThis.__vite_plugin_ssr__buildGetters || {
    getters: null
});
function setLoaders(getters) {
    buildGetters.getters = getters;
}
exports.setLoaders = setLoaders;
async function loadBuild() {
    if (!buildGetters.getters) {
        const { success, entryFile } = await (0, loadBuild_1.loadBuild)();
        (0, utils_1.assertUsage)(success, `Cannot find production build. Did you to run \`$ vite build\`? If you did, then you may need to use \`${loadBuild_1.importBuildFileName}\`, see https://vite-plugin-ssr.com/importBuild.cjs`);
        (0, utils_1.assert)(buildGetters.getters, { entryFile });
    }
    const [pageFiles, clientManifest, pluginManifest] = await Promise.all([
        buildGetters.getters.pageFiles(),
        buildGetters.getters.clientManifest(),
        buildGetters.getters.pluginManifest()
    ]);
    const buildEntries = { pageFiles, clientManifest, pluginManifest };
    return buildEntries;
}
exports.loadBuild = loadBuild;
